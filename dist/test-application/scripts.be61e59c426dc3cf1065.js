!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,(function(){"use strict";var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)},e=function(){return(e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function n(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function r(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function i(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=i(t[n],e[n]));return t}var o=(a.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},a);function a(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}var s,u,c,h=(c=Error,t(s=p,u=c),s.prototype=null===u?Object.create(u):(l.prototype=u.prototype,new l),p);function l(){this.constructor=s}function p(t,e){var n=c.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,p.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,f.prototype.create),n}var f=(d.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(y,(function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"}))}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new h(i,s),c=0,l=Object.keys(r);c<l.length;c++){var p=l[c];"_"!==p.slice(-1)&&(p in u&&console.warn('Overwriting FirebaseError base field "'+p+'" can cause unexpected behavior.'),u[p]=r[p])}return u},d);function d(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var y=/\{\$([^}]+)}/g;function v(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function g(t,e){var n=new m(t,e);return n.subscribe.bind(n)}var m=(_.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},_.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},_.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},_.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=b),void 0===r.error&&(r.error=b),void 0===r.complete&&(r.complete=b);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}})),this.observers.push(r),o},_.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},_.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},_.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},_.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},_);function _(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}function b(){}var w=(E.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},E.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},E.prototype.setServiceProps=function(t){return this.serviceProps=t,this},E);function E(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var T="[DEFAULT]",C=(S.prototype.get=function(t){void 0===t&&(t=T);var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new o;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},S.prototype.getImmediate=function(t){var n=e({identifier:T,optional:!1},t),r=n.optional,i=this.normalizeInstanceIdentifier(n.identifier);try{var o=this.getOrInitializeService(i);if(o)return o;if(r)return null;throw Error("Service "+this.name+" is not available")}catch(t){if(r)return null;throw t}},S.prototype.getComponent=function(){return this.component},S.prototype.setComponent=function(t){var e,i;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(function(t){return"EAGER"===t.instantiationMode}(this.component=t))try{this.getOrInitializeService(T)}catch(t){}try{for(var o=n(this.instancesDeferred.entries()),a=o.next();!a.done;a=o.next()){var s=r(a.value,2),u=s[1],c=this.normalizeInstanceIdentifier(s[0]);try{var h=this.getOrInitializeService(c);u.resolve(h)}catch(t){}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}},S.prototype.clearInstance=function(t){void 0===t&&(t=T),this.instancesDeferred.delete(t),this.instances.delete(t)},S.prototype.delete=function(){return function(t,e,n,r){return new(n=n||Promise)((function(e,i){function o(t){try{s(r.next(t))}catch(t){i(t)}}function a(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?e(t.value):new n((function(e){e(t.value)})).then(o,a)}s((r=r.apply(t,[])).next())}))}(this,0,void 0,(function(){var t;return function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))];case 1:return e.sent(),[2]}}))}))},S.prototype.isComponentSet=function(){return null!=this.component},S.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return t===T?void 0:t}(t)),this.instances.set(t,e)),e||null},S.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:T:t},S);function S(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}var I,N,A=(D.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},D.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},D.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new C(t,this);return this.providers.set(t,e),e},D.prototype.getProviders=function(){return Array.from(this.providers.values())},D);function D(t){this.name=t,this.providers=new Map}function k(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function R(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case I.DEBUG:case I.VERBOSE:console.log.apply(console,k(["["+i+"]  "+t.name+":"],n));break;case I.INFO:console.info.apply(console,k(["["+i+"]  "+t.name+":"],n));break;case I.WARN:console.warn.apply(console,k(["["+i+"]  "+t.name+":"],n));break;case I.ERROR:console.error.apply(console,k(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}(N=I=I||{})[N.DEBUG=0]="DEBUG",N[N.VERBOSE=1]="VERBOSE",N[N.INFO=2]="INFO",N[N.WARN=3]="WARN",N[N.ERROR=4]="ERROR",N[N.SILENT=5]="SILENT";var P,O=I.INFO,x=(Object.defineProperty(L.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in I))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(L.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),L.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,k([this,I.DEBUG],t))},L.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,k([this,I.VERBOSE],t))},L.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,k([this,I.INFO],t))},L.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,k([this,I.WARN],t))},L.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,k([this,I.ERROR],t))},L);function L(t){this.name=t,this._logLevel=O,this._logHandler=R}var M,F=((P={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",P["bad-app-name"]="Illegal App name: '{$appName}",P["duplicate-app"]="Firebase App named '{$appName}' already exists",P["app-deleted"]="Firebase App named '{$appName}' already deleted",P["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",P),U=new f("app","Firebase",F),q="@firebase/app",V="[DEFAULT]",B=((M={})[q]="fire-core",M["@firebase/analytics"]="fire-analytics",M["@firebase/auth"]="fire-auth",M["@firebase/database"]="fire-rtdb",M["@firebase/functions"]="fire-fn",M["@firebase/installations"]="fire-iid",M["@firebase/messaging"]="fire-fcm",M["@firebase/performance"]="fire-perf",M["@firebase/remote-config"]="fire-rc",M["@firebase/storage"]="fire-gcs",M["@firebase/firestore"]="fire-fst",M["fire-js"]="fire-js",M["firebase-wrapper"]="fire-js-all",M),j=new x("@firebase/app"),W=(Object.defineProperty(Q.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),Q.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},Q.prototype._getService=function(t,e){return void 0===e&&(e=V),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},Q.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=V),this.container.getProvider(t).clearInstance(e)},Q.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){j.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},Q.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},Q.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw U.create("app-deleted",{appName:this.name_})},Q);function Q(t,e,r){var o,a,s=this;this.firebase_=r,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=function(t){return i(void 0,t)}(t),this.container=new A(e.name),this._addComponent(new w("app",(function(){return s}),"PUBLIC"));try{for(var u=n(this.firebase_.INTERNAL.components.values()),c=u.next();!c.done;c=u.next())this._addComponent(c.value)}catch(t){o={error:t}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}}W.prototype.name&&W.prototype.options||W.prototype.delete||console.log("dc");var K=function t(){var r=function(t){var e={},r=new Map,o={__esModule:!0,initializeApp:function(n,r){void 0===r&&(r={}),"object"==typeof r&&null!==r||(r={name:r});var i=r;void 0===i.name&&(i.name=V);var a=i.name;if("string"!=typeof a||!a)throw U.create("bad-app-name",{appName:String(a)});if(v(e,a))throw U.create("duplicate-app",{appName:a});var s=new t(n,i,o);return e[a]=s},app:a,registerVersion:function(t,e,n){var r,i=null!==(r=B[t])&&void 0!==r?r:t;n&&(i+="-"+n);var o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){var u=['Unable to register library "'+i+'" with version "'+e+'":'];return o&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&a&&u.push("and"),a&&u.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void j.warn(u.join(" "))}s(new w(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},apps:null,SDK_VERSION:"7.7.0",INTERNAL:{registerComponent:s,removeApp:function(t){delete e[t]},components:r,useAsService:function(t,e){return"serverAuth"!==e?e:null}}};function a(t){if(!v(e,t=t||V))throw U.create("no-app",{appName:t});return e[t]}function s(s){var u,c,h=s.name;if(r.has(h))return j.debug("There were multiple attempts to register component "+h+"."),"PUBLIC"===s.type?o[h]:null;if(r.set(h,s),"PUBLIC"===s.type){var l=function(t){if(void 0===t&&(t=a()),"function"!=typeof t[h])throw U.create("invalid-app-argument",{appName:h});return t[h]()};void 0!==s.serviceProps&&i(l,s.serviceProps),o[h]=l,t.prototype[h]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,h).apply(this,s.multipleInstances?t:[])}}try{for(var p=n(Object.keys(e)),f=p.next();!f.done;f=p.next())e[f.value]._addComponent(s)}catch(c){u={error:c}}finally{try{f&&!f.done&&(c=p.return)&&c.call(p)}finally{if(u)throw u.error}}return"PUBLIC"===s.type?o[h]:null}return o.default=o,Object.defineProperty(o,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),a.App=t,o}(W);return r.INTERNAL=e(e({},r.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){i(r,t)},createSubscribe:g,ErrorFactory:f,deepExtend:i}),r}(),H=(z.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e;return"VERSION"===(null===(e=t.getComponent())||void 0===e?void 0:e.type)}(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},z);function z(t){this.container=t}if("object"==typeof self&&self.self===self&&void 0!==self.firebase){j.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var G=self.firebase.SDK_VERSION;G&&0<=G.indexOf("LITE")&&j.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var Y=K.initializeApp;K.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&j.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),Y.apply(void 0,t)};var X,J=K;return(X=J).INTERNAL.registerComponent(new w("platform-logger",(function(t){return new H(t)}),"PRIVATE")),X.registerVersion(q,"0.5.2",void 0),X.registerVersion("fire-js",""),J.registerVersion("firebase","7.7.0","app"),J})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,(function(t){"use strict";try{(function(){t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,n)},n=function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function r(t,e,n,r){return new(n=n||Promise)((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function o(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}var s,u,c,h=(c=Error,e(s=p,u=c),s.prototype=null===u?Object.create(u):(l.prototype=u.prototype,new l),p);function l(){this.constructor=s}function p(t,e){var n=c.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,p.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,f.prototype.create),n}var f=(d.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(y,(function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"}))}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new h(i,s),c=0,l=Object.keys(r);c<l.length;c++){var p=l[c];"_"!==p.slice(-1)&&(p in u&&console.warn('Overwriting FirebaseError base field "'+p+'" can cause unexpected behavior.'),u[p]=r[p])}return u},d);function d(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var y=/\{\$([^}]+)}/g,v=(g.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},g.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},g.prototype.setServiceProps=function(t){return this.serviceProps=t,this},g);function g(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}function m(t){return new Promise((function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function _(t,e,n){var r,i=new Promise((function(i,o){m(r=t[e].apply(t,n)).then(i,o)}));return i.request=r,i}function b(t,e,n){n.forEach((function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})}))}function w(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return _(this[e],r,arguments)})}))}function E(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})}))}function T(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return function(t,e,n){var r=_(t,e,n);return r.then((function(t){if(t)return new S(t,r.request)}))}(this[e],r,arguments)})}))}function C(t){this._index=t}function S(t,e){this._cursor=t,this._request=e}function I(t){this._store=t}function N(t){this._tx=t,this.complete=new Promise((function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}}))}function A(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new N(n)}function D(t){this._db=t}b(C,"_index",["name","keyPath","multiEntry","unique"]),w(C,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),T(C,"_index",IDBIndex,["openCursor","openKeyCursor"]),b(S,"_cursor",["direction","key","primaryKey","value"]),w(S,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(t){t in IDBCursor.prototype&&(S.prototype[t]=function(){var e=this,n=arguments;return Promise.resolve().then((function(){return e._cursor[t].apply(e._cursor,n),m(e._request).then((function(t){if(t)return new S(t,e._request)}))}))})})),I.prototype.createIndex=function(){return new C(this._store.createIndex.apply(this._store,arguments))},I.prototype.index=function(){return new C(this._store.index.apply(this._store,arguments))},b(I,"_store",["name","keyPath","indexNames","autoIncrement"]),w(I,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),T(I,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),E(I,"_store",IDBObjectStore,["deleteIndex"]),N.prototype.objectStore=function(){return new I(this._tx.objectStore.apply(this._tx,arguments))},b(N,"_tx",["objectStoreNames","mode"]),E(N,"_tx",IDBTransaction,["abort"]),A.prototype.createObjectStore=function(){return new I(this._db.createObjectStore.apply(this._db,arguments))},b(A,"_db",["name","version","objectStoreNames"]),E(A,"_db",IDBDatabase,["deleteObjectStore","close"]),D.prototype.transaction=function(){return new N(this._db.transaction.apply(this._db,arguments))},b(D,"_db",["name","version","objectStoreNames"]),E(D,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(t){[I,C].forEach((function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e=function(t){return Array.prototype.slice.call(t)}(arguments),n=e[e.length-1],r=this._store||this._index,i=r[t].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})}))})),[C,I].forEach((function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise((function(i){n.iterateCursor(t,(function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():i(r)):i(r)}))}))})}));var k,R="0.4.0",P=1e4,O="w:"+R,x="FIS_v2",L="https://firebaseinstallations.googleapis.com/v1",M=36e5,F=((k={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',k["not-registered"]="Firebase Installation is not registered.",k["installation-not-found"]="Firebase Installation not found.",k["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',k["app-offline"]="Could not process request. Application offline.",k["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",k),U=new f("installations","Installations",F);function q(t){return t instanceof h&&t.code.includes("request-failed")}function V(t){return L+"/projects/"+t.projectId+"/installations"}function B(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function j(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return[4,e.json()];case 1:return n=i.sent(),[2,U.create("request-failed",{requestName:t,serverCode:(r=n.error).code,serverMessage:r.message,serverStatus:r.status})]}}))}))}function W(t){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey})}function Q(t,e){var n=e.refreshToken,r=W(t);return r.append("Authorization",function(t){return x+" "+t}(n)),r}function K(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return 500<=(e=n.sent()).status&&e.status<600?[2,t()]:[2,e]}}))}))}function H(t){return new Promise((function(e){setTimeout(e,t)}))}var z=/^[cdef][\w-]{21}$/,G="";function Y(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t}(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return z.test(e)?e:G}catch(t){return G}}function X(t){return t.appName+"!"+t.appId}var J=new Map;function $(t,e){var n=X(t);Z(n,e),function(t,e){var n=et();n&&n.postMessage({key:t,fid:e}),nt()}(n,e)}function Z(t,e){var n,r,i=J.get(t);if(i)try{for(var a=o(i),s=a.next();!s.done;s=a.next())(0,s.value)(e)}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}var tt=null;function et(){return!tt&&"BroadcastChannel"in self&&((tt=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(t){Z(t.data.key,t.data.fid)}),tt}function nt(){0===J.size&&tt&&(tt.close(),tt=null)}var rt,it="firebase-installations-database",ot=1,at="firebase-installations-store",st=null;function ut(){return st=st||function(t,e,n){var r=_(indexedDB,"open",[t,e]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new A(i.result,t.oldVersion,i.transaction))}),r.then((function(t){return new D(t)}))}(it,ot,(function(t){switch(t.oldVersion){case 0:t.createObjectStore(at)}}))}function ct(t,e){return r(this,void 0,void 0,(function(){var n,r,o,a,s;return i(this,(function(i){switch(i.label){case 0:return n=X(t),[4,ut()];case 1:return r=i.sent(),o=r.transaction(at,"readwrite"),[4,(a=o.objectStore(at)).get(n)];case 2:return s=i.sent(),[4,a.put(e,n)];case 3:return i.sent(),[4,o.complete];case 4:return i.sent(),s&&s.fid===e.fid||$(t,e.fid),[2,e]}}))}))}function ht(t){return r(this,void 0,void 0,(function(){var e,n,r;return i(this,(function(i){switch(i.label){case 0:return e=X(t),[4,ut()];case 1:return n=i.sent(),[4,(r=n.transaction(at,"readwrite")).objectStore(at).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}}))}))}function lt(t,e){return r(this,void 0,void 0,(function(){var n,r,o,a,s,u;return i(this,(function(i){switch(i.label){case 0:return n=X(t),[4,ut()];case 1:return r=i.sent(),o=r.transaction(at,"readwrite"),[4,(a=o.objectStore(at)).get(n)];case 2:return s=i.sent(),void 0!==(u=e(s))?[3,4]:[4,a.delete(n)];case 3:return i.sent(),[3,6];case 4:return[4,a.put(u,n)];case 5:i.sent(),i.label=6;case 6:return[4,o.complete];case 7:return i.sent(),!u||s&&s.fid===u.fid||$(t,u.fid),[2,u]}}))}))}function pt(t){return r(this,void 0,void 0,(function(){var e,n,o;return i(this,(function(a){switch(a.label){case 0:return[4,lt(t,(function(n){var o=function(t){return dt(t||{fid:Y(),registrationStatus:0})}(n),a=function(t,e){if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(t){return r(this,void 0,void 0,(function(){var e,n,r,o;return i(this,(function(i){switch(i.label){case 0:return[4,ft(t)];case 1:e=i.sent(),i.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,H(100)];case 3:return i.sent(),[4,ft(t)];case 4:return e=i.sent(),[3,2];case 5:return 0!==e.registrationStatus?[3,7]:[4,pt(t)];case 6:return n=i.sent(),r=n.installationEntry,(o=n.registrationPromise)?[2,o]:[2,r];case 7:return[2,e]}}))}))}(t)}:{installationEntry:e};if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(U.create("app-offline"))};var n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:function(t,e){return r(this,void 0,void 0,(function(){var n,o;return i(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,7]),[4,function(t,e){var n=e.fid;return r(this,void 0,void 0,(function(){var e,r,o,a,s;return i(this,(function(i){switch(i.label){case 0:return e=V(t),r=W(t),o={method:"POST",headers:r,body:JSON.stringify({fid:n,authVersion:x,appId:t.appId,sdkVersion:O})},[4,K((function(){return fetch(e,o)}))];case 1:return(a=i.sent()).ok?[4,a.json()]:[3,3];case 2:return[2,{fid:(s=i.sent()).fid||n,registrationStatus:2,refreshToken:s.refreshToken,authToken:B(s.authToken)}];case 3:return[4,j("Create Installation",a)];case 4:throw i.sent()}}))}))}(t,e)];case 1:return n=a.sent(),[2,ct(t,n)];case 2:return q(o=a.sent())&&409===o.serverCode?[4,ht(t)]:[3,4];case 3:return a.sent(),[3,6];case 4:return[4,ct(t,{fid:e.fid,registrationStatus:0})];case 5:a.sent(),a.label=6;case 6:throw o;case 7:return[2]}}))}))}(t,n)}}(t,o);return e=a.registrationPromise,a.installationEntry}))];case 1:return(n=a.sent()).fid!==G?[3,3]:(o={},[4,e]);case 2:return[2,(o.installationEntry=a.sent(),o)];case 3:return[2,{installationEntry:n,registrationPromise:e}]}}))}))}function ft(t){return lt(t,(function(t){if(!t)throw U.create("installation-not-found");return dt(t)}))}function dt(t){return function(t){return 1===t.registrationStatus&&t.registrationTime+P<Date.now()}(t)?{fid:t.fid,registrationStatus:0}:t}function yt(t,e){var n=t.appConfig,o=t.platformLoggerProvider;return r(this,void 0,void 0,(function(){var t,r,a,s,u;return i(this,(function(i){switch(i.label){case 0:return t=function(t,e){var n=e.fid;return V(t)+"/"+n+"/authTokens:generate"}(n,e),r=Q(n,e),(a=o.getImmediate({optional:!0}))&&r.append("x-firebase-client",a.getPlatformInfoString()),s={method:"POST",headers:r,body:JSON.stringify({installation:{sdkVersion:O}})},[4,K((function(){return fetch(t,s)}))];case 1:return(u=i.sent()).ok?[4,u.json()]:[3,3];case 2:return[2,B(i.sent())];case 3:return[4,j("Generate Auth Token",u)];case 4:throw i.sent()}}))}))}function vt(t,e){return void 0===e&&(e=!1),r(this,void 0,void 0,(function(){var o,a,s;return i(this,(function(u){switch(u.label){case 0:return[4,lt(t.appConfig,(function(a){if(!mt(a))throw U.create("not-registered");var s=a.authToken;if(!e&&function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+M}(t)}(s))return a;if(1===s.requestStatus)return o=function(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return[4,gt(t.appConfig)];case 1:n=i.sent(),i.label=2;case 2:return 1!==n.authToken.requestStatus?[3,5]:[4,H(100)];case 3:return i.sent(),[4,gt(t.appConfig)];case 4:return n=i.sent(),[3,2];case 5:return 0===(r=n.authToken).requestStatus?[2,vt(t,e)]:[2,r]}}))}))}(t,e),a;if(!navigator.onLine)throw U.create("app-offline");var u=function(t){var e={requestStatus:1,requestTime:Date.now()};return n(n({},t),{authToken:e})}(a);return o=function(t,e){return r(this,void 0,void 0,(function(){var r,o,a;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,8]),[4,yt(t,e)];case 1:return r=i.sent(),a=n(n({},e),{authToken:r}),[4,ct(t.appConfig,a)];case 2:return i.sent(),[2,r];case 3:return!q(o=i.sent())||401!==o.serverCode&&404!==o.serverCode?[3,5]:[4,ht(t.appConfig)];case 4:return i.sent(),[3,7];case 5:return a=n(n({},e),{authToken:{requestStatus:0}}),[4,ct(t.appConfig,a)];case 6:i.sent(),i.label=7;case 7:throw o;case 8:return[2]}}))}))}(t,u),u}))];case 1:return a=u.sent(),o?[4,o]:[3,3];case 2:return s=u.sent(),[3,4];case 3:s=a.authToken,u.label=4;case 4:return[2,s]}}))}))}function gt(t){return lt(t,(function(t){if(!mt(t))throw U.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+P<Date.now()}(t.authToken)?n(n({},t),{authToken:{requestStatus:0}}):t}))}function mt(t){return void 0!==t&&2===t.registrationStatus}function _t(t,e){return r(this,void 0,void 0,(function(){var n,r,o,a;return i(this,(function(i){switch(i.label){case 0:return n=function(t,e){var n=e.fid;return V(t)+"/"+n}(t,e),r=Q(t,e),o={method:"DELETE",headers:r},[4,K((function(){return fetch(n,o)}))];case 1:return(a=i.sent()).ok?[3,3]:[4,j("Delete Installation",a)];case 2:throw i.sent();case 3:return[2]}}))}))}function bt(t){return U.create("missing-app-config-values",{valueName:t})}(rt=t).INTERNAL.registerComponent(new v("installations",(function(t){var e=t.getProvider("app").getImmediate(),n={appConfig:function(t){var e,n;if(!t||!t.options)throw bt("App Configuration");if(!t.name)throw bt("App Name");try{for(var r=o(["projectId","apiKey","appId"]),i=r.next();!i.done;i=r.next()){var a=i.value;if(!t.options[a])throw bt(a)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e),platformLoggerProvider:t.getProvider("platform-logger")};return{app:e,getId:function(){return function(t){return r(this,void 0,void 0,(function(){var e,n,r;return i(this,(function(i){switch(i.label){case 0:return[4,pt(t.appConfig)];case 1:return e=i.sent(),n=e.installationEntry,(r=e.registrationPromise)?r.catch(console.error):vt(t).catch(console.error),[2,n.fid]}}))}))}(n)},getToken:function(t){return function(t,e){return void 0===e&&(e=!1),r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,pt(t)];case 1:return(e=n.sent().registrationPromise)?[4,e]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))}(t.appConfig)];case 1:return n.sent(),[4,vt(t,e)];case 2:return[2,n.sent().token]}}))}))}(n,t)},delete:function(){return function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,lt(e=t.appConfig,(function(t){if(!t||0!==t.registrationStatus)return t}))];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw U.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw U.create("app-offline");case 3:return[4,_t(e,n)];case 4:return r.sent(),[4,ht(e)];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))}(n)},onIdChange:function(t){return function(t,e){var n=t.appConfig;return function(t,e){et();var n=X(t),r=J.get(n);r||(r=new Set,J.set(n,r)),r.add(e)}(n,e),function(){!function(t,e){var n=X(t),r=J.get(n);r&&(r.delete(e),0===r.size&&J.delete(n),nt())}(n,e)}}(n,t)}}}),"PUBLIC")),rt.registerVersion("@firebase/installations",R);var wt,Et,Tt,Ct,St,It="measurementId",Nt="https://www.googletagmanager.com/gtag/js";(Et=wt=wt||{}).EVENT="event",Et.SET="set",Et.CONFIG="config",(Ct=Tt=Tt||{}).ADD_PAYMENT_INFO="add_payment_info",Ct.ADD_TO_CART="add_to_cart",Ct.ADD_TO_WISHLIST="add_to_wishlist",Ct.BEGIN_CHECKOUT="begin_checkout",Ct.CHECKOUT_PROGRESS="checkout_progress",Ct.EXCEPTION="exception",Ct.GENERATE_LEAD="generate_lead",Ct.LOGIN="login",Ct.PAGE_VIEW="page_view",Ct.PURCHASE="purchase",Ct.REFUND="refund",Ct.REMOVE_FROM_CART="remove_from_cart",Ct.SCREEN_VIEW="screen_view",Ct.SEARCH="search",Ct.SELECT_CONTENT="select_content",Ct.SET_CHECKOUT_OPTION="set_checkout_option",Ct.SHARE="share",Ct.SIGN_UP="sign_up",Ct.TIMING_COMPLETE="timing_complete",Ct.VIEW_ITEM="view_item",Ct.VIEW_ITEM_LIST="view_item_list",Ct.VIEW_PROMOTION="view_promotion",Ct.VIEW_SEARCH_RESULTS="view_search_results";var At,Dt,kt,Rt=((St={})["no-ga-id"]='"'+It+'" field is empty in Firebase config. Firebase Analytics requires this field to contain a valid measurement ID.',St["already-exists"]="A Firebase Analytics instance with the measurement ID ${id}  already exists. Only one Firebase Analytics instance can be created for each measurement ID.",St["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",St["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate",St),Pt=new f("analytics","Analytics",Rt),Ot={},xt="dataLayer",Lt="gtag",Mt=!1,Ft="analytics";(kt=t).INTERNAL.registerComponent(new v(Ft,(function(t){return function(t,e){var o=t.options[It];if(!o)throw Pt.create("no-ga-id");if(null!=Ot[o])throw Pt.create("already-exists",{id:o});if(!Mt){!function(){for(var t=window.document.getElementsByTagName("script"),e=0,n=Object.values(t);e<n.length;e++){var r=n[e];if(r.src&&r.src.includes(Nt))return r}return null}()&&function(t){var e=document.createElement("script");e.src=Nt+"?l="+t,e.async=!0,document.head.appendChild(e)}(xt),function(t){var e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(xt);var a=function(t,e,n){var r=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];window[e].push(arguments)};return window[n]&&"function"==typeof window[n]&&(r=window[n]),window[n]=function(t,e){return function(n,r,i){if(n===wt.EVENT){var o=[];if(i&&i.send_to){var a=i.send_to;Array.isArray(a)||(a=[a]);for(var s=0,u=a;s<u.length;s++){var c=e[u[s]];if(!c){o=[];break}o.push(c)}}if(0===o.length)for(var h=0,l=Object.values(e);h<l.length;h++)o.push(l[h]);Promise.all(o).then((function(){return t(wt.EVENT,r,i||{})})).catch((function(t){return console.error(t)}))}else n===wt.CONFIG?(e[r]||Promise.resolve()).then((function(){t(wt.CONFIG,r,i)})).catch((function(t){return console.error(t)})):t(wt.SET,r)}}(r,t),{gtagCore:r,wrappedGtag:window[n]}}(Ot,xt,Lt);Dt=a.wrappedGtag,At=a.gtagCore,Mt=!0}return Ot[o]=function(t,e,n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return[4,e.getId()];case 1:return r=i.sent(),n("js",new Date),n(wt.CONFIG,t.options[It],((o={}).firebase_id=r,o.origin="firebase",o.update=!0,o)),[2]}}))}))}(t,e,At),{app:t,logEvent:function(t,e,r){return function(t,e,r,i,o){var a=i||{};o&&o.global||(a=n(n({},i),{send_to:e})),t(wt.EVENT,r,a||{})}(Dt,o,t,e,r)},setCurrentScreen:function(t,e){return function(t,e,n,r){r&&r.global?t(wt.SET,{screen_name:n}):t(wt.CONFIG,e,{update:!0,screen_name:n})}(Dt,o,t,e)},setUserId:function(t,e){return function(t,e,n,r){r&&r.global?t(wt.SET,{user_id:n}):t(wt.CONFIG,e,{update:!0,user_id:n})}(Dt,o,t,e)},setUserProperties:function(t,e){return function(t,e,n,r){if(r&&r.global){for(var i={},o=0,a=Object.keys(n);o<a.length;o++){var s=a[o];i["user_properties."+s]=n[s]}t(wt.SET,i)}else t(wt.CONFIG,e,{update:!0,user_properties:n})}(Dt,o,t,e)},setAnalyticsCollectionEnabled:function(t){return function(t,e){window["ga-disable-"+t]=!e}(o,t)}}}(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())}),"PUBLIC").setServiceProps({settings:function(t){if(Mt)throw Pt.create("already-initialized");t.dataLayerName&&(xt=t.dataLayerName),t.gtagName&&(Lt=t.gtagName)},EventName:Tt})),kt.INTERNAL.registerComponent(new v("analytics-internal",(function(t){try{return{logEvent:t.getProvider(Ft).getImmediate().logEvent}}catch(t){throw Pt.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),kt.registerVersion("@firebase/analytics","0.2.11")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-analytics.js - be sure to load firebase-app.js first.")}})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,(function(t){"use strict";try{(function(){t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,n)};function n(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function i(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function a(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}function s(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function u(t){try{return p.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var c={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},h=function(t,e){if(!t)throw l(e)},l=function(t){return new Error("Firebase Database ("+c.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},p={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=(15&s)<<2|c>>6,l=63&c;u||(l=64,a||(h=64)),r.push(n[o>>2],n[(3&o)<<4|s>>4],n[h],n[l])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();r.push(o<<2|a>>4),64!==s&&(r.push(a<<4&240|s>>2),64!==u&&r.push(s<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},f=(d.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},d);function d(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}function y(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function v(){return!0===c.NODE_ADMIN}var g,m=(n(_,g=Error),_);function _(t,e){var n=g.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,_.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,b.prototype.create),n}var b=(w.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(E,(function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"}))}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new m(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},w);function w(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var E=/\{\$([^}]+)}/g;function T(t){return JSON.parse(t)}function C(t){return JSON.stringify(t)}function S(t){var e={},n={},r={},i="";try{var o=t.split(".");e=T(u(o[0])||""),n=T(u(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function I(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function N(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function A(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function D(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var k,R,P=(O.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},O.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},O.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},O.prototype.digest=function(){var t=[],e=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},O);function O(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function x(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function L(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+r+" argument "}function M(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(L(t,e,r)+"must be a valid function.")}function F(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(L(t,e,r)+"must be a valid context object.")}function U(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}function q(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function V(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case k.DEBUG:case k.VERBOSE:console.log.apply(console,q(["["+i+"]  "+t.name+":"],n));break;case k.INFO:console.info.apply(console,q(["["+i+"]  "+t.name+":"],n));break;case k.WARN:console.warn.apply(console,q(["["+i+"]  "+t.name+":"],n));break;case k.ERROR:console.error.apply(console,q(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}(R=k=k||{})[R.DEBUG=0]="DEBUG",R[R.VERBOSE=1]="VERBOSE",R[R.INFO=2]="INFO",R[R.WARN=3]="WARN",R[R.ERROR=4]="ERROR",R[R.SILENT=5]="SILENT";var B=k.INFO,j=(Object.defineProperty(W.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in k))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),W.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,q([this,k.DEBUG],t))},W.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,q([this,k.VERBOSE],t))},W.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,q([this,k.INFO],t))},W.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,q([this,k.WARN],t))},W.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,q([this,k.ERROR],t))},W);function W(t){this.name=t,this._logLevel=B,this._logHandler=V}var Q=(K.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},K.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},K.prototype.setServiceProps=function(t){return this.serviceProps=t,this},K);function K(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var H=(z.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),C(e))},z.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:T(e)},z.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},z.prototype.prefixedName_=function(t){return this.prefix_+t},z.prototype.toString=function(){return this.domStorage_.toString()},z);function z(t){this.domStorage_=t,this.prefix_="firebase:"}var G=(Y.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},Y.prototype.get=function(t){return I(this.cache_,t)?this.cache_[t]:null},Y.prototype.remove=function(t){delete this.cache_[t]},Y);function Y(){this.cache_={},this.isInMemoryStorage=!0}function X(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new H(e)}}catch(t){}return new G}function J(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;h(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new P;n.update(e);var r=n.digest();return p.encodeByteArray(r)}function $(t,e){h(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(lt.logLevel=k.VERBOSE,dt=lt.log.bind(lt),e&&ht.set("logging_enabled",!0)):"function"==typeof t?dt=t:(dt=null,ht.remove("logging_enabled"))}function Z(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===yt&&(yt=!1,null===dt&&!0===ht.get("logging_enabled")&&$(!0)),dt){var n=ft.apply(null,t);dt(n)}}function tt(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Z.apply(void 0,a([t],e))}}function et(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+ft.apply(void 0,a(t));lt.error(n)}function nt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+ft.apply(void 0,a(t));throw lt.error(n),new Error(n)}function rt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+ft.apply(void 0,a(t));lt.warn(n)}function it(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)}function ot(t,e){return t===e?0:t<e?-1:1}function at(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+C(e))}function st(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)r.push(t.substring(i,n<i+e?n:i+e));return r}var ut,ct=X("localStorage"),ht=X("sessionStorage"),lt=new j("@firebase/database"),pt=(ut=1,function(){return ut++}),ft=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++){var i=t[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=ft.apply(null,i):n+="object"==typeof i?C(i):i,n+=" "}return n},dt=null,yt=!0,vt="[MIN_NAME]",gt="[MAX_NAME]",mt=function(t,e){if(t===e)return 0;if(t===vt||e===gt)return-1;if(e===vt||t===gt)return 1;var n=St(t),r=St(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},_t=function(t){if("object"!=typeof t||null===t)return C(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=C(e[i]),r+=":",r+=_t(t[e[i]]);return r+"}"};function bt(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function wt(t){var e,n,r,i,o;h(!it(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074))));var a=[];for(o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse();var s=a.join(""),u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function Et(t){try{t()}catch(e){setTimeout((function(){throw rt("Exception was thrown by user callback.",e.stack||""),e}),Math.floor(0))}}function Tt(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var Ct=new RegExp("^-?(0*)\\d{1,10}$"),St=function(t){if(Ct.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},It=(Object.defineProperty(Nt,"Empty",{get:function(){return new Nt("")},enumerable:!0,configurable:!0}),Nt.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},Nt.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},Nt.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new Nt(this.pieces_,t)},Nt.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},Nt.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},Nt.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},Nt.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},Nt.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new Nt(t,0)},Nt.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof Nt)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new Nt(e,0)},Nt.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},Nt.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return Nt.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},Nt.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=mt(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},Nt.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},Nt.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},Nt);function Nt(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var At=(Object.defineProperty(Dt,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(Dt,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),Dt.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=U(t),this.checkValid_()},Dt.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=U(t),0<this.parts_.length&&(this.byteLength_-=1)},Dt.prototype.checkValid_=function(){if(this.byteLength_>Dt.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+Dt.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>Dt.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Dt.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},Dt.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},Dt);function Dt(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=U(this.parts_[n]);this.checkValid_()}var kt="firebaseio.com",Rt="websocket",Pt="long_polling",Ot=(xt.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},xt.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},xt.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},xt.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},xt.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&ct.set("host:"+this.host,this.internalHost))},xt.prototype.connectionURL=function(t,e){var n;if(h("string"==typeof t,"typeof type must == string"),h("object"==typeof e,"typeof params must == object"),t===Rt)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==Pt)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return bt(e,(function(t,e){r.push(t+"="+e)})),n+r.join("&")},xt.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},xt.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},xt);function xt(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=ct.get("host:"+t)||this.host}function Lt(t){var e=zt(t),n=e.namespace;return"firebase"===e.domain&&nt(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===e.domain||nt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&rt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Ot(e.host,e.secure,n,"ws"===e.scheme||"wss"===e.scheme,"",n!==e.subdomain),path:new It(e.pathString)}}function Mt(t){return"string"==typeof t&&0!==t.length&&!Gt.test(t)}function Ft(t){return"string"==typeof t&&0!==t.length&&!Yt.test(t)}function Ut(t){return null===t||"string"==typeof t||"number"==typeof t&&!it(t)||t&&"object"==typeof t&&I(t,".sv")}function qt(t,e,n,r,i){i&&void 0===n||Jt(L(t,e,i),n,r)}function Vt(t,e,n,r,i){if(!i||void 0!==n){var o=L(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];bt(n,(function(t,e){var n=new It(t);if(Jt(o,e,r.child(n)),".priority"===n.getBack()&&!Ut(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)})),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!Mt(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(It.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function Bt(t,e,n,r){if(!r||void 0!==n){if(it(n))throw new Error(L(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ut(n))throw new Error(L(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function jt(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(L(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function Wt(t,e,n,r){if(!(r&&void 0===n||Mt(n)))throw new Error(L(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function Qt(t,e,n,r){if(!(r&&void 0===n||Ft(n)))throw new Error(L(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function Kt(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function Ht(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!Mt(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return Ft(t=t&&t.replace(/^\/*\.info(\/|$)/,"/"))}(r))throw new Error(L(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var zt=function(t){var e="",n="",r="",o="",a="",s=!0,u="https",c=443;if("string"==typeof t){var h=t.indexOf("//");0<=h&&(u=t.substring(0,h-1),t=t.substring(h+2));var l=t.indexOf("/");-1===l&&(l=t.length);var p=t.indexOf("?");-1===p&&(p=t.length),e=t.substring(0,Math.min(l,p)),l<p&&(o=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(l,p)));var f=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var o=i(t.split("&")),a=o.next();!a.done;a=o.next()){var s=a.value;if(0!==s.length){var u=s.split("=");2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):rt("Invalid query segment '"+s+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,p)));0<=(h=e.indexOf(":"))?(s="https"===u||"wss"===u,c=parseInt(e.substring(h+1),10)):h=t.length;var d=e.split(".");3===d.length?(n=d[1],a=r=d[0].toLowerCase()):2===d.length?n=d[0]:"localhost"===d[0].slice(0,h).toLowerCase()&&(n="localhost"),"ns"in f&&(a=f.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:s,scheme:u,pathString:o,namespace:a}},Gt=/[\[\].#$\/\u0000-\u001F\u007F]/,Yt=/[\[\].#$\u0000-\u001F\u007F]/,Xt=10485760,Jt=function(t,e,n){var r=n instanceof It?new At(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(it(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>Xt/3&&U(e)>Xt)throw new Error(t+"contains a string greater than "+Xt+" utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,o=!1;if(bt(e,(function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!Mt(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),Jt(t,n,r),r.pop()})),i&&o)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},$t=(Zt.prototype.cancel=function(t){x("OnDisconnect.cancel",0,1,arguments.length),M("OnDisconnect.cancel",1,t,!0);var e=new f;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},Zt.prototype.remove=function(t){x("OnDisconnect.remove",0,1,arguments.length),Kt("OnDisconnect.remove",this.path_),M("OnDisconnect.remove",1,t,!0);var e=new f;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},Zt.prototype.set=function(t,e){x("OnDisconnect.set",1,2,arguments.length),Kt("OnDisconnect.set",this.path_),qt("OnDisconnect.set",1,t,this.path_,!1),M("OnDisconnect.set",2,e,!0);var n=new f;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},Zt.prototype.setWithPriority=function(t,e,n){x("OnDisconnect.setWithPriority",2,3,arguments.length),Kt("OnDisconnect.setWithPriority",this.path_),qt("OnDisconnect.setWithPriority",1,t,this.path_,!1),Bt("OnDisconnect.setWithPriority",2,e,!1),M("OnDisconnect.setWithPriority",3,n,!0);var r=new f;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},Zt.prototype.update=function(t,e){if(x("OnDisconnect.update",1,2,arguments.length),Kt("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,rt("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Vt("OnDisconnect.update",1,t,this.path_,!1),M("OnDisconnect.update",2,e,!0);var i=new f;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},Zt);function Zt(t,e){this.repo_=t,this.path_=e}var te=(ee.prototype.toJSON=function(){return x("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},ee);function ee(t,e){this.committed=t,this.snapshot=e}var ne,re,ie,oe=(ne="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",re=0,ie=[],function(t){var e,n=t===re;re=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=ne.charAt(t%64),t=Math.floor(t/64);h(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===ie[e];e--)ie[e]=0;ie[e]++}else for(e=0;e<12;e++)ie[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=ne.charAt(ie[e]);return h(20===i.length,"nextPushId: Length should be 20."),i}),ae=(se.Wrap=function(t,e){return new se(t,e)},se);function se(t,e){this.name=t,this.node=e}var ue,ce=(he.prototype.getCompare=function(){return this.compare.bind(this)},he.prototype.indexedValueChanged=function(t,e){var n=new ae(vt,t),r=new ae(vt,e);return 0!==this.compare(n,r)},he.prototype.minPost=function(){return ae.MIN},he);function he(){}var le,pe=(n(fe,le=ce),Object.defineProperty(fe,"__EMPTY_NODE",{get:function(){return ue},set:function(t){ue=t},enumerable:!0,configurable:!0}),fe.prototype.compare=function(t,e){return mt(t.name,e.name)},fe.prototype.isDefinedOn=function(t){throw l("KeyIndex.isDefinedOn not expected to be called.")},fe.prototype.indexedValueChanged=function(t,e){return!1},fe.prototype.minPost=function(){return ae.MIN},fe.prototype.maxPost=function(){return new ae(gt,ue)},fe.prototype.makePost=function(t,e){return h("string"==typeof t,"KeyIndex indexValue must always be a string."),new ae(t,ue)},fe.prototype.toString=function(){return".key"},fe);function fe(){return null!==le&&le.apply(this,arguments)||this}var de,ye=new pe;function ve(t){return"number"==typeof t?"number:"+wt(t):"string:"+t}function ge(t){if(t.isLeafNode()){var e=t.val();h("string"==typeof e||"number"==typeof e||"object"==typeof e&&I(e,".sv"),"Priority must be a string or number.")}else h(t===de||t.isEmpty(),"priority of unexpected type.");h(t===de||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var me,_e,be,we,Ee=(Object.defineProperty(Te,"__childrenNodeConstructor",{get:function(){return me},set:function(t){me=t},enumerable:!0,configurable:!0}),Te.prototype.isLeafNode=function(){return!0},Te.prototype.getPriority=function(){return this.priorityNode_},Te.prototype.updatePriority=function(t){return new Te(this.value_,t)},Te.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:Te.__childrenNodeConstructor.EMPTY_NODE},Te.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:Te.__childrenNodeConstructor.EMPTY_NODE},Te.prototype.hasChild=function(){return!1},Te.prototype.getPredecessorChildName=function(t,e){return null},Te.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Te.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},Te.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(h(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,Te.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},Te.prototype.isEmpty=function(){return!1},Te.prototype.numChildren=function(){return 0},Te.prototype.forEachChild=function(t,e){return!1},Te.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},Te.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+ve(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?wt(this.value_):this.value_,this.lazyHash_=J(t)}return this.lazyHash_},Te.prototype.getValue=function(){return this.value_},Te.prototype.compareTo=function(t){return t===Te.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Te.__childrenNodeConstructor?-1:(h(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},Te.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=Te.VALUE_TYPE_ORDER.indexOf(e),i=Te.VALUE_TYPE_ORDER.indexOf(n);return h(0<=r,"Unknown leaf type: "+e),h(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},Te.prototype.withIndex=function(){return this},Te.prototype.isIndexed=function(){return!0},Te.prototype.equals=function(t){return t===this||!!t.isLeafNode()&&this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)},Te.VALUE_TYPE_ORDER=["object","boolean","number","string"],Te);function Te(t,e){void 0===e&&(e=Te.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,h(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),ge(this.priorityNode_)}function Ce(){return null!==we&&we.apply(this,arguments)||this}var Se=new(n(Ce,we=ce),Ce.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?mt(t.name,e.name):i},Ce.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},Ce.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},Ce.prototype.minPost=function(){return ae.MIN},Ce.prototype.maxPost=function(){return new ae(gt,new Ee("[PRIORITY-POST]",be))},Ce.prototype.makePost=function(t,e){var n=_e(t);return new ae(e,new Ee("[PRIORITY-POST]",n))},Ce.prototype.toString=function(){return".priority"},Ce),Ie=(Ne.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},Ne.prototype.hasNext=function(){return 0<this.nodeStack_.length},Ne.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},Ne);function Ne(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var Ae=(De.prototype.copy=function(t,e,n,r,i){return new De(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},De.prototype.count=function(){return this.left.count()+1+this.right.count()},De.prototype.isEmpty=function(){return!1},De.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)},De.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},De.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},De.prototype.minKey=function(){return this.min_().key},De.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},De.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp_()},De.prototype.removeMin_=function(){if(this.left.isEmpty())return Pe.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},De.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Pe.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},De.prototype.isRed_=function(){return this.color},De.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},De.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},De.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},De.prototype.rotateLeft_=function(){var t=this.copy(null,null,De.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},De.prototype.rotateRight_=function(){var t=this.copy(null,null,De.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},De.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},De.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},De.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},De.RED=!0,De.BLACK=!1,De);function De(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:De.RED,this.left=null!=r?r:Pe.EMPTY_NODE,this.right=null!=i?i:Pe.EMPTY_NODE}var ke=(Re.prototype.copy=function(t,e,n,r,i){return this},Re.prototype.insert=function(t,e,n){return new Ae(t,e,null)},Re.prototype.remove=function(t,e){return this},Re.prototype.count=function(){return 0},Re.prototype.isEmpty=function(){return!0},Re.prototype.inorderTraversal=function(t){return!1},Re.prototype.reverseTraversal=function(t){return!1},Re.prototype.minKey=function(){return null},Re.prototype.maxKey=function(){return null},Re.prototype.check_=function(){return 0},Re.prototype.isRed_=function(){return!1},Re);function Re(){}var Pe=(Oe.prototype.insert=function(t,e){return new Oe(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Ae.BLACK,null,null))},Oe.prototype.remove=function(t){return new Oe(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ae.BLACK,null,null))},Oe.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},Oe.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},Oe.prototype.isEmpty=function(){return this.root_.isEmpty()},Oe.prototype.count=function(){return this.root_.count()},Oe.prototype.minKey=function(){return this.root_.minKey()},Oe.prototype.maxKey=function(){return this.root_.maxKey()},Oe.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},Oe.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},Oe.prototype.getIterator=function(t){return new Ie(this.root_,null,this.comparator_,!1,t)},Oe.prototype.getIteratorFrom=function(t,e){return new Ie(this.root_,t,this.comparator_,!1,e)},Oe.prototype.getReverseIteratorFrom=function(t,e){return new Ie(this.root_,t,this.comparator_,!0,e)},Oe.prototype.getReverseIterator=function(t){return new Ie(this.root_,null,this.comparator_,!0,t)},Oe.EMPTY_NODE=new ke,Oe);function Oe(t,e){void 0===e&&(e=Oe.EMPTY_NODE),this.comparator_=t,this.root_=e}var xe=Math.log(2),Le=(Me.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},Me);function Me(t){this.count=parseInt(Math.log(t+1)/xe,10),this.current_=this.count-1;var e=parseInt(Array(this.count+1).join("1"),2);this.bits_=t+1&e}var Fe,Ue,qe=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,a,s=r-e;if(0==s)return null;if(1==s)return o=t[e],a=n?n(o):o,new Ae(a,o.node,Ae.BLACK,null,null);var u=parseInt(s/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],a=n?n(o):o,new Ae(a,o.node,Ae.BLACK,c,h)},o=function(e){for(var r=null,o=null,a=t.length,s=function(e,r){var o=a-e,s=a;a-=e;var c=i(1+o,s),h=t[o],l=n?n(h):h;u(new Ae(l,h.node,r,null,c))},u=function(t){r=r?r.left=t:o=t},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?s(l,Ae.BLACK):(s(l,Ae.BLACK),s(l,Ae.RED))}return o}(new Le(t.length));return new Pe(r||e,o)},Ve={},Be=(Object.defineProperty(je,"Default",{get:function(){return h(Se,"ChildrenNode.ts has not been loaded"),Fe=Fe||new je({".priority":Ve},{".priority":Se})},enumerable:!0,configurable:!0}),je.prototype.get=function(t){var e=N(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Pe?e:null},je.prototype.hasIndex=function(t){return I(this.indexSet_,t.toString())},je.prototype.addIndex=function(t,e){h(t!==ye,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,i=[],o=!1,a=e.getIterator(ae.Wrap),s=a.getNext();s;)o=o||t.isDefinedOn(s.node),i.push(s),s=a.getNext();n=o?qe(i,t.getCompare()):Ve;var u=t.toString(),c=r({},this.indexSet_);c[u]=t;var l=r({},this.indexes_);return l[u]=n,new je(l,c)},je.prototype.addToIndexes=function(t,e){var n=this;return new je(D(this.indexes_,(function(r,i){var o=N(n.indexSet_,i);if(h(o,"Missing index implementation for "+i),r===Ve){if(o.isDefinedOn(t.node)){for(var a=[],s=e.getIterator(ae.Wrap),u=s.getNext();u;)u.name!==t.name&&a.push(u),u=s.getNext();return a.push(t),qe(a,o.getCompare())}return Ve}var c=e.get(t.name),l=r;return c&&(l=l.remove(new ae(t.name,c))),l.insert(t,t.node)})),this.indexSet_)},je.prototype.removeFromIndexes=function(t,e){return new je(D(this.indexes_,(function(n){if(n===Ve)return n;var r=e.get(t.name);return r?n.remove(new ae(t.name,r)):n})),this.indexSet_)},je);function je(t,e){this.indexes_=t,this.indexSet_=e}function We(t,e){return mt(t.name,e.name)}function Qe(t,e){return mt(t,e)}var Ke,He=(Object.defineProperty(ze,"EMPTY_NODE",{get:function(){return Ue=Ue||new ze(new Pe(Qe),null,Be.Default)},enumerable:!0,configurable:!0}),ze.prototype.isLeafNode=function(){return!1},ze.prototype.getPriority=function(){return this.priorityNode_||Ue},ze.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new ze(this.children_,t,this.indexMap_)},ze.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?Ue:e},ze.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},ze.prototype.hasChild=function(t){return null!==this.children_.get(t)},ze.prototype.updateImmediateChild=function(t,e){if(h(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n,r=new ae(t,e),i=void 0;n=e.isEmpty()?(i=this.children_.remove(t),this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,e),this.indexMap_.addToIndexes(r,this.children_));var o=i.isEmpty()?Ue:this.priorityNode_;return new ze(i,o,n)},ze.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;h(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},ze.prototype.isEmpty=function(){return this.children_.isEmpty()},ze.prototype.numChildren=function(){return this.children_.count()},ze.prototype.val=function(t){if(this.isEmpty())return null;var e={},n=0,r=0,i=!0;if(this.forEachChild(Se,(function(o,a){e[o]=a.val(t),n++,i&&ze.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1})),!t&&i&&r<2*n){var o=[];for(var a in e)o[a]=e[a];return o}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e},ze.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+ve(this.getPriority().val())+":"),this.forEachChild(Se,(function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)})),this.lazyHash_=""===t?"":J(t)}return this.lazyHash_},ze.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new ae(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},ze.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},ze.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new ae(e,this.children_.get(e)):null},ze.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},ze.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new ae(e,this.children_.get(e)):null},ze.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal((function(t){return e(t.name,t.node)})):this.children_.inorderTraversal(e)},ze.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},ze.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(function(t){return t}));for(var r=this.children_.getIteratorFrom(t.name,ae.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},ze.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},ze.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(function(t){return t}));for(var r=this.children_.getReverseIteratorFrom(t.name,ae.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},ze.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ye?-1:0},ze.prototype.withIndex=function(t){if(t===ye||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new ze(this.children_,this.priorityNode_,e)},ze.prototype.isIndexed=function(t){return t===ye||this.indexMap_.hasIndex(t)},ze.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(Se),r=e.getIterator(Se),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},ze.prototype.resolveIndex_=function(t){return t===ye?null:this.indexMap_.get(t.toString())},ze.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,ze);function ze(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ge(this.priorityNode_),this.children_.isEmpty()&&h(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function Ge(){return Ke.call(this,new Pe(Qe),He.EMPTY_NODE,Be.Default)||this}var Ye=new(n(Ge,Ke=He),Ge.prototype.compareTo=function(t){return t===this?0:1},Ge.prototype.equals=function(t){return t===this},Ge.prototype.getPriority=function(){return this},Ge.prototype.getImmediateChild=function(t){return He.EMPTY_NODE},Ge.prototype.isEmpty=function(){return!1},Ge);Object.defineProperties(ae,{MIN:{value:new ae(vt,He.EMPTY_NODE)},MAX:{value:new ae(gt,Ye)}}),pe.__EMPTY_NODE=He.EMPTY_NODE,Ee.__childrenNodeConstructor=He,de=Ye,be=Ye;var Xe,Je=!0;function $e(t,e){if(void 0===e&&(e=null),null===t)return He.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),h(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Ee(t,$e(e));if(t instanceof Array||!Je){var n=He.EMPTY_NODE;return bt(t,(function(e,r){if(I(t,e)&&"."!==e.substring(0,1)){var i=$e(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i))}})),n.updatePriority($e(e))}var r=[],i=!1;if(bt(t,(function(t,e){if("."!==t.substring(0,1)){var n=$e(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new ae(t,n)))}})),0===r.length)return He.EMPTY_NODE;var o=qe(r,We,(function(t){return t.name}),Qe);if(i){var a=qe(r,Se.getCompare());return new He(o,$e(e),new Be({".priority":a},{".priority":Se}))}return new He(o,$e(e),Be.Default)}function Ze(){return null!==Xe&&Xe.apply(this,arguments)||this}_e=$e;var tn,en=new(n(Ze,Xe=ce),Ze.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?mt(t.name,e.name):n},Ze.prototype.isDefinedOn=function(t){return!0},Ze.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},Ze.prototype.minPost=function(){return ae.MIN},Ze.prototype.maxPost=function(){return ae.MAX},Ze.prototype.makePost=function(t,e){var n=$e(t);return new ae(e,n)},Ze.prototype.toString=function(){return".value"},Ze),nn=(n(rn,tn=ce),rn.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},rn.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},rn.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?mt(t.name,e.name):i},rn.prototype.makePost=function(t,e){var n=$e(t),r=He.EMPTY_NODE.updateChild(this.indexPath_,n);return new ae(e,r)},rn.prototype.maxPost=function(){var t=He.EMPTY_NODE.updateChild(this.indexPath_,Ye);return new ae(gt,t)},rn.prototype.toString=function(){return this.indexPath_.slice().join("/")},rn);function rn(t){var e=tn.call(this)||this;return e.indexPath_=t,h(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var on=(an.prototype.val=function(){return x("DataSnapshot.val",0,0,arguments.length),this.node_.val()},an.prototype.exportVal=function(){return x("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},an.prototype.toJSON=function(){return x("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},an.prototype.exists=function(){return x("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},an.prototype.child=function(t){x("DataSnapshot.child",0,1,arguments.length),Qt("DataSnapshot.child",1,t=String(t),!1);var e=new It(t),n=this.ref_.child(e);return new an(this.node_.getChild(e),n,Se)},an.prototype.hasChild=function(t){x("DataSnapshot.hasChild",1,1,arguments.length),Qt("DataSnapshot.hasChild",1,t,!1);var e=new It(t);return!this.node_.getChild(e).isEmpty()},an.prototype.getPriority=function(){return x("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},an.prototype.forEach=function(t){var e=this;return x("DataSnapshot.forEach",1,1,arguments.length),M("DataSnapshot.forEach",1,t,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,(function(n,r){return t(new an(r,e.ref_.child(n),Se))}))},an.prototype.hasChildren=function(){return x("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(an.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),an.prototype.numChildren=function(){return x("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},an.prototype.getRef=function(){return x("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(an.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),an);function an(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var sn=(un.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},un.prototype.getEventType=function(){return this.eventType},un.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},un.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+C(this.snapshot.exportVal())},un);function un(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var cn=(hn.prototype.getPath=function(){return this.path},hn.prototype.getEventType=function(){return"cancel"},hn.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},hn.prototype.toString=function(){return this.path.toString()+":cancel"},hn);function hn(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var ln=(pn.prototype.respondsTo=function(t){return"value"===t},pn.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new sn("value",this,new on(t.snapshotNode,e.getRef(),n))},pn.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){h(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},pn.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new cn(this,t,e):null},pn.prototype.matches=function(t){return t instanceof pn&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},pn.prototype.hasAnyCallback=function(){return null!==this.callback_},pn);function pn(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var fn,dn=(yn.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return I(this.callbacks_,e="children_removed"===e?"child_removed":e)},yn.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new cn(this,t,e):null},yn.prototype.createEvent=function(t,e){h(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new sn(t.type,this,new on(t.snapshotNode,n,r),t.prevName)},yn.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){h(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},yn.prototype.matches=function(t){var e=this;if(t instanceof yn){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var n=Object.keys(t.callbacks_),r=Object.keys(this.callbacks_),i=n.length;if(i===r.length){if(1!==i)return r.every((function(n){return t.callbacks_[n]===e.callbacks_[n]}));var o=n[0],a=r[0];return!(a!==o||t.callbacks_[o]&&this.callbacks_[a]&&t.callbacks_[o]!==this.callbacks_[a])}}}return!1},yn.prototype.hasAnyCallback=function(){return null!==this.callbacks_},yn);function yn(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var vn=(Object.defineProperty(gn,"__referenceConstructor",{get:function(){return h(fn,"Reference.ts has not been loaded"),fn},set:function(t){fn=t},enumerable:!0,configurable:!0}),gn.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===ye){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==vt)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!==gt)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Se){if(null!=e&&!Ut(e)||null!=n&&!Ut(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(h(t.getIndex()instanceof nn||t.getIndex()===en,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},gn.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},gn.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},gn.prototype.getQueryParams=function(){return this.queryParams_},gn.prototype.getRef=function(){return x("Query.ref",0,0,arguments.length),new gn.__referenceConstructor(this.repo,this.path)},gn.prototype.on=function(t,e,n,r){x("Query.on",2,4,arguments.length),jt("Query.on",1,t,!1),M("Query.on",2,e,!1);var i=gn.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},gn.prototype.onValueEvent=function(t,e,n){var r=new ln(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},gn.prototype.onChildEvent=function(t,e,n){var r=new dn(t,e,n);this.repo.addEventCallbackForQuery(this,r)},gn.prototype.off=function(t,e,n){x("Query.off",0,3,arguments.length),jt("Query.off",1,t,!0),M("Query.off",2,e,!0),F("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new ln(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new dn(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},gn.prototype.once=function(t,e,n,r){var i=this;x("Query.once",1,4,arguments.length),jt("Query.once",1,t,!1),M("Query.once",2,e,!0);var o=gn.getCancelAndContextArgs_("Query.once",n,r),a=!0,s=new f;s.promise.catch((function(){}));var u=function(n){a&&(a=!1,i.off(t,u),e&&e.bind(o.context)(n),s.resolve(n))};return this.on(t,u,(function(e){i.off(t,u),o.cancel&&o.cancel.bind(o.context)(e),s.reject(e)})),s.promise},gn.prototype.limitToFirst=function(t){if(x("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new gn(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},gn.prototype.limitToLast=function(t){if(x("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new gn(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},gn.prototype.orderByChild=function(t){if(x("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');Qt("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new It(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new nn(e),r=this.queryParams_.orderBy(n);return gn.validateQueryEndpoints_(r),new gn(this.repo,this.path,r,!0)},gn.prototype.orderByKey=function(){x("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(ye);return gn.validateQueryEndpoints_(t),new gn(this.repo,this.path,t,!0)},gn.prototype.orderByPriority=function(){x("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Se);return gn.validateQueryEndpoints_(t),new gn(this.repo,this.path,t,!0)},gn.prototype.orderByValue=function(){x("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(en);return gn.validateQueryEndpoints_(t),new gn(this.repo,this.path,t,!0)},gn.prototype.startAt=function(t,e){void 0===t&&(t=null),x("Query.startAt",0,2,arguments.length),qt("Query.startAt",1,t,this.path,!0),Wt("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(gn.validateLimit_(n),gn.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new gn(this.repo,this.path,n,this.orderByCalled_)},gn.prototype.endAt=function(t,e){void 0===t&&(t=null),x("Query.endAt",0,2,arguments.length),qt("Query.endAt",1,t,this.path,!0),Wt("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(gn.validateLimit_(n),gn.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new gn(this.repo,this.path,n,this.orderByCalled_)},gn.prototype.equalTo=function(t,e){if(x("Query.equalTo",1,2,arguments.length),qt("Query.equalTo",1,t,this.path,!1),Wt("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},gn.prototype.toString=function(){return x("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},gn.prototype.toJSON=function(){return x("Query.toJSON",0,1,arguments.length),this.toString()},gn.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},gn.prototype.queryIdentifier=function(){var t=this.queryObject(),e=_t(t);return"{}"===e?"default":e},gn.prototype.isEqual=function(t){if(x("Query.isEqual",1,1,arguments.length),!(t instanceof gn))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},gn.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,M(t,3,r.cancel,!0),r.context=n,F(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(L(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(gn.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),gn);function gn(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var mn=(_n.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},_n.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new _n);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},_n.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Se,(function(t,e){n.remember(new It(t),e)})),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},_n.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild((function(n,r){var i=new It(t.toString()+"/"+n);r.forEachTree(i,e)}))},_n.prototype.forEachChild=function(t){this.children.forEach((function(e,n){t(n,e)}))},_n);function _n(){this.value=null,this.children=new Map}function bn(t,e){return t&&"object"==typeof t?(h(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}var wn,En,Tn=function(t,e){var n,r=bn(t.getPriority().val(),e);if(t.isLeafNode()){var i=t,o=bn(i.getValue(),e);return o!==i.getValue()||r!==i.getPriority().val()?new Ee(o,$e(r)):t}var a=t;return r!==(n=a).getPriority().val()&&(n=n.updatePriority(new Ee(r))),a.forEachChild(Se,(function(t,r){var i=Tn(r,e);i!==r&&(n=n.updateImmediateChild(t,i))})),n};(En=wn=wn||{})[En.OVERWRITE=0]="OVERWRITE",En[En.MERGE=1]="MERGE",En[En.ACK_USER_WRITE=2]="ACK_USER_WRITE",En[En.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Cn=(Sn.User=new Sn(!0,!1,null,!1),Sn.Server=new Sn(!1,!0,null,!1),Sn.forServerTaggedQuery=function(t){return new Sn(!1,!0,t,!0)},Sn);function Sn(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,h(!r||e,"Tagged queries must be from server.")}var In,Nn=(An.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return h(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new It(t));return new An(It.Empty,e,this.revert)}return h(this.path.getFront()===t,"operationForChild called for unrelated child."),new An(this.path.popFront(),this.affectedTree,this.revert)},An);function An(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=wn.ACK_USER_WRITE,this.source=Cn.User}var Dn=(kn.fromObject=function(t){var e=kn.Empty;return bt(t,(function(t,n){e=e.set(new It(t),n)})),e},kn.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},kn.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:It.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new It(n).child(i.path),value:i.value}},kn.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,(function(){return!0}))},kn.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):kn.Empty},kn.prototype.set=function(t,e){if(t.isEmpty())return new kn(e,this.children);var n=t.getFront(),r=(this.children.get(n)||kn.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new kn(this.value,i)},kn.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?kn.Empty:new kn(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?kn.Empty:new kn(this.value,i)}return this},kn.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},kn.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n,r=t.getFront(),i=(this.children.get(r)||kn.Empty).setTree(t.popFront(),e);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new kn(this.value,n)},kn.prototype.fold=function(t){return this.fold_(It.Empty,t)},kn.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(t.child(r),e)})),e(t,this.value,n)},kn.prototype.findOnPath=function(t,e){return this.findOnPath_(t,It.Empty,e)},kn.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},kn.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,It.Empty,e)},kn.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):kn.Empty},kn.prototype.foreach=function(t){this.foreach_(It.Empty,t)},kn.prototype.foreach_=function(t,e){this.children.inorderTraversal((function(n,r){r.foreach_(t.child(n),e)})),this.value&&e(t,this.value)},kn.prototype.foreachChild=function(t){this.children.inorderTraversal((function(e,n){n.value&&t(e,n.value)}))},kn.Empty=new kn(null),kn);function kn(t,e){void 0===e&&(e=In=In||new Pe(ot)),this.value=t,this.children=e}var Rn=(Pn.prototype.operationForChild=function(t){return this.path.isEmpty()?new Pn(this.source,It.Empty):new Pn(this.source,this.path.popFront())},Pn);function Pn(t,e){this.source=t,this.path=e,this.type=wn.LISTEN_COMPLETE}var On=(xn.prototype.operationForChild=function(t){return this.path.isEmpty()?new xn(this.source,It.Empty,this.snap.getImmediateChild(t)):new xn(this.source,this.path.popFront(),this.snap)},xn);function xn(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=wn.OVERWRITE}var Ln=(Mn.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new It(t));return e.isEmpty()?null:e.value?new On(this.source,It.Empty,e.value):new Mn(this.source,It.Empty,e)}return h(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new Mn(this.source,this.path.popFront(),this.children)},Mn.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},Mn);function Mn(t,e,n){this.source=t,this.path=e,this.children=n,this.type=wn.MERGE}var Fn=(Un.prototype.isFullyInitialized=function(){return this.fullyInitialized_},Un.prototype.isFiltered=function(){return this.filtered_},Un.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},Un.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},Un.prototype.getNode=function(){return this.node_},Un);function Un(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var qn=(Vn.prototype.updateEventSnap=function(t,e,n){return new Vn(new Fn(t,e,n),this.serverCache_)},Vn.prototype.updateServerSnap=function(t,e,n){return new Vn(this.eventCache_,new Fn(t,e,n))},Vn.prototype.getEventCache=function(){return this.eventCache_},Vn.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},Vn.prototype.getServerCache=function(){return this.serverCache_},Vn.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},Vn.Empty=new Vn(new Fn(He.EMPTY_NODE,!1,!1),new Fn(He.EMPTY_NODE,!1,!1)),Vn);function Vn(t,e){this.eventCache_=t,this.serverCache_=e}var Bn=(jn.valueChange=function(t){return new jn(jn.VALUE,t)},jn.childAddedChange=function(t,e){return new jn(jn.CHILD_ADDED,e,t)},jn.childRemovedChange=function(t,e){return new jn(jn.CHILD_REMOVED,e,t)},jn.childChangedChange=function(t,e,n){return new jn(jn.CHILD_CHANGED,e,t,n)},jn.childMovedChange=function(t,e){return new jn(jn.CHILD_MOVED,e,t)},jn.CHILD_ADDED="child_added",jn.CHILD_REMOVED="child_removed",jn.CHILD_CHANGED="child_changed",jn.CHILD_MOVED="child_moved",jn.VALUE="value",jn);function jn(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var Wn=(Qn.prototype.updateChild=function(t,e,n,r,i,o){h(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(Bn.childRemovedChange(e,a)):h(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Bn.childAddedChange(e,n)):o.trackChildChange(Bn.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},Qn.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Se,(function(t,r){e.hasChild(t)||n.trackChildChange(Bn.childRemovedChange(t,r))})),e.isLeafNode()||e.forEachChild(Se,(function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(Bn.childChangedChange(e,r,i))}else n.trackChildChange(Bn.childAddedChange(e,r))}))),e.withIndex(this.index_)},Qn.prototype.updatePriority=function(t,e){return t.isEmpty()?He.EMPTY_NODE:t.updatePriority(e)},Qn.prototype.filtersNodes=function(){return!1},Qn.prototype.getIndexedFilter=function(){return this},Qn.prototype.getIndex=function(){return this.index_},Qn);function Qn(t){this.index_=t}var Kn=(Hn.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;h(e===Bn.CHILD_ADDED||e===Bn.CHILD_CHANGED||e===Bn.CHILD_REMOVED,"Only child changes supported for tracking"),h(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e===Bn.CHILD_ADDED&&i===Bn.CHILD_REMOVED)this.changeMap.set(n,Bn.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e===Bn.CHILD_REMOVED&&i===Bn.CHILD_ADDED)this.changeMap.delete(n);else if(e===Bn.CHILD_REMOVED&&i===Bn.CHILD_CHANGED)this.changeMap.set(n,Bn.childRemovedChange(n,r.oldSnap));else if(e===Bn.CHILD_CHANGED&&i===Bn.CHILD_ADDED)this.changeMap.set(n,Bn.childAddedChange(n,t.snapshotNode));else{if(e!==Bn.CHILD_CHANGED||i!==Bn.CHILD_CHANGED)throw l("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,Bn.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},Hn.prototype.getChanges=function(){return Array.from(this.changeMap.values())},Hn);function Hn(){this.changeMap=new Map}function zn(){}var Gn=new(zn.prototype.getCompleteChild=function(t){return null},zn.prototype.getChildAfterChild=function(t,e,n){return null},zn),Yn=(Xn.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new Fn(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},Xn.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},Xn);function Xn(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var Jn=function(t,e){this.viewCache=t,this.changes=e},$n=(Zn.prototype.assertIndexed=function(t){h(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),h(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},Zn.prototype.applyOperation=function(t,e,n,r){var i,o,a=new Kn;if(e.type===wn.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(h(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===wn.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(h(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===wn.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==wn.LISTEN_COMPLETE)throw l("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var p=a.getChanges();return Zn.maybeAddValueEvent_(t,i,p),new Jn(i,p)},Zn.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(Bn.valueChange(e.getCompleteEventSnap()))}},Zn.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(h(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=n.calcCompleteEventChildren(u instanceof He?u:He.EMPTY_NODE);a=this.filter_.updateFullNode(t.getEventCache().getNode(),c,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var p=e.getFront();if(".priority"===p){h(1===e.getLength(),"Can't have a priority with additional path components");var f=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,f,s);a=null!=d?this.filter_.updatePriority(f,d):o.getNode()}else{var y=e.popFront(),v=void 0;if(o.isCompleteForChild(p)){s=t.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);v=null!=g?o.getNode().getImmediateChild(p).updateChild(y,g):o.getNode().getImmediateChild(p)}else v=n.calcCompleteChild(p,t.getServerCache());a=null!=v?this.filter_.updateChild(o.getNode(),p,v,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},Zn.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var p=e.popFront(),f=u.getNode().getImmediateChild(l).updateChild(p,n);s=".priority"===l?c.updatePriority(u.getNode(),f):c.updateChild(u.getNode(),l,f,p,Gn,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new Yn(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},Zn.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new Yn(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),p=u.getNode().getImmediateChild(h),f=void 0;if(l.isEmpty())f=n;else{var d=c.getCompleteChild(h);f=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):He.EMPTY_NODE}if(p.equals(f))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,f,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},Zn.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},Zn.prototype.applyUserMerge_=function(t,e,n,r,i,o){var a=this,s=t;return n.foreach((function(n,u){var c=e.child(n);Zn.cacheHasChild_(t,c.getFront())&&(s=a.applyUserOverwrite_(s,c,u,r,i,o))})),n.foreach((function(n,u){var c=e.child(n);Zn.cacheHasChild_(t,c.getFront())||(s=a.applyUserOverwrite_(s,c,u,r,i,o))})),s},Zn.prototype.applyMerge_=function(t,e){return e.foreach((function(e,n){t=t.updateChild(e,n)})),t},Zn.prototype.applyServerMerge_=function(t,e,n,r,i,o,a){var s=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:Dn.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal((function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=s.applyMerge_(u,n);c=s.applyServerOverwrite_(c,new It(e),l,r,i,o,a)}})),u.children.inorderTraversal((function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),p=s.applyMerge_(l,n);c=s.applyServerOverwrite_(c,new It(e),p,r,i,o,a)}})),c},Zn.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,s.getNode().getChild(e),r,i,a,o);if(e.isEmpty()){var u=Dn.Empty;return s.getNode().forEachChild(ye,(function(t,e){u=u.set(new It(t),e)})),this.applyServerMerge_(t,e,u,r,i,a,o)}return t}var c=Dn.Empty;return n.foreach((function(t,n){var r=e.child(t);s.isCompleteForPath(r)&&(c=c.set(t,s.getNode().getChild(r)))})),this.applyServerMerge_(t,e,c,r,i,a,o)},Zn.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,Gn,r)},Zn.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new Yn(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var l=t.getServerCache().getNode();h(l instanceof He,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(l)}u=this.filter_.updateFullNode(s,c=c,i)}else{var p=e.getFront(),f=n.calcCompleteChild(p,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(p)&&(f=s.getImmediateChild(p)),(u=null!=f?this.filter_.updateChild(s,p,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(p)?this.filter_.updateChild(s,p,He.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(It.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},Zn);function Zn(t){this.filter_=t}var tr=(er.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach((function(t){t.type===Bn.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(Bn.childMovedChange(t.childName,t.snapshotNode))})),this.generateEventsForType_(i,Bn.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,Bn.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,Bn.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,Bn.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,Bn.VALUE,t,n,e),i},er.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,a=n.filter((function(t){return t.type===e}));a.sort(this.compareChanges_.bind(this)),a.forEach((function(e){var n=o.materializeSingleChange_(e,i);r.forEach((function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))}))}))},er.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},er.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw l("Should only compare child_ events.");var n=new ae(t.childName,t.snapshotNode),r=new ae(e.childName,e.snapshotNode);return this.index_.compare(n,r)},er);function er(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var nr,rr=(ir.prototype.getQuery=function(){return this.query_},ir.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},ir.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},ir.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},ir.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},ir.prototype.removeEventRegistration=function(t,e){var n=[];if(e){h(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach((function(t){var i=t.createCancelEvent(e=e,r);i&&n.push(i)}))}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},ir.prototype.applyOperation=function(t,e,n){t.type===wn.MERGE&&null!==t.source.queryId&&(h(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),h(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),h(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},ir.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(Se,(function(t,e){n.push(Bn.childAddedChange(t,e))})),e.isFullyInitialized()&&n.push(Bn.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},ir.prototype.generateEventsForChanges_=function(t,e,n){return this.eventGenerator_.generateEventsForChanges(t,e,n?[n]:this.eventRegistrations_)},ir);function ir(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new Wn(n.getIndex()),i=n.getNodeFilter();this.processor_=new $n(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(He.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(He.EMPTY_NODE,a.getNode(),null),c=new Fn(s,o.isFullyInitialized(),r.filtersNodes()),h=new Fn(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new qn(h,c),this.eventGenerator_=new tr(this.query_)}var or=(Object.defineProperty(ar,"__referenceConstructor",{get:function(){return h(nr,"Reference.ts has not been loaded"),nr},set:function(t){h(!nr,"__referenceConstructor has already been defined"),nr=t},enumerable:!0,configurable:!0}),ar.prototype.isEmpty=function(){return 0===this.views.size},ar.prototype.applyOperation=function(t,e,n){var r,o,a=t.source.queryId;if(null!==a){var s=this.views.get(a);return h(null!=s,"SyncTree gave us an op for an invalid query."),s.applyOperation(t,e,n)}var u=[];try{for(var c=i(this.views.values()),l=c.next();!l.done;l=c.next())u=u.concat((s=l.value).applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}return u},ar.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s,u=n.calcCompleteEventCache(i?r:null);s=!!u||(u=r instanceof He?n.calcCompleteEventChildren(r):He.EMPTY_NODE,!1);var c=new qn(new Fn(u,s,!1),new Fn(r,i,!1));a=new rr(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},ar.prototype.removeEventRegistration=function(t,e,n){var r,a,s=t.queryIdentifier(),u=[],c=[],h=this.hasCompleteView();if("default"===s)try{for(var l=i(this.views.entries()),p=l.next();!p.done;p=l.next()){var f=o(p.value,2),d=f[0],y=f[1];c=c.concat(y.removeEventRegistration(e,n)),y.isEmpty()&&(this.views.delete(d),y.getQuery().getQueryParams().loadsAllData()||u.push(y.getQuery()))}}catch(t){r={error:t}}finally{try{p&&!p.done&&(a=l.return)&&a.call(l)}finally{if(r)throw r.error}}else(y=this.views.get(s))&&(c=c.concat(y.removeEventRegistration(e,n)),y.isEmpty()&&(this.views.delete(s),y.getQuery().getQueryParams().loadsAllData()||u.push(y.getQuery())));return h&&!this.hasCompleteView()&&u.push(new ar.__referenceConstructor(t.repo,t.path)),{removed:u,events:c}},ar.prototype.getQueryViews=function(){var t,e,n=[];try{for(var r=i(this.views.values()),o=r.next();!o.done;o=r.next()){var a=o.value;a.getQuery().getQueryParams().loadsAllData()||n.push(a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},ar.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var o=i(this.views.values()),a=o.next();!a.done;a=o.next())r=r||a.value.getCompleteServerCache(t)}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r},ar.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},ar.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},ar.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},ar.prototype.getCompleteView=function(){var t,e;try{for(var n=i(this.views.values()),r=n.next();!r.done;r=n.next()){var o=r.value;if(o.getQuery().getQueryParams().loadsAllData())return o}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},ar);function ar(){this.views=new Map}var sr=(ur.prototype.addWrite=function(t,e){if(t.isEmpty())return new ur(new Dn(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=It.relativePath(r,t);return i=i.updateChild(o,e),new ur(this.writeTree_.set(r,i))}var a=new Dn(e);return new ur(this.writeTree_.setTree(t,a))},ur.prototype.addWrites=function(t,e){var n=this;return bt(e,(function(e,r){n=n.addWrite(t.child(e),r)})),n},ur.prototype.removeWrite=function(t){return t.isEmpty()?ur.Empty:new ur(this.writeTree_.setTree(t,Dn.Empty))},ur.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},ur.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(It.relativePath(e.path,t)):null},ur.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Se,(function(e,n){t.push(new ae(e,n))})):this.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new ae(e,n.value))})),t},ur.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new ur(null!=e?new Dn(e):this.writeTree_.subtree(t))},ur.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},ur.prototype.apply=function(t){return function t(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal((function(n,o){".priority"===n?(h(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=t(e.child(n),o,r)})),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r}(It.Empty,this.writeTree_,t)},ur.Empty=new ur(new Dn(null)),ur);function ur(t){this.writeTree_=t}var cr=(hr.prototype.childWrites=function(t){return new lr(t,this)},hr.prototype.addOverwrite=function(t,e,n,r){h(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},hr.prototype.addMerge=function(t,e,n){h(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},hr.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},hr.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex((function(e){return e.writeId===t}));h(0<=n,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(n<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):bt(r.children,(function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))})),!0)},hr.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},hr.prototype.calcCompleteEventCache=function(t,e,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(t);return!r&&i.isEmpty()?e:r||null!=e||i.hasCompleteWrite(It.Empty)?hr.layerTree_(this.allWrites_,(function(e){return(e.visible||r)&&(!n||!~n.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))}),t).apply(s=e||He.EMPTY_NODE):null}var o=this.visibleWrites_.getCompleteNode(t);if(null!=o)return o;var a=this.visibleWrites_.childCompoundWrite(t);if(a.isEmpty())return e;if(null!=e||a.hasCompleteWrite(It.Empty)){var s=e||He.EMPTY_NODE;return a.apply(s)}return null},hr.prototype.calcCompleteEventChildren=function(t,e){var n=He.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(Se,(function(t,e){n=n.updateImmediateChild(t,e)})),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Se,(function(t,e){var r=i.childCompoundWrite(new It(t)).apply(e);n=n.updateImmediateChild(t,r)})),i.getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n},hr.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){h(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},hr.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},hr.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},hr.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(It.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),p=l.getNext();p&&c.length<r;)0!==h(p,n)&&c.push(p),p=l.getNext();return c},hr.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},hr.prototype.resetTree_=function(){this.visibleWrites_=hr.layerTree_(this.allWrites_,hr.DefaultFilter_,It.Empty),this.lastWriteId_=0<this.allWrites_.length?this.allWrites_[this.allWrites_.length-1].writeId:-1},hr.DefaultFilter_=function(t){return t.visible},hr.layerTree_=function(t,e,n){for(var r=sr.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=It.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=It.relativePath(a,n),r=r.addWrite(It.Empty,o.snap.getChild(s)));else{if(!o.children)throw l("WriteRecord should have .snap or .children");if(n.contains(a))s=It.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=It.relativePath(a,n)).isEmpty())r=r.addWrites(It.Empty,o.children);else{var u=N(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(It.Empty,c)}}}}}return r},hr);function hr(){this.visibleWrites_=sr.Empty,this.allWrites_=[],this.lastWriteId_=-1}var lr=(pr.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},pr.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},pr.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},pr.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},pr.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},pr.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},pr.prototype.child=function(t){return new pr(this.treePath_.child(t),this.writeTree_)},pr);function pr(t,e){this.treePath_=t,this.writeTree_=e}var fr=(dr.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new On(Cn.User,t,e)):[]},dr.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=Dn.fromObject(e);return this.applyOperationToSyncPoints_(new Ln(Cn.User,t,r))},dr.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=Dn.Empty;return null!=n.snap?r=r.set(It.Empty,!0):bt(n.children,(function(t,e){r=r.set(new It(t),e)})),this.applyOperationToSyncPoints_(new Nn(n.path,r,e))}return[]},dr.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new On(Cn.Server,t,e))},dr.prototype.applyServerMerge=function(t,e){var n=Dn.fromObject(e);return this.applyOperationToSyncPoints_(new Ln(Cn.Server,t,n))},dr.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new Rn(Cn.Server,t))},dr.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=dr.parseQueryKey_(r),o=i.path,a=i.queryId,s=It.relativePath(o,t),u=new On(Cn.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},dr.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=dr.parseQueryKey_(r),o=i.path,a=i.queryId,s=It.relativePath(o,t),u=Dn.fromObject(e),c=new Ln(Cn.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},dr.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=dr.parseQueryKey_(n),i=r.path,o=r.queryId,a=It.relativePath(i,t),s=new Rn(Cn.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},dr.prototype.addEventRegistration=function(t,e){var n=t.path,r=null,i=!1;this.syncPointTree_.foreachOnPath(n,(function(t,e){var o=It.relativePath(t,n);r=r||e.getCompleteServerCache(o),i=i||e.hasCompleteView()}));var o,a=this.syncPointTree_.get(n);a?(i=i||a.hasCompleteView(),r=r||a.getCompleteServerCache(It.Empty)):(a=new or,this.syncPointTree_=this.syncPointTree_.set(n,a)),null!=r?o=!0:(o=!1,r=He.EMPTY_NODE,this.syncPointTree_.subtree(n).foreachChild((function(t,e){var n=e.getCompleteServerCache(It.Empty);n&&(r=r.updateImmediateChild(t,n))})));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=dr.makeQueryKey_(t);h(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=dr.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var l=this.pendingWriteTree_.childWrites(n),p=a.addEventRegistration(t,e,l,r,o);if(!s&&!i){var f=a.viewForQuery(t);p=p.concat(this.setupListener_(t,f))}return p},dr.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex((function(t){return t.getQueryParams().loadsAllData()})),h=this.syncPointTree_.findOnPath(i,(function(t,e){return e.hasCompleteView()}));if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(l),f=0;f<p.length;++f){var d=p[f],y=d.getQuery(),v=this.createListenerForView_(d);this.listenProvider_.startListening(dr.queryForListening_(y),this.tagForQuery_(y),v.hashFn,v.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(dr.queryForListening_(t),null):u.forEach((function(t){var e=r.queryToTagMap.get(dr.makeQueryKey_(t));r.listenProvider_.stopListening(dr.queryForListening_(t),e)}))),this.removeTags_(u)}return a},dr.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,(function(e,n){var r=It.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i}));return n.calcCompleteEventCache(t,r,e,!0)},dr.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold((function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),bt(n,(function(t,e){r=r.concat(e)})),r}))},dr.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=dr.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},dr.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},dr.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(dr.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)h(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold((function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map((function(t){return t.getQuery()})))),bt(n,(function(t,e){r=r.concat(e)})),r})),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(dr.queryForListening_(c),this.tagForQuery_(c))}return o},dr.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||He.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},dr.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},dr.parseQueryKey_=function(t){var e=t.indexOf("$");return h(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new It(t.substr(0,e))}},dr.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},dr.prototype.tagForQuery_=function(t){var e=dr.makeQueryKey_(t);return this.queryToTagMap.get(e)},dr.getNextQueryTag_=function(){return dr.nextQueryTag_++},dr.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);h(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},dr.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(It.Empty))},dr.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(It.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(It.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},dr.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(It.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(It.Empty));var a=[];return e.children.inorderTraversal((function(e,o){var s=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(a=a.concat(i.applyOperationDescendantsHelper_(c,o,s,u)))})),o&&(a=a.concat(o.applyOperation(t,r,n))),a},dr.nextQueryTag_=1,dr);function dr(t){this.listenProvider_=t,this.syncPointTree_=Dn.Empty,this.pendingWriteTree_=new cr,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var yr=(vr.prototype.getNode=function(t){return this.rootNode_.getChild(t)},vr.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},vr);function vr(){this.rootNode_=He.EMPTY_NODE}var gr=(mr.prototype.getToken=function(t){return this.auth_?this.auth_.getToken(t).catch((function(t){return t&&"auth/token-not-initialized"===t.code?(Z("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})):Promise.resolve(null)},mr.prototype.addTokenChangeListener=function(t){this.auth_?this.auth_.addAuthTokenListener(t):(setTimeout((function(){return t(null)}),0),this.authProvider_.get().then((function(e){return e.addAuthTokenListener(t)})))},mr.prototype.removeTokenChangeListener=function(t){this.authProvider_.get().then((function(e){return e.removeAuthTokenListener(t)}))},mr.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';rt(t+="credential"in this.app_.options?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.')},mr);function mr(t,e){var n=this;this.app_=t,this.authProvider_=e,this.auth_=null,this.auth_=e.getImmediate({optional:!0}),this.auth_||e.get().then((function(t){return n.auth_=t}))}var _r=(br.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),I(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},br.prototype.get=function(){return function(t){return function t(e,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return n}for(var r in n)n.hasOwnProperty(r)&&(e[r]=t(e[r],n[r]));return e}(void 0,t)}(this.counters_)},br);function br(){this.counters_={}}var wr=(Er.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new _r),this.collections_[e]},Er.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},Er.collections_={},Er.reporters_={},Er);function Er(){}var Tr=(Cr.prototype.get=function(){var t=this.collection_.get(),e=r({},t);return this.last_&&bt(this.last_,(function(t,n){e[t]=e[t]-n})),this.last_=t,e},Cr);function Cr(t){this.collection_=t,this.last_=null}var Sr=(Ir.prototype.includeStat=function(t){this.statsToReport_[t]=!0},Ir.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;bt(e,(function(e,i){0<i&&I(t.statsToReport_,e)&&(n[e]=i,r=!0)})),r&&this.server_.reportStats(n),Tt(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},Ir);function Ir(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Tr(t);var n=1e4+2e4*Math.random();Tt(this.reportStats_.bind(this),Math.floor(n))}var Nr=(Ar.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Dr(i)),e.add(r)}e&&this.eventLists_.push(e)},Ar.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.equals(t)}))},Ar.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.contains(t)||t.contains(e)}))},Ar.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},Ar);function Ar(){this.eventLists_=[],this.recursionDepth_=0}var Dr=(kr.prototype.add=function(t){this.events_.push(t)},kr.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();dt&&Z("event: "+e.toString()),Et(n)}}},kr.prototype.getPath=function(){return this.path_},kr);function kr(t){this.path_=t,this.events_=[]}var Rr=(Pr.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=a(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},Pr.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},Pr.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},Pr.prototype.validateEventType_=function(t){h(this.allowedEvents_.find((function(e){return e===t})),"Unknown event: "+t)},Pr);function Pr(t){this.allowedEvents_=t,this.listeners_={},h(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var Or,xr=(n(Lr,Or=Rr),Lr.getInstance=function(){return new Lr},Lr.prototype.getInitialEvent=function(t){return h("visible"===t,"Unknown event type: "+t),[this.visible_]},Lr);function Lr(){var t,e,n=Or.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),n.visible_=!0,e&&document.addEventListener(e,(function(){var e=!document[t];e!==n.visible_&&(n.visible_=e,n.trigger("visible",e))}),!1),n}var Mr,Fr=(n(Ur,Mr=Rr),Ur.getInstance=function(){return new Ur},Ur.prototype.getInitialEvent=function(t){return h("online"===t,"Unknown event type: "+t),[this.online_]},Ur.prototype.currentlyOnline=function(){return this.online_},Ur);function Ur(){var t=Mr.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||y()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}var qr=(Vr.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},Vr.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&Et((function(){n.onMessage_(t[e])}))},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},Vr);function Vr(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var Br=(jr.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new qr(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Wr((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=o(t,5),i=r[0],a=r[1],s=r[2];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===i)n.id=a,n.password=s;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);a?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(a,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=o(t,2),i=r[0],a=r[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,a)}),(function(){n.onClosed_()}),n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(kt)&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,(function(){}))}}))},jr.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},jr.forceAllow=function(){jr.forceAllow_=!0},jr.forceDisallow=function(){jr.forceDisallow_=!0},jr.isAvailable=function(){return!!jr.forceAllow_||!(jr.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},jr.prototype.markConnectionHealthy=function(){},jr.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},jr.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},jr.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},jr.prototype.send=function(t){var e=C(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=st(function(t){var e=s(t);return p.encodeByteArray(e,!0)}(e),1840),r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++},jr.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},jr.prototype.incrementIncomingBytes_=function(t){var e=C(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},jr);function jr(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=tt(t),this.stats_=wr.getCollection(e),this.urlFn=function(t){return e.connectionURL(Pt,t)}}var Wr=(Qr.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||Z("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},Qr.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)}),Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},Qr.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},Qr.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return this.addLongPollTag_(e+=n,this.currentSerial),!0}return!1},Qr.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},Qr.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,(function(){clearTimeout(i),r()}))},Qr.prototype.addTag=function(t,e){var n=this;setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){Z("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}}),Math.floor(1))},Qr);function Qr(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=pt(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=Qr.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){Z("frame writing exception"),t.stack&&Z(t.stack),Z(t)}}var Kr="",Hr=null;"undefined"!=typeof MozWebSocket?Hr=MozWebSocket:"undefined"!=typeof WebSocket&&(Hr=WebSocket);var zr=(Gr.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(kt)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(Rt,r)},Gr.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ct.set("previous_websocket_failure",!0);try{if(v()){var r={headers:{"User-Agent":"Firebase/5/"+Kr+"/"+process.platform+"/"+(c.NODE_ADMIN?"AdminNode":"Node")}},i=process.env,o=0===this.connURL.indexOf("wss://")?i.HTTPS_PROXY||i.https_proxy:i.HTTP_PROXY||i.http_proxy;o&&(r.proxy={origin:o}),this.mySock=new Hr(this.connURL,[],r)}else this.mySock=new Hr(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var a=t.message||t.data;return a&&this.log_(a),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},Gr.prototype.start=function(){},Gr.forceDisallow=function(){Gr.forceDisallow_=!0},Gr.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==Hr&&!Gr.forceDisallow_},Gr.previouslyFailed=function(){return ct.isInMemoryStorage||!0===ct.get("previous_websocket_failure")},Gr.prototype.markConnectionHealthy=function(){ct.remove("previous_websocket_failure")},Gr.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var n=T(e);this.onMessage(n)}},Gr.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},Gr.prototype.extractFrameCount_=function(t){if(h(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},Gr.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},Gr.prototype.send=function(t){this.resetKeepAlive();var e=C(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=st(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},Gr.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},Gr.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},Gr.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},Gr.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()}),Math.floor(45e3))},Gr.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},Gr.responsesRequiredToBeHealthy=2,Gr.healthyTimeout=3e4,Gr);function Gr(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=tt(this.connId),this.stats_=wr.getCollection(e),this.connURL=Gr.connectionURL_(e,n,r)}var Yr=(Object.defineProperty(Xr,"ALL_TRANSPORTS",{get:function(){return[Br,zr]},enumerable:!0,configurable:!0}),Xr.prototype.initTransports_=function(t){var e,n,r=zr&&zr.isAvailable(),o=r&&!zr.previouslyFailed();if(t.webSocketOnly&&(r||rt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[zr];else{var a=this.transports_=[];try{for(var s=i(Xr.ALL_TRANSPORTS),u=s.next();!u.done;u=s.next()){var c=u.value;c&&c.isAvailable()&&a.push(c)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}}},Xr.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},Xr.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},Xr);function Xr(t){this.initTransports_(t)}var Jr=($r.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){t.conn_&&t.conn_.open(n,r)}),Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Tt((function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))}),Math.floor(i)))},$r.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},$r.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},$r.prototype.connReceiver_=function(t){var e=this;return function(n){2!==e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},$r.prototype.sendRequest=function(t){this.sendData_({t:"d",d:t})},$r.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},$r.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},$r.prototype.onSecondaryMessageReceived_=function(t){var e=at("t",t),n=at("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},$r.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},$r.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},$r.prototype.onPrimaryMessageReceived_=function(t){var e=at("t",t),n=at("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)},$r.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},$r.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},$r.prototype.onControl_=function(t){var e=at("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?et("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):et("Unknown control packet command: "+e)}},$r.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&rt("Protocol version mismatch detected"),this.tryStartUpgrade_())},$r.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},$r.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Tt((function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())}),Math.floor(6e4))},$r.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},$r.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Tt((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},$r.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},$r.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},$r.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ct.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},$r.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},$r.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},$r.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},$r.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},$r);function $r(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=tt("c:"+this.id+":"),this.transportManager_=new Yr(e),this.log_("Connection created"),this.start_()}var Zr=(ti.prototype.put=function(t,e,n,r){},ti.prototype.merge=function(t,e,n,r){},ti.prototype.refreshAuthToken=function(t){},ti.prototype.onDisconnectPut=function(t,e,n){},ti.prototype.onDisconnectMerge=function(t,e,n){},ti.prototype.onDisconnectCancel=function(t,e){},ti.prototype.reportStats=function(t){},ti);function ti(){}var ei,ni=(n(ri,ei=Zr),ri.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(C(i)),h(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},ri.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),h(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),h(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},ri.prototype.sendListen_=function(t){var e=this,n=t.query,r=n.path.toString(),i=n.queryIdentifier();this.log_("Listen on "+r+" for "+i);var o={p:r};t.tag&&(o.q=n.queryObject(),o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,(function(o){var a=o.d,s=o.s;ri.warnOnListenWarnings_(a,n),(e.listens.get(r)&&e.listens.get(r).get(i))===t&&(e.log_("listen response",o),"ok"!==s&&e.removeListen_(r,i),t.onComplete&&t.onComplete(s,a))}))},ri.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&I(t,"w")){var n=N(t,"w");Array.isArray(n)&&~n.indexOf("no_index")&&rt('Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ".indexOn": "'+e.getQueryParams().getIndex().toString()+'" at '+e.path.toString()+" to your security rules for better performance.")}},ri.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(t)},ri.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=S(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},ri.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=function(t){var e=S(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(e)?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))}))}},ri.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),h(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},ri.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},ri.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},ri.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},ri.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},ri.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,(function(t){r&&setTimeout((function(){r(t.s,t.d)}),Math.floor(0))}))},ri.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},ri.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},ri.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+e)},ri.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,(function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)}))},ri.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,(function(t){"ok"!==t.s&&e.log_("reportStats","Error sending stats: "+t.d)}))}},ri.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+C(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},ri.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):et("Unrecognized action received from server: "+C(t)+"\nAre you using the latest client?")},ri.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},ri.prototype.scheduleConnect_=function(t){var e=this;h(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){e.establishConnectionTimer_=null,e.establishConnection_()}),Math.floor(t))},ri.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},ri.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},ri.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},ri.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+ri.nextConnectionId_++,i=this,o=this.lastSessionId,a=!1,s=null,u=function(){s?s.close():(a=!0,n())};this.realtime_={close:u,sendRequest:function(t){h(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(t)}};var c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(c).then((function(u){a?Z("getToken() completed but was canceled"):(Z("getToken() completed. Creating connection."),i.authToken_=u&&u.accessToken,s=new Jr(r,i.repoInfo_,t,e,n,(function(t){rt(t+" ("+i.repoInfo_.toString()+")"),i.interrupt("server_kill")}),o))})).then(null,(function(t){i.log_("Failed to get token: "+t),a||u()}))}},ri.prototype.interrupt=function(t){Z("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},ri.prototype.resume=function(t){Z("Resuming connection for reason: "+t),delete this.interruptReasons_[t],A(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},ri.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},ri.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},ri.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map((function(t){return _t(t)})).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},ri.prototype.removeListen_=function(t,e){var n,r=new It(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},ri.prototype.onAuthRevoked_=function(t,e){Z("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},ri.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},ri.prototype.restoreState_=function(){var t,e,n,r;this.tryAuth();try{for(var o=i(this.listens.values()),a=o.next();!a.done;a=o.next()){var s=a.value;try{for(var u=(n=void 0,i(s.values())),c=u.next();!c.done;c=u.next())this.sendListen_(c.value)}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},ri.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+Kr.replace(/\./g,"-")]=1,y()?t["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(t["framework.reactnative"]=1),this.reportStats(t)},ri.prototype.shouldReconnect_=function(){var t=Fr.getInstance().currentlyOnline();return A(this.interruptReasons_)&&t},ri.nextPersistentConnectionId_=0,ri.nextConnectionId_=0,ri);function ri(t,e,n,r,i,o){var a=ei.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=ri.nextPersistentConnectionId_++,a.log_=tt("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!v())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),xr.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&Fr.getInstance().on("online",a.onOnline_,a),a}var ii,oi=(n(ai,ii=Zr),ai.prototype.reportStats=function(t){throw new Error("Method not implemented.")},ai.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(h(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},ai.prototype.listen=function(t,e,n,r){var i=this,o=t.path.toString();this.log_("Listen called for "+o+" "+t.queryIdentifier());var a=ai.getListenId_(t,n),s={};this.listens_[a]=s;var u=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(o+".json",u,(function(t,e){var u=e;404===t&&(t=u=null),null===t&&i.onDataUpdate_(o,u,!1,n),N(i.listens_,a)===s&&r(t?401===t?"permission_denied":"rest_error:"+t:"ok",null)}))},ai.prototype.unlisten=function(t,e){var n=ai.getListenId_(t,e);delete this.listens_[n]},ai.prototype.refreshAuthToken=function(t){},ai.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken;o&&(e.auth=o);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+function(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach((function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))})):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1])}return e.length?"&"+e.join("&"):""}(e);r.log_("Sending REST request for "+a);var s=new XMLHttpRequest;s.onreadystatechange=function(){if(n&&4===s.readyState){r.log_("REST Response for "+a+" received. status:",s.status,"response:",s.responseText);var t=null;if(200<=s.status&&s.status<300){try{t=T(s.responseText)}catch(t){rt("Failed to parse JSON response for "+a+": "+s.responseText)}n(null,t)}else 401!==s.status&&404!==s.status&&rt("Got unsuccessful REST response for "+a+" Status: "+s.status),n(s.status);n=null}},s.open("GET",a,!0),s.send()}))},ai);function ai(t,e,n){var r=ii.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=tt("p:rest:"),r.listens_={},r}var si="repo_interrupt",ui=(ci.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},ci.prototype.name=function(){return this.repoInfo_.namespace},ci.prototype.serverTime=function(){var t=this.infoData_.getNode(new It(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},ci.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},ci.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new It(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=D(e,(function(t){return $e(t)}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=$e(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=D(e,(function(t){return $e(t)}));o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=$e(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},ci.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},ci.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},ci.prototype.onServerInfoUpdate_=function(t){var e=this;bt(t,(function(t,n){e.updateInfo_(t,n)}))},ci.prototype.updateInfo_=function(t,e){var n=new It("/.info/"+t),r=$e(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},ci.prototype.getNextWriteId_=function(){return this.nextWriteId_++},ci.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),a=$e(e,n),s=Tn(a,o),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),a.val(!0),(function(e,n){var o="ok"===e;o||rt("set at "+t+" failed: "+e);var a=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,a),i.callOnCompleteCallback(r,e,n)}));var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},ci.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),a={};if(bt(e,(function(t,e){i=!1;var n=$e(e);a[t]=Tn(n,o)})),i)Z("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,a,s);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,(function(e,i){var o="ok"===e;o||rt("update at "+t+" failed: "+e);var a=r.serverSyncTree_.ackUserWrite(s,!o),u=0<a.length?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,a),r.callOnCompleteCallback(n,e,i)})),bt(e,(function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(t,[])}},ci.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=function(t,e){var n=new mn;return t.forEachTree(new It(""),(function(t,r){n.remember(t,Tn(r,e))})),n}(this.onDisconnect_,e),r=[];n.forEachTree(It.Empty,(function(e,n){r=r.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var i=t.abortTransactions_(e);t.rerunTransactions_(i)})),this.onDisconnect_=new mn,this.eventQueue_.raiseEventsForChangedPath(It.Empty,r)},ci.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)}))},ci.prototype.onDisconnectSet=function(t,e,n){var r=this,i=$e(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),(function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)}))},ci.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=$e(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),(function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)}))},ci.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(A(e))return Z("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,(function(i,o){"ok"===i&&bt(e,(function(e,n){var i=$e(n);r.onDisconnect_.remember(t.child(e),i)})),r.callOnCompleteCallback(n,i,o)}))},ci.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},ci.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},ci.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(si)},ci.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(si)},ci.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new Tr(this.stats_)),this.statsListener_.get()):this.stats_.get();var n=Object.keys(e).reduce((function(t,e){return Math.max(e.length,t)}),0);bt(e,(function(t,e){for(var r=t,i=t.length;i<n+2;i++)r+=" ";console.log(r+e)}))}},ci.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},ci.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Z.apply(void 0,a([n],t))},ci.prototype.callOnCompleteCallback=function(t,e,n){t&&Et((function(){if("ok"===e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}}))},Object.defineProperty(ci.prototype,"database",{get:function(){return this.__database||(this.__database=new Ai(this))},enumerable:!0,configurable:!0}),ci);function ci(t,e,n,r){var i=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Nr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new mn,this.persistentConnection_=null;var o=new gr(n,r);if(this.stats_=wr.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new oi(this.repoInfo_,this.onDataUpdate_.bind(this),o),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var a=n.options.databaseAuthVariableOverride;if(null!=a){if("object"!=typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{C(a)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new ni(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),o,a),this.server_=this.persistentConnection_}o.addTokenChangeListener((function(t){i.server_.refreshAuthToken(t)})),this.statsReporter_=wr.getOrCreateReporter(t,(function(){return new Sr(i.stats_,i.server_)})),this.transactionsInit_(),this.infoData_=new yr,this.infoSyncTree_=new fr({startListening:function(t,e,n,r){var o=[],a=i.infoData_.getNode(t.path);return a.isEmpty()||(o=i.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout((function(){r("ok")}),0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new fr({startListening:function(t,e,n,r){return i.server_.listen(t,n,e,(function(e,n){var o=r(e,n);i.eventQueue_.raiseEventsForChangedPath(t.path,o)})),[]},stopListening:function(t,e){i.server_.unlisten(t,e)}})}var hi=(li.prototype.getStartPost=function(){return this.startPost_},li.prototype.getEndPost=function(){return this.endPost_},li.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},li.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new ae(e,n))||(n=He.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},li.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=He.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(He.EMPTY_NODE);var i=this;return e.forEachChild(Se,(function(t,e){i.matches(new ae(t,e))||(r=r.updateImmediateChild(t,He.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,r,n)},li.prototype.updatePriority=function(t,e){return t},li.prototype.filtersNodes=function(){return!0},li.prototype.getIndexedFilter=function(){return this.indexedFilter_},li.prototype.getIndex=function(){return this.index_},li.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},li.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},li);function li(t){this.indexedFilter_=new Wn(t.getIndex()),this.index_=t.getIndex(),this.startPost_=li.getStartPost_(t),this.endPost_=li.getEndPost_(t)}var pi=(fi.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new ae(e,n))||(n=He.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},fi.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=He.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=He.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(He.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,He.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},fi.prototype.updatePriority=function(t,e){return t},fi.prototype.filtersNodes=function(){return!0},fi.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},fi.prototype.getIndex=function(){return this.index_},fi.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;h(s.numChildren()===this.limit_,"");var u=new ae(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),l=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var p=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name===e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var d=null==f?1:o(f,u);if(l&&!n.isEmpty()&&0<=d)return null!=i&&i.trackChildChange(Bn.childChangedChange(e,n,p)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(Bn.childRemovedChange(e,p));var y=s.updateImmediateChild(e,He.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(Bn.childAddedChange(f.name,f.node)),y.updateImmediateChild(f.name,f.node)):y}return n.isEmpty()?t:l&&0<=o(c,u)?(null!=i&&(i.trackChildChange(Bn.childRemovedChange(c.name,c.node)),i.trackChildChange(Bn.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,He.EMPTY_NODE)):t},fi);function fi(t){this.rangedFilter_=new hi(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var di=(yi.prototype.hasStart=function(){return this.startSet_},yi.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===yi.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},yi.prototype.getIndexStartValue=function(){return h(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},yi.prototype.getIndexStartName=function(){return h(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:vt},yi.prototype.hasEnd=function(){return this.endSet_},yi.prototype.getIndexEndValue=function(){return h(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},yi.prototype.getIndexEndName=function(){return h(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:gt},yi.prototype.hasLimit=function(){return this.limitSet_},yi.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},yi.prototype.getLimit=function(){return h(this.limitSet_,"Only valid if limit has been set"),this.limit_},yi.prototype.getIndex=function(){return this.index_},yi.prototype.copy_=function(){var t=new yi;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},yi.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},yi.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=yi.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},yi.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=yi.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},yi.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},yi.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},yi.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},yi.prototype.getQueryObject=function(){var t=yi.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==Se&&(e[t.INDEX]=this.index_.toString()),e},yi.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},yi.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Se},yi.prototype.getNodeFilter=function(){return this.loadsAllData()?new Wn(this.getIndex()):this.hasLimit()?new pi(this):new hi(this)},yi.prototype.toRestQueryStringParameters=function(){var t,e=yi.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===Se?e.PRIORITY_INDEX:this.index_===en?e.VALUE_INDEX:this.index_===ye?e.KEY_INDEX:(h(this.index_ instanceof nn,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=C(t),this.startSet_&&(n[e.START_AT]=C(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+C(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=C(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+C(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},yi.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},yi.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},yi.DEFAULT=new yi,yi);function yi(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Se}var vi,gi=(n(mi,vi=vn),mi.prototype.getKey=function(){return x("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},mi.prototype.child=function(t){return x("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof It||(null===this.path.getFront()?Qt("Reference.child",1,e=(e=t)&&e.replace(/^\/*\.info(\/|$)/,"/"),!1):Qt("Reference.child",1,t,!1)),new mi(this.repo,this.path.child(t));var e},mi.prototype.getParent=function(){x("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new mi(this.repo,t)},mi.prototype.getRoot=function(){x("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},mi.prototype.databaseProp=function(){return this.repo.database},mi.prototype.set=function(t,e){x("Reference.set",1,2,arguments.length),Kt("Reference.set",this.path),qt("Reference.set",1,t,this.path,!1),M("Reference.set",2,e,!0);var n=new f;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},mi.prototype.update=function(t,e){if(x("Reference.update",1,2,arguments.length),Kt("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,rt("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Vt("Reference.update",1,t,this.path,!1),M("Reference.update",2,e,!0);var i=new f;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},mi.prototype.setWithPriority=function(t,e,n){if(x("Reference.setWithPriority",2,3,arguments.length),Kt("Reference.setWithPriority",this.path),qt("Reference.setWithPriority",1,t,this.path,!1),Bt("Reference.setWithPriority",2,e,!1),M("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new f;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},mi.prototype.remove=function(t){return x("Reference.remove",0,1,arguments.length),Kt("Reference.remove",this.path),M("Reference.remove",1,t,!0),this.set(null,t)},mi.prototype.transaction=function(t,e,n){if(x("Reference.transaction",1,3,arguments.length),Kt("Reference.transaction",this.path),M("Reference.transaction",1,t,!1),M("Reference.transaction",2,e,!0),function(t,e,n,r){if(void 0!==n&&"boolean"!=typeof n)throw new Error(L("Reference.transaction",3,!0)+"must be a boolean.")}(0,0,n),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new f;return"function"==typeof e&&r.promise.catch((function(){})),this.repo.startTransaction(this.path,t,(function(t,n,i){t?r.reject(t):r.resolve(new te(n,i)),"function"==typeof e&&e(t,n,i)}),n),r.promise},mi.prototype.setPriority=function(t,e){x("Reference.setPriority",1,2,arguments.length),Kt("Reference.setPriority",this.path),Bt("Reference.setPriority",1,t,!1),M("Reference.setPriority",2,e,!0);var n=new f;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},mi.prototype.push=function(t,e){x("Reference.push",0,2,arguments.length),Kt("Reference.push",this.path),qt("Reference.push",1,t,this.path,!0),M("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=oe(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then((function(){return a})):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch((function(){})),o},mi.prototype.onDisconnect=function(){return Kt("Reference.onDisconnect",this.path),new $t(this.repo,this.path)},Object.defineProperty(mi.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),mi);function mi(t,e){if(!(t instanceof ui))throw new Error("new Reference() no longer supported - use app.database().");return vi.call(this,t,e,di.DEFAULT,!1)||this}vn.__referenceConstructor=gi,or.__referenceConstructor=gi;var _i,bi,wi=function(){this.children={},this.childCount=0,this.value=null},Ei=(Ti.prototype.subTree=function(t){for(var e=t instanceof It?t:new It(t),n=this,r=e.getFront();null!==r;)n=new Ti(r,n,N(n.node_.children,r)||new wi),r=(e=e.popFront()).getFront();return n},Ti.prototype.getValue=function(){return this.node_.value},Ti.prototype.setValue=function(t){h(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},Ti.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},Ti.prototype.hasChildren=function(){return 0<this.node_.childCount},Ti.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},Ti.prototype.forEachChild=function(t){var e=this;bt(this.node_.children,(function(n,r){t(new Ti(n,e,r))}))},Ti.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild((function(e){e.forEachDescendant(t,!0,n)})),e&&n&&t(this)},Ti.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},Ti.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild((function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)}))},Ti.prototype.path=function(){return new It(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},Ti.prototype.name=function(){return this.name_},Ti.prototype.parent=function(){return this.parent_},Ti.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},Ti.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=I(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},Ti);function Ti(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new wi),this.name_=t,this.parent_=e,this.node_=n}(bi=_i=_i||{})[bi.RUN=0]="RUN",bi[bi.SENT=1]="SENT",bi[bi.COMPLETED=2]="COMPLETED",bi[bi.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",bi[bi.NEEDS_ABORT=4]="NEEDS_ABORT",ui.MAX_TRANSACTION_RETRIES_=25,ui.prototype.transactionsInit_=function(){this.transactionQueueTree_=new Ei},ui.prototype.startTransaction=function(t,e,n,r){function i(){}this.log_("transaction on "+t);var o=new gi(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:pt(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new on(a.currentInputSnapshot,new gi(this,a.path),Se);a.onComplete(null,!1,c)}}else{Jt("transaction failed: Data returned ",u,a.path),a.status=_i.RUN;var l=this.transactionQueueTree_.subTree(t),p=l.getValue()||[];p.push(a),l.setValue(p);var f=void 0;"object"==typeof u&&null!==u&&I(u,".priority")?(f=N(u,".priority"),h(Ut(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(this.serverSyncTree_.calcCompleteEventCache(t)||He.EMPTY_NODE).getPriority().val(),f=f;var d=this.generateServerValues(),y=$e(u,f),v=Tn(y,d);a.currentOutputSnapshotRaw=y,a.currentOutputSnapshotResolved=v,a.currentWriteId=this.getNextWriteId_();var g=this.serverSyncTree_.applyUserOverwrite(t,v,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,g),this.sendReadyTransactions_()}},ui.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||He.EMPTY_NODE},ui.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);h(0<n.length,"Sending zero length transaction queue"),n.every((function(t){return t.status===_i.RUN}))&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild((function(t){e.sendReadyTransactions_(t)}))},ui.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map((function(t){return t.currentWriteId})),i=this.getLatestState_(t,r),o=i,a=i.hash(),s=0;s<e.length;s++){var u=e[s];h(u.status===_i.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=_i.SENT,u.retryCount++;var c=It.relativePath(t,u.path);o=o.updateChild(c,u.currentOutputSnapshotRaw)}var l=o.val(!0),p=t;this.server_.put(p.toString(),l,(function(r){n.log_("transaction put response",{path:p.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<e.length;a++){if(e[a].status=_i.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[a].currentWriteId)),e[a].onComplete){var s=e[a].currentOutputSnapshotResolved,u=new gi(n,e[a].path),c=new on(s,u,Se);o.push(e[a].onComplete.bind(null,null,!0,c))}e[a].unwatcher()}for(n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i),a=0;a<o.length;a++)Et(o[a])}else{if("datastale"===r)for(a=0;a<e.length;a++)e[a].status=e[a].status===_i.SENT_NEEDS_ABORT?_i.NEEDS_ABORT:_i.RUN;else for(rt("transaction at "+p.toString()+" failed: "+r),a=0;a<e.length;a++)e[a].status=_i.NEEDS_ABORT,e[a].abortReason=r;n.rerunTransactions_(t)}}),a)},ui.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},ui.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n=[],r=[],i=t.filter((function(t){return t.status===_i.RUN})).map((function(t){return t.currentWriteId})),o=0;o<t.length;o++){var a=t[o],s=It.relativePath(e,a.path),u=!1,c=void 0;if(h(null!==s,"rerunTransactionsUnderNode_: relativePath should not be null."),a.status===_i.NEEDS_ABORT)u=!0,c=a.abortReason,r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else if(a.status===_i.RUN)if(a.retryCount>=ui.MAX_TRANSACTION_RETRIES_)u=!0,c="maxretry",r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else{var l=this.getLatestState_(a.path,i);a.currentInputSnapshot=l;var p=t[o].update(l.val());if(void 0!==p){Jt("transaction failed: Data returned ",p,a.path);var f=$e(p);"object"==typeof p&&null!=p&&I(p,".priority")||(f=f.updatePriority(l.getPriority()));var d=a.currentWriteId,y=this.generateServerValues(),v=Tn(f,y);a.currentOutputSnapshotRaw=f,a.currentOutputSnapshotResolved=v,a.currentWriteId=this.getNextWriteId_(),i.splice(i.indexOf(d),1),r=(r=r.concat(this.serverSyncTree_.applyUserOverwrite(a.path,v,a.currentWriteId,a.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else u=!0,c="nodata",r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,r),r=[],u&&(t[o].status=_i.COMPLETED,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete))if("nodata"===c){var g=new gi(this,t[o].path),m=new on(t[o].currentInputSnapshot,g,Se);n.push(t[o].onComplete.bind(null,null,!1,m))}else n.push(t[o].onComplete.bind(null,new Error(c),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),o=0;o<n.length;o++)Et(n[o]);this.sendReadyTransactions_()}},ui.prototype.getAncestorTransactionNode_=function(t){var e,n=this.transactionQueueTree_;for(e=t.getFront();null!==e&&null===n.getValue();)n=n.subTree(e),e=(t=t.popFront()).getFront();return n},ui.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort((function(t,e){return t.order-e.order})),e},ui.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild((function(t){n.aggregateTransactionQueuesForNode_(t,e)}))},ui.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==_i.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild((function(t){e.pruneCompletedTransactionsBelowNode_(t)}))},ui.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor((function(t){e.abortTransactionsOnNode_(t)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(t){e.abortTransactionsOnNode_(t)})),n},ui.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)e[o].status===_i.SENT_NEEDS_ABORT||(e[o].status===_i.SENT?(h(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=_i.SENT_NEEDS_ABORT,e[o].abortReason="set"):(h(e[o].status===_i.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete&&n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))));for(-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r),o=0;o<n.length;o++)Et(n[o])}};var Ci,Si="databaseURL",Ii=(Ni.getInstance=function(){return Ci=Ci||new Ni},Ni.prototype.interrupt=function(){var t,e,n,r;try{for(var o=i(Object.keys(this.repos_)),a=o.next();!a.done;a=o.next()){var s=a.value;try{for(var u=(n=void 0,i(Object.keys(this.repos_[s]))),c=u.next();!c.done;c=u.next())this.repos_[s][c.value].interrupt()}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},Ni.prototype.resume=function(){var t,e,n,r;try{for(var o=i(Object.keys(this.repos_)),a=o.next();!a.done;a=o.next()){var s=a.value;try{for(var u=(n=void 0,i(Object.keys(this.repos_[s]))),c=u.next();!c.done;c=u.next())this.repos_[s][c.value].resume()}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},Ni.prototype.databaseFromApp=function(t,e,n){var r=n||t.options[Si];void 0===r&&nt("Can't determine Firebase Database URL.  Be sure to include "+Si+" option when calling firebase.initializeApp().");var i=Lt(r),o=i.repoInfo,a=void 0;return"undefined"!=typeof process&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a&&(o=(i=Lt(r="http://"+a+"?ns="+o.namespace)).repoInfo),Ht("Invalid Firebase Database URL",1,i),i.path.isEmpty()||nt("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(o,t,e).database},Ni.prototype.deleteRepo=function(t){var e=N(this.repos_,t.app.name);e&&N(e,t.repoInfo_.toURLString())===t||nt("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},Ni.prototype.createRepo=function(t,e,n){var r=N(this.repos_,e.name);r||(this.repos_[e.name]=r={});var i=N(r,t.toURLString());return i&&nt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new ui(t,this.useRestClient_,e,n),r[t.toURLString()]=i},Ni.prototype.forceRestClient=function(t){this.useRestClient_=t},Ni);function Ni(){this.repos_={},this.useRestClient_=!1}var Ai=(Object.defineProperty(Di.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),Di.prototype.ref=function(t){return this.checkDeleted_("ref"),x("database.ref",0,1,arguments.length),t instanceof gi?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},Di.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),x(e,1,1,arguments.length);var n=Lt(t);Ht(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&nt(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},Di.prototype.checkDeleted_=function(t){null===this.repo_&&nt("Cannot call "+t+" on a deleted database.")},Di.prototype.goOffline=function(){x("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},Di.prototype.goOnline=function(){x("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},Di.ServerValue={TIMESTAMP:{".sv":"timestamp"}},Di);function Di(t){(this.repo_=t)instanceof ui||nt("Don't call new Database() directly - please use firebase.database()."),this.root_=new gi(t,It.Empty),this.INTERNAL=new ki(this)}var ki=(Ri.prototype.delete=function(){return function(t,e,n,r){return new(n=n||Promise)((function(e,i){function o(t){try{s(r.next(t))}catch(t){i(t)}}function a(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?e(t.value):new n((function(e){e(t.value)})).then(o,a)}s((r=r.apply(t,[])).next())}))}(this,0,void 0,(function(){return function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(t){return this.database.checkDeleted_("delete"),Ii.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]}))}))},Ri);function Ri(t){this.database=t}var Pi=Object.freeze({__proto__:null,forceLongPolling:function(){zr.forceDisallow(),Br.forceAllow()},forceWebSockets:function(){Br.forceDisallow()},isWebSocketsAvailable:function(){return zr.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),Oi=ni;ni.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},ni.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var xi,Li,Mi=Object.freeze({__proto__:null,DataConnection:Oi,RealTimeConnection:Jr,hijackHash:function(t){var e=ni.prototype.put;return ni.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){ni.prototype.put=e}},ConnectionTarget:Ot,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){Ii.getInstance().forceRestClient(t)}}),Fi=Ai.ServerValue;xi=(Li=t).SDK_VERSION,Kr=xi,Li.INTERNAL.registerComponent(new Q("database",(function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return Ii.getInstance().databaseFromApp(n,r,e)}),"PUBLIC").setServiceProps({Reference:gi,Query:vn,Database:Ai,DataSnapshot:on,enableLogging:$,INTERNAL:Pi,ServerValue:Fi,TEST_ACCESS:Mi}).setMultipleInstances(!0)),Li.registerVersion("@firebase/database","0.5.19")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-database.js - be sure to load firebase-app.js first.")}})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,(function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,r="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in t,o="ArrayBuffer"in t;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<a.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=p(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=p(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),f(t)},d.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),f(t)},d.prototype.entries=function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),f(t)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},_.call(b.prototype),_.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=b,t.Response=E,t.fetch=function(t,e){return new Promise((function(n,i){var o=new b(t,e),a=new XMLHttpRequest;a.onload=function(){var t={status:a.status,statusText:a.statusText,headers:function(t){var e=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}})),e}(a.getAllResponseHeaders()||"")};t.url="responseURL"in a?a.responseURL:t.headers.get("X-Request-URL"),n(new E("response"in a?a.response:a.responseText,t))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),o.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),a.send(void 0===o._bodyInit?null:o._bodyInit)}))},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function p(t){return"string"!=typeof t&&(t=String(t)),t}function f(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function d(t){this.map={},t instanceof d?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function v(t){return new Promise((function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function g(t){var e=new FileReader,n=v(e);return e.readAsArrayBuffer(t),n}function m(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(r&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(i&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(o&&r&&s(t))this._bodyArrayBuffer=m(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!o||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=m(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=v(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}function b(t,e){var n=(e=e||{}).body;if(t instanceof b){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<c.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function w(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}})),e}function E(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(t){return t&&t.Math==Math&&t}function r(t){try{return!!t()}catch(t){return!0}}function i(t){return"object"==typeof t?null!==t:"function"==typeof t}function o(t){return g?v.createElement(t):{}}function a(t){if(!i(t))throw TypeError(String(t)+" is not an object");return t}function s(t,e){if(!i(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!i(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function u(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function c(e,n){try{w(f,e,n)}catch(t){f[e]=n}return n}function h(t,e){return S.call(t,e)}function l(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++I+N).toString(36)}function p(t){return h(k,t)||(k[t]=A&&h(R,t)?R[t]:P("Symbol."+t)),k[t]}var f=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")(),d=!1,y=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),v=f.document,g=i(v)&&i(v.createElement),m=!y&&!r((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})),_=Object.defineProperty,b={f:y?_:function(t,e,n){if(a(t),e=s(e,!0),a(n),m)try{return _(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},w=y?function(t,e,n){return b.f(t,e,u(1,n))}:function(t,e,n){return t[e]=n,t},E="__core-js_shared__",T=f[E]||c(E,{}),C=e((function(t){(t.exports=function(t,e){return T[t]||(T[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.2",mode:"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})})),S={}.hasOwnProperty,I=0,N=Math.random(),A=!!Object.getOwnPropertySymbols&&!r((function(){return!String(Symbol())})),D=A&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,k=C("wks"),R=f.Symbol,P=D?R:R&&R.withoutSetter||l,O={};O[p("toStringTag")]="z";var x="[object z]"===String(O),L=Function.toString;function M(t){return W[t]||(W[t]=l(t))}"function"!=typeof T.inspectSource&&(T.inspectSource=function(t){return L.call(t)});var F,U,q,V=T.inspectSource,B=f.WeakMap,j="function"==typeof B&&/native code/.test(V(B)),W=C("keys"),Q={};if(j){var K=new(0,f.WeakMap),H=K.get,z=K.has,G=K.set;F=function(t,e){return G.call(K,t,e),e},U=function(t){return H.call(K,t)||{}},q=function(t){return z.call(K,t)}}else{var Y=M("state");Q[Y]=!0,F=function(t,e){return w(t,Y,e),e},U=function(t){return h(t,Y)?t[Y]:{}},q=function(t){return h(t,Y)}}function X(t){return Z.call(t).slice(8,-1)}var J={set:F,get:U,has:q,enforce:function(t){return q(t)?U(t):F(t,{})},getterFor:function(t){return function(e){var n;if(!i(e)||(n=U(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},$=e((function(t){var e=J.get,n=J.enforce,r=String(String).split("String");(t.exports=function(t,e,i,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable,u=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof e||h(i,"name")||w(i,"name",e),n(i).source=r.join("string"==typeof e?e:"")),t!==f?(a?!u&&t[e]&&(s=!0):delete t[e],s?t[e]=i:w(t,e,i)):s?t[e]=i:c(e,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||V(this)}))})),Z={}.toString,tt=p("toStringTag"),et="Arguments"==X(function(){return arguments}()),nt=x?X:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),tt))?n:et?X(e):"Object"==(r=X(e))&&"function"==typeof e.callee?"Arguments":r};function rt(t){return isNaN(t=+t)?0:(0<t?bt:_t)(t)}function it(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function ot(t){return function(e,n){var r,i,o=String(it(e)),a=rt(n),s=o.length;return a<0||s<=a?t?"":void 0:(r=o.charCodeAt(a))<55296||56319<r||a+1===s||(i=o.charCodeAt(a+1))<56320||57343<i?t?o.charAt(a):r:t?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}}function at(t){return It(it(t))}function st(t){return"function"==typeof t?t:void 0}function ut(t,e){return arguments.length<2?st(Dt[t])||st(f[t]):Dt[t]&&Dt[t][e]||f[t]&&f[t][e]}function ct(t){return 0<t?kt(rt(t),9007199254740991):0}function ht(t){return function(e,n,r){var i,o=at(e),a=ct(o.length),s=function(t,e){var n=rt(t);return n<0?Rt(n+e,0):Pt(n,e)}(r,a);if(t&&n!=n){for(;s<a;)if((i=o[s++])!=i)return!0}else for(;s<a;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}}function lt(t,e){var n,r=at(t),i=0,o=[];for(n in r)!h(Q,n)&&h(r,n)&&o.push(n);for(;e.length>i;)h(r,n=e[i++])&&(~Ot(o,n)||o.push(n));return o}function pt(t,e){for(var n=Ut(e),r=b.f,i=At.f,o=0;o<n.length;o++){var a=n[o];h(t,a)||r(t,a,i(e,a))}}function ft(t,e){var n=Bt[Vt(t)];return n==Wt||n!=jt&&("function"==typeof e?r(e):!!e)}function dt(t,e){var n,r,i,o,a,s=t.target,u=t.global,h=t.stat;if(n=u?f:h?f[s]||c(s,{}):(f[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Kt(n,r))&&a.value:n[r],!Qt(u?r:s+(h?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;pt(o,i)}(t.sham||i&&i.sham)&&w(o,"sham",!0),$(n,r,o,t)}}function yt(t){return Object(it(t))}x||$(Object.prototype,"toString",x?{}.toString:function(){return"[object "+nt(this)+"]"},{unsafe:!0});var vt,gt,mt,_t=Math.ceil,bt=Math.floor,wt={codeAt:ot(!1),charAt:ot(!0)},Et={}.propertyIsEnumerable,Tt=Object.getOwnPropertyDescriptor,Ct={f:Tt&&!Et.call({1:2},1)?function(t){var e=Tt(this,t);return!!e&&e.enumerable}:Et},St="".split,It=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==X(t)?St.call(t,""):Object(t)}:Object,Nt=Object.getOwnPropertyDescriptor,At={f:y?Nt:function(t,e){if(t=at(t),e=s(e,!0),m)try{return Nt(t,e)}catch(t){}if(h(t,e))return u(!Ct.f.call(t,e),t[e])}},Dt=f,kt=Math.min,Rt=Math.max,Pt=Math.min,Ot=(ht(!0),ht(!1)),xt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Lt=xt.concat("length","prototype"),Mt={f:Object.getOwnPropertyNames||function(t){return lt(t,Lt)}},Ft={f:Object.getOwnPropertySymbols},Ut=ut("Reflect","ownKeys")||function(t){var e=Mt.f(a(t)),n=Ft.f;return n?e.concat(n(t)):e},qt=/#|\.prototype\./,Vt=ft.normalize=function(t){return String(t).replace(qt,".").toLowerCase()},Bt=ft.data={},jt=ft.NATIVE="N",Wt=ft.POLYFILL="P",Qt=ft,Kt=At.f,Ht=!r((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),zt=M("IE_PROTO"),Gt=Object.prototype,Yt=Ht?Object.getPrototypeOf:function(t){return h(t=yt(t),zt)?t[zt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Gt:null},Xt=p("iterator"),Jt=!1;function $t(){}function Zt(t){return"<script>"+t+"</"+ae+">"}[].keys&&("next"in(mt=[].keys())?(gt=Yt(Yt(mt)))!==Object.prototype&&(vt=gt):Jt=!0),null==vt&&(vt={}),h(vt,Xt)||w(vt,Xt,(function(){return this}));var te,ee={IteratorPrototype:vt,BUGGY_SAFARI_ITERATORS:Jt},ne=Object.keys||function(t){return lt(t,xt)},re=y?Object.defineProperties:function(t,e){a(t);for(var n,r=ne(e),i=r.length,o=0;o<i;)b.f(t,n=r[o++],e[n]);return t},ie=ut("document","documentElement"),oe="prototype",ae="script",se=M("IE_PROTO"),ue=function(){try{te=document.domain&&new ActiveXObject("htmlfile")}catch(t){}ue=te?function(t){t.write(Zt("")),t.close();var e=t.parentWindow.Object;return t=null,e}(te):function(){var t,e=o("iframe");return e.style.display="none",ie.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Zt("document.F=Object")),t.close(),t.F}();for(var t=xt.length;t--;)delete ue[oe][xt[t]];return ue()};function ce(t,e,n){t&&!h(t=n?t:t.prototype,ye)&&de(t,ye,{configurable:!0,value:e})}function he(){return this}function le(){return this}function pe(t,e,n,r,i,o,a){function s(t){if(t===i&&v)return v;if(!be&&t in d)return d[t];switch(t){case"keys":case Ee:case Te:return function(){return new n(this,t)}}return function(){return new n(this)}}!function(t,e,n){var r=e+" Iterator";t.prototype=fe(ge,{next:u(1,n)}),ce(t,r,!1),ve[r]=he}(n,e,r);var c,h,l,p=e+" Iterator",f=!1,d=t.prototype,y=d[we]||d["@@iterator"]||i&&d[i],v=!be&&y||s(i),g="Array"==e&&d.entries||y;if(g&&(c=Yt(g.call(new t)),_e!==Object.prototype&&c.next&&(Yt(c)!==_e&&(me?me(c,_e):"function"!=typeof c[we]&&w(c,we,le)),ce(c,p,!0))),i==Ee&&y&&y.name!==Ee&&(f=!0,v=function(){return y.call(this)}),d[we]!==v&&w(d,we,v),ve[e]=v,i)if(h={values:s(Ee),keys:o?v:s("keys"),entries:s(Te)},a)for(l in h)!be&&!f&&l in d||$(d,l,h[l]);else dt({target:e,proto:!0,forced:be||f},h);return h}Q[se]=!0;var fe=Object.create||function(t,e){var n;return null!==t?($t[oe]=a(t),n=new $t,$t[oe]=null,n[se]=t):n=ue(),void 0===e?n:re(n,e)},de=b.f,ye=p("toStringTag"),ve={},ge=ee.IteratorPrototype,me=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(n){}return function(n,r){return a(n),function(t){if(!i(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(r),e?t.call(n,r):n.__proto__=r,n}}():void 0),_e=ee.IteratorPrototype,be=ee.BUGGY_SAFARI_ITERATORS,we=p("iterator"),Ee="values",Te="entries",Ce=wt.charAt,Se="String Iterator",Ie=J.set,Ne=J.getterFor(Se);pe(String,"String",(function(t){Ie(this,{type:Se,string:String(t),index:0})}),(function(){var t,e=Ne(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=Ce(n,r),e.index+=t.length,{value:t,done:!1})}));var Ae={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},De=p("unscopables"),ke=Array.prototype;function Re(t){ke[De][t]=!0}null==ke[De]&&b.f(ke,De,{configurable:!0,value:fe(null)});var Pe="Array Iterator",Oe=J.set,xe=J.getterFor(Pe),Le=pe(Array,"Array",(function(t,e){Oe(this,{type:Pe,target:at(t),index:0,kind:e})}),(function(){var t=xe(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values");ve.Arguments=ve.Array,Re("keys"),Re("values"),Re("entries");var Me=p("iterator"),Fe=p("toStringTag"),Ue=Le.values;for(var qe in Ae){var Ve=f[qe],Be=Ve&&Ve.prototype;if(Be){if(Be[Me]!==Ue)try{w(Be,Me,Ue)}catch(js){Be[Me]=Ue}if(Be[Fe]||w(Be,Fe,qe),Ae[qe])for(var je in Le)if(Be[je]!==Le[je])try{w(Be,je,Le[je])}catch(js){Be[je]=Le[je]}}}function We(t,e,n){for(var r in e)$(t,r,e[r],n);return t}function Qe(t){var e=ut(t);y&&e&&!e[$e]&&(0,b.f)(e,$e,{configurable:!0,get:function(){return this}})}function Ke(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function He(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}function ze(t){return void 0!==t&&(ve.Array===t||tn[Ze]===t)}function Ge(t,e,n){if(Ke(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}function Ye(t){if(null!=t)return t[en]||t["@@iterator"]||ve[nt(t)]}function Xe(t,e,n,r){try{return r?e(a(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&a(i.call(t)),e}}var Je=f.Promise,$e=p("species"),Ze=p("iterator"),tn=Array.prototype,en=p("iterator"),nn=e((function(t){function e(t,e){this.stopped=t,this.result=e}(t.exports=function(t,n,r,i,o){var s,u,c,h,l,p,f,d=Ge(n,r,i?2:1);if(o)s=t;else{if("function"!=typeof(u=Ye(t)))throw TypeError("Target is not iterable");if(ze(u)){for(c=0,h=ct(t.length);c<h;c++)if((l=i?d(a(f=t[c])[0],f[1]):d(t[c]))&&l instanceof e)return l;return new e(!1)}s=u.call(t)}for(p=s.next;!(f=p.call(s)).done;)if("object"==typeof(l=Xe(s,d,f.value,i))&&l&&l instanceof e)return l;return new e(!1)}).stop=function(t){return new e(!0,t)}})),rn=p("iterator"),on=!1;try{var an=0,sn={next:function(){return{done:!!an++}},return:function(){on=!0}};sn[rn]=function(){return this},Array.from(sn,(function(){throw 2}))}catch(js){}function un(t,e){if(!e&&!on)return!1;var n=!1;try{var r={};r[rn]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}function cn(t,e){var n,r=a(t).constructor;return void 0===r||null==(n=a(r)[gn])?e:Ke(n)}function hn(t){if(Nn.hasOwnProperty(t)){var e=Nn[t];delete Nn[t],e()}}function ln(t){return function(){hn(t)}}function pn(t){hn(t.data)}function fn(t){f.postMessage(t+"",bn.protocol+"//"+bn.host)}var dn,yn,vn,gn=p("species"),mn=ut("navigator","userAgent")||"",_n=/(iphone|ipod|ipad).*applewebkit/i.test(mn),bn=f.location,wn=f.setImmediate,En=f.clearImmediate,Tn=f.process,Cn=f.MessageChannel,Sn=f.Dispatch,In=0,Nn={},An="onreadystatechange";wn&&En||(wn=function(t){for(var e=[],n=1;n<arguments.length;)e.push(arguments[n++]);return Nn[++In]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},dn(In),In},En=function(t){delete Nn[t]},"process"==X(Tn)?dn=function(t){Tn.nextTick(ln(t))}:Sn&&Sn.now?dn=function(t){Sn.now(ln(t))}:Cn&&!_n?(vn=(yn=new Cn).port2,yn.port1.onmessage=pn,dn=Ge(vn.postMessage,vn,1)):!f.addEventListener||"function"!=typeof postMessage||f.importScripts||r(fn)?dn=An in o("script")?function(t){ie.appendChild(o("script"))[An]=function(){ie.removeChild(this),hn(t)}}:function(t){setTimeout(ln(t),0)}:(dn=fn,f.addEventListener("message",pn,!1)));var Dn,kn,Rn,Pn,On,xn,Ln,Mn,Fn={set:wn,clear:En},Un=At.f,qn=Fn.set,Vn=f.MutationObserver||f.WebKitMutationObserver,Bn=f.process,jn=f.Promise,Wn="process"==X(Bn),Qn=Un(f,"queueMicrotask"),Kn=Qn&&Qn.value;function Hn(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=Ke(e),this.reject=Ke(n)}function zn(t,e){if(a(t),i(e)&&e.constructor===t)return e;var n=$n.f(t);return(0,n.resolve)(e),n.promise}function Gn(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}Kn||(Dn=function(){var t,e;for(Wn&&(t=Bn.domain)&&t.exit();kn;){e=kn.fn,kn=kn.next;try{e()}catch(t){throw kn?Pn():Rn=void 0,t}}Rn=void 0,t&&t.enter()},Pn=Wn?function(){Bn.nextTick(Dn)}:Vn&&!_n?(On=!0,xn=document.createTextNode(""),new Vn(Dn).observe(xn,{characterData:!0}),function(){xn.data=On=!On}):jn&&jn.resolve?(Ln=jn.resolve(void 0),Mn=Ln.then,function(){Mn.call(Ln,Dn)}):function(){qn.call(f,Dn)});var Yn,Xn,Jn=Kn||function(t){var e={fn:t,next:void 0};Rn&&(Rn.next=e),kn||(kn=e,Pn()),Rn=e},$n={f:function(t){return new Hn(t)}},Zn=f.process,tr=Zn&&Zn.versions,er=tr&&tr.v8;function nr(t){var e;return!(!i(t)||"function"!=typeof(e=t.then))&&e}function rr(t,e,n){if(!e.notified){e.notified=!0;var r=e.reactions;Jn((function(){for(var i=e.value,o=1==e.state,a=0;r.length>a;){var s,u,c,h=r[a++],l=o?h.ok:h.fail,p=h.resolve,f=h.reject,d=h.domain;try{l?(o||(2===e.rejection&&Pr(t,e),e.rejection=1),!0===l?s=i:(d&&d.enter(),s=l(i),d&&(d.exit(),c=!0)),s===h.promise?f(_r("Promise-chain cycle")):(u=nr(s))?u.call(s,p,f):p(s)):f(i)}catch(i){d&&!c&&d.exit(),f(i)}}e.reactions=[],e.notified=!1,n&&!e.rejection&&kr(t,e)}))}}function ir(t,e,n){var r,i;Ir?((r=br.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),f.dispatchEvent(r)):r={promise:e,reason:n},(i=f["on"+t])?i(r):t===Nr&&function(t,e){var n=f.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)}function or(t,e,n,r){return function(i){t(e,n,i,r)}}function ar(t,e,n,r){e.done||(e.done=!0,r&&(e=r),e.value=n,e.state=2,rr(t,e,!0))}er?Xn=(Yn=er.split("."))[0]+Yn[1]:mn&&(!(Yn=mn.match(/Edge\/(\d+)/))||74<=Yn[1])&&(Yn=mn.match(/Chrome\/(\d+)/))&&(Xn=Yn[1]);var sr,ur,cr,hr,lr=Xn&&+Xn,pr=Fn.set,fr=p("species"),dr="Promise",yr=J.get,vr=J.set,gr=J.getterFor(dr),mr=Je,_r=f.TypeError,br=f.document,wr=f.process,Er=ut("fetch"),Tr=$n.f,Cr=Tr,Sr="process"==X(wr),Ir=!!(br&&br.createEvent&&f.dispatchEvent),Nr="unhandledrejection",Ar=Qt(dr,(function(){if(V(mr)===String(mr)){if(66===lr)return!0;if(!Sr&&"function"!=typeof PromiseRejectionEvent)return!0}if(51<=lr&&/native code/.test(mr))return!1;function t(t){t((function(){}),(function(){}))}var e=mr.resolve(1);return(e.constructor={})[fr]=t,!(e.then((function(){}))instanceof t)})),Dr=Ar||!un((function(t){mr.all(t).catch((function(){}))})),kr=function(t,e){pr.call(f,(function(){var n,r=e.value;if(Rr(e)&&(n=Gn((function(){Sr?wr.emit("unhandledRejection",r,t):ir(Nr,t,r)})),e.rejection=Sr||Rr(e)?2:1,n.error))throw n.value}))},Rr=function(t){return 1!==t.rejection&&!t.parent},Pr=function(t,e){pr.call(f,(function(){Sr?wr.emit("rejectionHandled",t):ir("rejectionhandled",t,e.value)}))},Or=function(t,e,n,r){if(!e.done){e.done=!0,r&&(e=r);try{if(t===n)throw _r("Promise can't be resolved itself");var i=nr(n);i?Jn((function(){var r={done:!1};try{i.call(n,or(Or,t,r,e),or(ar,t,r,e))}catch(n){ar(t,r,n,e)}})):(e.value=n,e.state=1,rr(t,e,!1))}catch(n){ar(t,{done:!1},n,e)}}};Ar&&(mr=function(t){He(this,mr,dr),Ke(t),sr.call(this);var e=yr(this);try{t(or(Or,this,e),or(ar,this,e))}catch(t){ar(this,e,t)}},(sr=function(t){vr(this,{type:dr,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=We(mr.prototype,{then:function(t,e){var n=gr(this),r=Tr(cn(this,mr));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=Sr?wr.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&rr(this,n,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),ur=function(){var t=new sr,e=yr(t);this.promise=t,this.resolve=or(Or,t,e),this.reject=or(ar,t,e)},$n.f=Tr=function(t){return t===mr||t===cr?new ur(t):Cr(t)},"function"==typeof Je&&(hr=Je.prototype.then,$(Je.prototype,"then",(function(t,e){var n=this;return new mr((function(t,e){hr.call(n,t,e)})).then(t,e)}),{unsafe:!0}),"function"==typeof Er&&dt({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return zn(mr,Er.apply(f,arguments))}}))),dt({global:!0,wrap:!0,forced:Ar},{Promise:mr}),ce(mr,dr,!1),Qe(dr),cr=ut(dr),dt({target:dr,stat:!0,forced:Ar},{reject:function(t){var e=Tr(this);return e.reject.call(void 0,t),e.promise}}),dt({target:dr,stat:!0,forced:Ar},{resolve:function(t){return zn(this,t)}}),dt({target:dr,stat:!0,forced:Dr},{all:function(t){var e=this,n=Tr(e),r=n.resolve,i=n.reject,o=Gn((function(){var n=Ke(e.resolve),o=[],a=0,s=1;nn(t,(function(t){var u=a++,c=!1;o.push(void 0),s++,n.call(e,t).then((function(t){c||(c=!0,o[u]=t,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(t){var e=this,n=Tr(e),r=n.reject,i=Gn((function(){var i=Ke(e.resolve);nn(t,(function(t){i.call(e,t).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}}),dt({target:"Promise",stat:!0},{allSettled:function(t){var e=this,n=$n.f(e),r=n.resolve,i=n.reject,o=Gn((function(){var n=Ke(e.resolve),i=[],o=0,a=1;nn(t,(function(t){var s=o++,u=!1;i.push(void 0),a++,n.call(e,t).then((function(t){u||(u=!0,i[s]={status:"fulfilled",value:t},--a||r(i))}),(function(t){u||(u=!0,i[s]={status:"rejected",reason:t},--a||r(i))}))})),--a||r(i)}));return o.error&&i(o.value),n.promise}}),dt({target:"Promise",proto:!0,real:!0,forced:!!Je&&r((function(){Je.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var e=cn(this,ut("Promise")),n="function"==typeof t;return this.then(n?function(n){return zn(e,t()).then((function(){return n}))}:t,n?function(n){return zn(e,t()).then((function(){throw n}))}:t)}}),"function"!=typeof Je||Je.prototype.finally||$(Je.prototype,"finally",ut("Promise").prototype.finally);var xr=J.set,Lr=J.getterFor("AggregateError"),Mr=function(t,e){var n=this;if(!(n instanceof Mr))return new Mr(t,e);me&&(n=me(new Error(e),Yt(n)));var r=[];return nn(t,r.push,r),y?xr(n,{errors:r,type:"AggregateError"}):n.errors=r,void 0!==e&&w(n,"message",String(e)),n};Mr.prototype=fe(Error.prototype,{constructor:u(5,Mr),message:u(5,""),name:u(5,"AggregateError")}),y&&b.f(Mr.prototype,"errors",{get:function(){return Lr(this).errors},configurable:!0}),dt({global:!0},{AggregateError:Mr}),dt({target:"Promise",stat:!0},{try:function(t){var e=$n.f(this),n=Gn(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var Fr="No one promise resolved";function Ur(t,e){var n;return jr(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!jr(n.prototype)?i(n)&&null===(n=n[Wr])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}function qr(t){var e=1==t,n=2==t,r=3==t,i=4==t,o=6==t,a=5==t||o;return function(s,u,c,h){for(var l,p,f=yt(s),d=It(f),y=Ge(u,c,3),v=ct(d.length),g=0,m=h||Ur,_=e?m(s,v):n?m(s,0):void 0;g<v;g++)if((a||g in d)&&(p=y(l=d[g],g,f),t))if(e)_[g]=p;else if(p)switch(t){case 3:return!0;case 5:return l;case 6:return g;case 2:Qr.call(_,l)}else if(i)return!1;return o?-1:r||i?i:_}}function Vr(t){throw t}function Br(t,e){var n=[][t],i=!!h(e=e||{},"ACCESSORS")&&e.ACCESSORS,o=h(e,0)?e[0]:Vr,a=h(e,1)?e[1]:void 0;return!!n&&!r((function(){if(i&&!y)return!0;function t(t){i?Hr(e,t,{enumerable:!0,get:Vr}):e[t]=1}var e={length:-1};t(1),t(2147483646),t(4294967294),n.call(e,o,a)}))}dt({target:"Promise",stat:!0},{any:function(t){var e=this,n=$n.f(e),r=n.resolve,i=n.reject,o=Gn((function(){var n=Ke(e.resolve),o=[],a=0,s=1,u=!1;nn(t,(function(t){var c=a++,h=!1;o.push(void 0),s++,n.call(e,t).then((function(t){h||u||(u=!0,r(t))}),(function(t){h||u||(h=!0,o[c]=t,--s||i(new(ut("AggregateError"))(o,Fr)))}))})),--s||i(new(ut("AggregateError"))(o,Fr))}));return o.error&&i(o.value),n.promise}});var jr=Array.isArray||function(t){return"Array"==X(t)},Wr=p("species"),Qr=[].push,Kr={forEach:qr(0),map:qr(1),filter:qr(2),some:qr(3),every:qr(4),find:qr(5),findIndex:qr(6)},Hr=Object.defineProperty,zr=Kr.find,Gr="find",Yr=!0,Xr=Br(Gr);function Jr(t,e,n){return Ge($r,f[t].prototype[e],n)}Gr in[]&&Array(1)[Gr]((function(){Yr=!1})),dt({target:"Array",proto:!0,forced:Yr||!Xr},{find:function(t,e){return zr(this,t,1<arguments.length?e:void 0)}}),Re(Gr);var $r=Function.call,Zr=(Jr("Array","find"),Kr.findIndex),ti="findIndex",ei=!0,ni=Br(ti);function ri(t,e,n){var r=s(e);r in t?b.f(t,r,u(0,n)):t[r]=n}ti in[]&&Array(1)[ti]((function(){ei=!1})),dt({target:"Array",proto:!0,forced:ei||!ni},{findIndex:function(t,e){return Zr(this,t,1<arguments.length?e:void 0)}}),Re(ti),Jr("Array","findIndex"),dt({target:"Array",stat:!0,forced:!un((function(t){Array.from(t)}))},{from:function(t,e,n){var r,i,o,a,s,u=yt(t),c="function"==typeof this?this:Array,h=arguments.length,l=1<h?e:void 0,p=void 0!==l,f=Ye(u),d=0;if(p&&(l=Ge(l,2<h?n:void 0,2)),null==f||c==Array&&ze(f))for(i=new c(r=ct(u.length));d<r;d++)ri(i,d,p?l(u[d],d):u[d]);else for(s=(a=f.call(u)).next,i=new c;!(o=s.call(a)).done;d++)ri(i,d,p?Xe(a,l,[o.value,d],!0):o.value);return i.length=d,i}});var ii,oi=Kr.some,ai=!!(ii=[].some)&&r((function(){ii.call(null,(function(){throw 1}),1)})),si=Br("some");dt({target:"Array",proto:!0,forced:!ai||!si},{some:function(t,e){return oi(this,t,1<arguments.length?e:void 0)}}),Jr("Array","some");var ui,ci="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,hi=b.f,li=f.Int8Array,pi=li&&li.prototype,fi=f.Uint8ClampedArray,di=fi&&fi.prototype,yi=li&&Yt(li),vi=pi&&Yt(pi),gi=Object.prototype,mi=p("toStringTag"),_i=l("TYPED_ARRAY_TAG"),bi=ci&&!!me&&"Opera"!==nt(f.opera),wi={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(ui in wi)f[ui]||(bi=!1);if((!bi||"function"!=typeof yi||yi===Function.prototype)&&(yi=function(){throw TypeError("Incorrect invocation")},bi))for(ui in wi)f[ui]&&me(f[ui],yi);if((!bi||!vi||vi===gi)&&(vi=yi.prototype,bi))for(ui in wi)f[ui]&&me(f[ui].prototype,vi);if(bi&&Yt(di)!==vi&&me(di,vi),y&&!h(vi,mi))for(ui in hi(vi,mi,{get:function(){return i(this)?this[_i]:void 0}}),wi)f[ui]&&w(f[ui],_i,ui);function Ei(){return Si.call(Ai(this))}var Ti=p("iterator"),Ci=f.Uint8Array,Si=Le.values,Ii=Le.keys,Ni=Le.entries,Ai=function(t){if(function(t){return i(t)&&h(wi,nt(t))}(t))return t;throw TypeError("Target is not a typed array")},Di=function(t,e,n){if(y){if(n)for(var r in wi){var i=f[r];i&&h(i.prototype,t)&&delete i.prototype[t]}vi[t]&&!n||$(vi,t,n?e:bi&&pi[t]||e)}},ki=Ci&&Ci.prototype[Ti],Ri=!!ki&&("values"==ki.name||null==ki.name);Di("entries",(function(){return Ni.call(Ai(this))})),Di("keys",(function(){return Ii.call(Ai(this))})),Di("values",Ei,!Ri),Di(Ti,Ei,!Ri);var Pi=Object.assign,Oi=Object.defineProperty,xi=!Pi||r((function(){if(y&&1!==Pi({b:1},Pi(Oi({},"a",{enumerable:!0,get:function(){Oi(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach((function(t){e[t]=t})),7!=Pi({},t)[n]||ne(Pi({},e)).join("")!=r}))?function(t,e){for(var n=yt(t),r=arguments.length,i=1,o=Ft.f,a=Ct.f;i<r;)for(var s,u=It(arguments[i++]),c=o?ne(u).concat(o(u)):ne(u),h=c.length,l=0;l<h;)s=c[l++],y&&!a.call(u,s)||(n[s]=u[s]);return n}:Pi;function Li(t){return function(e){for(var n,r=at(e),i=ne(r),o=i.length,a=0,s=[];a<o;)n=i[a++],y&&!Mi.call(r,n)||s.push(t?[n,r[n]]:r[n]);return s}}dt({target:"Object",stat:!0,forced:Object.assign!==xi},{assign:xi});var Mi=Ct.f,Fi={entries:Li(!0),values:Li(!1)},Ui=Fi.entries;dt({target:"Object",stat:!0},{entries:function(t){return Ui(t)}});var qi=Fi.values;function Vi(t){if(function(t){var e;return i(t)&&(void 0!==(e=t[ji])?!!e:"RegExp"==X(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t}function Bi(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[Wi]=!1,"/./"[e](n)}catch(t){}}return!1}dt({target:"Object",stat:!0},{values:function(t){return qi(t)}});var ji=p("match"),Wi=p("match");dt({target:"String",proto:!0,forced:!Bi("includes")},{includes:function(t,e){return!!~String(it(this)).indexOf(Vi(t),1<arguments.length?e:void 0)}}),Jr("String","includes");var Qi,Ki=At.f,Hi="".startsWith,zi=Math.min,Gi=Bi("startsWith");function Yi(t){if(!i(t))return!1;var e=t[Ji];return void 0!==e?!!e:jr(t)}dt({target:"String",proto:!0,forced:!(!Gi&&(Qi=Ki(String.prototype,"startsWith"))&&!Qi.writable||Gi)},{startsWith:function(t,e){var n=String(it(this));Vi(t);var r=ct(zi(1<arguments.length?e:void 0,n.length)),i=String(t);return Hi?Hi.call(n,i,r):n.slice(r,r+i.length)===i}}),Jr("String","startsWith"),dt({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(it(this)),n="",r=rt(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}}),Jr("String","repeat");var Xi=p("species"),Ji=p("isConcatSpreadable"),$i=9007199254740991,Zi="Maximum allowed index exceeded",to=51<=lr||!r((function(){var t=[];return t[Ji]=!1,t.concat()[0]!==t})),eo=51<=lr||!r((function(){var t=[];return(t.constructor={})[Xi]=function(){return{foo:1}},1!==t.concat(Boolean).foo}));function no(t){var e=Dt.Symbol||(Dt.Symbol={});h(e,t)||po(e,t,{value:lo.f(t)})}function ro(t,e){var n=Ao[t]=fe(Eo[go]);return _o(n,{type:vo,tag:t,description:e}),y||(n.description=e),n}function io(t,e){a(t);var n=at(e),r=ne(n).concat(qo(n));return fo(r,(function(e){y&&!Uo.call(n,e)||Fo(t,e,n[e])})),t}function oo(t,e){var n=at(t),r=s(e,!0);if(n!==wo||!h(Ao,r)||h(Do,r)){var i=Co(n,r);return!i||!h(Ao,r)||h(n,yo)&&n[yo][r]||(i.enumerable=!0),i}}function ao(t){var e=Io(at(t)),n=[];return fo(e,(function(t){h(Ao,t)||h(Q,t)||n.push(t)})),n}dt({target:"Array",proto:!0,forced:!to||!eo},{concat:function(t){var e,n,r,i,o,a=yt(this),s=Ur(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(Yi(o=-1===e?a:arguments[e])){if(i=ct(o.length),$i<u+i)throw TypeError(Zi);for(n=0;n<i;n++,u++)n in o&&ri(s,u,o[n])}else{if($i<=u)throw TypeError(Zi);ri(s,u++,o)}return s.length=u,s}});var so=Mt.f,uo={}.toString,co="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ho={f:function(t){return co&&"[object Window]"==uo.call(t)?function(t){try{return so(t)}catch(t){return co.slice()}}(t):so(at(t))}},lo={f:p},po=b.f,fo=Kr.forEach,yo=M("hidden"),vo="Symbol",go="prototype",mo=p("toPrimitive"),_o=J.set,bo=J.getterFor(vo),wo=Object[go],Eo=f.Symbol,To=ut("JSON","stringify"),Co=At.f,So=b.f,Io=ho.f,No=Ct.f,Ao=C("symbols"),Do=C("op-symbols"),ko=C("string-to-symbol-registry"),Ro=C("symbol-to-string-registry"),Po=C("wks"),Oo=f.QObject,xo=!Oo||!Oo[go]||!Oo[go].findChild,Lo=y&&r((function(){return 7!=fe(So({},"a",{get:function(){return So(this,"a",{value:7}).a}})).a}))?function(t,e,n){var r=Co(wo,e);r&&delete wo[e],So(t,e,n),r&&t!==wo&&So(wo,e,r)}:So,Mo=D?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof Eo},Fo=function(t,e,n){t===wo&&Fo(Do,e,n),a(t);var r=s(e,!0);return a(n),h(Ao,r)?(n.enumerable?(h(t,yo)&&t[yo][r]&&(t[yo][r]=!1),n=fe(n,{enumerable:u(0,!1)})):(h(t,yo)||So(t,yo,u(1,{})),t[yo][r]=!0),Lo(t,r,n)):So(t,r,n)},Uo=function(t){var e=s(t,!0),n=No.call(this,e);return!(this===wo&&h(Ao,e)&&!h(Do,e))&&(!(n||!h(this,e)||!h(Ao,e)||h(this,yo)&&this[yo][e])||n)},qo=function(t){var e=t===wo,n=Io(e?Do:at(t)),r=[];return fo(n,(function(t){!h(Ao,t)||e&&!h(wo,t)||r.push(Ao[t])})),r};A||($((Eo=function(t){if(this instanceof Eo)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==t?String(t):void 0,n=l(e),r=function(t){this===wo&&r.call(Do,t),h(this,yo)&&h(this[yo],n)&&(this[yo][n]=!1),Lo(this,n,u(1,t))};return y&&xo&&Lo(wo,n,{configurable:!0,set:r}),ro(n,e)})[go],"toString",(function(){return bo(this).tag})),$(Eo,"withoutSetter",(function(t){return ro(l(t),t)})),Ct.f=Uo,b.f=Fo,At.f=oo,Mt.f=ho.f=ao,Ft.f=qo,lo.f=function(t){return ro(p(t),t)},y&&(So(Eo[go],"description",{configurable:!0,get:function(){return bo(this).description}}),$(wo,"propertyIsEnumerable",Uo,{unsafe:!0}))),dt({global:!0,wrap:!0,forced:!A,sham:!A},{Symbol:Eo}),fo(ne(Po),(function(t){no(t)})),dt({target:vo,stat:!0,forced:!A},{for:function(t){var e=String(t);if(h(ko,e))return ko[e];var n=Eo(e);return ko[e]=n,Ro[n]=e,n},keyFor:function(t){if(!Mo(t))throw TypeError(t+" is not a symbol");if(h(Ro,t))return Ro[t]},useSetter:function(){xo=!0},useSimple:function(){xo=!1}}),dt({target:"Object",stat:!0,forced:!A,sham:!y},{create:function(t,e){return void 0===e?fe(t):io(fe(t),e)},defineProperty:Fo,defineProperties:io,getOwnPropertyDescriptor:oo}),dt({target:"Object",stat:!0,forced:!A},{getOwnPropertyNames:ao,getOwnPropertySymbols:qo}),dt({target:"Object",stat:!0,forced:r((function(){Ft.f(1)}))},{getOwnPropertySymbols:function(t){return Ft.f(yt(t))}}),To&&dt({target:"JSON",stat:!0,forced:!A||r((function(){var t=Eo();return"[null]"!=To([t])||"{}"!=To({a:t})||"{}"!=To(Object(t))}))},{stringify:function(t,e,n){for(var r,o=[t],a=1;a<arguments.length;)o.push(arguments[a++]);if((i(r=e)||void 0!==t)&&!Mo(t))return jr(e)||(e=function(t,e){if("function"==typeof r&&(e=r.call(this,t,e)),!Mo(e))return e}),o[1]=e,To.apply(null,o)}}),Eo[go][mo]||w(Eo[go],mo,Eo[go].valueOf),ce(Eo,vo),Q[yo]=!0,no("asyncIterator");var Vo=b.f,Bo=f.Symbol;if(y&&"function"==typeof Bo&&!("description"in Bo.prototype&&void 0===Bo().description)){var jo={},Wo=function(t){var e=arguments.length<1||void 0===t?void 0:String(t),n=this instanceof Wo?new Bo(e):void 0===e?Bo():Bo(e);return""===e&&(jo[n]=!0),n};pt(Wo,Bo);var Qo=Wo.prototype=Bo.prototype;Qo.constructor=Wo;var Ko=Qo.toString,Ho="Symbol(test)"==String(Bo("test")),zo=/^Symbol\((.*)\)[^)]+$/;Vo(Qo,"description",{configurable:!0,get:function(){var t=i(this)?this.valueOf():this,e=Ko.call(t);if(h(jo,t))return"";var n=Ho?e.slice(7,-1):e.replace(zo,"$1");return""===n?void 0:n}}),dt({global:!0,forced:!0},{Symbol:Wo})}function Go(t,e,n){function o(t){var e=h[t];$(h,t,"add"==t?function(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(s&&!i(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return s&&!i(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function(t){return!(s&&!i(t))&&e.call(this,0===t?0:t)}:function(t,n){return e.call(this,0===t?0:t,n),this})}var a=-1!==t.indexOf("Map"),s=-1!==t.indexOf("Weak"),u=a?"set":"add",c=f[t],h=c&&c.prototype,l=c,p={};if(Qt(t,"function"!=typeof c||!(s||h.forEach&&!r((function(){(new c).entries().next()})))))l=n.getConstructor(e,t,a,u),Jo.REQUIRED=!0;else if(Qt(t,!0)){var d=new l,y=d[u](s?{}:-0,1)!=d,v=r((function(){d.has(1)})),g=un((function(t){new c(t)})),m=!s&&r((function(){for(var t=new c,e=5;e--;)t[u](e,e);return!t.has(-0)}));g||(((l=e((function(e,n){He(e,l,t);var r=function(t,e,n){var r,o;return me&&"function"==typeof(r=e.constructor)&&r!==n&&i(o=r.prototype)&&o!==n.prototype&&me(t,o),t}(new c,e,l);return null!=n&&nn(n,r[u],r,a),r}))).prototype=h).constructor=l),(v||m)&&(o("delete"),o("has"),a&&o("get")),(m||y)&&o(u),s&&h.clear&&delete h.clear}return p[t]=l,dt({global:!0,forced:l!=c},p),ce(l,t),s||n.setStrong(l,t,a),l}function Yo(t,e,n){var r,i,o,a,s=arguments.length,u=1<s?e:void 0;return Ke(this),(r=void 0!==u)&&Ke(u),null==t?new this:(i=[],r?(o=0,a=Ge(u,2<s?n:void 0,2),nn(t,(function(t){i.push(a(t,o++))}))):nn(t,i.push,i),new this(i))}no("hasInstance"),no("isConcatSpreadable"),no("iterator"),no("match"),no("matchAll"),no("replace"),no("search"),no("species"),no("split"),no("toPrimitive"),no("toStringTag"),no("unscopables"),ce(Math,"Math",!0),ce(f.JSON,"JSON",!0),no("asyncDispose"),no("dispose"),no("observable"),no("patternMatch"),no("replaceAll"),lo.f("iterator");var Xo=!r((function(){return Object.isExtensible(Object.preventExtensions({}))})),Jo=e((function(t){function e(t){n(t,r,{value:{objectID:"O"+ ++o,weakData:{}}})}var n=b.f,r=l("meta"),o=0,a=Object.isExtensible||function(){return!0},s=t.exports={REQUIRED:!1,fastKey:function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!h(t,r)){if(!a(t))return"F";if(!n)return"E";e(t)}return t[r].objectID},getWeakData:function(t,n){if(!h(t,r)){if(!a(t))return!0;if(!n)return!1;e(t)}return t[r].weakData},onFreeze:function(t){return Xo&&s.REQUIRED&&a(t)&&!h(t,r)&&e(t),t}};Q[r]=!0})),$o=b.f,Zo=Jo.fastKey,ta=J.set,ea=J.getterFor,na={getConstructor:function(t,e,n,r){function i(t,e,n){var r,i,o=a(t),u=s(t,e);return u?u.value=n:(o.last=u={index:i=Zo(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=u),r&&(r.next=u),y?o.size++:t.size++,"F"!==i&&(o.index[i]=u)),t}var o=t((function(t,i){He(t,o,e),ta(t,{type:e,index:fe(null),first:void 0,last:void 0,size:0}),y||(t.size=0),null!=i&&nn(i,t[r],t,n)})),a=ea(e),s=function(t,e){var n,r=a(t),i=Zo(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return We(o.prototype,{clear:function(){for(var t=a(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,y?t.size=0:this.size=0},delete:function(t){var e=a(this),n=s(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),y?e.size--:this.size--}return!!n},forEach:function(t,e){for(var n,r=a(this),i=Ge(t,1<arguments.length?e:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(t){return!!s(this,t)}}),We(o.prototype,n?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return i(this,0===t?0:t,e)}}:{add:function(t){return i(this,t=0===t?0:t,t)}}),y&&$o(o.prototype,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,n){var r=e+" Iterator",i=ea(e),o=ea(r);pe(t,e,(function(t,e){ta(this,{type:r,target:t,state:i(t),kind:e,last:void 0})}),(function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}}),n?"entries":"values",!n,!0),Qe(e)}};function ra(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}function ia(){for(var t,e=a(this),n=Ke(e.delete),r=!0,i=0,o=arguments.length;i<o;i++)t=n.call(e,arguments[i]),r=r&&t;return!!r}function oa(t){return Map.prototype.entries.call(t)}function aa(t,e,n){var r,i=a(this),o=2<arguments.length?n:void 0;if("function"!=typeof e&&"function"!=typeof o)throw TypeError("At least one callback required");return i.has(t)?(r=i.get(t),"function"==typeof e&&(r=e(r),i.set(t,r))):"function"==typeof o&&(r=o(),i.set(t,r)),r}function sa(t){return Set.prototype.values.call(t)}Go("Map",(function(t){return function(e){return t(this,arguments.length?e:void 0)}}),na),dt({target:"Map",stat:!0},{from:Yo}),dt({target:"Map",stat:!0},{of:ra}),dt({target:"Map",proto:!0,real:!0,forced:d},{deleteAll:function(){return ia.apply(this,arguments)}}),dt({target:"Map",proto:!0,real:!0,forced:d},{every:function(t,e){var n=a(this),r=oa(n),i=Ge(t,1<arguments.length?e:void 0,3);return!nn(r,(function(t,e){if(!i(e,t,n))return nn.stop()}),void 0,!0,!0).stopped}}),dt({target:"Map",proto:!0,real:!0,forced:d},{filter:function(t,e){var n=a(this),r=oa(n),i=Ge(t,1<arguments.length?e:void 0,3),o=new(cn(n,ut("Map"))),s=Ke(o.set);return nn(r,(function(t,e){i(e,t,n)&&s.call(o,t,e)}),void 0,!0,!0),o}}),dt({target:"Map",proto:!0,real:!0,forced:d},{find:function(t,e){var n=a(this),r=oa(n),i=Ge(t,1<arguments.length?e:void 0,3);return nn(r,(function(t,e){if(i(e,t,n))return nn.stop(e)}),void 0,!0,!0).result}}),dt({target:"Map",proto:!0,real:!0,forced:d},{findKey:function(t,e){var n=a(this),r=oa(n),i=Ge(t,1<arguments.length?e:void 0,3);return nn(r,(function(t,e){if(i(e,t,n))return nn.stop(t)}),void 0,!0,!0).result}}),dt({target:"Map",stat:!0},{groupBy:function(t,e){var n=new this;Ke(e);var r=Ke(n.has),i=Ke(n.get),o=Ke(n.set);return nn(t,(function(t){var a=e(t);r.call(n,a)?i.call(n,a).push(t):o.call(n,a,[t])})),n}}),dt({target:"Map",proto:!0,real:!0,forced:d},{includes:function(t){return nn(oa(a(this)),(function(e,n){if(function(t,e){return t===e||t!=t&&e!=e}(n,t))return nn.stop()}),void 0,!0,!0).stopped}}),dt({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;Ke(e);var r=Ke(n.set);return nn(t,(function(t){r.call(n,e(t),t)})),n}}),dt({target:"Map",proto:!0,real:!0,forced:d},{keyOf:function(t){return nn(oa(a(this)),(function(e,n){if(n===t)return nn.stop(e)}),void 0,!0,!0).result}}),dt({target:"Map",proto:!0,real:!0,forced:d},{mapKeys:function(t,e){var n=a(this),r=oa(n),i=Ge(t,1<arguments.length?e:void 0,3),o=new(cn(n,ut("Map"))),s=Ke(o.set);return nn(r,(function(t,e){s.call(o,i(e,t,n),e)}),void 0,!0,!0),o}}),dt({target:"Map",proto:!0,real:!0,forced:d},{mapValues:function(t,e){var n=a(this),r=oa(n),i=Ge(t,1<arguments.length?e:void 0,3),o=new(cn(n,ut("Map"))),s=Ke(o.set);return nn(r,(function(t,e){s.call(o,t,i(e,t,n))}),void 0,!0,!0),o}}),dt({target:"Map",proto:!0,real:!0,forced:d},{merge:function(t){for(var e=a(this),n=Ke(e.set),r=0;r<arguments.length;)nn(arguments[r++],n,e,!0);return e}}),dt({target:"Map",proto:!0,real:!0,forced:d},{reduce:function(t,e){var n=a(this),r=oa(n),i=arguments.length<2,o=i?void 0:e;if(Ke(t),nn(r,(function(e,r){o=i?(i=!1,r):t(o,r,e,n)}),void 0,!0,!0),i)throw TypeError("Reduce of empty map with no initial value");return o}}),dt({target:"Map",proto:!0,real:!0,forced:d},{some:function(t,e){var n=a(this),r=oa(n),i=Ge(t,1<arguments.length?e:void 0,3);return nn(r,(function(t,e){if(i(e,t,n))return nn.stop()}),void 0,!0,!0).stopped}}),dt({target:"Map",proto:!0,real:!0,forced:d},{update:function(t,e,n){var r=a(this),i=arguments.length;Ke(e);var o=r.has(t);if(!o&&i<3)throw TypeError("Updating absent value");var s=o?r.get(t):Ke(2<i?n:void 0)(t,r);return r.set(t,e(s,t,r)),r}}),dt({target:"Map",proto:!0,real:!0,forced:d},{upsert:aa}),dt({target:"Map",proto:!0,real:!0,forced:d},{updateOrInsert:aa}),Go("Set",(function(t){return function(e){return t(this,arguments.length?e:void 0)}}),na),dt({target:"Set",stat:!0},{from:Yo}),dt({target:"Set",stat:!0},{of:ra}),dt({target:"Set",proto:!0,real:!0,forced:d},{addAll:function(){return(function(){for(var t=a(this),e=Ke(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}).apply(this,arguments)}}),dt({target:"Set",proto:!0,real:!0,forced:d},{deleteAll:function(){return ia.apply(this,arguments)}}),dt({target:"Set",proto:!0,real:!0,forced:d},{every:function(t,e){var n=a(this),r=sa(n),i=Ge(t,1<arguments.length?e:void 0,3);return!nn(r,(function(t){if(!i(t,t,n))return nn.stop()}),void 0,!1,!0).stopped}}),dt({target:"Set",proto:!0,real:!0,forced:d},{difference:function(t){var e=a(this),n=new(cn(e,ut("Set")))(e),r=Ke(n.delete);return nn(t,(function(t){r.call(n,t)})),n}}),dt({target:"Set",proto:!0,real:!0,forced:d},{filter:function(t,e){var n=a(this),r=sa(n),i=Ge(t,1<arguments.length?e:void 0,3),o=new(cn(n,ut("Set"))),s=Ke(o.add);return nn(r,(function(t){i(t,t,n)&&s.call(o,t)}),void 0,!1,!0),o}}),dt({target:"Set",proto:!0,real:!0,forced:d},{find:function(t,e){var n=a(this),r=sa(n),i=Ge(t,1<arguments.length?e:void 0,3);return nn(r,(function(t){if(i(t,t,n))return nn.stop(t)}),void 0,!1,!0).result}}),dt({target:"Set",proto:!0,real:!0,forced:d},{intersection:function(t){var e=a(this),n=new(cn(e,ut("Set"))),r=Ke(e.has),i=Ke(n.add);return nn(t,(function(t){r.call(e,t)&&i.call(n,t)})),n}}),dt({target:"Set",proto:!0,real:!0,forced:d},{isDisjointFrom:function(t){var e=a(this),n=Ke(e.has);return!nn(t,(function(t){if(!0===n.call(e,t))return nn.stop()})).stopped}}),dt({target:"Set",proto:!0,real:!0,forced:d},{isSubsetOf:function(t){var e=function(t){var e=Ye(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return a(e.call(t))}(this),n=a(t),r=n.has;return"function"!=typeof r&&(n=new(ut("Set"))(t),r=Ke(n.has)),!nn(e,(function(t){if(!1===r.call(n,t))return nn.stop()}),void 0,!1,!0).stopped}}),dt({target:"Set",proto:!0,real:!0,forced:d},{isSupersetOf:function(t){var e=a(this),n=Ke(e.has);return!nn(t,(function(t){if(!1===n.call(e,t))return nn.stop()})).stopped}}),dt({target:"Set",proto:!0,real:!0,forced:d},{join:function(t){var e=sa(a(this)),n=void 0===t?",":String(t),r=[];return nn(e,r.push,r,!1,!0),r.join(n)}}),dt({target:"Set",proto:!0,real:!0,forced:d},{map:function(t,e){var n=a(this),r=sa(n),i=Ge(t,1<arguments.length?e:void 0,3),o=new(cn(n,ut("Set"))),s=Ke(o.add);return nn(r,(function(t){s.call(o,i(t,t,n))}),void 0,!1,!0),o}}),dt({target:"Set",proto:!0,real:!0,forced:d},{reduce:function(t,e){var n=a(this),r=sa(n),i=arguments.length<2,o=i?void 0:e;if(Ke(t),nn(r,(function(e){o=i?(i=!1,e):t(o,e,e,n)}),void 0,!1,!0),i)throw TypeError("Reduce of empty set with no initial value");return o}}),dt({target:"Set",proto:!0,real:!0,forced:d},{some:function(t,e){var n=a(this),r=sa(n),i=Ge(t,1<arguments.length?e:void 0,3);return nn(r,(function(t){if(i(t,t,n))return nn.stop()}),void 0,!1,!0).stopped}}),dt({target:"Set",proto:!0,real:!0,forced:d},{symmetricDifference:function(t){var e=a(this),n=new(cn(e,ut("Set")))(e),r=Ke(n.delete),i=Ke(n.add);return nn(t,(function(t){r.call(n,t)||i.call(n,t)})),n}}),dt({target:"Set",proto:!0,real:!0,forced:d},{union:function(t){var e=a(this),n=new(cn(e,ut("Set")))(e);return nn(t,Ke(n.add),n),n}});var ua=Math.floor;dt({target:"Number",stat:!0},{isInteger:function(t){return!i(t)&&isFinite(t)&&ua(t)===t}});var ca=function(t,e){return(ca=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function ha(t,e){function n(){this.constructor=t}ca(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var la=function(){return(la=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function pa(t,e,n,r){return new(n=n||Promise)((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function fa(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function da(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function ya(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function va(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ya(arguments[e]));return t}function ga(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function ma(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function _a(t){try{return Ta.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var ba={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},wa=function(t,e){if(!t)throw Ea(e)},Ea=function(t){return new Error("Firebase Database ("+ba.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},Ta={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=(15&s)<<2|c>>6,l=63&c;u||(l=64,a||(h=64)),r.push(n[o>>2],n[(3&o)<<4|s>>4],n[h],n[l])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(ma(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();r.push(o<<2|a>>4),64!==s&&(r.push(a<<4&240|s>>2),64!==u&&r.push(s<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function Ca(t){return Sa(void 0,t)}function Sa(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=Sa(t[n],e[n]));return t}var Ia=(Na.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},Na);function Na(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}function Aa(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Da(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Aa())}function ka(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Ra(){return!0===ba.NODE_ADMIN}var Pa,Oa=(ha(xa,Pa=Error),xa);function xa(t,e){var n=Pa.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,xa.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,La.prototype.create),n}var La=(Ma.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(Fa,(function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"}))}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new Oa(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},Ma);function Ma(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var Fa=/\{\$([^}]+)}/g;function Ua(t){return JSON.parse(t)}function qa(t){return JSON.stringify(t)}function Va(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Ua(_a(o[0])||""),n=Ua(_a(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function Ba(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ja(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Wa(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Qa(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var Ka=(Ha.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},Ha.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},Ha.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},Ha.prototype.digest=function(){var t=[],e=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},Ha);function Ha(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function za(t,e){var n=new Ga(t,e);return n.subscribe.bind(n)}var Ga=(Ya.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},Ya.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},Ya.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},Ya.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=Xa),void 0===r.error&&(r.error=Xa),void 0===r.complete&&(r.complete=Xa);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}})),this.observers.push(r),o},Ya.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},Ya.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},Ya.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},Ya.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},Ya);function Ya(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}function Xa(){}function Ja(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function $a(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+r+" argument "}function Za(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error($a(t,e,r)+"must be a valid function.")}function ts(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error($a(t,e,r)+"must be a valid context object.")}function es(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}var ns=(rs.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},rs.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},rs.prototype.setServiceProps=function(t){return this.serviceProps=t,this},rs);function rs(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var is="[DEFAULT]",os=(as.prototype.get=function(t){void 0===t&&(t=is);var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new Ia;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},as.prototype.getImmediate=function(t){var e=la({identifier:is,optional:!1},t),n=e.optional,r=this.normalizeInstanceIdentifier(e.identifier);try{var i=this.getOrInitializeService(r);if(i)return i;if(n)return null;throw Error("Service "+this.name+" is not available")}catch(t){if(n)return null;throw t}},as.prototype.getComponent=function(){return this.component},as.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(function(t){return"EAGER"===t.instantiationMode}(this.component=t))try{this.getOrInitializeService(is)}catch(t){}try{for(var r=da(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var o=ya(i.value,2),a=o[1],s=this.normalizeInstanceIdentifier(o[0]);try{var u=this.getOrInitializeService(s);a.resolve(u)}catch(t){}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},as.prototype.clearInstance=function(t){void 0===t&&(t=is),this.instancesDeferred.delete(t),this.instances.delete(t)},as.prototype.delete=function(){return pa(this,void 0,void 0,(function(){var t;return fa(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))];case 1:return e.sent(),[2]}}))}))},as.prototype.isComponentSet=function(){return null!=this.component},as.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return t===is?void 0:t}(t)),this.instances.set(t,e)),e||null},as.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:is:t},as);function as(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}var ss,us,cs=(hs.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},hs.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},hs.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new os(t,this);return this.providers.set(t,e),e},hs.prototype.getProviders=function(){return Array.from(this.providers.values())},hs);function hs(t){this.name=t,this.providers=new Map}function ls(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function ps(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case ss.DEBUG:case ss.VERBOSE:console.log.apply(console,ls(["["+i+"]  "+t.name+":"],n));break;case ss.INFO:console.info.apply(console,ls(["["+i+"]  "+t.name+":"],n));break;case ss.WARN:console.warn.apply(console,ls(["["+i+"]  "+t.name+":"],n));break;case ss.ERROR:console.error.apply(console,ls(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}(us=ss=ss||{})[us.DEBUG=0]="DEBUG",us[us.VERBOSE=1]="VERBOSE",us[us.INFO=2]="INFO",us[us.WARN=3]="WARN",us[us.ERROR=4]="ERROR",us[us.SILENT=5]="SILENT";var fs,ds=ss.INFO,ys=(Object.defineProperty(vs.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in ss))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(vs.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),vs.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ls([this,ss.DEBUG],t))},vs.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ls([this,ss.VERBOSE],t))},vs.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ls([this,ss.INFO],t))},vs.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ls([this,ss.WARN],t))},vs.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ls([this,ss.ERROR],t))},vs);function vs(t){this.name=t,this._logLevel=ds,this._logHandler=ps}var gs,ms=((fs={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",fs["bad-app-name"]="Illegal App name: '{$appName}",fs["duplicate-app"]="Firebase App named '{$appName}' already exists",fs["app-deleted"]="Firebase App named '{$appName}' already deleted",fs["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",fs),_s=new La("app","Firebase",ms),bs="@firebase/app",ws="[DEFAULT]",Es=((gs={})[bs]="fire-core",gs["@firebase/analytics"]="fire-analytics",gs["@firebase/auth"]="fire-auth",gs["@firebase/database"]="fire-rtdb",gs["@firebase/functions"]="fire-fn",gs["@firebase/installations"]="fire-iid",gs["@firebase/messaging"]="fire-fcm",gs["@firebase/performance"]="fire-perf",gs["@firebase/remote-config"]="fire-rc",gs["@firebase/storage"]="fire-gcs",gs["@firebase/firestore"]="fire-fst",gs["fire-js"]="fire-js",gs["firebase-wrapper"]="fire-js-all",gs),Ts=new ys("@firebase/app"),Cs=(Object.defineProperty(Ss.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(Ss.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(Ss.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),Ss.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},Ss.prototype._getService=function(t,e){return void 0===e&&(e=ws),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},Ss.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=ws),this.container.getProvider(t).clearInstance(e)},Ss.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(t){Ts.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,t)}},Ss.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},Ss.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw _s.create("app-deleted",{appName:this.name_})},Ss);function Ss(t,e,n){var r,i,o=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=Ca(t),this.container=new cs(e.name),this._addComponent(new ns("app",(function(){return o}),"PUBLIC"));try{for(var a=da(this.firebase_.INTERNAL.components.values()),s=a.next();!s.done;s=a.next())this._addComponent(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}}Cs.prototype.name&&Cs.prototype.options||Cs.prototype.delete||console.log("dc");var Is=function t(){var e=function(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={}),"object"==typeof i&&null!==i||(i={name:i});var o=i;void 0===o.name&&(o.name=ws);var a=o.name;if("string"!=typeof a||!a)throw _s.create("bad-app-name",{appName:String(a)});if(Ba(e,a))throw _s.create("duplicate-app",{appName:a});var s=new t(n,o,r);return e[a]=s},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=Es[t])&&void 0!==r?r:t;n&&(i+="-"+n);var a=i.match(/\s|\//),s=e.match(/\s|\//);if(a||s){var u=['Unable to register library "'+i+'" with version "'+e+'":'];return a&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),a&&s&&u.push("and"),s&&u.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void Ts.warn(u.join(" "))}o(new ns(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},apps:null,SDK_VERSION:"7.7.0",INTERNAL:{registerComponent:o,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){return"serverAuth"!==e?e:null}}};function i(t){if(!Ba(e,t=t||ws))throw _s.create("no-app",{appName:t});return e[t]}function o(o){var a,s,u=o.name;if(n.has(u))return Ts.debug("There were multiple attempts to register component "+u+"."),"PUBLIC"===o.type?r[u]:null;if(n.set(u,o),"PUBLIC"===o.type){var c=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[u])throw _s.create("invalid-app-argument",{appName:u});return t[u]()};void 0!==o.serviceProps&&Sa(c,o.serviceProps),r[u]=c,t.prototype[u]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,u).apply(this,o.multipleInstances?t:[])}}try{for(var h=da(Object.keys(e)),l=h.next();!l.done;l=h.next())e[l.value]._addComponent(o)}catch(s){a={error:s}}finally{try{l&&!l.done&&(s=h.return)&&s.call(h)}finally{if(a)throw a.error}}return"PUBLIC"===o.type?r[u]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,r}(Cs);return e.INTERNAL=la(la({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){Sa(e,t)},createSubscribe:za,ErrorFactory:La,deepExtend:Sa}),e}(),Ns=(As.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e;return"VERSION"===(null===(e=t.getComponent())||void 0===e?void 0:e.type)}(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},As);function As(t){this.container=t}if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Ts.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var Ds=self.firebase.SDK_VERSION;Ds&&0<=Ds.indexOf("LITE")&&Ts.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var ks=Is.initializeApp;Is.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&Ts.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),ks.apply(void 0,t)};var Rs,Ps=Is;(Rs=Ps).INTERNAL.registerComponent(new ns("platform-logger",(function(t){return new Ns(t)}),"PRIVATE")),Rs.registerVersion(bs,"0.5.2",void 0),Rs.registerVersion("fire-js",""),Ps.registerVersion("firebase","7.7.0","app"),(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},n="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function r(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,r){if(r){var i=n;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in i||(i[a]={}),i=i[a]}(r=r(o=i[t=t[t.length-1]]))!=o&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Promise",(function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function i(){this.a=null}function o(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;i.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c((function(){e.g()}))}this.a.push(t)};var a=n.setTimeout;i.prototype.c=function(t){a(t,0)},i.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},i.prototype.f=function(t){this.c((function(){throw t}))},e.prototype.f=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.m),reject:t(this.g)}},e.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.o(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.u(t):this.h(t)}},e.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},e.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)s.b(this.a[t]);this.a=null}};var s=new i;return e.prototype.o=function(t){var e=this.f();t.La(e.resolve,e.reject)},e.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(e){o(e)}}:e}var i,o,a=new e((function(t,e){i=t,o=e}));return this.La(r(t,i),r(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.La=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},e.resolve=o,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var i=r(t),a=i.next();!a.done;a=i.next())o(a.value).La(e,n)}))},e.all=function(t){var n=r(t),i=n.next();return i.done?o([]):new e((function(t,e){function r(e){return function(n){a[e]=n,0==--s&&t(a)}}for(var a=[],s=0;a.push(void 0),s++,o(i.value).La(r(a.length-1),e),!(i=n.next()).done;);}))},e}));var i=i||{},o=this||self;function a(t){return"string"==typeof t}function s(t){return"boolean"==typeof t}var u=/^[\w+/_-]+[=]{0,2}$/,c=null;function h(){}function l(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function p(t){return null===t}function f(t){return"array"==l(t)}function d(t){var e=l(t);return"array"==e||"object"==e&&"number"==typeof t.length}function y(t){return"function"==l(t)}function v(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),m=0;function _(t,e,n){return t.call.apply(t.bind,arguments)}function b(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function w(t,e,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_:b).apply(null,arguments)}function E(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var T=Date.now||function(){return+new Date};function C(t,e){function n(){}n.prototype=e.prototype,t.qb=e.prototype,t.prototype=new n,(t.prototype.constructor=t).gd=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function S(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function I(t){if(Error.captureStackTrace)Error.captureStackTrace(this,I);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");I.call(this,n+t[r])}function A(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function D(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function k(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function R(){this.b=this.a=null}C(I,Error),I.prototype.name="CustomError",C(N,I),N.prototype.name="AssertionError",D.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var P=new D((function(){return new O}),(function(t){t.reset()}));function O(){this.next=this.b=this.a=null}function x(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||o).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(v(t))try{var a=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){a="<object could not be stringified>"}else a=void 0===t?"undefined":null===t?"null":typeof t;A("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,a)}}R.prototype.add=function(t,e){var n=P.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},O.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},O.prototype.reset=function(){this.next=this.b=this.a=null};var L=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(a(t))return a(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},M=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=a(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)},F=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=a(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},U=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=a(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function q(t,e){return 0<=L(t,e)}function V(t,e){var n;return(n=0<=(e=L(t,e)))&&Array.prototype.splice.call(t,e,1),n}function B(t,e){!function(t,e){for(var n=a(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(t,(function(n,r){e.call(void 0,n,r,t)&&Array.prototype.splice.call(t,r,1)}))}function j(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Q(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function K(t){for(var e in t)return!1;return!0}function H(t){var e,n={};for(e in t)n[e]=t[e];return n}var z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function G(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<z.length;o++)n=z[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Y(t,e){this.a=t===$&&e||"",this.b=J}function X(t){return t instanceof Y&&t.constructor===Y&&t.b===J?t.a:(A("expected object of type Const, got '"+t+"'"),"type_error:Const")}Y.prototype.qa=!0,Y.prototype.pa=function(){return this.a},Y.prototype.toString=function(){return"Const{"+this.a+"}"};var J={},$={},Z=new Y($,"");function tt(){this.a="",this.b=ot}function et(t){return t instanceof tt&&t.constructor===tt&&t.b===ot?t.a:(A("expected object of type TrustedResourceUrl, got '"+t+"' of type "+l(t)),"type_error:TrustedResourceUrl")}function nt(t,e){var n=X(t);if(!it.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return at(t=n.replace(rt,(function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof Y?X(t):encodeURIComponent(String(t))})))}tt.prototype.qa=!0,tt.prototype.pa=function(){return this.a.toString()},tt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var rt=/%{(\w+)}/g,it=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ot={};function at(t){var e=new tt;return e.a=t,e}var st=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ut=/&/g,ct=/</g,ht=/>/g,lt=/"/g,pt=/'/g,ft=/\x00/g,dt=/[\x00&<>"']/;function yt(t,e){return-1!=t.indexOf(e)}function vt(t,e){return t<e?-1:e<t?1:0}function gt(){this.a="",this.b=Et}function mt(t){return t instanceof gt&&t.constructor===gt&&t.b===Et?t.a:(A("expected object of type SafeUrl, got '"+t+"' of type "+l(t)),"type_error:SafeUrl")}gt.prototype.qa=!0,gt.prototype.pa=function(){return this.a.toString()},gt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var _t=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function bt(t){return t instanceof gt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),_t.test(t)||(t="about:invalid#zClosurez"),Tt(t))}var wt,Et={};function Tt(t){var e=new gt;return e.a=t,e}Tt("about:blank");t:{var Ct=o.navigator;if(Ct){var St=Ct.userAgent;if(St){wt=St;break t}}wt=""}function It(t){return yt(wt,t)}function Nt(){this.a="",this.b=Dt}function At(t){return t instanceof Nt&&t.constructor===Nt&&t.b===Dt?t.a:(A("expected object of type SafeHtml, got '"+t+"' of type "+l(t)),"type_error:SafeHtml")}Nt.prototype.qa=!0,Nt.prototype.pa=function(){return this.a.toString()},Nt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Dt={};function kt(t){var e=new Nt;return e.a=t,e}kt("<!DOCTYPE html>");var Rt,Pt,Ot=kt("");function xt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Lt(t){return dt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ut,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ct,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ht,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(lt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(pt,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(ft,"&#0;"))),t}function Mt(t){o.setTimeout((function(){throw t}),0)}function Ft(t,e){Pt||function(){if(o.Promise&&o.Promise.resolve){var t=o.Promise.resolve(void 0);Pt=function(){t.then(Vt)}}else Pt=function(){var t=Vt;!y(o.setImmediate)||o.Window&&o.Window.prototype&&!It("Edge")&&o.Window.prototype.setImmediate==o.setImmediate?(Rt=Rt||function(){var t=o.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!It("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=at(X(Z));x(t,"HTMLIFrameElement"),t.src=et(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(At(Ot)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=w((function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()}),this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||It("Trident")||It("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){o.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}())(t):o.setImmediate(t)}}(),Ut||(Pt(),Ut=!0),qt.add(t,e)}kt("<br>");var Ut=!1,qt=new R;function Vt(){for(var t;n=e=void 0,n=null,(e=qt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Mt(t)}k(P,t)}var e,n;Ut=!1}function Bt(t,e){if(this.a=jt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=h)try{var n=this;t.call(e,(function(t){te(n,Wt,t)}),(function(t){if(!(t instanceof se))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}te(n,Qt,t)}))}catch(t){te(this,Qt,t)}}var jt=0,Wt=2,Qt=3;function Kt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Kt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Ht=new D((function(){return new Kt}),(function(t){t.reset()}));function zt(t,e,n){var r=Ht.get();return r.g=t,r.b=e,r.f=n,r}function Gt(t){if(t instanceof Bt)return t;var e=new Bt(h);return te(e,Wt,t),e}function Yt(t){return new Bt((function(e,n){n(t)}))}function Xt(t,e,n){ee(t,e,n,null)||Ft(E(e,t))}function Jt(t){return new Bt((function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Gb:!0,value:o}:{Gb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)Xt(t[o],E(i,o,!0),E(i,o,!1));else e(r)}))}function $t(t,e){t.b||t.a!=Wt&&t.a!=Qt||ne(t),t.f?t.f.next=e:t.b=e,t.f=e}function Zt(t,e,n,r){var i=zt(null,null,null);return i.a=new Bt((function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(n){o(n)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof se?o(e):t(i)}catch(e){o(e)}}:o})),$t(i.a.c=t,i),i.a}function te(t,e,n){t.a==jt&&(t===n&&(e=Qt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ee(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,ne(t),e!=Qt||n instanceof se||function(t,e){t.g=!0,Ft((function(){t.g&&ae.call(null,e)}))}(t,n)))}function ee(t,e,n,r){if(t instanceof Bt)return $t(t,zt(e||h,n||null,r)),!0;if(S(t))return t.then(e,n,r),!0;if(v(t))try{var i=t.then;if(y(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,(function(t){a||(a=!0,n.call(i,t))}),o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function ne(t){t.h||(t.h=!0,Ft(t.Zb,t))}function re(t){var e=null;return t.b&&(t.b=(e=t.b).next,e.next=null),t.b||(t.f=null),e}function ie(t,e,n,r){if(n==Qt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,oe(e,n,r);else try{e.c?e.g.call(e.f):oe(e,n,r)}catch(t){ae.call(null,t)}k(Ht,e)}function oe(t,e,n){e==Wt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}Bt.prototype.then=function(t,e,n){return Zt(this,y(t)?t:null,y(e)?e:null,n)},Bt.prototype.$goog_Thenable=!0,(t=Bt.prototype).ka=function(t,e){return(t=zt(t,t,e)).c=!0,$t(this,t),this},t.s=function(t,e){return Zt(this,null,t,e)},t.cancel=function(t){this.a==jt&&Ft((function(){!function t(e,n){if(e.a==jt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==jt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):re(r),ie(r,o,Qt,n)))}e.c=null}else te(e,Qt,n)}(this,new se(t))}),this)},t.Oc=function(t){this.a=jt,te(this,Wt,t)},t.Pc=function(t){this.a=jt,te(this,Qt,t)},t.Zb=function(){for(var t;t=re(this);)ie(this,t,this.a,this.i);this.h=!1};var ae=Mt;function se(t){I.call(this,t)}function ue(){this.va=this.va,this.la=this.la}C(se,I);var ce=0;function he(t){t.va||(t.va=!0,t.za(),0==ce)||t[g]||(t[g]=++m)}function le(t){return le[" "](t),t}ue.prototype.va=!(se.prototype.name="cancel"),ue.prototype.za=function(){if(this.la)for(;this.la.length;)this.la.shift()()},le[" "]=h;var pe,fe,de=It("Opera"),ye=It("Trident")||It("MSIE"),ve=It("Edge"),ge=ve||ye,me=It("Gecko")&&!(yt(wt.toLowerCase(),"webkit")&&!It("Edge"))&&!(It("Trident")||It("MSIE"))&&!It("Edge"),_e=yt(wt.toLowerCase(),"webkit")&&!It("Edge");function be(){var t=o.document;return t?t.documentMode:void 0}t:{var we="",Ee=(fe=wt,me?/rv:([^\);]+)(\)|;)/.exec(fe):ve?/Edge\/([\d\.]+)/.exec(fe):ye?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(fe):_e?/WebKit\/(\S+)/.exec(fe):de?/(?:Version)[ \/]?(\S+)/.exec(fe):void 0);if(Ee&&(we=Ee?Ee[1]:""),ye){var Te=be();if(null!=Te&&Te>parseFloat(we)){pe=String(Te);break t}}pe=we}var Ce,Se={};function Ie(t){return function(e,n){var r=Se;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=function(){for(var e=0,n=st(String(pe)).split("."),r=st(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=vt(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||vt(0==a[2].length,0==s[2].length)||vt(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}()}(t)}Ce=o.document&&ye?be():void 0;var Ne=Object.freeze||function(t){return t},Ae=!ye||9<=Number(Ce),De=ye&&!Ie("9"),ke=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{o.addEventListener("test",h,e),o.removeEventListener("test",h,e)}catch(t){}return t}();function Re(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function Pe(t,e){if(Re.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(me){t:{try{le(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=a(t.pointerType)?t.pointerType:Oe[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Re.prototype.preventDefault=function(){this.Mb=!1},C(Pe,Re);var Oe=Ne({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var xe="closure_listenable_"+(1e6*Math.random()|0),Le=0;function Me(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Pa=i,this.key=++Le,this.ta=this.Ka=!1}function Fe(t){t.ta=!0,t.listener=null,t.proxy=null,t.src=null,t.Pa=null}function Ue(t){this.src=t,this.a={},this.b=0}function qe(t,e){var n=e.type;n in t.a&&V(t.a[n],e)&&(Fe(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Ve(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ta&&o.listener==e&&o.capture==!!n&&o.Pa==r)return i}return-1}Ue.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Ve(t,e,r,i);return-1<a?(e=t[a],n||(e.Ka=!1)):((e=new Me(e,this.src,o,!!r,i)).Ka=n,t.push(e)),e};var Be="closure_lm_"+(1e6*Math.random()|0),je={};function We(t,e,n,r,i){if(r&&r.once)Ke(t,e,n,r,i);else if(f(e))for(var o=0;o<e.length;o++)We(t,e[o],n,r,i);else n=tn(n),t&&t[xe]?nn(t,e,n,v(r)?!!r.capture:!!r,i):Qe(t,e,n,!1,r,i)}function Qe(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=v(i)?!!i.capture:!!i,s=$e(t);if(s||(t[Be]=s=new Ue(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var t=Je,e=Ae?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)ke||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ge(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function Ke(t,e,n,r,i){if(f(e))for(var o=0;o<e.length;o++)Ke(t,e[o],n,r,i);else n=tn(n),t&&t[xe]?rn(t,e,n,v(r)?!!r.capture:!!r,i):Qe(t,e,n,!0,r,i)}function He(t,e,n,r,i){if(f(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else r=v(r)?!!r.capture:!!r,n=tn(n),t&&t[xe]?(t=t.u,(e=String(e).toString())in t.a&&-1<(n=Ve(o=t.a[e],n,r,i))&&(Fe(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):(t=t&&$e(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Ve(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.ta){var e=t.src;if(e&&e[xe])qe(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ge(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=$e(e))?(qe(n,t),0==n.b&&(n.src=null,e[Be]=null)):Fe(t)}}}function Ge(t){return t in je?je[t]:je[t]="on"+t}function Ye(t,e,n,r){var i=!0;if((t=$e(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ta&&(o=Xe(o,r),i=i&&!1!==o)}return i}function Xe(t,e){var n=t.listener,r=t.Pa||t.src;return t.Ka&&ze(t),n.call(r,e)}function Je(t,e){if(t.ta)return!0;if(Ae)return Xe(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=o,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}!i&&null!=r.returnValue||(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var a=Ye(r[i],t,!0,e);n=n&&a}for(i=0;i<r.length;i++)e.b=r[i],a=Ye(r[i],t,!1,e),n=n&&a}return n}function $e(t){return(t=t[Be])instanceof Ue?t:null}var Ze="__closure_events_fn_"+(1e9*Math.random()>>>0);function tn(t){return y(t)?t:(t[Ze]||(t[Ze]=function(e){return t.handleEvent(e)}),t[Ze])}function en(){ue.call(this),this.u=new Ue(this),(this.Sb=this).Xa=null}function nn(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function rn(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function on(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ta&&a.capture==n){var s=a.listener,u=a.Pa||a.src;a.Ka&&qe(t.u,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Mb}function an(t,e,n){if(y(t))n&&(t=w(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=w(t.handleEvent,t)}return 2147483647<Number(e)?-1:o.setTimeout(t,e||0)}function sn(t){var e=null;return new Bt((function(n,r){-1==(e=an((function(){n(void 0)}),t))&&r(Error("Failed to schedule timer."))})).s((function(t){throw o.clearTimeout(e),t}))}function un(t){if(t.U&&"function"==typeof t.U)return t.U();if(a(t))return t.split("");if(d(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function cn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(d(t)||a(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function hn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof hn)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ln(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}C(en,ue),en.prototype[xe]=!0,en.prototype.addEventListener=function(t,e,n,r){We(this,t,e,n,r)},en.prototype.removeEventListener=function(t,e,n,r){He(this,t,e,n,r)},en.prototype.dispatchEvent=function(t){var e,n=this.Xa;if(n)for(e=[];n;n=n.Xa)e.push(n);n=this.Sb;var r=t.type||t;if(a(t))t=new Re(t,n);else if(t instanceof Re)t.target=t.target||n;else{var i=t;G(t=new Re(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.b=e[o];i=on(s,r,!0,t)&&i}if(i=on(s=t.b=n,r,!0,t)&&i,i=on(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=on(s=t.b=e[o],r,!1,t)&&i;return i},en.prototype.za=function(){if(en.qb.za.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Fe(n[r]);delete e.a[t],e.b--}}this.Xa=null},(t=hn.prototype).U=function(){ln(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return ln(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var fn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function dn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof dn?(this.h=void 0!==e?e:t.h,yn(this,t.f),this.i=t.i,this.b=t.b,vn(this,t.l),this.c=t.c,gn(this,Mn(t.a)),this.g=t.g):t&&(n=String(t).match(fn))?(this.h=!!e,yn(this,n[1]||"",!0),this.i=En(n[2]||""),this.b=En(n[3]||"",!0),vn(this,n[4]),this.c=En(n[5]||"",!0),gn(this,n[6]||"",!0),this.g=En(n[7]||"")):(this.h=!!e,this.a=new kn(null,this.h))}function yn(t,e,n){t.f=n?En(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function vn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.l=e}else t.l=null}function gn(t,e,n){e instanceof kn?(t.a=e,function(t,e){e&&!t.f&&(Rn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(On(this,e),Ln(this,n,t))}),t)),t.f=e}(t.a,t.h)):(n||(e=Tn(e,An)),t.a=new kn(e,t.h))}function mn(t,e,n){t.a.set(e,n)}function _n(t,e){return t.a.get(e)}function bn(t){return t instanceof dn?new dn(t):new dn(t,void 0)}function wn(t,e){var n=new dn(null,void 0);return yn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function En(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Tn(t,e,n){return a(t)?(t=encodeURI(t).replace(e,Cn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Cn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}dn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Tn(e,Sn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(Tn(e,Sn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Tn(n,"/"==n.charAt(0)?Nn:In,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Tn(n,Dn)),t.join("")},dn.prototype.resolve=function(t){var e=new dn(this),n=!!t.f;n?yn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)vn(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(yt(i,"./")||yt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?gn(e,Mn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Sn=/[#\/\?@]/g,In=/[#\?:]/g,Nn=/[#\?]/g,An=/[#\?@]/g,Dn=/#/g;function kn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Rn(t){t.a||(t.a=new hn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Pn(t){var e=cn(t);if(void 0===e)throw Error("Keys are undefined");var n=new kn(null,void 0);t=un(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];f(o)?Ln(n,i,o):n.add(i,o)}return n}function On(t,e){Rn(t),e=Fn(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&ln(t)))}function xn(t,e){return Rn(t),e=Fn(t,e),pn(t.a.b,e)}function Ln(t,e,n){On(t,e),0<n.length&&(t.c=null,t.a.set(Fn(t,e),W(n)),t.b+=n.length)}function Mn(t){var e=new kn;return e.c=t.c,t.a&&(e.a=new hn(t.a),e.b=t.b),e}function Fn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=kn.prototype).add=function(t,e){Rn(this),this.c=null,t=Fn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){Rn(this),this.a.forEach((function(n,r){M(n,(function(n){t.call(e,n,r,this)}),this)}),this)},t.X=function(){Rn(this);for(var t=this.a.U(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.U=function(t){Rn(this);var e=[];if(a(t))xn(this,t)&&(e=j(e,this.a.get(Fn(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=j(e,t[n])}return e},t.set=function(t,e){return Rn(this),this.c=null,xn(this,t=Fn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.U(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var Un=!ye||9<=Number(Ce);function qn(t){var e=document;return a(t)?e.getElementById(t):t}function Vn(t,e){Q(e,(function(e,n){e&&"object"==typeof e&&e.qa&&(e=e.pa()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:Bn.hasOwnProperty(n)?t.setAttribute(Bn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e}))}var Bn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function jn(t){if(t&&"number"==typeof t.length){if(v(t))return"function"==typeof t.item||"string"==typeof t.item;if(y(t))return"function"==typeof t.item}return!1}function Wn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(f(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&"function"!=typeof(a=n[i])&&(r.push(o),zn(i,r),r.push(":"),t(e,a,r),o=",");return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":zn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Qn,t,e),e.join("")}function Qn(){}var Kn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Hn=/\uffff/.test("")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function zn(t,e){e.push('"',t.replace(Hn,(function(t){var e=Kn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Kn[t]=e),e})),'"')}function Gn(){var t=fr();return ye&&!!Ce&&11==Ce||/Edge\/\d+/.test(t)}function Yn(){return o.window&&o.window.location.href||self&&self.location&&self.location.href||""}function Xn(t,e){e=e||o.window;var n="about:blank";t&&(n=mt(bt(t)).toString()),e.location.href=n}function Jn(t){return!!((t=(t||fr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function $n(t){t=t||o.window;try{t.close()}catch(t){}}function Zn(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=fr().toLowerCase(),r&&(e.target=r,yt(n,"crios/")&&(e.target="_blank")),hr(fr())==ur&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof gt?n:bt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((It("iPhone")&&!It("iPod")&&!It("iPad")||It("iPad")||It("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(x(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof gt||e instanceof gt||(e="object"==typeof e&&e.qa?e.pa():String(e),_t.test(e)||(e="about:invalid#zClosurez"),e=Tt(e)),a.href=mt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=mt(e).toString(),a&&(ge&&yt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=kt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Lt(t)+'">'),a.document.write(At(t)),a.document.close())):(a=r.open(mt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var tr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,er=/^[^@]+@[^@]+$/;function nr(){var t=null;return new Bt((function(e){"complete"==o.document.readyState?e():(t=function(){e()},Ke(window,"load",t))})).s((function(e){throw He(window,"load",t),e}))}function rr(t){return t=t||fr(),!("file:"!==mr()&&"ionic:"!==mr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function ir(){var t=o.window;try{return!(!t||t==t.top)}catch(t){return!1}}function or(){return void 0!==o.WorkerGlobalScope&&"function"==typeof o.importScripts}function ar(){return Ps.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":Ps.INTERNAL.hasOwnProperty("node")?"Node":or()?"Worker":"Browser"}function sr(){var t=ar();return"ReactNative"===t||"Node"===t}var ur="Firefox",cr="Chrome";function hr(t){var e=t.toLowerCase();return yt(e,"opera/")||yt(e,"opr/")||yt(e,"opios/")?"Opera":yt(e,"iemobile")?"IEMobile":yt(e,"msie")||yt(e,"trident/")?"IE":yt(e,"edge/")?"Edge":yt(e,"firefox/")?ur:yt(e,"silk/")?"Silk":yt(e,"blackberry")?"Blackberry":yt(e,"webos")?"Webos":!yt(e,"safari/")||yt(e,"chrome/")||yt(e,"crios/")||yt(e,"android")?!yt(e,"chrome/")&&!yt(e,"crios/")||yt(e,"edge/")?yt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":cr:"Safari"}var lr={Wc:"FirebaseCore-web",Yc:"FirebaseUI-web"};function pr(t,e){e=e||[];var n,r=[],i={};for(n in lr)i[lr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=ar())?r=hr(i=fr()):"Worker"===r&&(r=hr(i=fr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function fr(){return o.navigator&&o.navigator.userAgent||""}function dr(t,e){t=t.split("."),e=e||o;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function yr(){try{var t=o.localStorage,e=Tr();if(t)return t.setItem(e,"1"),t.removeItem(e),!Gn()||!!o.indexedDB}catch(t){return or()&&!!o.indexedDB}return!1}function vr(){return(gr()||"chrome-extension:"===mr()||rr())&&!sr()&&yr()&&!or()}function gr(){return"http:"===mr()||"https:"===mr()}function mr(){return o.location&&o.location.protocol||null}function _r(t){return!Jn(t=t||fr())&&hr(t)!=ur}function br(t){return void 0===t?null:Wn(t)}function wr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!=t[e]&&(n[e]=t[e]);return n}function Er(t){if(null!==t)return JSON.parse(t)}function Tr(t){return t||Math.floor(1e9*Math.random()).toString()}function Cr(t){return"Safari"!=hr(t=t||fr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Sr(){var t=o.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Ir(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=fr(),e=ar(),this.b=Jn(t)||"ReactNative"===e}function Nr(){var t=o.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Ar(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Dr(){return!(!dr("fireauth.oauthhelper",o)&&!dr("fireauth.iframe",o))}Ir.prototype.get=function(){var t=o.navigator;return!t||"boolean"!=typeof t.onLine||!gr()&&"chrome-extension:"!==mr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var kr,Rr={};function Pr(t){Rr[t]||(Rr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Or={};Object.defineProperty(Or,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Or,"abcd",{configurable:!0,enumerable:!0,value:2}),kr=2==Or.abcd}catch(t){kr=!1}function xr(t,e,n){kr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Lr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&xr(t,n,e[n])}function Mr(t){var e={};return Lr(e,t),e}function Fr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)xr(e,n,Fr(t[n]));return e}function Ur(t){var e={},n=t[Vr],r=t[Br];if(!(t=t[jr])||t!=qr&&!n)throw Error("Invalid provider user info!");e[Qr]=r||null,e[Wr]=n||null,xr(this,Hr,t),xr(this,Kr,Fr(e))}var qr="EMAIL_SIGNIN",Vr="email",Br="newEmail",jr="requestType",Wr="email",Qr="fromEmail",Kr="data",Hr="operation";function zr(t,e){this.code=Yr+t,this.message=e||Xr[t]||""}function Gr(t){var e=t&&t.code;return e?new zr(e.substring(Yr.length),t.message):null}C(zr,Error),zr.prototype.A=function(){return{code:this.code,message:this.message}},zr.prototype.toJSON=function(){return this.A()};var Yr="auth/",Xr={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Jr(t){var e=_n(t=bn(t),$r)||null,n=_n(t,Zr)||null,r=_n(t,ni)||null;if(r=r&&ii[r]||null,!e||!n||!r)throw new zr("argument-error",$r+", "+Zr+"and "+ni+" are required in a valid action code URL.");Lr(this,{apiKey:e,operation:r,code:n,continueUrl:_n(t,ti)||null,languageCode:_n(t,ei)||null,tenantId:_n(t,ri)||null})}var $r="apiKey",Zr="oobCode",ti="continueUrl",ei="languageCode",ni="mode",ri="tenantId",ii={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:qr,verifyEmail:"VERIFY_EMAIL"};function oi(t){try{return new Jr(t)}catch(t){return null}}function ai(t){var e=t[li];if(void 0===e)throw new zr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new zr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[si];if(n&&"object"==typeof n){e=n[di];var r=n[pi];if(n=n[fi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new zr("argument-error",pi+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new zr("argument-error",fi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new zr("argument-error",di+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new zr("missing-android-pkg-name")}}else if(void 0!==n)throw new zr("argument-error",si+" property must be a non null object when specified.");if(this.f=null,(e=t[hi])&&"object"==typeof e){if("string"==typeof(e=e[yi])&&e.length)this.f=e;else if(void 0!==e)throw new zr("argument-error",yi+" property must be a non empty string when specified.")}else if(void 0!==e)throw new zr("argument-error",hi+" property must be a non null object when specified.");if(void 0!==(e=t[ci])&&"boolean"!=typeof e)throw new zr("argument-error",ci+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[ui])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new zr("argument-error",ui+" property must be a non empty string when specified.");this.i=t||null}var si="android",ui="dynamicLinkDomain",ci="handleCodeInApp",hi="iOS",li="url",pi="installApp",fi="minimumVersion",di="packageName",yi="bundleId";function vi(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var gi=null,mi=null;function _i(t){this.f=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function bi(t){return(t=wi(t))&&t.sub&&t.iss&&t.aud&&t.exp?new _i(t):null}function wi(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(function(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=mi[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!gi){gi={},mi={};for(var t=0;t<65;t++)gi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(mi[gi[t]]=t)&&(mi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,(function(t){e+=String.fromCharCode(t)})),e}(t))}catch(t){}return null}_i.prototype.R=function(){return this.c},_i.prototype.g=function(){return this.b};var Ei,Ti={bd:{cb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},dd:{cb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ed:{cb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Ci(t){for(var e in Ti)if(Ti[e].id===t)return{firebaseEndpoint:(t=Ti[e]).cb,secureTokenEndpoint:t.ib};return null}Ei=Ci("__EID__")?"__EID__":void 0;var Si="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Ii=["client_id","response_type","scope","redirect_uri","state"],Ni={Xc:{Ea:"locale",sa:700,ra:600,Fa:"facebook.com",Qa:Ii},Zc:{Ea:null,sa:500,ra:750,Fa:"github.com",Qa:Ii},$c:{Ea:"hl",sa:515,ra:680,Fa:"google.com",Qa:Ii},fd:{Ea:"lang",sa:485,ra:705,Fa:"twitter.com",Qa:Si},Vc:{Ea:"locale",sa:600,ra:600,Fa:"apple.com",Qa:[]}};function Ai(t){for(var e in Ni)if(Ni[e].Fa==t)return Ni[e];return null}function Di(t){var e={};e["facebook.com"]=xi,e["google.com"]=Mi,e["github.com"]=Li,e["twitter.com"]=Fi;var n=t&&t[Ri];try{if(n)return e[n]?new e[n](t):new Oi(t);if(void 0!==t[ki])return new Pi(t)}catch(t){}return null}var ki="idToken",Ri="providerId";function Pi(t){var e=t[Ri];if(!e&&t[ki]){var n=bi(t[ki]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),xr(this,"providerId",e),xr(this,"isNewUser",n)}function Oi(t){Pi.call(this,t),xr(this,"profile",Fr((t=Er(t.rawUserInfo||"{}"))||{}))}function xi(t){if(Oi.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Li(t){if(Oi.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",this.profile&&this.profile.login||null)}function Mi(t){if(Oi.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Fi(t){if(Oi.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",t.screenName||null)}function Ui(t){var e=bn(t),n=_n(e,"link"),r=_n(bn(n),"link");return _n(bn(e=_n(e,"deep_link_id")),"link")||e||r||n||t}function qi(){}function Vi(t,e){return t.then((function(t){if(t[Na]){var n=bi(t[Na]);if(!n||e!=n.f)throw new zr("user-mismatch");return t}throw new zr("user-mismatch")})).s((function(t){throw t&&t.code&&t.code==Yr+"user-not-found"?new zr("user-mismatch"):t}))}function Bi(t,e){if(!e)throw new zr("internal-error","failed to construct a credential");this.a=e,xr(this,"providerId",t),xr(this,"signInMethod",t)}function ji(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Wi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Bi(t.providerId,t.pendingToken)}catch(t){}return null}function Qi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&xr(this,"idToken",e.idToken),e.accessToken&&xr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&xr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new zr("internal-error","failed to construct a credential");xr(this,"accessToken",e.oauthToken),xr(this,"secret",e.oauthTokenSecret)}xr(this,"providerId",t),xr(this,"signInMethod",n)}function Ki(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Hi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Qi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function zi(t,e){this.Fc=e||[],Lr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(Ai(t)||{}).Ea||null,this.bb=null}function Gi(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new zr("argument-error",'SAML provider IDs must be prefixed with "saml."');zi.call(this,t,[])}function Yi(t){zi.call(this,t,Ii),this.a=[]}function Xi(){Yi.call(this,"facebook.com")}function Ji(t){if(!t)throw new zr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Xi).credential({accessToken:e})}function $i(){Yi.call(this,"github.com")}function Zi(t){if(!t)throw new zr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new $i).credential({accessToken:e})}function to(){Yi.call(this,"google.com"),this.ya("profile")}function eo(t,e){var n=t;return v(t)&&(n=t.idToken,e=t.accessToken),(new to).credential({idToken:n,accessToken:e})}function no(){zi.call(this,"twitter.com",Si)}function ro(t,e){var n=t;if(v(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new zr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Qi("twitter.com",n,"twitter.com")}function io(t,e,n){this.a=t,this.c=e,xr(this,"providerId","password"),xr(this,"signInMethod",n===ao.EMAIL_LINK_SIGN_IN_METHOD?ao.EMAIL_LINK_SIGN_IN_METHOD:ao.EMAIL_PASSWORD_SIGN_IN_METHOD)}function oo(t){return t&&t.email&&t.password?new io(t.email,t.password,t.signInMethod):null}function ao(){Lr(this,{providerId:"password",isOAuthProvider:!1})}function so(t,e){if(!(e=uo(e)))throw new zr("argument-error","Invalid email link!");return new io(t,e.code,ao.EMAIL_LINK_SIGN_IN_METHOD)}function uo(t){return(t=oi(t=Ui(t)))&&t.operation===qr?t:null}function co(t){if(!(t.Va&&t.Ua||t.Ha&&t.ba))throw new zr("internal-error");this.a=t,xr(this,"providerId","phone"),xr(this,"signInMethod","phone")}function ho(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return M(["verificationId","verificationCode","temporaryProof","phoneNumber"],(function(n){t[n]&&(e[n]=t[n])})),new co(e)}return null}function lo(t){return t.a.Ha&&t.a.ba?{temporaryProof:t.a.Ha,phoneNumber:t.a.ba}:{sessionInfo:t.a.Va,code:t.a.Ua}}function po(t){try{this.a=t||Ps.auth()}catch(t){throw new zr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Lr(this,{providerId:"phone",isOAuthProvider:!1})}function fo(t,e){if(!t)throw new zr("missing-verification-id");if(!e)throw new zr("missing-verification-code");return new co({Va:t,Ua:e})}function yo(t){if(t.temporaryProof&&t.phoneNumber)return new co({Ha:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return eo(o,n);case"facebook.com":return Ji(n);case"github.com":return Zi(n);case"twitter.com":return ro(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Bi(e,a):new Qi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Yi(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function vo(t){if(!t.isOAuthProvider)throw new zr("invalid-oauth-provider")}function go(t,e,n,r,i,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new zr("invalid-auth-event");if(this.g&&this.a)throw new zr("invalid-auth-event");if(this.g&&!this.f)throw new zr("invalid-auth-event")}function mo(t){return(t=t||{}).type?new go(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Gr(t.error),t.postBody,t.tenantId):null}function _o(){this.b=null,this.a=[]}C(Oi,Pi),C(xi,Oi),C(Li,Oi),C(Mi,Oi),C(Fi,Oi),Bi.prototype.na=function(t){return Ka(t,ji(this))},Bi.prototype.b=function(t,e){var n=ji(this);return n.idToken=e,Ha(t,n)},Bi.prototype.f=function(t,e){return Vi(za(t,ji(this)),e)},Bi.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Qi.prototype.na=function(t){return Ka(t,Ki(this))},Qi.prototype.b=function(t,e){var n=Ki(this);return n.idToken=e,Ha(t,n)},Qi.prototype.f=function(t,e){return Vi(za(t,Ki(this)),e)},Qi.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},zi.prototype.Ga=function(t){return this.zb=H(t),this},C(Gi,zi),C(Yi,zi),Yi.prototype.ya=function(t){return q(this.a,t)||this.a.push(t),this},Yi.prototype.Hb=function(){return W(this.a)},Yi.prototype.credential=function(t,e){var n;if(!(n=v(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new zr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Qi(this.providerId,n,this.providerId)},C(Xi,Yi),xr(Xi,"PROVIDER_ID","facebook.com"),xr(Xi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),C($i,Yi),xr($i,"PROVIDER_ID","github.com"),xr($i,"GITHUB_SIGN_IN_METHOD","github.com"),C(to,Yi),xr(to,"PROVIDER_ID","google.com"),xr(to,"GOOGLE_SIGN_IN_METHOD","google.com"),C(no,zi),xr(no,"PROVIDER_ID","twitter.com"),xr(no,"TWITTER_SIGN_IN_METHOD","twitter.com"),io.prototype.na=function(t){return this.signInMethod==ao.EMAIL_LINK_SIGN_IN_METHOD?Es(t,es,{email:this.a,oobCode:this.c}):Es(t,ms,{email:this.a,password:this.c})},io.prototype.b=function(t,e){return this.signInMethod==ao.EMAIL_LINK_SIGN_IN_METHOD?Es(t,ns,{idToken:e,email:this.a,oobCode:this.c}):Es(t,ps,{idToken:e,email:this.a,password:this.c})},io.prototype.f=function(t,e){return Vi(this.na(t),e)},io.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Lr(ao,{PROVIDER_ID:"password"}),Lr(ao,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Lr(ao,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),co.prototype.na=function(t){return t.Wa(lo(this))},co.prototype.b=function(t,e){var n=lo(this);return n.idToken=e,Es(t,bs,n)},co.prototype.f=function(t,e){var n=lo(this);return n.operation="REAUTH",Vi(t=Es(t,ws,n),e)},co.prototype.A=function(){var t={providerId:"phone"};return this.a.Va&&(t.verificationId=this.a.Va),this.a.Ua&&(t.verificationCode=this.a.Ua),this.a.Ha&&(t.temporaryProof=this.a.Ha),this.a.ba&&(t.phoneNumber=this.a.ba),t},po.prototype.Wa=function(t,e){var n=this.a.b;return Gt(e.verify()).then((function(r){if(!a(r))throw new zr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return Es(t,hs,e)}(n,{phoneNumber:t,recaptchaToken:r}).then((function(t){return"function"==typeof e.reset&&e.reset(),t}),(function(t){throw"function"==typeof e.reset&&e.reset(),t}));default:throw new zr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}}))},Lr(po,{PROVIDER_ID:"phone"}),Lr(po,{PHONE_SIGN_IN_METHOD:"phone"}),go.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},go.prototype.R=function(){return this.h},go.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var bo,wo=null;function Eo(t){var e="unauthorized-domain",n=void 0,r=bn(t);t=r.b,"chrome-extension"==(r=r.f)?n=xt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=xt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",zr.call(this,e,n)}function To(t,e,n){zr.call(this,t,n),(t=e||{}).Ab&&xr(this,"email",t.Ab),t.ba&&xr(this,"phoneNumber",t.ba),t.credential&&xr(this,"credential",t.credential),t.Qb&&xr(this,"tenantId",t.Qb)}function Co(t){if(t.code){var e=t.code||"";0==e.indexOf(Yr)&&(e=e.substring(Yr.length));var n={credential:yo(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new zr(e,t.message||void 0);return new To(e,n,t.message)}return null}function So(){}function Io(){}function No(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function Ao(){}function Do(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=w(this.fc,this),this.a.onerror=w(this.Ib,this),this.a.onprogress=w(this.gc,this),this.a.ontimeout=w(this.kc,this)}function ko(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Ro(t,e,n){this.reset(t,e,n,void 0,void 0)}function Po(t){this.f=t,this.b=this.c=this.a=null}function Oo(t,e){this.name=t,this.value=e}C(Eo,zr),C(To,zr),To.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&G(t,e),t},To.prototype.toJSON=function(){return this.A()},So.prototype.c=null,C(Io,So),Io.prototype.a=function(){var t=No(this);return t?new ActiveXObject(t):new XMLHttpRequest},Io.prototype.b=function(){var t={};return No(this)&&(t[0]=!0,t[1]=!0),t},bo=new Io,C(Ao,So),Ao.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Do;throw Error("Unsupported browser")},Ao.prototype.b=function(){return{}},(t=Do.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,ko(this,4)},t.Ib=function(){this.status=500,this.response=this.responseText="",ko(this,4)},t.kc=function(){this.Ib()},t.gc=function(){this.status=200,ko(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Ro.prototype.a=null,Ro.prototype.reset=function(t,e,n,r,i){delete this.a},Oo.prototype.toString=function(){return this.name};var xo=new Oo("SEVERE",1e3),Lo=new Oo("WARNING",900),Mo=new Oo("CONFIG",700),Fo=new Oo("FINE",500);Po.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(A("Root logger has no level set."),null)}(this).value)for(y(e)&&(e=e()),t=new Ro(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var Uo,qo={},Vo=null;function Bo(t){var e;if(Vo||(Vo=new Po(""),(qo[""]=Vo).c=Mo),!(e=qo[t])){e=new Po(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Bo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,qo[t]=e}return e}function jo(t,e){t&&t.log(Fo,e,void 0)}function Wo(t){this.f=t}function Qo(t){en.call(this),this.o=t,this.readyState=Ko,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Bo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}C(Wo,So),Wo.prototype.a=function(){return new Qo(this.f)},Wo.prototype.b=(Uo={},function(){return Uo}),C(Qo,en);var Ko=0;function Ho(t){t.c.read().then(t.ec.bind(t)).catch(t.Oa.bind(t))}function zo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Go(t)}function Go(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Yo(t){en.call(this),this.headers=new hn,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=Xo,this.v=this.P=!1}(t=Qo.prototype).open=function(t,e){if(this.readyState!=Ko)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,Go(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Oa.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,zo(this,!1)),this.readyState=Ko},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Go(this)),this.a&&(this.readyState=3,Go(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Oa.bind(this)):void 0!==o.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Ho(this)):t.text().then(this.ic.bind(this),this.Oa.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?zo(this,!0):Go(this),3==this.readyState&&Ho(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,zo(this,!0))},t.hc=function(t){this.a&&(this.response=t,zo(this,!0))},t.Oa=function(t){var e=this.h;e&&e.log(Lo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&zo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Lo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Lo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},C(Yo,en);var Xo="";Yo.prototype.b=Bo("goog.net.XhrIo");var Jo=/^https?$/i,$o=["POST","PUT"];function Zo(t){return"content-type"==t.toLowerCase()}function ta(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,ea(t),ra(t)}function ea(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function na(t){if(t.c&&void 0!==i)if(t.w[1]&&4==oa(t)&&2==aa(t))jo(t.b,sa(t,"Local request error detected and ignored"));else if(t.i&&4==oa(t))an(t.Lb,0,t);else if(t.dispatchEvent("readystatechange"),4==oa(t)){jo(t.b,sa(t,"Request complete")),t.c=!1;try{var e,n=aa(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var a;if(a=0===n){var s=String(t.l).match(fn)[1]||null;if(!s&&o.self&&o.self.location){var u=o.self.location.protocol;s=u.substr(0,u.length-1)}a=!Jo.test(s?s.toLowerCase():"")}e=a}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<oa(t)?t.a.statusText:""}catch(e){jo(t.b,"Can not get status: "+e.message),c=""}t.h=c+" ["+aa(t)+"]",ea(t)}}finally{ra(t)}}}function ra(t,e){if(t.a){ia(t);var n=t.a,r=t.w[0]?h:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(xo,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function ia(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(o.clearTimeout(t.o),t.o=null)}function oa(t){return t.a?t.a.readyState:0}function aa(t){try{return 2<oa(t)?t.a.status:-1}catch(t){return-1}}function sa(t,e){return e+" ["+t.O+" "+t.l+" "+aa(t)+"]"}function ua(t){var e=_a;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function ca(t,e,n){t.a=!0,t.c=n,t.f=!e,fa(t)}function ha(t){if(t.a){if(!t.u)throw new da(t);t.u=!1}}function la(t,e,n,r){t.g.push([e,n,r]),t.a&&fa(t)}function pa(t){return U(t.g,(function(t){return y(t[1])}))}function fa(t){if(t.h&&t.a&&pa(t)){var e=t.h,n=ga[e];n&&(o.clearTimeout(n.a),delete ga[e]),t.h=0}t.b&&(t.b.l--,delete t.b),e=t.c;for(var r=n=!1;t.g.length&&!t.i;){var i=t.g.shift(),a=i[0],s=i[1];if(i=i[2],a=t.f?s:a)try{var u=a.call(i||t.o,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(S(e)||"function"==typeof o.Promise&&e instanceof o.Promise)&&(r=!0,t.i=!0)}catch(r){e=r,t.f=!0,pa(t)||(n=!0)}}t.c=e,r&&(u=w(t.m,t,!0),r=w(t.m,t,!1),e instanceof ua?(la(e,u,r),e.w=!0):e.then(u,r)),n&&(e=new va(e),ga[e.a]=e,t.h=e.a)}function da(){I.call(this)}function ya(){I.call(this)}function va(t){this.a=o.setTimeout(w(this.c,this),0),this.b=t}(t=Yo.prototype).Ia=function(){void 0!==i&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",jo(this.b,sa(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(jo(this.b,sa(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ra(this))},t.za=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ra(this,!0)),Yo.qb.za.call(this)},t.Lb=function(){this.va||(this.J||this.i||this.f?na(this):this.yc())},t.yc=function(){na(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case Xo:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(xo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return jo(this.b,"Can not get response: "+t.message),null}},ua.prototype.cancel=function(t){if(this.a)this.c instanceof ua&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,e.l<=0&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new ya(this),ha(this),ca(this,!1,t))}},ua.prototype.m=function(t,e){this.i=!1,ca(this,t,e)},ua.prototype.then=function(t,e,n){var r,i,o=new Bt((function(t,e){r=t,i=e}));return la(this,r,(function(t){t instanceof ya?o.cancel():i(t)})),o.then(t,e,n)},ua.prototype.$goog_Thenable=!0,C(da,I),da.prototype.message="Deferred has already fired",da.prototype.name="AlreadyCalledError",C(ya,I),ya.prototype.message="Deferred was canceled",ya.prototype.name="CanceledError",va.prototype.c=function(){throw delete ga[this.a],this.b};var ga={};function ma(t){var e,n=document,r=et(t).toString(),i=document.createElement("SCRIPT"),a={Nb:i,Ia:void 0},s=new ua(a);return e=window.setTimeout((function(){ba(i,!0);var t=new Ta(Ea,"Timeout reached for loading script "+r);ha(s),ca(s,!1,t)}),5e3),a.Ia=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(ba(i,!1,e),ha(s),ca(s,!0,null))},i.onerror=function(){ba(i,!0,e);var t=new Ta(wa,"Error while loading script "+r);ha(s),ca(s,!1,t)},G(a={},{type:"text/javascript",charset:"UTF-8"}),Vn(i,a),function(t,e){x(t,"HTMLScriptElement"),t.src=et(e),null===c&&(c=(e=(e=o.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&u.test(e)?e:""),(e=c)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),s}function _a(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&ba(t,!0,this.Ia)}}function ba(t,e,n){null!=n&&o.clearTimeout(n),t.onload=h,t.onerror=h,t.onreadystatechange=h,e&&window.setTimeout((function(){t&&t.parentNode&&t.parentNode.removeChild(t)}),0)}var wa=0,Ea=1;function Ta(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),I.call(this,n),this.code=t}function Ca(t){this.f=t}function Sa(t,e,n){if(this.c=t,this.l=(t=e||{}).secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||Aa,this.g=H(t.secureTokenHeaders||Da),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||ka,this.a=H(t.firebaseHeaders||Ra),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==ar(),!(n=o.XMLHttpRequest||n&&Ps.INTERNAL.node&&Ps.INTERNAL.node.XMLHttpRequest)&&!or())throw new zr("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,this.f=or()?new Wo(self):sr()?new Ca(n):new Ao,this.b=null}C(Ta,I),C(Ca,So),Ca.prototype.a=function(){return new this.f},Ca.prototype.b=function(){return{}};var Ia,Na="idToken",Aa=new Ir(3e4,6e4),Da={"Content-Type":"application/x-www-form-urlencoded"},ka=new Ir(3e4,6e4),Ra={"Content-Type":"application/json"};function Pa(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Oa(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function xa(t,e,n,r,i,a,s){(t=function(){var t=fr();return!((t=hr(t)!=cr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30||ye&&Ce&&!(9<Ce))}()||or()?w(t.o,t):(Ia=Ia||new Bt((function(t,e){!function(t,e){((window.gapi||{}).client||{}).request?t():(o[Ma]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){la(t,null,e,void 0)}(ma(nt(La,{onload:Ma})),(function(){e(Error("CORS_UNSUPPORTED"))})))}(t,e)})),w(t.m,t)))(e,n,r,i,a,s)}Sa.prototype.R=function(){return this.b},Sa.prototype.o=function(t,e,n,r,i,s){if(or()&&(void 0===o.fetch||void 0===o.Headers||void 0===o.Request))throw new zr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var u=new Yo(this.f);if(s){u.g=Math.max(0,s);var c=setTimeout((function(){u.dispatchEvent("timeout")}),s)}nn(u,"complete",(function(){c&&clearTimeout(c);var n=null;try{n=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return jo(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){n=null}e&&e(n)})),rn(u,"ready",(function(){c&&clearTimeout(c),he(this)})),rn(u,"timeout",(function(){c&&clearTimeout(c),he(this),e&&e(null)})),function(t,e,n,r,i){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.O=n,t.I=!1,t.c=!0,t.a=t.B?t.B.a():bo.a(),t.w=function(t){return t.c||(t.c=t.b())}(t.B?t.B:bo),t.a.onreadystatechange=w(t.Lb,t);try{jo(t.b,sa(t,"Opening Xhr")),t.J=!0,t.a.open(n,String(e),!0),t.J=!1}catch(e){return jo(t.b,sa(t,"Error opening Xhr: "+e.message)),void ta(t,e)}e=r||"";var s=new hn(t.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(d(t)||a(t))M(t,e,void 0);else for(var n=cn(t),r=un(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,(function(t,e){s.set(e,t)})),i=function(t){t:{for(var e=Zo,n=t.length,r=a(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:a(t)?t.charAt(e):t[e]}(s.X()),r=o.FormData&&e instanceof o.FormData,!q($o,n)||i||r||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach((function(t,e){this.a.setRequestHeader(e,t)}),t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.P&&(t.a.withCredentials=t.P);try{ia(t),0<t.g&&(t.v=function(t){return ye&&Ie(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),jo(t.b,sa(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=w(t.Ia,t)):t.o=an(t.Ia,t.g,t)),jo(t.b,sa(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){jo(t.b,sa(t,"Send error: "+e.message)),ta(t,e)}}(u,t,n,r,i)};var La=new Y($,"https://apis.google.com/js/client.js?onload=%{onload}"),Ma="__fcb"+Math.floor(1e6*Math.random()).toString();function Fa(t){if(!a(t=t.email)||!er.test(t))throw new zr("invalid-email")}function Ua(t){"email"in t&&Fa(t)}function qa(t){if(!t[Na])throw new zr("internal-error")}function Va(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new zr("internal-error")}else{if(!t.sessionInfo)throw new zr("missing-verification-id");if(!t.code)throw new zr("missing-verification-code")}}Sa.prototype.m=function(t,e,n,r,i){var o=this;Ia.then((function(){window.gapi.client.setApiKey(o.c);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})})).s((function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})}))},Sa.prototype.ob=function(){return Es(this,fs,{})},Sa.prototype.rb=function(t,e){return Es(this,ls,{idToken:t,email:e})},Sa.prototype.sb=function(t,e){return Es(this,ps,{idToken:t,password:e})};var Ba={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function ja(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new zr("internal-error")}function Wa(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&xn(t=new kn(t.postBody),"nonce")&&(e.nonce=t.get("nonce"))),e}function Qa(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=Co(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=Co(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=Co(t)):t.errorMessage&&(e=Ts(t.errorMessage)),e)throw e;if(!t[Na])throw new zr("internal-error")}function Ka(t,e){return e.returnIdpCredential=!0,Es(t,ds,e)}function Ha(t,e){return e.returnIdpCredential=!0,Es(t,vs,e)}function za(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Es(t,ys,e)}function Ga(t){if(!t.oobCode)throw new zr("invalid-action-code")}(t=Sa.prototype).tb=function(t,e){var n={idToken:t},r=[];return Q(Ba,(function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)})),r.length&&(n.deleteAttribute=r),Es(this,ls,n)},t.kb=function(t,e){return G(t={requestType:"PASSWORD_RESET",email:t},e),Es(this,as,t)},t.lb=function(t,e){return G(t={requestType:"EMAIL_SIGNIN",email:t},e),Es(this,is,t)},t.jb=function(t,e){return G(t={requestType:"VERIFY_EMAIL",idToken:t},e),Es(this,os,t)},t.Wa=function(t){return Es(this,_s,t)},t.ab=function(t,e){return Es(this,cs,{oobCode:t,newPassword:e})},t.Ma=function(t){return Es(this,Xa,{oobCode:t})},t.Ya=function(t){return Es(this,Ya,{oobCode:t})};var Ya={endpoint:"setAccountInfo",D:Ga,fa:"email",F:!0},Xa={endpoint:"resetPassword",D:Ga,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new zr("internal-error")},F:!0},Ja={endpoint:"signupNewUser",D:function(t){if(Fa(t),!t.password)throw new zr("weak-password")},K:qa,T:!0,F:!0},$a={endpoint:"createAuthUri",F:!0},Za={endpoint:"deleteAccount",V:["idToken"]},ts={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!f(t.deleteProvider))throw new zr("internal-error")}},es={endpoint:"emailLinkSignin",V:["email","oobCode"],D:Fa,K:qa,T:!0,F:!0},ns={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:Fa,K:qa,T:!0},rs={endpoint:"getAccountInfo"},is={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new zr("internal-error");Fa(t)},fa:"email",F:!0},os={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new zr("internal-error")},fa:"email",F:!0},as={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new zr("internal-error");Fa(t)},fa:"email",F:!0},ss={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},us={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new zr("internal-error")}},cs={endpoint:"resetPassword",D:Ga,fa:"email",F:!0},hs={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},ls={endpoint:"setAccountInfo",V:["idToken"],D:Ua,T:!0},ps={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Ua(t),!t.password)throw new zr("weak-password")},K:qa,T:!0},fs={endpoint:"signupNewUser",K:qa,T:!0,F:!0},ds={endpoint:"verifyAssertion",D:ja,Ra:Wa,K:Qa,T:!0,F:!0},ys={endpoint:"verifyAssertion",D:ja,Ra:Wa,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new zr("user-not-found");if(t.errorMessage)throw Ts(t.errorMessage);if(!t[Na])throw new zr("internal-error")},T:!0,F:!0},vs={endpoint:"verifyAssertion",D:function(t){if(ja(t),!t.idToken)throw new zr("internal-error")},Ra:Wa,K:Qa,T:!0},gs={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new zr("invalid-custom-token")},K:qa,T:!0,F:!0},ms={endpoint:"verifyPassword",D:function(t){if(Fa(t),!t.password)throw new zr("wrong-password")},K:qa,T:!0,F:!0},_s={endpoint:"verifyPhoneNumber",D:Va,K:qa,F:!0},bs={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new zr("internal-error");Va(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",Co(t);qa(t)}},ws={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Va,K:qa,F:!0};function Es(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.V))return Yt(new zr("internal-error"));var r,i=e.Kb||"POST";return Gt(n).then(e.D).then((function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,n,r,i,o){var a=bn(t.h+e);mn(a,"key",t.c),o&&mn(a,"cb",T().toString());var s="GET"==n;if(s)for(var u in r)r.hasOwnProperty(u)&&mn(a,u,r[u]);return new Bt((function(e,o){xa(t,a.toString(),(function(t){t?t.error?o(Cs(t,i||{})):e(t):o(new zr("network-request-failed"))}),n,s?void 0:Wn(wr(r)),t.a,t.i.get())}))}(t,e.endpoint,i,n,e.Yb,e.wb||!1)})).then((function(t){return r=t,e.Ra?e.Ra(n,r):r})).then(e.K).then((function(){if(!e.fa)return r;if(!(e.fa in r))throw new zr("internal-error");return r[e.fa]}))}function Ts(t){return Cs({error:{errors:[{message:t}],code:400,message:t}})}function Cs(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new zr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",G(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new zr(r[i],e);return!e&&t&&(e=br(t)),new zr("internal-error",e)}function Ss(t){this.b=t,this.a=null,this.gb=function(t){return(Ds=Ds||new Bt((function(t,e){function n(){Sr(),dr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Sr(),e(Error("Network Error"))},timeout:Ns.get()})}if(dr("gapi.iframes.Iframe"))t();else if(dr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();o[r]=function(){dr("gapi.load")?n():e(Error("Network Error"))},Gt(ma(r=nt(Is,{onload:r}))).s((function(){e(Error("Network Error"))}))}})).s((function(t){throw Ds=null,t}))).then((function(){return new Bt((function(e,n){dr("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:dr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},(function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout((function(){n(Error("Network Error"))}),As.get());r.ping(i).then(i,(function(){n(Error("Network Error"))}))}))}))}))}(this)}var Is=new Y($,"https://apis.google.com/js/api.js?onload=%{onload}"),Ns=new Ir(3e4,6e4),As=new Ir(5e3,15e3),Ds=null;function ks(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=wn(this.i,"/__/auth/iframe"),mn(this.a,"apiKey",this.g),mn(this.a,"appName",this.h),this.b=null,this.c=[]}function Rs(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function Os(t){try{return Ps.app(t).auth().Ca()}catch(t){return[]}}function xs(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function Ls(t){var e=Yn();return function(t){return Es(t,ss,{}).then((function(t){return t.authorizedDomains||[]}))}(t).then((function(t){t:{var n=bn(e),r=n.f;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],a=n,s=r;if(a=0==o.indexOf("chrome-extension://")?bn(o).b==a&&"chrome-extension"==s:("http"==s||"https"==s)&&(tr.test(o)?a==o:(o=o.split(".").join("\\."),new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)))){t=!0;break t}}t=!1}if(!t)throw new Eo(Yn())}))}function Ms(t){return t.l||(t.l=nr().then((function(){if(!t.o){var e=t.c,n=t.h,r=Os(t.b),i=new ks(t.u,t.f,t.b);i.f=e,i.b=n,i.c=W(r||[]),t.o=i.toString()}t.i=new Ss(t.o),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.gb.then((function(){t.a.register("authEvent",e,dr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}(t.i,(function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=mo(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",Gt(n)}return n.status="ERROR",Gt(n)}))}(t)}))),t.l}function Fs(t){return t.m||(t.v=t.c?pr(t.c,Os(t.b)):null,t.m=new Sa(t.f,Ci(t.h),t.v)),t.m}function Us(t,e,n,r,i,o,a,s,u,c,h){return(t=new Rs(t,e,n,r,i)).l=o,t.g=a,t.i=s,t.b=H(u||null),t.f=c,t.nb(h).toString()}function qs(t){if(this.a=t||Ps.INTERNAL.reactNative&&Ps.INTERNAL.reactNative.AsyncStorage,!this.a)throw new zr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Vs(t){this.b=t,this.a={},this.f=w(this.c,this)}ks.prototype.toString=function(){return this.f?mn(this.a,"v",this.f):On(this.a.a,"v"),this.b?mn(this.a,"eid",this.b):On(this.a.a,"eid"),this.c.length?mn(this.a,"fw",this.c.join(",")):On(this.a.a,"fw"),this.a.toString()},Rs.prototype.nb=function(t){return this.h=t,this},Rs.prototype.toString=function(){var t=wn(this.o,"/__/auth/handler");if(mn(t,"apiKey",this.m),mn(t,"appName",this.c),mn(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=Ps.app(this.c).auth().ha()}catch(t){n=null}for(var r in e.bb=n,mn(t,"providerId",this.a.providerId),n=wr((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=H(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.eb&&e.bb&&!n[e.eb]&&(n[e.eb]=e.bb),K(n)||mn(t,"customParameters",br(n))}if("function"==typeof this.a.Hb&&(e=this.a.Hb()).length&&mn(t,"scopes",e.join(",")),this.l?mn(t,"redirectUrl",this.l):On(t.a,"redirectUrl"),this.g?mn(t,"eventId",this.g):On(t.a,"eventId"),this.i?mn(t,"v",this.i):On(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!_n(t,a)&&mn(t,a,this.b[a]);return this.h?mn(t,"tid",this.h):On(t.a,"tid"),this.f?mn(t,"eid",this.f):On(t.a,"eid"),(a=Os(this.c)).length&&mn(t,"fw",a.join(",")),t.toString()},(t=xs.prototype).Fb=function(t,e,n){var r=new zr("popup-closed-by-user"),i=new zr("web-storage-unsupported"),o=this,a=!1;return this.ia().then((function(){(function(t){var e={type:"webStorageSupport"};return Ms(t).then((function(){return function(t,e){return t.gb.then((function(){return new Bt((function(n){t.a.send(e.type,e,n,dr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}))}(t.i,e)})).then((function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()}))})(o).then((function(n){n||(t&&$n(t),e(i),a=!0)}))})).s((function(){})).then((function(){if(!a)return function(t){return new Bt((function(e){return function n(){sn(2e3).then((function(){if(t&&!t.closed)return n();e()}))}()}))}(t)})).then((function(){if(!a)return sn(n).then((function(){e(r)}))}))},t.Ob=function(){var t=fr();return!_r(t)&&!Cr(t)},t.Jb=function(){return!1},t.Db=function(t,e,n,r,i,o,a,s){if(!t)return Yt(new zr("popup-blocked"));if(a&&!_r())return this.ia().s((function(e){$n(t),i(e)})),r(),Gt();this.a||(this.a=Ls(Fs(this)));var u=this;return this.a.then((function(){var e=u.ia().s((function(e){throw $n(t),i(e),e}));return r(),e})).then((function(){vo(n),a||Xn(Us(u.u,u.f,u.b,e,n,null,o,u.c,void 0,u.h,s),t)})).s((function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t}))},t.Eb=function(t,e,n,r){this.a||(this.a=Ls(Fs(this)));var i=this;return this.a.then((function(){vo(e),Xn(Us(i.u,i.f,i.b,t,e,Yn(),n,i.c,void 0,i.h,r))})).s((function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t}))},t.ia=function(){var t=this;return Ms(this).then((function(){return t.i.gb})).s((function(){throw t.a=null,new zr("network-request-failed")}))},t.Rb=function(){return!0},t.Aa=function(t){this.g.push(t)},t.Na=function(t){B(this.g,(function(e){return e==t}))},(t=qs.prototype).get=function(t){return Gt(this.a.getItem(t)).then((function(t){return t&&Er(t)}))},t.set=function(t,e){return Gt(this.a.setItem(t,br(e)))},t.S=function(t){return Gt(this.a.removeItem(t))},t.$=function(){},t.ea=function(){};var Bs,js=[];function Ws(t,e,n){K(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Qs(t){this.a=t}function Ks(t){this.c=t,this.b=!1,this.a=[]}function Hs(t,e,n,r){var i,o,a,s,u=n||{},c=null;if(t.b)return Yt(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new Bt((function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout((function(){r(Error("unsupported_event"))}),h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout((function(){r(Error("timeout"))}),3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))})).then((function(e){return zs(t,c),e})).s((function(e){throw zs(t,c),e}))}function zs(t,e){if(e){var n=e.messageChannel;n&&(n.port1.removeEventListener("message",e.onMessage),n.port1.close()),B(t.a,(function(t){return t==e}))}}function Gs(){if(!Xs())throw new zr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=o.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var t=this;or()&&self?(this.l=function(){var t=or()?self:null;if(M(js,(function(n){n.b==t&&(e=n)})),!e){var e=new Vs(t);js.push(e)}return e}(),Ws(this.l,"keyChanged",(function(e,n){return eu(t).then((function(e){return 0<e.length&&M(t.a,(function(t){t(e)})),{keyProcessed:q(e,n.key)}}))})),Ws(this.l,"ping",(function(){return Gt(["keyChanged"])}))):function(){var t=o.navigator;return t&&t.serviceWorker?Gt().then((function(){return t.serviceWorker.ready})).then((function(t){return t.active||null})).s((function(){return null})):Gt(null)}().then((function(e){(t.h=e)&&(t.g=new Ks(new Qs(e)),Hs(t.g,"ping",null,!0).then((function(e){e[0].fulfilled&&q(e[0].value,"keyChanged")&&(t.o=!0)})).s((function(){})))}))}function Ys(t){return t.m||(t.m=function t(e){return new Bt((function(n,r){var i=e.u.open("firebaseLocalStorageDb",1);i.onerror=function(t){try{t.preventDefault()}catch(t){}r(Error(t.target.error))},i.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){r(t)}},i.onsuccess=function(i){(i=i.target.result).objectStoreNames.contains("firebaseLocalStorage")?n(i):function(t){return new Bt((function(e,n){var r=t.u.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}}))}(e).then((function(){return t(e)})).then((function(t){n(t)})).s((function(t){r(t)}))}}))}(t)),t.m}function Xs(){try{return!!o.indexedDB}catch(t){return!1}}function Js(t){return t.objectStore("firebaseLocalStorage")}function $s(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Zs(t){return new Bt((function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}}))}function tu(t,e){return t.g&&t.h&&function(){var t=o.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Hs(t.g,"keyChanged",{key:e},t.o).then((function(){})).s((function(){})):Gt()}function eu(t){return Ys(t).then((function(t){var e=Js($s(t,!1));return e.getAll?Zs(e.getAll()):new Bt((function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}}))})).then((function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r}))}function nu(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function ru(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Gt().then((function(){if(Xs()){var t=Tr(),r="__sak"+t;return Bs=Bs||new Gs,(n=Bs).set(r,t).then((function(){return n.get(r)})).then((function(e){if(e!==t)throw Error("indexedDB not supported!");return n.S(r)})).then((function(){return n})).s((function(){return e.c}))}return e.c})).then((function(t){return e.type=t.type,t.$((function(t){M(e.a,(function(e){e(t)}))})),t}))}function iu(){this.a={},this.type="inMemory"}function ou(){if(!function(){var t="Node"==ar();if(!(t=au()||t&&Ps.INTERNAL.node&&Ps.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ar())throw new zr("internal-error","The LocalStorage compatibility library was not found.");throw new zr("web-storage-unsupported")}this.a=au()||Ps.INTERNAL.node.localStorage,this.type="localStorage"}function au(){try{var t=o.localStorage,e=Tr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function su(){this.type="nullStorage"}function uu(){if(!function(){var t="Node"==ar();if(!(t=cu()||t&&Ps.INTERNAL.node&&Ps.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ar())throw new zr("internal-error","The SessionStorage compatibility library was not found.");throw new zr("web-storage-unsupported")}this.a=cu()||Ps.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function cu(){try{var t=o.sessionStorage,e=Tr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function hu(){var t={};t.Browser=fu,t.Node=du,t.ReactNative=yu,t.Worker=vu,this.a=t[ar()]}Vs.prototype.c=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];M(r,(function(e){i.push(Gt().then((function(){return e(t.origin,t.data.data)})))})),Jt(i).then((function(r){var i=[];M(r,(function(t){i.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})})),M(i,(function(t){for(var e in t)void 0===t[e]&&delete t[e]})),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})}))}},Qs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ks.prototype.close=function(){for(;0<this.a.length;)zs(this,this.a[0]);this.b=!0},(t=Gs.prototype).set=function(t,e){var n,r=!1,i=this;return Ys(this).then((function(e){return Zs((e=Js($s(n=e,!0))).get(t))})).then((function(o){var a=Js($s(n,!0));return o?(o.value=e,Zs(a.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,Zs(a.add(o)))})).then((function(){return i.c[t]=e,tu(i,t)})).ka((function(){r&&i.b--}))},t.get=function(t){return Ys(this).then((function(e){return Zs(Js($s(e,!1)).get(t))})).then((function(t){return t&&t.value}))},t.S=function(t){var e=!1,n=this;return Ys(this).then((function(r){return e=!0,n.b++,Zs(Js($s(r,!0)).delete(t))})).then((function(){return delete n.c[t],tu(n,t)})).ka((function(){e&&n.b--}))},t.$=function(t){0==this.a.length&&function(t){nu(t),function e(){t.f=setTimeout((function(){t.i=eu(t).then((function(e){0<e.length&&M(t.a,(function(t){t(e)}))})).then((function(){e()})).s((function(t){"STOP_EVENT"!=t.message&&e()}))}),800)}()}(this),this.a.push(t)},t.ea=function(t){B(this.a,(function(e){return e==t})),0==this.a.length&&nu(this)},(t=ru.prototype).get=function(t){return this.b.then((function(e){return e.get(t)}))},t.set=function(t,e){return this.b.then((function(n){return n.set(t,e)}))},t.S=function(t){return this.b.then((function(e){return e.S(t)}))},t.$=function(t){this.a.push(t)},t.ea=function(t){B(this.a,(function(e){return e==t}))},(t=iu.prototype).get=function(t){return Gt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Gt()},t.S=function(t){return delete this.a[t],Gt()},t.$=function(){},t.ea=function(){},(t=ou.prototype).get=function(t){var e=this;return Gt().then((function(){return Er(e.a.getItem(t))}))},t.set=function(t,e){var n=this;return Gt().then((function(){var r=br(e);null===r?n.S(t):n.a.setItem(t,r)}))},t.S=function(t){var e=this;return Gt().then((function(){e.a.removeItem(t)}))},t.$=function(t){o.window&&We(o.window,"storage",t)},t.ea=function(t){o.window&&He(o.window,"storage",t)},(t=su.prototype).get=function(){return Gt(null)},t.set=function(){return Gt()},t.S=function(){return Gt()},t.$=function(){},t.ea=function(){},(t=uu.prototype).get=function(t){var e=this;return Gt().then((function(){return Er(e.a.getItem(t))}))},t.set=function(t,e){var n=this;return Gt().then((function(){var r=br(e);null===r?n.S(t):n.a.setItem(t,r)}))},t.S=function(t){var e=this;return Gt().then((function(){e.a.removeItem(t)}))},t.$=function(){},t.ea=function(){};var lu,pu,fu={C:ou,Ta:uu},du={C:ou,Ta:uu},yu={C:qs,Ta:su},vu={C:ou,Ta:su},gu={ad:"local",NONE:"none",cd:"session"};function mu(){var t=!(Cr(fr())||!ir()),e=_r(),n=yr();this.m=t,this.h=e,this.l=n,this.a={},t=lu=lu||new hu;try{this.g=!Gn()&&Dr()||!o.indexedDB?new t.a.C:new ru(or()?new iu:new t.a.C)}catch(t){this.g=new iu,this.h=!0}try{this.i=new t.a.Ta}catch(t){this.i=new iu}this.u=new iu,this.f=w(this.Pb,this),this.b={}}function _u(){return pu=pu||new mu}function bu(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function wu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function Eu(t,e,n){return n=wu(e,n),"local"==e.C&&(t.b[n]=null),bu(t,e.C).S(n)}function Tu(t){t.c&&(clearInterval(t.c),t.c=null)}function Cu(t){this.a=t,this.b=_u()}(t=mu.prototype).get=function(t,e){return bu(this,t.C).get(wu(t,e))},t.set=function(t,e,n){var r=wu(t,n),i=this,o=bu(this,t.C);return o.set(r,e).then((function(){return o.get(r)})).then((function(e){"local"==t.C&&(i.b[r]=e)}))},t.addListener=function(t,e,n){t=wu(t,e),this.l&&(this.b[t]=o.localStorage.getItem(t)),K(this.a)&&(bu(this,"local").$(this.f),this.h||(Gn()||!Dr())&&o.indexedDB||!this.l||function(t){Tu(t),t.c=setInterval((function(){for(var e in t.a){var n=o.localStorage.getItem(e),r=t.b[e];n!=r&&(t.b[e]=n,n=new Pe({type:"storage",key:e,target:window,oldValue:r,newValue:n,a:!0}),t.Pb(n))}}),1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=wu(t,e),this.a[t]&&(B(this.a[t],(function(t){return t==n})),0==this.a[t].length&&delete this.a[t]),K(this.a)&&(bu(this,"local").ea(this.f),Tu(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=o.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.$a(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?bu(this,"local").ea(this.f):Tu(this),this.m)if(n=o.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?o.localStorage.setItem(e,r):o.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var a=this;n=function(){void 0===t.a.a&&a.b[e]===o.localStorage.getItem(e)||(a.b[e]=o.localStorage.getItem(e),a.$a(e))},ye&&Ce&&10==Ce&&o.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else M(t,w(this.$a,this))},t.$a=function(t){this.a[t]&&M(this.a[t],(function(t){t()}))};var Su,Iu={name:"authEvent",C:"local"};function Nu(){this.a=_u()}function Au(t,e){this.b=Du,this.f=o.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=o.Int32Array?new Int32Array(64):Array(64),void 0!==Su||(Su=o.Int32Array?new Int32Array(Mu):Mu),this.reset()}C(Au,(function(){this.b=-1}));for(var Du=64,ku=Du-1,Ru=[],Pu=0;Pu<ku;Pu++)Ru[Pu]=0;var Ou=j(128,Ru);function xu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){var o=(0|n[e-16])+(((i=0|n[e-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+(((r=0|n[e-2])>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var p=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Su[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+p|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Lu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(a(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(xu(t),i=0);else{if(!d(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(xu(t),i=0)}}t.c=i,t.g+=n}Au.prototype.reset=function(){this.g=this.c=0,this.a=o.Int32Array?new Int32Array(this.h):W(this.h)};var Mu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Fu(){Au.call(this,8,Uu)}C(Fu,Au);var Uu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function qu(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.o=i||null,this.h=e+":"+n,this.v=new Nu,this.g=new Cu(this.h),this.f=null,this.b=[],this.a=this.c=null}function Vu(t){return new zr("invalid-cordova-configuration",t)}function Bu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function ju(t){return t.f||(t.f=t.ia().then((function(){return new Bt((function(e){t.Aa((function n(r){return e(r),t.Na(n),!1})),function(t){function e(e){r=!0,i&&i.cancel(),Wu(t).then((function(r){var i=n;if(r&&e&&e.url){var o=null;-1!=(i=Ui(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=Er(_n(o=bn(i),"firebaseError")||null))?Gr(o):null)?new go(r.c,r.b,null,null,o,null,r.R()):new go(r.c,r.b,i,r.f,null,null,r.R())),i=o||n}Bu(t,i)}))}var n=new go("unknown",null,null,null,new zr("no-auth-event")),r=!1,i=sn(500).then((function(){return Wu(t).then((function(){r||Bu(t,n)}))})),a=o.handleOpenURL;o.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(dr("BuildInfo.packageName",o).toLowerCase()+"://")&&e({url:t}),"function"==typeof a)try{a(t)}catch(t){console.error(t)}},wo=wo||new _o,function(t){var e=wo;e.a.push(t),e.b||(e.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=dr("universalLinks.subscribe",o))&&t(null,e.b))}(e)}(t)}))}))),t.f}function Wu(t){var e=null;return function(t){return t.b.get(Iu,t.a).then((function(t){return mo(t)}))}(t.g).then((function(n){return e=n,Eu((n=t.g).b,Iu,n.a)})).then((function(){return e}))}function Qu(t){this.a=t,this.b=_u()}(t=qu.prototype).ia=function(){return this.Da?this.Da:this.Da=(rr(void 0)?nr().then((function(){return new Bt((function(t,e){var n=o.document,r=setTimeout((function(){e(Error("Cordova framework is not ready."))}),1e3);n.addEventListener("deviceready",(function(){clearTimeout(r),t()}),!1)}))})):Yt(Error("Cordova must run in an Android or iOS file scheme."))).then((function(){if("function"!=typeof dr("universalLinks.subscribe",o))throw Vu("cordova-universal-links-plugin-fix is not installed");if(void 0===dr("BuildInfo.packageName",o))throw Vu("cordova-plugin-buildinfo is not installed");if("function"!=typeof dr("cordova.plugins.browsertab.openUrl",o))throw Vu("cordova-plugin-browsertab is not installed");if("function"!=typeof dr("cordova.InAppBrowser.open",o))throw Vu("cordova-plugin-inappbrowser is not installed")}),(function(){throw new zr("cordova-not-ready")}))},t.Fb=function(t,e){return e(new zr("operation-not-supported-in-this-environment")),Gt()},t.Db=function(){return Yt(new zr("operation-not-supported-in-this-environment"))},t.Rb=function(){return!1},t.Ob=function(){return!0},t.Jb=function(){return!0},t.Eb=function(t,e,n,r){if(this.c)return Yt(new zr("redirect-operation-pending"));var i=this,a=o.document,s=null,u=null,c=null,h=null;return this.c=Gt().then((function(){return vo(e),ju(i)})).then((function(){return function(t,e,n,r,i){var a=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),s=new go(e,r,null,a,new zr("no-auth-event"),null,i),u=dr("BuildInfo.packageName",o);if("string"!=typeof u)throw new zr("invalid-cordova-configuration");var c=dr("BuildInfo.displayName",o),h={};if(fr().toLowerCase().match(/iphone|ipad|ipod/))h.ibi=u;else{if(!fr().toLowerCase().match(/android/))return Yt(new zr("operation-not-supported-in-this-environment"));h.apn=u}c&&(h.appDisplayName=c),a=function(t){var e=new Fu;Lu(e,t),t=[];var n=8*e.g;Lu(e,Ou,e.c<56?56-e.c:e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(xu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return F(t,(function(t){return 1<(t=t.toString(16)).length?t:"0"+t})).join("")}(t)}(a),h.sessionId=a;var l=Us(t.u,t.i,t.l,e,n,null,r,t.m,h,t.o,i);return t.ia().then((function(){var e=t.h;return t.v.a.set(Iu,s.A(),e)})).then((function(){var e=dr("cordova.plugins.browsertab.isAvailable",o);if("function"!=typeof e)throw new zr("invalid-cordova-configuration");var n=null;e((function(e){if(e){if("function"!=typeof(n=dr("cordova.plugins.browsertab.openUrl",o)))throw new zr("invalid-cordova-configuration");n(l)}else{if("function"!=typeof(n=dr("cordova.InAppBrowser.open",o)))throw new zr("invalid-cordova-configuration");e=fr(),t.a=n(l,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}}))}))}(i,t,e,n,r)})).then((function(){return new Bt((function(t,e){u=function(){var e=dr("cordova.plugins.browsertab.close",o);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.Aa(u),h=function(){Nr()&&c()},a.addEventListener("resume",c=function(){s=s||sn(2e3).then((function(){e(new zr("redirect-cancelled-by-user"))}))},!1),fr().toLowerCase().match(/android/)||a.addEventListener("visibilitychange",h,!1)})).s((function(t){return Wu(i).then((function(){throw t}))}))})).ka((function(){c&&a.removeEventListener("resume",c,!1),h&&a.removeEventListener("visibilitychange",h,!1),s&&s.cancel(),u&&i.Na(u),i.c=null}))},t.Aa=function(t){this.b.push(t),ju(this).s((function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new go("unknown",null,null,null,new zr("no-auth-event")),t(e))}))},t.Na=function(t){B(this.b,(function(e){return e==t}))};var Ku={name:"pendingRedirect",C:"session"};function Hu(t){return Eu(t.b,Ku,t.a)}function zu(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=w(this.o,this),this.b=new sc,this.w=new pc,this.g=new Qu(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=Gu(this.B,this.u,this.m,Ei)}function Gu(t,e,n,r){var i=Ps.SDK_VERSION||null;return rr()?new qu(t,e,n,i,r):new xs(t,e,n,i,r)}function Yu(t){t.f||(t.f=!0,t.a.Aa(t.l));var e=t.a;return t.a.ia().s((function(n){throw t.a==e&&t.reset(),n}))}function Xu(t){t.a.Ob()&&Yu(t).s((function(e){var n=new go("unknown",null,null,null,new zr("operation-not-supported-in-this-environment"));nc(e)&&t.o(n)})),t.a.Jb()||uc(t.b)}function Ju(t,e){q(t.h,e)||t.h.push(e),t.f||function(t){return t.b.get(Ku,t.a).then((function(t){return"pending"==t}))}(t.g).then((function(e){e?Hu(t.g).then((function(){Yu(t).s((function(e){var n=new go("unknown",null,null,null,new zr("operation-not-supported-in-this-environment"));nc(e)&&t.o(n)}))})):Xu(t)})).s((function(){Xu(t)}))}function $u(t,e){B(t.h,(function(t){return t==e}))}zu.prototype.reset=function(){this.f=!1,this.a.Na(this.l),this.a=Gu(this.B,this.u,this.m),this.i={}},zu.prototype.o=function(t){if(!t)throw new zr("invalid-auth-event");if(6e5<=T()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=T())),e=!0;break}}return uc(this.b),e};var Zu=new Ir(2e3,1e4),tc=new Ir(3e4,6e4);function ec(t,e,n,r,i,o,a){return t.a.Db(e,n,r,(function(){t.f||(t.f=!0,t.a.Aa(t.l))}),(function(){t.reset()}),i,o,a)}function nc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function rc(t,e,n,r,i){var o;return function(t){return t.b.set(Ku,"pending",t.a)}(t.g).then((function(){return t.a.Eb(e,n,r,i).s((function(e){if(nc(e))throw new zr("operation-not-supported-in-this-environment");return o=e,Hu(t.g).then((function(){throw o}))})).then((function(){return t.a.Rb()?new Bt((function(){})):Hu(t.g).then((function(){return t.oa()})).then((function(){})).s((function(){}))}))}))}function ic(t,e,n,r,i){return t.a.Fb(r,(function(t){e.ja(n,null,t,i)}),Zu.get())}zu.prototype.oa=function(){return this.b.oa()};var oc={};function ac(t,e,n){var r=e+":"+n;return oc[r]||(oc[r]=new zu(t,e,n)),oc[r]}function sc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function uc(t){t.g||(t.g=!0,lc(t,!1,null,null))}function cc(t){t.g&&!t.i&&lc(t,!1,null,null)}function hc(t,e){if(t.b=function(){return Gt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function lc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Yt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):hc(t,n):hc(t,{user:null}),t.f=[],t.c=[]}function pc(){}function fc(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function dc(t,e){this.a=e,xr(this,"verificationId",t)}function yc(t,e,n,r){return new po(t).Wa(e,n).then((function(t){return new dc(t,r)}))}function vc(t){var e=wi(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new zr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Lr(this,{token:t,expirationTime:Ar(1e3*e.exp),authTime:Ar(1e3*e.auth_time),issuedAtTime:Ar(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function gc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function mc(t){this.f=t,this.b=this.a=null,this.c=0}function _c(t,e){var n=e[Na],r=e.refreshToken;e=bc(e.expiresIn),t.b=n,t.c=e,t.a=r}function bc(t){return T()+1e3*parseInt(t,10)}function wc(t,e){this.a=t||null,this.b=e||null,Lr(this,{lastSignInTime:Ar(e||null),creationTime:Ar(t||null)})}function Ec(t,e,n,r,i,o){Lr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Tc(t,e){for(var n in Re.call(this,t),e)this[n]=e[n]}function Cc(t,e,n){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=Ps.SDK_VERSION?pr(Ps.SDK_VERSION):null,this.a=new Sa(this.l,Ci(Ei),t),this.b=new mc(this.a),Rc(this,e[Na]),_c(this.b,e),xr(this,"refreshToken",this.b.a),xc(this,n||{}),en.call(this),this.J=!1,this.o&&vr()&&(this.i=ac(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(t){return new gc((function(){return t.G(!0)}),(function(t){return!(!t||"auth/network-request-failed"!=t.code)}),(function(){var e=t.b.c-T()-3e5;return 0<e?e:0}))}(this),this.W=w(this.Ja,this);var r=this;this.ga=null,this.xa=function(t){r.ua(t.g)},this.Z=null,this.P=[],this.wa=function(t){Ic(r,t.c)},this.Y=null}function Sc(t,e){t.Z&&He(t.Z,"languageCodeChanged",t.xa),(t.Z=e)&&We(e,"languageCodeChanged",t.xa)}function Ic(t,e){t.P=e,Oa(t.a,Ps.SDK_VERSION?pr(Ps.SDK_VERSION,t.P):null)}function Nc(t,e){t.Y&&He(t.Y,"frameworkChanged",t.wa),(t.Y=e)&&We(e,"frameworkChanged",t.wa)}function Ac(e){try{return Ps.app(e.m).auth()}catch(t){throw new zr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function Dc(t){t.B||t.w.b||(t.w.start(),He(t,"tokenChanged",t.W),We(t,"tokenChanged",t.W))}function kc(t){He(t,"tokenChanged",t.W),t.w.stop()}function Rc(t,e){t.ma=e,xr(t,"_lat",e)}function Pc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return Jt(e).then((function(){return t}))}function Oc(t){t.i&&!t.J&&(t.J=!0,Ju(t.i,t))}function xc(t,e){Lr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new wc(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Lc(){}function Mc(t){return Gt().then((function(){if(t.B)throw new zr("app-deleted")}))}function Fc(t){return F(t.providerData,(function(t){return t.providerId}))}function Uc(t,e){e&&(qc(t,e.providerId),t.providerData.push(e))}function qc(t,e){B(t.providerData,(function(t){return t.providerId==e}))}function Vc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&xr(t,e,n)}function Bc(t,e){t!=e&&(Lr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,tenantId:e.tenantId,providerData:[]}),xr(t,"metadata",e.metadata?function(t){return new wc(t.a,t.b)}(e.metadata):new wc),M(e.providerData,(function(e){Uc(t,e)})),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.b,e.b),xr(t,"refreshToken",t.b.a))}function jc(t){return t.G().then((function(e){var n=t.isAnonymous;return function(t,e){return Es(t.a,rs,{idToken:e}).then(w(t.zc,t))}(t,e).then((function(){return n||Vc(t,"isAnonymous",!1),e}))}))}function Wc(t,e){e[Na]&&t.ma!=e[Na]&&(_c(t.b,e),t.dispatchEvent(new Tc("tokenChanged")),Rc(t,e[Na]),Vc(t,"refreshToken",t.b.a))}function Qc(t,e){return jc(t).then((function(){if(q(Fc(t),e))return Pc(t).then((function(){throw new zr("provider-already-linked")}))}))}function Kc(t,e,n){return Mr({user:t,credential:yo(e),additionalUserInfo:e=Di(e),operationType:n})}function Hc(t,e){return Wc(t,e),t.reload().then((function(){return t}))}function zc(t,e,n,r,i){if(!vr())return Yt(new zr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Yt(t.h);var o=Ai(n.providerId),a=Tr(t.uid+":::"),s=null;(!_r()||ir())&&t.o&&n.isOAuthProvider&&(s=Us(t.o,t.l,t.m,e,n,null,a,Ps.SDK_VERSION||null,null,null,t.tenantId));var u=Zn(s,o&&o.sa,o&&o.ra);return r=r().then((function(){if(Yc(t),!i)return t.G().then((function(){}))})).then((function(){return ec(t.i,u,e,n,a,!!s,t.tenantId)})).then((function(){return new Bt((function(n,r){t.ja(e,null,new zr("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=a,t.c=ic(t.i,t,e,u,a)}))})).then((function(t){return u&&$n(u),t?Mr(t):null})).s((function(t){throw u&&$n(u),t})),Xc(t,r,i)}function Gc(t,e,n,r,i){if(!vr())return Yt(new zr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Yt(t.h);var o=null,a=Tr(t.uid+":::");return r=r().then((function(){if(Yc(t),!i)return t.G().then((function(){}))})).then((function(){return t.ca=a,Pc(t)})).then((function(e){return t.da&&(e=(e=t.da).b.set(Zc,t.A(),e.a)),e})).then((function(){return rc(t.i,e,n,a,t.tenantId)})).s((function(e){if(o=e,t.da)return th(t.da);throw o})).then((function(){if(o)throw o})),Xc(t,r,i)}function Yc(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new zr("internal-error");throw new zr("auth-domain-config-required")}}function Xc(t,e,n){var r=function(t,e,n){return t.h&&!n?(e.cancel(),Yt(t.h)):e.s((function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.h||t.dispatchEvent(new Tc("userInvalidated")),t.h=e),e}))}(t,e,n);return t.I.push(r),r.ka((function(){V(t.I,r)})),r}function Jc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Na]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-T())/1e3;var r=new Cc(e,n,t);return t.providerData&&M(t.providerData,(function(t){t&&Uc(r,Mr(t))})),t.redirectEventId&&(r.ca=t.redirectEventId),r}function $c(t){this.a=t,this.b=_u()}sc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},sc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(lc(this,!0,null,t.a),Gt()):e.Ba(n,r)?function(t,e,n){n=n.Ba(e.c,e.b);var r=e.g,i=e.f,o=e.i,a=e.R(),s=!!e.c.match(/Redirect$/);n(r,i,a,o).then((function(e){lc(t,s,e,null)})).s((function(e){lc(t,s,null,e)}))}(this,t,e):Yt(new zr("invalid-auth-event")):(lc(this,!1,null,null),Gt())}else Yt(new zr("invalid-auth-event"))},sc.prototype.oa=function(){var t=this;return new Bt((function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new zr("timeout");t.a&&t.a.cancel(),t.a=sn(tc.get()).then((function(){t.b||(t.g=!0,lc(t,!0,null,e))}))}(t))}))},pc.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ja(t.c,null,t.a,t.b),Gt()):e.Ba(n,r)?function(t,e){var n=t.b,r=t.c;e.Ba(r,n)(t.g,t.f,t.R(),t.i).then((function(t){e.ja(r,t,null,n)})).s((function(t){e.ja(r,null,t,n)}))}(t,e):Yt(new zr("invalid-auth-event"))}else Yt(new zr("invalid-auth-event"))},dc.prototype.confirm=function(t){return t=fo(this.verificationId,t),this.a(t)},gc.prototype.start=function(){this.a=this.c,function t(e,n){e.stop(),e.b=sn(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then((function(){return t=o.document,e=null,Nr()||!t?Gt():new Bt((function(n){e=function(){Nr()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)})).s((function(n){throw t.removeEventListener("visibilitychange",e,!1),n}));var t,e})).then((function(){return e.h()})).then((function(){t(e,!0)})).s((function(n){e.i(n)&&t(e,!1)}))}(this,!0)},gc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},mc.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},mc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Yt(new zr("user-token-expired")):t||!this.b||T()>this.c-3e4?this.a?function(t,e){return function(t,e){return new Bt((function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?xa(t,t.l+"?key="+encodeURIComponent(t.c),(function(t){t?t.error?r(Cs(t)):t.access_token&&t.refresh_token?n(t):r(new zr("internal-error")):r(new zr("network-request-failed"))}),"POST",Pn(e).toString(),t.g,t.u.get()):r(new zr("internal-error"))}))}(t.f,e).then((function(e){return t.b=e.access_token,t.c=bc(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}})).s((function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e}))}(this,{grant_type:"refresh_token",refresh_token:this.a}):Gt(null):Gt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},wc.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},C(Tc,Re),C(Cc,en),Cc.prototype.ua=function(t){this.ga=t,Pa(this.a,t)},Cc.prototype.ha=function(){return this.ga},Cc.prototype.Ca=function(){return W(this.P)},Cc.prototype.Ja=function(){this.w.b&&(this.w.stop(),this.w.start())},xr(Cc.prototype,"providerId","firebase"),(t=Cc.prototype).reload=function(){var t=this;return Xc(this,Mc(this).then((function(){return jc(t).then((function(){return Pc(t)})).then(Lc)})))},t.dc=function(t){return this.G(t).then((function(t){return new vc(t)}))},t.G=function(t){var e=this;return Xc(this,Mc(this).then((function(){return e.b.getToken(t)})).then((function(t){if(!t)throw new zr("internal-error");return t.accessToken!=e.ma&&(Rc(e,t.accessToken),e.dispatchEvent(new Tc("tokenChanged"))),Vc(e,"refreshToken",t.refreshToken),t.accessToken})))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new zr("internal-error");xc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?F(t,(function(t){return new Ec(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)})):[]}(t),n=0;n<e.length;n++)Uc(this,e[n]);Vc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.Ac=function(t){return Pr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.hb(t)},t.hb=function(t){var e=this,n=null;return Xc(this,t.f(this.a,this.uid).then((function(t){return Wc(e,t),n=Kc(e,t,"reauthenticate"),e.h=null,e.reload()})).then((function(){return n})),!0)},t.rc=function(t){return Pr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.fb(t)},t.fb=function(t){var e=this,n=null;return Xc(this,Qc(this,t.providerId).then((function(){return e.G()})).then((function(n){return t.b(e.a,n)})).then((function(t){return n=Kc(e,t,"link"),Hc(e,t)})).then((function(){return n})))},t.sc=function(t,e){var n=this;return Xc(this,Qc(this,"phone").then((function(){return yc(Ac(n),t,e,w(n.fb,n))})))},t.Bc=function(t,e){var n=this;return Xc(this,Gt().then((function(){return yc(Ac(n),t,e,w(n.hb,n))})),!0)},t.rb=function(t){var e=this;return Xc(this,this.G().then((function(n){return e.a.rb(n,t)})).then((function(t){return Wc(e,t),e.reload()})))},t.Sc=function(t){var e=this;return Xc(this,this.G().then((function(n){return t.b(e.a,n)})).then((function(t){return Wc(e,t),e.reload()})))},t.sb=function(t){var e=this;return Xc(this,this.G().then((function(n){return e.a.sb(n,t)})).then((function(t){return Wc(e,t),e.reload()})))},t.tb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Mc(this);var e=this;return Xc(this,this.G().then((function(n){return e.a.tb(n,{displayName:t.displayName,photoUrl:t.photoURL})})).then((function(t){return Wc(e,t),Vc(e,"displayName",t.displayName||null),Vc(e,"photoURL",t.photoUrl||null),M(e.providerData,(function(t){"password"===t.providerId&&(xr(t,"displayName",e.displayName),xr(t,"photoURL",e.photoURL))})),Pc(e)})).then(Lc))},t.Qc=function(t){var e=this;return Xc(this,jc(this).then((function(n){return q(Fc(e),t)?function(t,e,n){return Es(t,ts,{idToken:e,deleteProvider:n})}(e.a,n,[t]).then((function(t){var n={};return M(t.providerUserInfo||[],(function(t){n[t.providerId]=!0})),M(Fc(e),(function(t){n[t]||qc(e,t)})),n[po.PROVIDER_ID]||xr(e,"phoneNumber",null),Pc(e)})):Pc(e).then((function(){throw new zr("no-such-provider")}))})))},t.delete=function(){var t=this;return Xc(this,this.G().then((function(e){return Es(t.a,Za,{idToken:e})})).then((function(){t.dispatchEvent(new Tc("userDeleted"))}))).then((function(){for(var e=0;e<t.I.length;e++)t.I[e].cancel("app-deleted");Sc(t,null),Nc(t,null),t.I=[],t.B=!0,kc(t),xr(t,"refreshToken",null),t.i&&$u(t.i,t)}))},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},t.ja=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?w(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?w(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?w(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?w(this.Cb,this):null},t.tc=function(t){var e=this;return zc(this,"linkViaPopup",t,(function(){return Qc(e,t.providerId).then((function(){return Pc(e)}))}),!1)},t.Cc=function(t){return zc(this,"reauthViaPopup",t,(function(){return Gt()}),!0)},t.uc=function(t){var e=this;return Gc(this,"linkViaRedirect",t,(function(){return Qc(e,t.providerId)}),!1)},t.Dc=function(t){return Gc(this,"reauthViaRedirect",t,(function(){return Gt()}),!0)},t.Bb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return Xc(this,this.G().then((function(n){return Ha(i.a,{requestUri:t,postBody:r,sessionId:e,idToken:n})})).then((function(t){return o=Kc(i,t,"link"),Hc(i,t)})).then((function(){return o})))},t.Cb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return Xc(this,Gt().then((function(){return Vi(za(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)})).then((function(t){return o=Kc(i,t,"reauthenticate"),Wc(i,t),i.h=null,i.reload()})).then((function(){return o})),!0)},t.jb=function(t){var e=this,n=null;return Xc(this,this.G().then((function(e){return n=e,void 0===t||K(t)?{}:vi(new ai(t))})).then((function(t){return e.a.jb(n,t)})).then((function(t){if(e.email!=t)return e.reload()})).then((function(){})))},t.toJSON=function(){return this.A()},t.A=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&G(t,this.metadata.A()),M(this.providerData,(function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))})),t};var Zc={name:"redirectUser",C:"session"};function th(t){return Eu(t.b,Zc,t.a)}function eh(t){this.a=t,this.b=_u(),this.c=null,this.f=function(t){var e=ih("local"),n=ih("session"),r=ih("none");return function(t,e,n){var r=wu(e,n),i=bu(t,e.C);return t.get(e,n).then((function(a){var s=null;try{s=Er(o.localStorage.getItem(r))}catch(a){}if(s&&!a)return o.localStorage.removeItem(r),t.set(e,s,n);s&&a&&"localStorage"!=i.type&&o.localStorage.removeItem(r)}))}(t.b,e,t.a).then((function(){return t.b.get(n,t.a)})).then((function(i){return i?n:t.b.get(r,t.a).then((function(n){return n?r:t.b.get(e,t.a).then((function(n){return n?e:t.b.get(rh,t.a).then((function(t){return t?ih(t):e}))}))}))})).then((function(e){return t.c=e,nh(t,e.C)})).s((function(){t.c||(t.c=e)}))}(this),this.b.addListener(ih("local"),this.a,w(this.g,this))}function nh(t,e){var n,r=[];for(n in gu)gu[n]!==e&&r.push(Eu(t.b,ih(gu[n]),t.a));return r.push(Eu(t.b,rh,t.a)),function(t){return new Bt((function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},a=function(t){n(t)},s=0;s<t.length;s++)Xt(t[s],E(o,s),a);else e(i)}))}(r)}eh.prototype.g=function(){var t=this,e=ih("local");uh(this,(function(){return Gt().then((function(){return t.c&&"local"!=t.c.C?t.b.get(e,t.a):null})).then((function(n){if(n)return nh(t,"local").then((function(){t.c=e}))}))}))};var rh={name:"persistence",C:"session"};function ih(t){return{name:"authUser",C:t}}function oh(t,e){return uh(t,(function(){return t.b.set(t.c,e.A(),t.a)}))}function ah(t){return uh(t,(function(){return Eu(t.b,t.c,t.a)}))}function sh(t,e){return uh(t,(function(){return t.b.get(t.c,t.a).then((function(t){return t&&e&&(t.authDomain=e),Jc(t||{})}))}))}function uh(t,e){return t.f=t.f.then(e,e),t.f}function ch(t){if(this.l=!1,xr(this,"settings",new fc),xr(this,"app",t),!gh(this).options||!gh(this).options.apiKey)throw new zr("invalid-api-key");t=Ps.SDK_VERSION?pr(Ps.SDK_VERSION):null,this.b=new Sa(gh(this).options&&gh(this).options.apiKey,Ci(Ei),t),this.O=[],this.m=[],this.J=[],this.Ub=Ps.INTERNAL.createSubscribe(w(this.oc,this)),this.W=void 0,this.Vb=Ps.INTERNAL.createSubscribe(w(this.pc,this)),yh(this,null),this.h=new eh(gh(this).options.apiKey+":"+gh(this).name),this.w=new $c(gh(this).options.apiKey+":"+gh(this).name),this.Y=wh(this,function(t){var e=gh(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(Zc,t.a).then((function(t){return t&&e&&(t.authDomain=e),Jc(t||{})}))}(t.w,gh(t).options.authDomain).then((function(e){return(t.B=e)&&(e.da=t.w),th(t.w)}));return wh(t,e)}(t).then((function(){return sh(t.h,e)})).then((function(e){return e?(e.da=t.w,t.B&&(t.B.ca||null)==(e.ca||null)?e:e.reload().then((function(){return oh(t.h,e).then((function(){return e}))})).s((function(n){return"auth/network-request-failed"==n.code?e:ah(t.h)}))):null})).then((function(e){yh(t,e||null)}));return wh(t,n)}(this)),this.i=wh(this,function(t){return t.Y.then((function(){return fh(t)})).s((function(){})).then((function(){if(!t.l)return t.ma()})).s((function(){})).then((function(){if(!t.l){t.ga=!0;var e=t.h;e.b.addListener(ih("local"),e.a,t.ma)}}))}(this)),this.ga=!1,this.ma=w(this.Nc,this),this.ub=w(this.aa,this),this.wa=w(this.bc,this),this.xa=w(this.mc,this),this.Ja=w(this.nc,this),this.a=null,function(t){var e=gh(t).options.authDomain,n=gh(t).options.apiKey;e&&vr()&&(t.Tb=t.Y.then((function(){if(!t.l){if(t.a=ac(e,n,gh(t).name),Ju(t.a,t),mh(t)&&Oc(mh(t)),t.B){Oc(t.B);var r=t.B;r.ua(t.ha()),Sc(r,t),Ic(r=t.B,t.I),Nc(r,t),t.B=null}return t.a}})))}(this),this.INTERNAL={},this.INTERNAL.delete=w(this.delete,this),this.INTERNAL.logFramework=w(this.vc,this),this.o=0,en.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.ua(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function hh(t){Re.call(this,"languageCodeChanged"),this.g=t}function lh(t){Re.call(this,"frameworkChanged"),this.c=t}function ph(t){return t.Tb||Yt(new zr("auth-domain-config-required"))}function fh(t){if(!vr())return Yt(new zr("operation-not-supported-in-this-environment"));var e=ph(t).then((function(){return t.a.oa()})).then((function(t){return t?Mr(t):null}));return wh(t,e)}function dh(t,e){var n={};return n.apiKey=gh(t).options.apiKey,n.authDomain=gh(t).options.authDomain,n.appName=gh(t).name,t.Y.then((function(){return function(t,e,n,r){var i=new Cc(t,e);return n&&(i.da=n),r&&Ic(i,r),i.reload().then((function(){return i}))}(n,e,t.w,t.Ca())})).then((function(e){return mh(t)&&e.uid==mh(t).uid?Bc(mh(t),e):(yh(t,e),Oc(e)),t.aa(e)})).then((function(){bh(t)}))}function yh(t,e){mh(t)&&(function(t,e){B(t.O,(function(t){return t==e}))}(mh(t),t.ub),He(mh(t),"tokenChanged",t.wa),He(mh(t),"userDeleted",t.xa),He(mh(t),"userInvalidated",t.Ja),kc(mh(t))),e&&(e.O.push(t.ub),We(e,"tokenChanged",t.wa),We(e,"userDeleted",t.xa),We(e,"userInvalidated",t.Ja),0<t.o&&Dc(e)),xr(t,"currentUser",e),e&&(e.ua(t.ha()),Sc(e,t),Ic(e,t.I),Nc(e,t))}function vh(t,e){var n=null,r=null;return wh(t,e.then((function(e){return n=yo(e),r=Di(e),dh(t,e)})).then((function(){return Mr({user:mh(t),credential:n,additionalUserInfo:r,operationType:"signIn"})})))}function gh(t){return t.app}function mh(t){return t.currentUser}function _h(t){return mh(t)&&mh(t)._lat||null}function bh(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](_h(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](_h(t))}}function wh(t,e){return t.O.push(e),e.ka((function(){V(t.O,e)})),e}function Eh(){}function Th(){this.a={},this.b=1e12}eh.prototype.mb=function(t){var e=null,n=this;return function(t){var e=new zr("invalid-persistence-type"),n=new zr("unsupported-persistence-type");t:{for(r in gu)if(gu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(ar()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!yr()&&"none"!==t)throw n}}(t),uh(this,(function(){return t!=n.c.C?n.b.get(n.c,n.a).then((function(r){return e=r,nh(n,t)})).then((function(){if(n.c=ih(t),e)return n.b.set(n.c,e,n.a)})):Gt()}))},C(ch,en),C(hh,Re),C(lh,Re),(t=ch.prototype).mb=function(t){return wh(this,t=this.h.mb(t))},t.ua=function(t){this.Z===t||this.l||(this.Z=t,Pa(this.b,this.Z),this.dispatchEvent(new hh(this.ha())))},t.ha=function(){return this.Z},t.Tc=function(){var t=o.navigator;this.ua(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.I.push(t),Oa(this.b,Ps.SDK_VERSION?pr(Ps.SDK_VERSION,this.I):null),this.dispatchEvent(new lh(this.I))},t.Ca=function(){return W(this.I)},t.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},t.R=function(){return this.P},t.toJSON=function(){return{apiKey:gh(this).options.apiKey,authDomain:gh(this).options.authDomain,appName:gh(this).name,currentUser:mh(this)&&mh(this).A()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ja=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?w(this.ac,this):null},t.ac=function(t,e,n,r){var i=this;t={requestUri:t,postBody:r,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=Ka(i.b,t).then((function(t){return o=yo(t),a=Di(t),t}));return wh(this,t=i.Y.then((function(){return s})).then((function(t){return dh(i,t)})).then((function(){return Mr({user:mh(i),credential:o,additionalUserInfo:a,operationType:"signIn"})})))},t.Lc=function(t){if(!vr())return Yt(new zr("operation-not-supported-in-this-environment"));var e=this,n=Ai(t.providerId),r=Tr(),i=null;(!_r()||ir())&&gh(this).options.authDomain&&t.isOAuthProvider&&(i=Us(gh(this).options.authDomain,gh(this).options.apiKey,gh(this).name,"signInViaPopup",t,null,r,Ps.SDK_VERSION||null,null,null,this.R()));var o=Zn(i,n&&n.sa,n&&n.ra);return wh(this,n=ph(this).then((function(n){return ec(n,o,"signInViaPopup",t,r,!!i,e.R())})).then((function(){return new Bt((function(t,n){e.ja("signInViaPopup",null,new zr("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=r,e.c=ic(e.a,e,"signInViaPopup",o,r)}))})).then((function(t){return o&&$n(o),t?Mr(t):null})).s((function(t){throw o&&$n(o),t})))},t.Mc=function(t){if(!vr())return Yt(new zr("operation-not-supported-in-this-environment"));var e=this;return wh(this,ph(this).then((function(){return function(t){return uh(t,(function(){return t.b.set(rh,t.c.C,t.a)}))}(e.h)})).then((function(){return rc(e.a,"signInViaRedirect",t,void 0,e.R())})))},t.oa=function(){var t=this;return fh(this).then((function(e){return t.a&&cc(t.a.b),e})).s((function(e){throw t.a&&cc(t.a.b),e}))},t.Rc=function(t){if(!t)return Yt(new zr("null-user"));if(this.P!=t.tenantId)return Yt(new zr("tenant-id-mismatch"));var e=this,n={};n.apiKey=gh(this).options.apiKey,n.authDomain=gh(this).options.authDomain,n.appName=gh(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var i=t.b,o={};return o[Na]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-T())/1e3,e=new Cc(e,o),n&&(e.da=n),r&&Ic(e,r),Bc(e,t),e}(t,n,e.w,e.Ca());return wh(this,this.i.then((function(){if(gh(e).options.apiKey!=t.l)return r.reload()})).then((function(){return mh(e)&&t.uid==mh(e).uid?(Bc(mh(e),t),e.aa(t)):(yh(e,r),Oc(r),e.aa(r))})).then((function(){bh(e)})))},t.pb=function(){var t=this;return wh(this,this.i.then((function(){return t.a&&cc(t.a.b),mh(t)?(yh(t,null),ah(t.h).then((function(){bh(t)}))):Gt()})))},t.Nc=function(){var t=this;return sh(this.h,gh(this).options.authDomain).then((function(e){if(!t.l){var n;if(n=mh(t)&&e){n=mh(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return Bc(mh(t),e),mh(t).G();(mh(t)||e)&&(yh(t,e),e&&(Oc(e),e.da=t.w),t.a&&Ju(t.a,t),bh(t))}}))},t.aa=function(t){return oh(this.h,t)},t.bc=function(){bh(this),this.aa(mh(this))},t.mc=function(){this.pb()},t.nc=function(){this.pb()},t.oc=function(t){var e=this;this.addAuthTokenListener((function(){t.next(mh(e))}))},t.pc=function(t){var e=this;!function(t,e){t.J.push(e),wh(t,t.i.then((function(){!t.l&&q(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(_h(t)))})))}(this,(function(){t.next(mh(e))}))},t.xc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then((function(){y(t)?t(mh(r)):y(t.next)&&t.next(mh(r))})),this.Ub(t,e,n)},t.wc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then((function(){r.W=r.getUid(),y(t)?t(mh(r)):y(t.next)&&t.next(mh(r))})),this.Vb(t,e,n)},t.cc=function(t){var e=this;return wh(this,this.i.then((function(){return mh(e)?mh(e).G(t).then((function(t){return{accessToken:t}})):null})))},t.Hc=function(t){var e=this;return this.i.then((function(){return vh(e,Es(e.b,gs,{token:t}))})).then((function(t){var n=t.user;return Vc(n,"isAnonymous",!1),e.aa(n),t}))},t.Ic=function(t,e){var n=this;return this.i.then((function(){return vh(n,Es(n.b,ms,{email:t,password:e}))}))},t.Xb=function(t,e){var n=this;return this.i.then((function(){return vh(n,Es(n.b,Ja,{email:t,password:e}))}))},t.Sa=function(t){var e=this;return this.i.then((function(){return vh(e,t.na(e.b))}))},t.Gc=function(t){return Pr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Sa(t)},t.ob=function(){var t=this;return this.i.then((function(){var e=mh(t);return e&&e.isAnonymous?Mr({user:e,credential:null,additionalUserInfo:Mr({providerId:null,isNewUser:!1}),operationType:"signIn"}):vh(t,t.b.ob()).then((function(e){var n=e.user;return Vc(n,"isAnonymous",!0),t.aa(n),e}))}))},t.getUid=function(){return mh(this)&&mh(this).uid||null},t.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&mh(this)&&Dc(mh(this))},t.Ec=function(t){var e=this;M(this.m,(function(n){n==t&&e.o--})),this.o<0&&(this.o=0),0==this.o&&mh(this)&&kc(mh(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),wh(this,this.i.then((function(){e.l||q(e.m,t)&&t(_h(e))})))},t.removeAuthTokenListener=function(t){B(this.m,(function(e){return e==t}))},t.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(ih("local"),t.a,this.ma),this.a&&($u(this.a,this),cc(this.a.b)),Promise.resolve()},t.$b=function(t){return wh(this,function(t,e){return Es(t,$a,{identifier:e,continueUri:gr()?Yn():"http://localhost"}).then((function(t){return t.signinMethods||[]}))}(this.b,t))},t.qc=function(t){return!!uo(t)},t.lb=function(t,e){var n=this;return wh(this,Gt().then((function(){var t=new ai(e);if(!t.c)throw new zr("argument-error",ci+" must be true when sending sign in link to email");return vi(t)})).then((function(e){return n.b.lb(t,e)})).then((function(){})))},t.Uc=function(t){return this.Ma(t).then((function(t){return t.data.email}))},t.ab=function(t,e){return wh(this,this.b.ab(t,e).then((function(){})))},t.Ma=function(t){return wh(this,this.b.Ma(t).then((function(t){return new Ur(t)})))},t.Ya=function(t){return wh(this,this.b.Ya(t).then((function(){})))},t.kb=function(t,e){var n=this;return wh(this,Gt().then((function(){return void 0===e||K(e)?{}:vi(new ai(e))})).then((function(e){return n.b.kb(t,e)})).then((function(){})))},t.Kc=function(t,e){return wh(this,yc(this,t,e,w(this.Sa,this)))},t.Jc=function(t,e){var n=this;return wh(this,Gt().then((function(){var r=e||Yn(),i=so(t,r);if(!(r=uo(r)))throw new zr("argument-error","Invalid email link!");if(r.tenantId!==n.R())throw new zr("tenant-id-mismatch");return n.Sa(i)})))},Eh.prototype.render=function(){},Eh.prototype.reset=function(){},Eh.prototype.getResponse=function(){},Eh.prototype.execute=function(){};var Ch=null;function Sh(t,e){return(e=Ih(e))&&t.a[e]||null}function Ih(t){return(t=void 0===t?1e12:t)?t.toString():null}function Nh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=qn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():We(this.f,"click",this.i)}function Ah(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Dh(){}Th.prototype.render=function(t,e){return this.a[this.b.toString()]=new Nh(t,e),this.b++},Th.prototype.reset=function(t){var e=Sh(this,t);t=Ih(t),e&&t&&(e.delete(),delete this.a[t])},Th.prototype.getResponse=function(t){return(t=Sh(this,t))?t.getResponse():null},Th.prototype.execute=function(t){(t=Sh(this,t))&&t.execute()},Nh.prototype.getResponse=function(){return Ah(this),this.b},Nh.prototype.execute=function(){Ah(this);var t=this;this.a||(this.a=setTimeout((function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(e){}t.a=setTimeout((function(){if(t.a=null,t.b=null,n)try{n()}catch(e){}t.h&&t.execute()}),6e4)}),500))},Nh.prototype.delete=function(){Ah(this),this.g=!0,clearTimeout(this.a),this.a=null,He(this.f,"click",this.i)},Dh.prototype.g=function(){return Gt(Ch=Ch||new Th)},Dh.prototype.c=function(){};var kh=null;function Rh(){this.b=o.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Ph=new Y($,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Oh=new Ir(3e4,6e4);Rh.prototype.g=function(t){var e=this;return new Bt((function(n,r){var i=setTimeout((function(){r(new zr("network-request-failed"))}),Oh.get());!o.grecaptcha||t!==e.f&&!e.b?(o[e.a]=function(){if(o.grecaptcha){e.f=t;var a=o.grecaptcha.render;o.grecaptcha.render=function(t,n){return t=a(t,n),e.b++,t},clearTimeout(i),n(o.grecaptcha)}else clearTimeout(i),r(new zr("internal-error"));delete o[e.a]},Gt(ma(nt(Ph,{onload:e.a,hl:t||""}))).s((function(){clearTimeout(i),r(new zr("internal-error","Unable to load external reCAPTCHA dependencies!"))}))):(clearTimeout(i),n(o.grecaptcha))}))},Rh.prototype.c=function(){this.b--};var xh=null;function Lh(t,e,n,r,i,a,s){if(xr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,s=s?kh=kh||new Dh:xh=xh||new Rh,this.m=s,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Uh])throw new zr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[qh],!o.document)throw new zr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!qn(e)||!this.i&&qn(e).hasChildNodes())throw new zr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Sa(t,a||null,i||null),this.v=r||function(){return null};var u=this;this.l=[];var c=this.a[Mh];this.a[Mh]=function(t){if(Vh(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=dr(c,o);"function"==typeof e&&e(t)}};var h=this.a[Fh];this.a[Fh]=function(){if(Vh(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=dr(h,o);"function"==typeof t&&t()}}}var Mh="callback",Fh="expired-callback",Uh="sitekey",qh="size";function Vh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function Bh(t,e){return t.h.push(e),e.ka((function(){V(t.h,e)})),e}function jh(t){if(t.B)throw new zr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Wh(t,e,n){var r=!1;try{this.b=n||Ps.app()}catch(t){throw new zr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new zr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().Ca()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=Ps.SDK_VERSION?pr(Ps.SDK_VERSION,o):null,Lh.call(this,n,t,e,(function(){try{var e=i.b.auth().ha()}catch(t){e=null}return e}),o,Ci(Ei),r)}function Qh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new zr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].N(n[i])&&!o){if(e=e[i],i<0||i>=Kh.length)throw new zr("internal-error","Argument validator received an unsupported number of arguments.");n=Kh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}r=null}}if(r)throw new zr("argument-error",t+" failed: "+r)}(t=Lh.prototype).Da=function(){var t=this;return this.f?this.f:this.f=Bh(this,Gt().then((function(){if(gr()&&!or())return nr();throw new zr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")})).then((function(){return t.m.g(t.v())})).then((function(e){return t.g=e,Es(t.o,us,{})})).then((function(e){t.a[Uh]=e.recaptchaSiteKey})).s((function(e){throw t.f=null,e})))},t.render=function(){jh(this);var t=this;return Bh(this,this.Da().then((function(){if(null===t.c){var e=t.u;if(!t.i){var n=qn(e);e=function(t,e,n){var r=arguments,i=document,o=String(r[0]),s=r[1];if(!Un&&s&&(s.name||s.type)){if(o=["<",o],s.name&&o.push(' name="',Lt(s.name),'"'),s.type){o.push(' type="',Lt(s.type),'"');var u={};G(u,s),delete u.type,s=u}o.push(">"),o=o.join("")}return o=i.createElement(o),s&&(a(s)?o.className=s:f(s)?o.className=s.join(" "):Vn(o,s)),2<r.length&&function(t,e,n){function r(n){n&&e.appendChild(a(n)?t.createTextNode(n):n)}for(var i=2;i<n.length;i++){var o=n[i];!d(o)||v(o)&&0<o.nodeType?r(o):M(jn(o)?W(o):o,r)}}(i,o,r),o}("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c})))},t.verify=function(){jh(this);var t=this;return Bh(this,this.render().then((function(e){return new Bt((function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){e&&(function(t,e){B(t.l,(function(t){return t==e}))}(t,i),n(e))};t.l.push(i),t.i&&t.g.execute(t.c)}}))})))},t.reset=function(){jh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){jh(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=qn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},C(Wh,Lh);var Kh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Hh(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:a}}function zh(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:s}}function Gh(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:v}}function Yh(t,e){return{name:t||"",M:"a function",optional:!!e,N:y}}function Xh(t,e){return{name:t||"",M:"null",optional:!!e,N:p}}function Jh(t){return{name:t?t+"Credential":"credential",M:t?"a valid "+t+" credential":"a valid credential",optional:!1,N:function(e){return!!e&&!(!e.na||t&&e.providerId!==t)}}}function $h(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&a(t.type)&&y(t.verify))}}}function Zh(t,e,n,r){return{name:n||"",M:t.M+" or "+e.M,optional:!!r,N:function(n){return t.N(n)||e.N(n)}}}function tl(t,e){for(var n in e){var r=e[n].name;t[r]=rl(r,t[n],e[n].j)}}function el(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:E((function(t){return this[t]}),n),set:E((function(t,e,n,r){Qh(t,[n],[r],!0),this[e]=r}),r,n,e[n].Za),enumerable:!0})}}function nl(t,e,n,r){t[e]=rl(e,n,r)}function rl(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Qh(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}tl(ch.prototype,{Ya:{name:"applyActionCode",j:[Hh("code")]},Ma:{name:"checkActionCode",j:[Hh("code")]},ab:{name:"confirmPasswordReset",j:[Hh("code"),Hh("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[Hh("email"),Hh("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[Hh("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[Hh("emailLink")]},wc:{name:"onAuthStateChanged",j:[Zh(Gh(),Yh(),"nextOrObserver"),Yh("opt_error",!0),Yh("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[Zh(Gh(),Yh(),"nextOrObserver"),Yh("opt_error",!0),Yh("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[Hh("email"),Zh(Gh("opt_actionCodeSettings",!0),Xh(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[Hh("email"),Gh("actionCodeSettings")]},mb:{name:"setPersistence",j:[Hh("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[Jh()]},ob:{name:"signInAnonymously",j:[]},Sa:{name:"signInWithCredential",j:[Jh()]},Hc:{name:"signInWithCustomToken",j:[Hh("token")]},Ic:{name:"signInWithEmailAndPassword",j:[Hh("email"),Hh("password")]},Jc:{name:"signInWithEmailLink",j:[Hh("email"),Hh("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[Hh("phoneNumber"),$h()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[Zh({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Cc)}},Xh(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Hh(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[Hh("code")]}}),el(ch.prototype,{lc:{name:"languageCode",Za:Zh(Hh(),Xh(),"languageCode")},ti:{name:"tenantId",Za:Zh(Hh(),Xh(),"tenantId")}}),(ch.Persistence=gu).LOCAL="local",ch.Persistence.SESSION="session",ch.Persistence.NONE="none",tl(Cc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[zh("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[zh("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[Jh()]},fb:{name:"linkWithCredential",j:[Jh()]},sc:{name:"linkWithPhoneNumber",j:[Hh("phoneNumber"),$h()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Jh()]},hb:{name:"reauthenticateWithCredential",j:[Jh()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[Hh("phoneNumber"),$h()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[Zh(Gh("opt_actionCodeSettings",!0),Xh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Hh(null,!0)]},Qc:{name:"unlink",j:[Hh("provider")]},rb:{name:"updateEmail",j:[Hh("email")]},sb:{name:"updatePassword",j:[Hh("password")]},Sc:{name:"updatePhoneNumber",j:[Jh("phone")]},tb:{name:"updateProfile",j:[Gh("profile")]}}),tl(Th.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),tl(Eh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),tl(Bt.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),el(fc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Za:zh("appVerificationDisabledForTesting")}}),tl(dc.prototype,{confirm:{name:"confirm",j:[Hh("verificationCode")]}}),nl(qi,"fromJSON",(function(t){t=a(t)?JSON.parse(t):t;for(var e,n=[Hi,oo,ho,Wi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null}),[Zh(Hh(),Gh(),"json")]),nl(ao,"credential",(function(t,e){return new io(t,e)}),[Hh("email"),Hh("password")]),tl(io.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Xi.prototype,{ya:{name:"addScope",j:[Hh("scope")]},Ga:{name:"setCustomParameters",j:[Gh("customOAuthParameters")]}}),nl(Xi,"credential",Ji,[Zh(Hh(),Gh(),"token")]),nl(ao,"credentialWithLink",so,[Hh("email"),Hh("emailLink")]),tl($i.prototype,{ya:{name:"addScope",j:[Hh("scope")]},Ga:{name:"setCustomParameters",j:[Gh("customOAuthParameters")]}}),nl($i,"credential",Zi,[Zh(Hh(),Gh(),"token")]),tl(to.prototype,{ya:{name:"addScope",j:[Hh("scope")]},Ga:{name:"setCustomParameters",j:[Gh("customOAuthParameters")]}}),nl(to,"credential",eo,[Zh(Hh(),Zh(Gh(),Xh()),"idToken"),Zh(Hh(),Xh(),"accessToken",!0)]),tl(no.prototype,{Ga:{name:"setCustomParameters",j:[Gh("customOAuthParameters")]}}),nl(no,"credential",ro,[Zh(Hh(),Gh(),"token"),Hh("secret",!0)]),tl(Yi.prototype,{ya:{name:"addScope",j:[Hh("scope")]},credential:{name:"credential",j:[Zh(Hh(),Zh(Gh(),Xh()),"optionsOrIdToken"),Zh(Hh(),Xh(),"accessToken",!0)]},Ga:{name:"setCustomParameters",j:[Gh("customOAuthParameters")]}}),tl(Qi.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Bi.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),nl(po,"credential",fo,[Hh("verificationId"),Hh("verificationCode")]),tl(po.prototype,{Wa:{name:"verifyPhoneNumber",j:[Hh("phoneNumber"),$h()]}}),tl(co.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),tl(zr.prototype,{toJSON:{name:"toJSON",j:[Hh(null,!0)]}}),tl(To.prototype,{toJSON:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Eo.prototype,{toJSON:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Wh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),nl(Jr,"parseLink",oi,[Hh("link")]),function(){if(void 0===Ps||!Ps.INTERNAL||!Ps.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:qr,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:ch,AuthCredential:qi,Error:zr};nl(t,"EmailAuthProvider",ao,[]),nl(t,"FacebookAuthProvider",Xi,[]),nl(t,"GithubAuthProvider",$i,[]),nl(t,"GoogleAuthProvider",to,[]),nl(t,"TwitterAuthProvider",no,[]),nl(t,"OAuthProvider",Yi,[Hh("providerId")]),nl(t,"SAMLAuthProvider",Gi,[Hh("providerId")]),nl(t,"PhoneAuthProvider",po,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof ch)}}]),nl(t,"RecaptchaVerifier",Wh,[Zh(Hh(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Gh("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof Ps.app.App)}}]),nl(t,"ActionCodeURL",Jr,[]),Ps.INTERNAL.registerComponent({name:"auth",instanceFactory:function(t){return new ch(t=t.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:t,instantiationMode:"LAZY",type:"PUBLIC"}),Ps.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(t){return{getUid:w((t=t.getProvider("auth").getImmediate()).getUid,t),getToken:w(t.cc,t),addAuthTokenListener:w(t.Wb,t),removeAuthTokenListener:w(t.Ec,t)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),Ps.registerVersion("@firebase/auth","0.13.4"),Ps.INTERNAL.extendNamespace({User:Cc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Os=(xs.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),qa(e))},xs.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Ua(e)},xs.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},xs.prototype.prefixedName_=function(t){return this.prefix_+t},xs.prototype.toString=function(){return this.domStorage_.toString()},xs);function xs(t){this.domStorage_=t,this.prefix_="firebase:"}var Ls=(Ms.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},Ms.prototype.get=function(t){return Ba(this.cache_,t)?this.cache_[t]:null},Ms.prototype.remove=function(t){delete this.cache_[t]},Ms);function Ms(){this.cache_={},this.isInMemoryStorage=!0}function Fs(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Os(e)}}catch(t){}return new Ls}function Us(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;wa(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new Ka;n.update(e);var r=n.digest();return Ta.encodeByteArray(r)}function qs(t,e){wa(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?($s.logLevel=ss.VERBOSE,eu=$s.log.bind($s),e&&Js.set("logging_enabled",!0)):"function"==typeof t?eu=t:(eu=null,Js.remove("logging_enabled"))}function Vs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===nu&&(nu=!1,null===eu&&!0===Js.get("logging_enabled")&&qs(!0)),eu){var n=tu.apply(null,t);eu(n)}}function Bs(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Vs.apply(void 0,va([t],e))}}function js(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+tu.apply(void 0,va(t));$s.error(n)}function Ws(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+tu.apply(void 0,va(t));throw $s.error(n),new Error(n)}function Qs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+tu.apply(void 0,va(t));$s.warn(n)}function Ks(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)}function Hs(t,e){return t===e?0:t<e?-1:1}function zs(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+qa(e))}function Gs(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)r.push(t.substring(i,n<i+e?n:i+e));return r}var Ys,Xs=Fs("localStorage"),Js=Fs("sessionStorage"),$s=new ys("@firebase/database"),Zs=(Ys=1,function(){return Ys++}),tu=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++){var i=t[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=tu.apply(null,i):n+="object"==typeof i?qa(i):i,n+=" "}return n},eu=null,nu=!0,ru="[MIN_NAME]",iu="[MAX_NAME]",ou=function(t,e){if(t===e)return 0;if(t===ru||e===iu)return-1;if(e===ru||t===iu)return 1;var n=pu(t),r=pu(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},au=function(t){if("object"!=typeof t||null===t)return qa(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=qa(e[i]),r+=":",r+=au(t[e[i]]);return r+"}"};function su(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function uu(t){var e,n,r,i,o;wa(!Ks(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074))));var a=[];for(o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse();var s=a.join(""),u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function cu(t){try{t()}catch(e){setTimeout((function(){throw Qs("Exception was thrown by user callback.",e.stack||""),e}),Math.floor(0))}}function hu(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var lu=new RegExp("^-?(0*)\\d{1,10}$"),pu=function(t){if(lu.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},fu=(Object.defineProperty(du,"Empty",{get:function(){return new du("")},enumerable:!0,configurable:!0}),du.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},du.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},du.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new du(this.pieces_,t)},du.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},du.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},du.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},du.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},du.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new du(t,0)},du.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof du)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new du(e,0)},du.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},du.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return du.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},du.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=ou(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},du.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},du.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},du);function du(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var yu=(Object.defineProperty(vu,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(vu,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),vu.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=es(t),this.checkValid_()},vu.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=es(t),0<this.parts_.length&&(this.byteLength_-=1)},vu.prototype.checkValid_=function(){if(this.byteLength_>vu.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+vu.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>vu.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+vu.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},vu.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},vu);function vu(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=es(this.parts_[n]);this.checkValid_()}var gu="firebaseio.com",mu="websocket",_u="long_polling",bu=(wu.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},wu.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},wu.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},wu.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},wu.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Xs.set("host:"+this.host,this.internalHost))},wu.prototype.connectionURL=function(t,e){var n;if(wa("string"==typeof t,"typeof type must == string"),wa("object"==typeof e,"typeof params must == object"),t===mu)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==_u)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return su(e,(function(t,e){r.push(t+"="+e)})),n+r.join("&")},wu.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},wu.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},wu);function wu(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=Xs.get("host:"+t)||this.host}function Eu(t){var e=xu(t),n=e.namespace;return"firebase"===e.domain&&Ws(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===e.domain||Ws("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Qs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new bu(e.host,e.secure,n,"ws"===e.scheme||"wss"===e.scheme,"",n!==e.subdomain),path:new fu(e.pathString)}}function Tu(t){return"string"==typeof t&&0!==t.length&&!Lu.test(t)}function Cu(t){return"string"==typeof t&&0!==t.length&&!Mu.test(t)}function Su(t){return null===t||"string"==typeof t||"number"==typeof t&&!Ks(t)||t&&"object"==typeof t&&Ba(t,".sv")}function Iu(t,e,n,r,i){i&&void 0===n||Uu($a(t,e,i),n,r)}function Nu(t,e,n,r,i){if(!i||void 0!==n){var o=$a(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];su(n,(function(t,e){var n=new fu(t);if(Uu(o,e,r.child(n)),".priority"===n.getBack()&&!Su(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)})),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!Tu(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(fu.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function Au(t,e,n,r){if(!r||void 0!==n){if(Ks(n))throw new Error($a(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Su(n))throw new Error($a(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function Du(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error($a(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function ku(t,e,n,r){if(!(r&&void 0===n||Tu(n)))throw new Error($a(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function Ru(t,e,n,r){if(!(r&&void 0===n||Cu(n)))throw new Error($a(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function Pu(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function Ou(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!Tu(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return Cu(t=t&&t.replace(/^\/*\.info(\/|$)/,"/"))}(r))throw new Error($a(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var xu=function(t){var e="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof t){var c=t.indexOf("//");0<=c&&(s=t.substring(0,c-1),t=t.substring(c+2));var h=t.indexOf("/");-1===h&&(h=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(h,l)),h<l&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,l)));var p=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=da(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Qs("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,l)));0<=(c=e.indexOf(":"))?(a="https"===s||"wss"===s,u=parseInt(e.substring(c+1),10)):c=t.length;var f=e.split(".");3===f.length?(n=f[1],o=r=f[0].toLowerCase()):2===f.length?n=f[0]:"localhost"===f[0].slice(0,c).toLowerCase()&&(n="localhost"),"ns"in p&&(o=p.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},Lu=/[\[\].#$\/\u0000-\u001F\u007F]/,Mu=/[\[\].#$\u0000-\u001F\u007F]/,Fu=10485760,Uu=function(t,e,n){var r=n instanceof fu?new yu(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(Ks(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>Fu/3&&es(e)>Fu)throw new Error(t+"contains a string greater than "+Fu+" utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,o=!1;if(su(e,(function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!Tu(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),Uu(t,n,r),r.pop()})),i&&o)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},qu=(Vu.prototype.cancel=function(t){Ja("OnDisconnect.cancel",0,1,arguments.length),Za("OnDisconnect.cancel",1,t,!0);var e=new Ia;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},Vu.prototype.remove=function(t){Ja("OnDisconnect.remove",0,1,arguments.length),Pu("OnDisconnect.remove",this.path_),Za("OnDisconnect.remove",1,t,!0);var e=new Ia;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},Vu.prototype.set=function(t,e){Ja("OnDisconnect.set",1,2,arguments.length),Pu("OnDisconnect.set",this.path_),Iu("OnDisconnect.set",1,t,this.path_,!1),Za("OnDisconnect.set",2,e,!0);var n=new Ia;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},Vu.prototype.setWithPriority=function(t,e,n){Ja("OnDisconnect.setWithPriority",2,3,arguments.length),Pu("OnDisconnect.setWithPriority",this.path_),Iu("OnDisconnect.setWithPriority",1,t,this.path_,!1),Au("OnDisconnect.setWithPriority",2,e,!1),Za("OnDisconnect.setWithPriority",3,n,!0);var r=new Ia;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},Vu.prototype.update=function(t,e){if(Ja("OnDisconnect.update",1,2,arguments.length),Pu("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Qs("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Nu("OnDisconnect.update",1,t,this.path_,!1),Za("OnDisconnect.update",2,e,!0);var i=new Ia;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},Vu);function Vu(t,e){this.repo_=t,this.path_=e}var Bu=(ju.prototype.toJSON=function(){return Ja("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},ju);function ju(t,e){this.committed=t,this.snapshot=e}var Wu,Qu,Ku,Hu=(Wu="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Qu=0,Ku=[],function(t){var e,n=t===Qu;Qu=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=Wu.charAt(t%64),t=Math.floor(t/64);wa(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===Ku[e];e--)Ku[e]=0;Ku[e]++}else for(e=0;e<12;e++)Ku[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Wu.charAt(Ku[e]);return wa(20===i.length,"nextPushId: Length should be 20."),i}),zu=(Gu.Wrap=function(t,e){return new Gu(t,e)},Gu);function Gu(t,e){this.name=t,this.node=e}var Yu,Xu=(Ju.prototype.getCompare=function(){return this.compare.bind(this)},Ju.prototype.indexedValueChanged=function(t,e){var n=new zu(ru,t),r=new zu(ru,e);return 0!==this.compare(n,r)},Ju.prototype.minPost=function(){return zu.MIN},Ju);function Ju(){}var $u,Zu=(ha(tc,$u=Xu),Object.defineProperty(tc,"__EMPTY_NODE",{get:function(){return Yu},set:function(t){Yu=t},enumerable:!0,configurable:!0}),tc.prototype.compare=function(t,e){return ou(t.name,e.name)},tc.prototype.isDefinedOn=function(t){throw Ea("KeyIndex.isDefinedOn not expected to be called.")},tc.prototype.indexedValueChanged=function(t,e){return!1},tc.prototype.minPost=function(){return zu.MIN},tc.prototype.maxPost=function(){return new zu(iu,Yu)},tc.prototype.makePost=function(t,e){return wa("string"==typeof t,"KeyIndex indexValue must always be a string."),new zu(t,Yu)},tc.prototype.toString=function(){return".key"},tc);function tc(){return null!==$u&&$u.apply(this,arguments)||this}var ec,nc=new Zu;function rc(t){return"number"==typeof t?"number:"+uu(t):"string:"+t}function ic(t){if(t.isLeafNode()){var e=t.val();wa("string"==typeof e||"number"==typeof e||"object"==typeof e&&Ba(e,".sv"),"Priority must be a string or number.")}else wa(t===ec||t.isEmpty(),"priority of unexpected type.");wa(t===ec||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var oc,ac,sc,uc,cc=(Object.defineProperty(hc,"__childrenNodeConstructor",{get:function(){return oc},set:function(t){oc=t},enumerable:!0,configurable:!0}),hc.prototype.isLeafNode=function(){return!0},hc.prototype.getPriority=function(){return this.priorityNode_},hc.prototype.updatePriority=function(t){return new hc(this.value_,t)},hc.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:hc.__childrenNodeConstructor.EMPTY_NODE},hc.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:hc.__childrenNodeConstructor.EMPTY_NODE},hc.prototype.hasChild=function(){return!1},hc.prototype.getPredecessorChildName=function(t,e){return null},hc.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:hc.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},hc.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(wa(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,hc.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},hc.prototype.isEmpty=function(){return!1},hc.prototype.numChildren=function(){return 0},hc.prototype.forEachChild=function(t,e){return!1},hc.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},hc.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+rc(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?uu(this.value_):this.value_,this.lazyHash_=Us(t)}return this.lazyHash_},hc.prototype.getValue=function(){return this.value_},hc.prototype.compareTo=function(t){return t===hc.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof hc.__childrenNodeConstructor?-1:(wa(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},hc.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=hc.VALUE_TYPE_ORDER.indexOf(e),i=hc.VALUE_TYPE_ORDER.indexOf(n);return wa(0<=r,"Unknown leaf type: "+e),wa(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},hc.prototype.withIndex=function(){return this},hc.prototype.isIndexed=function(){return!0},hc.prototype.equals=function(t){return t===this||!!t.isLeafNode()&&this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)},hc.VALUE_TYPE_ORDER=["object","boolean","number","string"],hc);function hc(t,e){void 0===e&&(e=hc.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,wa(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),ic(this.priorityNode_)}function lc(){return null!==uc&&uc.apply(this,arguments)||this}var pc=new(ha(lc,uc=Xu),lc.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?ou(t.name,e.name):i},lc.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},lc.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},lc.prototype.minPost=function(){return zu.MIN},lc.prototype.maxPost=function(){return new zu(iu,new cc("[PRIORITY-POST]",sc))},lc.prototype.makePost=function(t,e){var n=ac(t);return new zu(e,new cc("[PRIORITY-POST]",n))},lc.prototype.toString=function(){return".priority"},lc),fc=(dc.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},dc.prototype.hasNext=function(){return 0<this.nodeStack_.length},dc.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},dc);function dc(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var yc=(vc.prototype.copy=function(t,e,n,r,i){return new vc(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},vc.prototype.count=function(){return this.left.count()+1+this.right.count()},vc.prototype.isEmpty=function(){return!1},vc.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)},vc.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},vc.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},vc.prototype.minKey=function(){return this.min_().key},vc.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},vc.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp_()},vc.prototype.removeMin_=function(){if(this.left.isEmpty())return _c.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},vc.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return _c.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},vc.prototype.isRed_=function(){return this.color},vc.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},vc.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},vc.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},vc.prototype.rotateLeft_=function(){var t=this.copy(null,null,vc.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},vc.prototype.rotateRight_=function(){var t=this.copy(null,null,vc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},vc.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},vc.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},vc.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},vc.RED=!0,vc.BLACK=!1,vc);function vc(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:vc.RED,this.left=null!=r?r:_c.EMPTY_NODE,this.right=null!=i?i:_c.EMPTY_NODE}var gc=(mc.prototype.copy=function(t,e,n,r,i){return this},mc.prototype.insert=function(t,e,n){return new yc(t,e,null)},mc.prototype.remove=function(t,e){return this},mc.prototype.count=function(){return 0},mc.prototype.isEmpty=function(){return!0},mc.prototype.inorderTraversal=function(t){return!1},mc.prototype.reverseTraversal=function(t){return!1},mc.prototype.minKey=function(){return null},mc.prototype.maxKey=function(){return null},mc.prototype.check_=function(){return 0},mc.prototype.isRed_=function(){return!1},mc);function mc(){}var _c=(bc.prototype.insert=function(t,e){return new bc(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,yc.BLACK,null,null))},bc.prototype.remove=function(t){return new bc(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,yc.BLACK,null,null))},bc.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},bc.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},bc.prototype.isEmpty=function(){return this.root_.isEmpty()},bc.prototype.count=function(){return this.root_.count()},bc.prototype.minKey=function(){return this.root_.minKey()},bc.prototype.maxKey=function(){return this.root_.maxKey()},bc.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},bc.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},bc.prototype.getIterator=function(t){return new fc(this.root_,null,this.comparator_,!1,t)},bc.prototype.getIteratorFrom=function(t,e){return new fc(this.root_,t,this.comparator_,!1,e)},bc.prototype.getReverseIteratorFrom=function(t,e){return new fc(this.root_,t,this.comparator_,!0,e)},bc.prototype.getReverseIterator=function(t){return new fc(this.root_,null,this.comparator_,!0,t)},bc.EMPTY_NODE=new gc,bc);function bc(t,e){void 0===e&&(e=bc.EMPTY_NODE),this.comparator_=t,this.root_=e}var wc=Math.log(2),Ec=(Tc.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},Tc);function Tc(t){this.count=parseInt(Math.log(t+1)/wc,10),this.current_=this.count-1;var e=parseInt(Array(this.count+1).join("1"),2);this.bits_=t+1&e}var Cc,Sc,Ic=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,a,s=r-e;if(0==s)return null;if(1==s)return o=t[e],a=n?n(o):o,new yc(a,o.node,yc.BLACK,null,null);var u=parseInt(s/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],a=n?n(o):o,new yc(a,o.node,yc.BLACK,c,h)},o=function(e){for(var r=null,o=null,a=t.length,s=function(e,r){var o=a-e,s=a;a-=e;var c=i(1+o,s),h=t[o],l=n?n(h):h;u(new yc(l,h.node,r,null,c))},u=function(t){r=r?r.left=t:o=t},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?s(l,yc.BLACK):(s(l,yc.BLACK),s(l,yc.RED))}return o}(new Ec(t.length));return new _c(r||e,o)},Nc={},Ac=(Object.defineProperty(Dc,"Default",{get:function(){return wa(pc,"ChildrenNode.ts has not been loaded"),Cc=Cc||new Dc({".priority":Nc},{".priority":pc})},enumerable:!0,configurable:!0}),Dc.prototype.get=function(t){var e=ja(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof _c?e:null},Dc.prototype.hasIndex=function(t){return Ba(this.indexSet_,t.toString())},Dc.prototype.addIndex=function(t,e){wa(t!==nc,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(zu.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?Ic(r,t.getCompare()):Nc;var s=t.toString(),u=la({},this.indexSet_);u[s]=t;var c=la({},this.indexes_);return c[s]=n,new Dc(c,u)},Dc.prototype.addToIndexes=function(t,e){var n=this;return new Dc(Qa(this.indexes_,(function(r,i){var o=ja(n.indexSet_,i);if(wa(o,"Missing index implementation for "+i),r===Nc){if(o.isDefinedOn(t.node)){for(var a=[],s=e.getIterator(zu.Wrap),u=s.getNext();u;)u.name!==t.name&&a.push(u),u=s.getNext();return a.push(t),Ic(a,o.getCompare())}return Nc}var c=e.get(t.name),h=r;return c&&(h=h.remove(new zu(t.name,c))),h.insert(t,t.node)})),this.indexSet_)},Dc.prototype.removeFromIndexes=function(t,e){return new Dc(Qa(this.indexes_,(function(n){if(n===Nc)return n;var r=e.get(t.name);return r?n.remove(new zu(t.name,r)):n})),this.indexSet_)},Dc);function Dc(t,e){this.indexes_=t,this.indexSet_=e}function kc(t,e){return ou(t.name,e.name)}function Rc(t,e){return ou(t,e)}var Pc,Oc=(Object.defineProperty(xc,"EMPTY_NODE",{get:function(){return Sc=Sc||new xc(new _c(Rc),null,Ac.Default)},enumerable:!0,configurable:!0}),xc.prototype.isLeafNode=function(){return!1},xc.prototype.getPriority=function(){return this.priorityNode_||Sc},xc.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new xc(this.children_,t,this.indexMap_)},xc.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?Sc:e},xc.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},xc.prototype.hasChild=function(t){return null!==this.children_.get(t)},xc.prototype.updateImmediateChild=function(t,e){if(wa(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n,r=new zu(t,e),i=void 0;n=e.isEmpty()?(i=this.children_.remove(t),this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,e),this.indexMap_.addToIndexes(r,this.children_));var o=i.isEmpty()?Sc:this.priorityNode_;return new xc(i,o,n)},xc.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;wa(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},xc.prototype.isEmpty=function(){return this.children_.isEmpty()},xc.prototype.numChildren=function(){return this.children_.count()},xc.prototype.val=function(t){if(this.isEmpty())return null;var e={},n=0,r=0,i=!0;if(this.forEachChild(pc,(function(o,a){e[o]=a.val(t),n++,i&&xc.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1})),!t&&i&&r<2*n){var o=[];for(var a in e)o[a]=e[a];return o}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e},xc.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+rc(this.getPriority().val())+":"),this.forEachChild(pc,(function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)})),this.lazyHash_=""===t?"":Us(t)}return this.lazyHash_},xc.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new zu(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},xc.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},xc.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new zu(e,this.children_.get(e)):null},xc.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},xc.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new zu(e,this.children_.get(e)):null},xc.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal((function(t){return e(t.name,t.node)})):this.children_.inorderTraversal(e)},xc.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},xc.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(function(t){return t}));for(var r=this.children_.getIteratorFrom(t.name,zu.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},xc.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},xc.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(function(t){return t}));for(var r=this.children_.getReverseIteratorFrom(t.name,zu.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},xc.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Mc?-1:0},xc.prototype.withIndex=function(t){if(t===nc||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new xc(this.children_,this.priorityNode_,e)},xc.prototype.isIndexed=function(t){return t===nc||this.indexMap_.hasIndex(t)},xc.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(pc),r=e.getIterator(pc),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},xc.prototype.resolveIndex_=function(t){return t===nc?null:this.indexMap_.get(t.toString())},xc.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,xc);function xc(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ic(this.priorityNode_),this.children_.isEmpty()&&wa(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function Lc(){return Pc.call(this,new _c(Rc),Oc.EMPTY_NODE,Ac.Default)||this}var Mc=new(ha(Lc,Pc=Oc),Lc.prototype.compareTo=function(t){return t===this?0:1},Lc.prototype.equals=function(t){return t===this},Lc.prototype.getPriority=function(){return this},Lc.prototype.getImmediateChild=function(t){return Oc.EMPTY_NODE},Lc.prototype.isEmpty=function(){return!1},Lc);Object.defineProperties(zu,{MIN:{value:new zu(ru,Oc.EMPTY_NODE)},MAX:{value:new zu(iu,Mc)}}),Zu.__EMPTY_NODE=Oc.EMPTY_NODE,cc.__childrenNodeConstructor=Oc,ec=Mc,sc=Mc;var Fc,Uc=!0;function qc(t,e){if(void 0===e&&(e=null),null===t)return Oc.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),wa(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new cc(t,qc(e));if(t instanceof Array||!Uc){var n=Oc.EMPTY_NODE;return su(t,(function(e,r){if(Ba(t,e)&&"."!==e.substring(0,1)){var i=qc(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i))}})),n.updatePriority(qc(e))}var r=[],i=!1;if(su(t,(function(t,e){if("."!==t.substring(0,1)){var n=qc(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new zu(t,n)))}})),0===r.length)return Oc.EMPTY_NODE;var o=Ic(r,kc,(function(t){return t.name}),Rc);if(i){var a=Ic(r,pc.getCompare());return new Oc(o,qc(e),new Ac({".priority":a},{".priority":pc}))}return new Oc(o,qc(e),Ac.Default)}function Vc(){return null!==Fc&&Fc.apply(this,arguments)||this}ac=qc;var Bc,jc=new(ha(Vc,Fc=Xu),Vc.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?ou(t.name,e.name):n},Vc.prototype.isDefinedOn=function(t){return!0},Vc.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},Vc.prototype.minPost=function(){return zu.MIN},Vc.prototype.maxPost=function(){return zu.MAX},Vc.prototype.makePost=function(t,e){var n=qc(t);return new zu(e,n)},Vc.prototype.toString=function(){return".value"},Vc),Wc=(ha(Qc,Bc=Xu),Qc.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},Qc.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},Qc.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?ou(t.name,e.name):i},Qc.prototype.makePost=function(t,e){var n=qc(t),r=Oc.EMPTY_NODE.updateChild(this.indexPath_,n);return new zu(e,r)},Qc.prototype.maxPost=function(){var t=Oc.EMPTY_NODE.updateChild(this.indexPath_,Mc);return new zu(iu,t)},Qc.prototype.toString=function(){return this.indexPath_.slice().join("/")},Qc);function Qc(t){var e=Bc.call(this)||this;return e.indexPath_=t,wa(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var Kc=(Hc.prototype.val=function(){return Ja("DataSnapshot.val",0,0,arguments.length),this.node_.val()},Hc.prototype.exportVal=function(){return Ja("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},Hc.prototype.toJSON=function(){return Ja("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},Hc.prototype.exists=function(){return Ja("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},Hc.prototype.child=function(t){Ja("DataSnapshot.child",0,1,arguments.length),Ru("DataSnapshot.child",1,t=String(t),!1);var e=new fu(t),n=this.ref_.child(e);return new Hc(this.node_.getChild(e),n,pc)},Hc.prototype.hasChild=function(t){Ja("DataSnapshot.hasChild",1,1,arguments.length),Ru("DataSnapshot.hasChild",1,t,!1);var e=new fu(t);return!this.node_.getChild(e).isEmpty()},Hc.prototype.getPriority=function(){return Ja("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},Hc.prototype.forEach=function(t){var e=this;return Ja("DataSnapshot.forEach",1,1,arguments.length),Za("DataSnapshot.forEach",1,t,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,(function(n,r){return t(new Hc(r,e.ref_.child(n),pc))}))},Hc.prototype.hasChildren=function(){return Ja("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(Hc.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),Hc.prototype.numChildren=function(){return Ja("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},Hc.prototype.getRef=function(){return Ja("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(Hc.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Hc);function Hc(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var zc=(Gc.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},Gc.prototype.getEventType=function(){return this.eventType},Gc.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Gc.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+qa(this.snapshot.exportVal())},Gc);function Gc(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var Yc=(Xc.prototype.getPath=function(){return this.path},Xc.prototype.getEventType=function(){return"cancel"},Xc.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Xc.prototype.toString=function(){return this.path.toString()+":cancel"},Xc);function Xc(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var Jc=($c.prototype.respondsTo=function(t){return"value"===t},$c.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new zc("value",this,new Kc(t.snapshotNode,e.getRef(),n))},$c.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){wa(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},$c.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Yc(this,t,e):null},$c.prototype.matches=function(t){return t instanceof $c&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},$c.prototype.hasAnyCallback=function(){return null!==this.callback_},$c);function $c(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var Zc,th=(eh.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return Ba(this.callbacks_,e="children_removed"===e?"child_removed":e)},eh.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Yc(this,t,e):null},eh.prototype.createEvent=function(t,e){wa(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new zc(t.type,this,new Kc(t.snapshotNode,n,r),t.prevName)},eh.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){wa(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},eh.prototype.matches=function(t){var e=this;if(t instanceof eh){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var n=Object.keys(t.callbacks_),r=Object.keys(this.callbacks_),i=n.length;if(i===r.length){if(1!==i)return r.every((function(n){return t.callbacks_[n]===e.callbacks_[n]}));var o=n[0],a=r[0];return!(a!==o||t.callbacks_[o]&&this.callbacks_[a]&&t.callbacks_[o]!==this.callbacks_[a])}}}return!1},eh.prototype.hasAnyCallback=function(){return null!==this.callbacks_},eh);function eh(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var nh=(Object.defineProperty(rh,"__referenceConstructor",{get:function(){return wa(Zc,"Reference.ts has not been loaded"),Zc},set:function(t){Zc=t},enumerable:!0,configurable:!0}),rh.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===nc){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==ru)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!==iu)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===pc){if(null!=e&&!Su(e)||null!=n&&!Su(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(wa(t.getIndex()instanceof Wc||t.getIndex()===jc,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},rh.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},rh.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},rh.prototype.getQueryParams=function(){return this.queryParams_},rh.prototype.getRef=function(){return Ja("Query.ref",0,0,arguments.length),new rh.__referenceConstructor(this.repo,this.path)},rh.prototype.on=function(t,e,n,r){Ja("Query.on",2,4,arguments.length),Du("Query.on",1,t,!1),Za("Query.on",2,e,!1);var i=rh.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},rh.prototype.onValueEvent=function(t,e,n){var r=new Jc(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},rh.prototype.onChildEvent=function(t,e,n){var r=new th(t,e,n);this.repo.addEventCallbackForQuery(this,r)},rh.prototype.off=function(t,e,n){Ja("Query.off",0,3,arguments.length),Du("Query.off",1,t,!0),Za("Query.off",2,e,!0),ts("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Jc(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new th(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},rh.prototype.once=function(t,e,n,r){var i=this;Ja("Query.once",1,4,arguments.length),Du("Query.once",1,t,!1),Za("Query.once",2,e,!0);var o=rh.getCancelAndContextArgs_("Query.once",n,r),a=!0,s=new Ia;s.promise.catch((function(){}));var u=function(n){a&&(a=!1,i.off(t,u),e&&e.bind(o.context)(n),s.resolve(n))};return this.on(t,u,(function(e){i.off(t,u),o.cancel&&o.cancel.bind(o.context)(e),s.reject(e)})),s.promise},rh.prototype.limitToFirst=function(t){if(Ja("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new rh(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},rh.prototype.limitToLast=function(t){if(Ja("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new rh(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},rh.prototype.orderByChild=function(t){if(Ja("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');Ru("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new fu(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new Wc(e),r=this.queryParams_.orderBy(n);return rh.validateQueryEndpoints_(r),new rh(this.repo,this.path,r,!0)},rh.prototype.orderByKey=function(){Ja("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(nc);return rh.validateQueryEndpoints_(t),new rh(this.repo,this.path,t,!0)},rh.prototype.orderByPriority=function(){Ja("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(pc);return rh.validateQueryEndpoints_(t),new rh(this.repo,this.path,t,!0)},rh.prototype.orderByValue=function(){Ja("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(jc);return rh.validateQueryEndpoints_(t),new rh(this.repo,this.path,t,!0)},rh.prototype.startAt=function(t,e){void 0===t&&(t=null),Ja("Query.startAt",0,2,arguments.length),Iu("Query.startAt",1,t,this.path,!0),ku("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(rh.validateLimit_(n),rh.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new rh(this.repo,this.path,n,this.orderByCalled_)},rh.prototype.endAt=function(t,e){void 0===t&&(t=null),Ja("Query.endAt",0,2,arguments.length),Iu("Query.endAt",1,t,this.path,!0),ku("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(rh.validateLimit_(n),rh.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new rh(this.repo,this.path,n,this.orderByCalled_)},rh.prototype.equalTo=function(t,e){if(Ja("Query.equalTo",1,2,arguments.length),Iu("Query.equalTo",1,t,this.path,!1),ku("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},rh.prototype.toString=function(){return Ja("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},rh.prototype.toJSON=function(){return Ja("Query.toJSON",0,1,arguments.length),this.toString()},rh.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},rh.prototype.queryIdentifier=function(){var t=this.queryObject(),e=au(t);return"{}"===e?"default":e},rh.prototype.isEqual=function(t){if(Ja("Query.isEqual",1,1,arguments.length),!(t instanceof rh))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},rh.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Za(t,3,r.cancel,!0),r.context=n,ts(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error($a(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(rh.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),rh);function rh(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var ih=(oh.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},oh.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new oh);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},oh.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(pc,(function(t,e){n.remember(new fu(t),e)})),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},oh.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild((function(n,r){var i=new fu(t.toString()+"/"+n);r.forEachTree(i,e)}))},oh.prototype.forEachChild=function(t){this.children.forEach((function(e,n){t(n,e)}))},oh);function oh(){this.value=null,this.children=new Map}function ah(t,e){return t&&"object"==typeof t?(wa(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}var sh,uh,ch=function(t,e){var n,r=ah(t.getPriority().val(),e);if(t.isLeafNode()){var i=t,o=ah(i.getValue(),e);return o!==i.getValue()||r!==i.getPriority().val()?new cc(o,qc(r)):t}var a=t;return r!==(n=a).getPriority().val()&&(n=n.updatePriority(new cc(r))),a.forEachChild(pc,(function(t,r){var i=ch(r,e);i!==r&&(n=n.updateImmediateChild(t,i))})),n};(uh=sh=sh||{})[uh.OVERWRITE=0]="OVERWRITE",uh[uh.MERGE=1]="MERGE",uh[uh.ACK_USER_WRITE=2]="ACK_USER_WRITE",uh[uh.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var hh=(lh.User=new lh(!0,!1,null,!1),lh.Server=new lh(!1,!0,null,!1),lh.forServerTaggedQuery=function(t){return new lh(!1,!0,t,!0)},lh);function lh(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,wa(!r||e,"Tagged queries must be from server.")}var ph,fh=(dh.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return wa(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new fu(t));return new dh(fu.Empty,e,this.revert)}return wa(this.path.getFront()===t,"operationForChild called for unrelated child."),new dh(this.path.popFront(),this.affectedTree,this.revert)},dh);function dh(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=sh.ACK_USER_WRITE,this.source=hh.User}var yh=(vh.fromObject=function(t){var e=vh.Empty;return su(t,(function(t,n){e=e.set(new fu(t),n)})),e},vh.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},vh.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:fu.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new fu(n).child(i.path),value:i.value}},vh.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,(function(){return!0}))},vh.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):vh.Empty},vh.prototype.set=function(t,e){if(t.isEmpty())return new vh(e,this.children);var n=t.getFront(),r=(this.children.get(n)||vh.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new vh(this.value,i)},vh.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?vh.Empty:new vh(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?vh.Empty:new vh(this.value,i)}return this},vh.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},vh.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n,r=t.getFront(),i=(this.children.get(r)||vh.Empty).setTree(t.popFront(),e);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new vh(this.value,n)},vh.prototype.fold=function(t){return this.fold_(fu.Empty,t)},vh.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(t.child(r),e)})),e(t,this.value,n)},vh.prototype.findOnPath=function(t,e){return this.findOnPath_(t,fu.Empty,e)},vh.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},vh.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,fu.Empty,e)},vh.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):vh.Empty},vh.prototype.foreach=function(t){this.foreach_(fu.Empty,t)},vh.prototype.foreach_=function(t,e){this.children.inorderTraversal((function(n,r){r.foreach_(t.child(n),e)})),this.value&&e(t,this.value)},vh.prototype.foreachChild=function(t){this.children.inorderTraversal((function(e,n){n.value&&t(e,n.value)}))},vh.Empty=new vh(null),vh);function vh(t,e){void 0===e&&(e=ph=ph||new _c(Hs)),this.value=t,this.children=e}var gh=(mh.prototype.operationForChild=function(t){return this.path.isEmpty()?new mh(this.source,fu.Empty):new mh(this.source,this.path.popFront())},mh);function mh(t,e){this.source=t,this.path=e,this.type=sh.LISTEN_COMPLETE}var _h=(bh.prototype.operationForChild=function(t){return this.path.isEmpty()?new bh(this.source,fu.Empty,this.snap.getImmediateChild(t)):new bh(this.source,this.path.popFront(),this.snap)},bh);function bh(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=sh.OVERWRITE}var wh=(Eh.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new fu(t));return e.isEmpty()?null:e.value?new _h(this.source,fu.Empty,e.value):new Eh(this.source,fu.Empty,e)}return wa(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new Eh(this.source,this.path.popFront(),this.children)},Eh.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},Eh);function Eh(t,e,n){this.source=t,this.path=e,this.children=n,this.type=sh.MERGE}var Th=(Ch.prototype.isFullyInitialized=function(){return this.fullyInitialized_},Ch.prototype.isFiltered=function(){return this.filtered_},Ch.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},Ch.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},Ch.prototype.getNode=function(){return this.node_},Ch);function Ch(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var Sh=(Ih.prototype.updateEventSnap=function(t,e,n){return new Ih(new Th(t,e,n),this.serverCache_)},Ih.prototype.updateServerSnap=function(t,e,n){return new Ih(this.eventCache_,new Th(t,e,n))},Ih.prototype.getEventCache=function(){return this.eventCache_},Ih.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},Ih.prototype.getServerCache=function(){return this.serverCache_},Ih.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},Ih.Empty=new Ih(new Th(Oc.EMPTY_NODE,!1,!1),new Th(Oc.EMPTY_NODE,!1,!1)),Ih);function Ih(t,e){this.eventCache_=t,this.serverCache_=e}var Nh=(Ah.valueChange=function(t){return new Ah(Ah.VALUE,t)},Ah.childAddedChange=function(t,e){return new Ah(Ah.CHILD_ADDED,e,t)},Ah.childRemovedChange=function(t,e){return new Ah(Ah.CHILD_REMOVED,e,t)},Ah.childChangedChange=function(t,e,n){return new Ah(Ah.CHILD_CHANGED,e,t,n)},Ah.childMovedChange=function(t,e){return new Ah(Ah.CHILD_MOVED,e,t)},Ah.CHILD_ADDED="child_added",Ah.CHILD_REMOVED="child_removed",Ah.CHILD_CHANGED="child_changed",Ah.CHILD_MOVED="child_moved",Ah.VALUE="value",Ah);function Ah(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var Dh=(kh.prototype.updateChild=function(t,e,n,r,i,o){wa(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(Nh.childRemovedChange(e,a)):wa(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Nh.childAddedChange(e,n)):o.trackChildChange(Nh.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},kh.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(pc,(function(t,r){e.hasChild(t)||n.trackChildChange(Nh.childRemovedChange(t,r))})),e.isLeafNode()||e.forEachChild(pc,(function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(Nh.childChangedChange(e,r,i))}else n.trackChildChange(Nh.childAddedChange(e,r))}))),e.withIndex(this.index_)},kh.prototype.updatePriority=function(t,e){return t.isEmpty()?Oc.EMPTY_NODE:t.updatePriority(e)},kh.prototype.filtersNodes=function(){return!1},kh.prototype.getIndexedFilter=function(){return this},kh.prototype.getIndex=function(){return this.index_},kh);function kh(t){this.index_=t}var Rh=(Ph.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;wa(e===Nh.CHILD_ADDED||e===Nh.CHILD_CHANGED||e===Nh.CHILD_REMOVED,"Only child changes supported for tracking"),wa(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e===Nh.CHILD_ADDED&&i===Nh.CHILD_REMOVED)this.changeMap.set(n,Nh.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e===Nh.CHILD_REMOVED&&i===Nh.CHILD_ADDED)this.changeMap.delete(n);else if(e===Nh.CHILD_REMOVED&&i===Nh.CHILD_CHANGED)this.changeMap.set(n,Nh.childRemovedChange(n,r.oldSnap));else if(e===Nh.CHILD_CHANGED&&i===Nh.CHILD_ADDED)this.changeMap.set(n,Nh.childAddedChange(n,t.snapshotNode));else{if(e!==Nh.CHILD_CHANGED||i!==Nh.CHILD_CHANGED)throw Ea("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,Nh.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},Ph.prototype.getChanges=function(){return Array.from(this.changeMap.values())},Ph);function Ph(){this.changeMap=new Map}function Oh(){}var xh=new(Oh.prototype.getCompleteChild=function(t){return null},Oh.prototype.getChildAfterChild=function(t,e,n){return null},Oh),Lh=(Mh.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new Th(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},Mh.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},Mh);function Mh(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var Fh=function(t,e){this.viewCache=t,this.changes=e},Uh=(qh.prototype.assertIndexed=function(t){wa(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),wa(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},qh.prototype.applyOperation=function(t,e,n,r){var i,o,a=new Rh;if(e.type===sh.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(wa(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===sh.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(wa(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===sh.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==sh.LISTEN_COMPLETE)throw Ea("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return qh.maybeAddValueEvent_(t,i,h),new Fh(i,h)},qh.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(Nh.valueChange(e.getCompleteEventSnap()))}},qh.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(wa(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=n.calcCompleteEventChildren(u instanceof Oc?u:Oc.EMPTY_NODE);a=this.filter_.updateFullNode(t.getEventCache().getNode(),c,i)}else{var h=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=e.getFront();if(".priority"===l){wa(1===e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var f=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=f?this.filter_.updatePriority(p,f):o.getNode()}else{var d=e.popFront(),y=void 0;if(o.isCompleteForChild(l)){s=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);y=null!=v?o.getNode().getImmediateChild(l).updateChild(d,v):o.getNode().getImmediateChild(l)}else y=n.calcCompleteChild(l,t.getServerCache());a=null!=y?this.filter_.updateChild(o.getNode(),l,y,d,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},qh.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var p=e.popFront(),f=u.getNode().getImmediateChild(l).updateChild(p,n);s=".priority"===l?c.updatePriority(u.getNode(),f):c.updateChild(u.getNode(),l,f,p,xh,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new Lh(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},qh.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new Lh(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),p=u.getNode().getImmediateChild(h),f=void 0;if(l.isEmpty())f=n;else{var d=c.getCompleteChild(h);f=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):Oc.EMPTY_NODE}if(p.equals(f))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,f,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},qh.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},qh.prototype.applyUserMerge_=function(t,e,n,r,i,o){var a=this,s=t;return n.foreach((function(n,u){var c=e.child(n);qh.cacheHasChild_(t,c.getFront())&&(s=a.applyUserOverwrite_(s,c,u,r,i,o))})),n.foreach((function(n,u){var c=e.child(n);qh.cacheHasChild_(t,c.getFront())||(s=a.applyUserOverwrite_(s,c,u,r,i,o))})),s},qh.prototype.applyMerge_=function(t,e){return e.foreach((function(e,n){t=t.updateChild(e,n)})),t},qh.prototype.applyServerMerge_=function(t,e,n,r,i,o,a){var s=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:yh.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal((function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=s.applyMerge_(u,n);c=s.applyServerOverwrite_(c,new fu(e),l,r,i,o,a)}})),u.children.inorderTraversal((function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),p=s.applyMerge_(l,n);c=s.applyServerOverwrite_(c,new fu(e),p,r,i,o,a)}})),c},qh.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,s.getNode().getChild(e),r,i,a,o);if(e.isEmpty()){var u=yh.Empty;return s.getNode().forEachChild(nc,(function(t,e){u=u.set(new fu(t),e)})),this.applyServerMerge_(t,e,u,r,i,a,o)}return t}var c=yh.Empty;return n.foreach((function(t,n){var r=e.child(t);s.isCompleteForPath(r)&&(c=c.set(t,s.getNode().getChild(r)))})),this.applyServerMerge_(t,e,c,r,i,a,o)},qh.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,xh,r)},qh.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new Lh(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();wa(h instanceof Oc,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}u=this.filter_.updateFullNode(s,c=c,i)}else{var l=e.getFront(),p=n.calcCompleteChild(l,t.getServerCache());null==p&&t.getServerCache().isCompleteForChild(l)&&(p=s.getImmediateChild(l)),(u=null!=p?this.filter_.updateChild(s,l,p,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,Oc.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(fu.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},qh);function qh(t){this.filter_=t}var Vh=(Bh.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach((function(t){t.type===Nh.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(Nh.childMovedChange(t.childName,t.snapshotNode))})),this.generateEventsForType_(i,Nh.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,Nh.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,Nh.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,Nh.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,Nh.VALUE,t,n,e),i},Bh.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,a=n.filter((function(t){return t.type===e}));a.sort(this.compareChanges_.bind(this)),a.forEach((function(e){var n=o.materializeSingleChange_(e,i);r.forEach((function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))}))}))},Bh.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},Bh.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw Ea("Should only compare child_ events.");var n=new zu(t.childName,t.snapshotNode),r=new zu(e.childName,e.snapshotNode);return this.index_.compare(n,r)},Bh);function Bh(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var jh,Wh=(Qh.prototype.getQuery=function(){return this.query_},Qh.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},Qh.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},Qh.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},Qh.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},Qh.prototype.removeEventRegistration=function(t,e){var n=[];if(e){wa(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach((function(t){var i=t.createCancelEvent(e=e,r);i&&n.push(i)}))}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},Qh.prototype.applyOperation=function(t,e,n){t.type===sh.MERGE&&null!==t.source.queryId&&(wa(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),wa(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),wa(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},Qh.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(pc,(function(t,e){n.push(Nh.childAddedChange(t,e))})),e.isFullyInitialized()&&n.push(Nh.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},Qh.prototype.generateEventsForChanges_=function(t,e,n){return this.eventGenerator_.generateEventsForChanges(t,e,n?[n]:this.eventRegistrations_)},Qh);function Qh(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new Dh(n.getIndex()),i=n.getNodeFilter();this.processor_=new Uh(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(Oc.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Oc.EMPTY_NODE,a.getNode(),null),c=new Th(s,o.isFullyInitialized(),r.filtersNodes()),h=new Th(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new Sh(h,c),this.eventGenerator_=new Vh(this.query_)}var Kh=(Object.defineProperty(Hh,"__referenceConstructor",{get:function(){return wa(jh,"Reference.ts has not been loaded"),jh},set:function(t){wa(!jh,"__referenceConstructor has already been defined"),jh=t},enumerable:!0,configurable:!0}),Hh.prototype.isEmpty=function(){return 0===this.views.size},Hh.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return wa(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=da(this.views.values()),c=u.next();!c.done;c=u.next())s=s.concat((a=c.value).applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},Hh.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s,u=n.calcCompleteEventCache(i?r:null);s=!!u||(u=r instanceof Oc?n.calcCompleteEventChildren(r):Oc.EMPTY_NODE,!1);var c=new Sh(new Th(u,s,!1),new Th(r,i,!1));a=new Wh(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},Hh.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=da(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=ya(h.value,2),p=l[0],f=l[1];s=s.concat(f.removeEventRegistration(e,n)),f.isEmpty()&&(this.views.delete(p),f.getQuery().getQueryParams().loadsAllData()||a.push(f.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(f=this.views.get(o))&&(s=s.concat(f.removeEventRegistration(e,n)),f.isEmpty()&&(this.views.delete(o),f.getQuery().getQueryParams().loadsAllData()||a.push(f.getQuery())));return u&&!this.hasCompleteView()&&a.push(new Hh.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},Hh.prototype.getQueryViews=function(){var t,e,n=[];try{for(var r=da(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},Hh.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=da(this.views.values()),o=i.next();!o.done;o=i.next())r=r||o.value.getCompleteServerCache(t)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},Hh.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},Hh.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},Hh.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},Hh.prototype.getCompleteView=function(){var t,e;try{for(var n=da(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},Hh);function Hh(){this.views=new Map}var zh=(Gh.prototype.addWrite=function(t,e){if(t.isEmpty())return new Gh(new yh(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=fu.relativePath(r,t);return i=i.updateChild(o,e),new Gh(this.writeTree_.set(r,i))}var a=new yh(e);return new Gh(this.writeTree_.setTree(t,a))},Gh.prototype.addWrites=function(t,e){var n=this;return su(e,(function(e,r){n=n.addWrite(t.child(e),r)})),n},Gh.prototype.removeWrite=function(t){return t.isEmpty()?Gh.Empty:new Gh(this.writeTree_.setTree(t,yh.Empty))},Gh.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},Gh.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(fu.relativePath(e.path,t)):null},Gh.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(pc,(function(e,n){t.push(new zu(e,n))})):this.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new zu(e,n.value))})),t},Gh.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new Gh(null!=e?new yh(e):this.writeTree_.subtree(t))},Gh.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},Gh.prototype.apply=function(t){return function t(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal((function(n,o){".priority"===n?(wa(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=t(e.child(n),o,r)})),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r}(fu.Empty,this.writeTree_,t)},Gh.Empty=new Gh(new yh(null)),Gh);function Gh(t){this.writeTree_=t}var Yh=(Xh.prototype.childWrites=function(t){return new Jh(t,this)},Xh.prototype.addOverwrite=function(t,e,n,r){wa(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},Xh.prototype.addMerge=function(t,e,n){wa(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},Xh.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},Xh.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex((function(e){return e.writeId===t}));wa(0<=n,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(n<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):su(r.children,(function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))})),!0)},Xh.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},Xh.prototype.calcCompleteEventCache=function(t,e,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(t);return!r&&i.isEmpty()?e:r||null!=e||i.hasCompleteWrite(fu.Empty)?Xh.layerTree_(this.allWrites_,(function(e){return(e.visible||r)&&(!n||!~n.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))}),t).apply(s=e||Oc.EMPTY_NODE):null}var o=this.visibleWrites_.getCompleteNode(t);if(null!=o)return o;var a=this.visibleWrites_.childCompoundWrite(t);if(a.isEmpty())return e;if(null!=e||a.hasCompleteWrite(fu.Empty)){var s=e||Oc.EMPTY_NODE;return a.apply(s)}return null},Xh.prototype.calcCompleteEventChildren=function(t,e){var n=Oc.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(pc,(function(t,e){n=n.updateImmediateChild(t,e)})),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(pc,(function(t,e){var r=i.childCompoundWrite(new fu(t)).apply(e);n=n.updateImmediateChild(t,r)})),i.getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n},Xh.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){wa(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},Xh.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},Xh.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},Xh.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(fu.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),p=l.getNext();p&&c.length<r;)0!==h(p,n)&&c.push(p),p=l.getNext();return c},Xh.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},Xh.prototype.resetTree_=function(){this.visibleWrites_=Xh.layerTree_(this.allWrites_,Xh.DefaultFilter_,fu.Empty),this.lastWriteId_=0<this.allWrites_.length?this.allWrites_[this.allWrites_.length-1].writeId:-1},Xh.DefaultFilter_=function(t){return t.visible},Xh.layerTree_=function(t,e,n){for(var r=zh.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=fu.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=fu.relativePath(a,n),r=r.addWrite(fu.Empty,o.snap.getChild(s)));else{if(!o.children)throw Ea("WriteRecord should have .snap or .children");if(n.contains(a))s=fu.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=fu.relativePath(a,n)).isEmpty())r=r.addWrites(fu.Empty,o.children);else{var u=ja(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(fu.Empty,c)}}}}}return r},Xh);function Xh(){this.visibleWrites_=zh.Empty,this.allWrites_=[],this.lastWriteId_=-1}var Jh=($h.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},$h.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},$h.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},$h.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},$h.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},$h.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},$h.prototype.child=function(t){return new $h(this.treePath_.child(t),this.writeTree_)},$h);function $h(t,e){this.treePath_=t,this.writeTree_=e}var Zh=(tl.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new _h(hh.User,t,e)):[]},tl.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=yh.fromObject(e);return this.applyOperationToSyncPoints_(new wh(hh.User,t,r))},tl.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=yh.Empty;return null!=n.snap?r=r.set(fu.Empty,!0):su(n.children,(function(t,e){r=r.set(new fu(t),e)})),this.applyOperationToSyncPoints_(new fh(n.path,r,e))}return[]},tl.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new _h(hh.Server,t,e))},tl.prototype.applyServerMerge=function(t,e){var n=yh.fromObject(e);return this.applyOperationToSyncPoints_(new wh(hh.Server,t,n))},tl.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new gh(hh.Server,t))},tl.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=tl.parseQueryKey_(r),o=i.path,a=i.queryId,s=fu.relativePath(o,t),u=new _h(hh.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},tl.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=tl.parseQueryKey_(r),o=i.path,a=i.queryId,s=fu.relativePath(o,t),u=yh.fromObject(e),c=new wh(hh.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},tl.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=tl.parseQueryKey_(n),i=r.path,o=r.queryId,a=fu.relativePath(i,t),s=new gh(hh.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},tl.prototype.addEventRegistration=function(t,e){var n=t.path,r=null,i=!1;this.syncPointTree_.foreachOnPath(n,(function(t,e){var o=fu.relativePath(t,n);r=r||e.getCompleteServerCache(o),i=i||e.hasCompleteView()}));var o,a=this.syncPointTree_.get(n);a?(i=i||a.hasCompleteView(),r=r||a.getCompleteServerCache(fu.Empty)):(a=new Kh,this.syncPointTree_=this.syncPointTree_.set(n,a)),null!=r?o=!0:(o=!1,r=Oc.EMPTY_NODE,this.syncPointTree_.subtree(n).foreachChild((function(t,e){var n=e.getCompleteServerCache(fu.Empty);n&&(r=r.updateImmediateChild(t,n))})));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=tl.makeQueryKey_(t);wa(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=tl.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(n),l=a.addEventRegistration(t,e,h,r,o);if(!s&&!i){var p=a.viewForQuery(t);l=l.concat(this.setupListener_(t,p))}return l},tl.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex((function(t){return t.getQueryParams().loadsAllData()})),h=this.syncPointTree_.findOnPath(i,(function(t,e){return e.hasCompleteView()}));if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(l),f=0;f<p.length;++f){var d=p[f],y=d.getQuery(),v=this.createListenerForView_(d);this.listenProvider_.startListening(tl.queryForListening_(y),this.tagForQuery_(y),v.hashFn,v.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(tl.queryForListening_(t),null):u.forEach((function(t){var e=r.queryToTagMap.get(tl.makeQueryKey_(t));r.listenProvider_.stopListening(tl.queryForListening_(t),e)}))),this.removeTags_(u)}return a},tl.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,(function(e,n){var r=fu.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i}));return n.calcCompleteEventCache(t,r,e,!0)},tl.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold((function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),su(n,(function(t,e){r=r.concat(e)})),r}))},tl.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=tl.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},tl.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},tl.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(tl.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)wa(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold((function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map((function(t){return t.getQuery()})))),su(n,(function(t,e){r=r.concat(e)})),r})),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(tl.queryForListening_(c),this.tagForQuery_(c))}return o},tl.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||Oc.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},tl.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},tl.parseQueryKey_=function(t){var e=t.indexOf("$");return wa(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new fu(t.substr(0,e))}},tl.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},tl.prototype.tagForQuery_=function(t){var e=tl.makeQueryKey_(t);return this.queryToTagMap.get(e)},tl.getNextQueryTag_=function(){return tl.nextQueryTag_++},tl.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);wa(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},tl.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(fu.Empty))},tl.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(fu.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(fu.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},tl.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(fu.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(fu.Empty));var a=[];return e.children.inorderTraversal((function(e,o){var s=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(a=a.concat(i.applyOperationDescendantsHelper_(c,o,s,u)))})),o&&(a=a.concat(o.applyOperation(t,r,n))),a},tl.nextQueryTag_=1,tl);function tl(t){this.listenProvider_=t,this.syncPointTree_=yh.Empty,this.pendingWriteTree_=new Yh,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var el=(nl.prototype.getNode=function(t){return this.rootNode_.getChild(t)},nl.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},nl);function nl(){this.rootNode_=Oc.EMPTY_NODE}var rl=(il.prototype.getToken=function(t){return this.auth_?this.auth_.getToken(t).catch((function(t){return t&&"auth/token-not-initialized"===t.code?(Vs("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})):Promise.resolve(null)},il.prototype.addTokenChangeListener=function(t){this.auth_?this.auth_.addAuthTokenListener(t):(setTimeout((function(){return t(null)}),0),this.authProvider_.get().then((function(e){return e.addAuthTokenListener(t)})))},il.prototype.removeTokenChangeListener=function(t){this.authProvider_.get().then((function(e){return e.removeAuthTokenListener(t)}))},il.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';Qs(t+="credential"in this.app_.options?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.')},il);function il(t,e){var n=this;this.app_=t,this.authProvider_=e,this.auth_=null,this.auth_=e.getImmediate({optional:!0}),this.auth_||e.get().then((function(t){return n.auth_=t}))}var ol=(al.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Ba(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},al.prototype.get=function(){return Ca(this.counters_)},al);function al(){this.counters_={}}var sl=(ul.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new ol),this.collections_[e]},ul.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},ul.collections_={},ul.reporters_={},ul);function ul(){}var cl=(hl.prototype.get=function(){var t=this.collection_.get(),e=la({},t);return this.last_&&su(this.last_,(function(t,n){e[t]=e[t]-n})),this.last_=t,e},hl);function hl(t){this.collection_=t,this.last_=null}var ll=(pl.prototype.includeStat=function(t){this.statsToReport_[t]=!0},pl.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;su(e,(function(e,i){0<i&&Ba(t.statsToReport_,e)&&(n[e]=i,r=!0)})),r&&this.server_.reportStats(n),hu(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},pl);function pl(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new cl(t);var n=1e4+2e4*Math.random();hu(this.reportStats_.bind(this),Math.floor(n))}var fl=(dl.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new yl(i)),e.add(r)}e&&this.eventLists_.push(e)},dl.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.equals(t)}))},dl.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.contains(t)||t.contains(e)}))},dl.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},dl);function dl(){this.eventLists_=[],this.recursionDepth_=0}var yl=(vl.prototype.add=function(t){this.events_.push(t)},vl.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();eu&&Vs("event: "+e.toString()),cu(n)}}},vl.prototype.getPath=function(){return this.path_},vl);function vl(t){this.path_=t,this.events_=[]}var gl=(ml.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=va(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},ml.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},ml.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},ml.prototype.validateEventType_=function(t){wa(this.allowedEvents_.find((function(e){return e===t})),"Unknown event: "+t)},ml);function ml(t){this.allowedEvents_=t,this.listeners_={},wa(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var _l,bl=(ha(wl,_l=gl),wl.getInstance=function(){return new wl},wl.prototype.getInitialEvent=function(t){return wa("visible"===t,"Unknown event type: "+t),[this.visible_]},wl);function wl(){var t,e,n=_l.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),n.visible_=!0,e&&document.addEventListener(e,(function(){var e=!document[t];e!==n.visible_&&(n.visible_=e,n.trigger("visible",e))}),!1),n}var El,Tl=(ha(Cl,El=gl),Cl.getInstance=function(){return new Cl},Cl.prototype.getInitialEvent=function(t){return wa("online"===t,"Unknown event type: "+t),[this.online_]},Cl.prototype.currentlyOnline=function(){return this.online_},Cl);function Cl(){var t=El.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Da()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}var Sl=(Il.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},Il.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&cu((function(){n.onMessage_(t[e])}))},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},Il);function Il(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var Nl=(Al.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Sl(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Dl((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=ya(t,5),i=r[0],o=r[1],a=r[2];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===i)n.id=o,n.password=a;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=ya(t,2),i=r[0],o=r[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,o)}),(function(){n.onClosed_()}),n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(gu)&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,(function(){}))}}))},Al.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},Al.forceAllow=function(){Al.forceAllow_=!0},Al.forceDisallow=function(){Al.forceDisallow_=!0},Al.isAvailable=function(){return!!Al.forceAllow_||!(Al.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},Al.prototype.markConnectionHealthy=function(){},Al.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},Al.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},Al.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},Al.prototype.send=function(t){var e=qa(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=Gs(function(t){var e=ma(t);return Ta.encodeByteArray(e,!0)}(e),1840),r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++},Al.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},Al.prototype.incrementIncomingBytes_=function(t){var e=qa(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},Al);function Al(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Bs(t),this.stats_=sl.getCollection(e),this.urlFn=function(t){return e.connectionURL(_u,t)}}var Dl=(kl.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Vs("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},kl.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)}),Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},kl.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},kl.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return this.addLongPollTag_(e+=n,this.currentSerial),!0}return!1},kl.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},kl.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,(function(){clearTimeout(i),r()}))},kl.prototype.addTag=function(t,e){var n=this;setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){Vs("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}}),Math.floor(1))},kl);function kl(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=Zs(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=kl.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){Vs("frame writing exception"),t.stack&&Vs(t.stack),Vs(t)}}var Rl="",Pl=null;"undefined"!=typeof MozWebSocket?Pl=MozWebSocket:"undefined"!=typeof WebSocket&&(Pl=WebSocket);var Ol=(xl.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(gu)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(mu,r)},xl.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Xs.set("previous_websocket_failure",!0);try{if(Ra()){var r={headers:{"User-Agent":"Firebase/5/"+Rl+"/"+process.platform+"/"+(ba.NODE_ADMIN?"AdminNode":"Node")}},i=process.env,o=0===this.connURL.indexOf("wss://")?i.HTTPS_PROXY||i.https_proxy:i.HTTP_PROXY||i.http_proxy;o&&(r.proxy={origin:o}),this.mySock=new Pl(this.connURL,[],r)}else this.mySock=new Pl(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var a=t.message||t.data;return a&&this.log_(a),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},xl.prototype.start=function(){},xl.forceDisallow=function(){xl.forceDisallow_=!0},xl.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==Pl&&!xl.forceDisallow_},xl.previouslyFailed=function(){return Xs.isInMemoryStorage||!0===Xs.get("previous_websocket_failure")},xl.prototype.markConnectionHealthy=function(){Xs.remove("previous_websocket_failure")},xl.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Ua(e);this.onMessage(n)}},xl.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},xl.prototype.extractFrameCount_=function(t){if(wa(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},xl.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},xl.prototype.send=function(t){this.resetKeepAlive();var e=qa(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=Gs(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},xl.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},xl.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},xl.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},xl.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()}),Math.floor(45e3))},xl.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},xl.responsesRequiredToBeHealthy=2,xl.healthyTimeout=3e4,xl);function xl(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Bs(this.connId),this.stats_=sl.getCollection(e),this.connURL=xl.connectionURL_(e,n,r)}var Ll=(Object.defineProperty(Ml,"ALL_TRANSPORTS",{get:function(){return[Nl,Ol]},enumerable:!0,configurable:!0}),Ml.prototype.initTransports_=function(t){var e,n,r=Ol&&Ol.isAvailable(),i=r&&!Ol.previouslyFailed();if(t.webSocketOnly&&(r||Qs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Ol];else{var o=this.transports_=[];try{for(var a=da(Ml.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},Ml.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},Ml.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},Ml);function Ml(t){this.initTransports_(t)}var Fl=(Ul.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){t.conn_&&t.conn_.open(n,r)}),Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=hu((function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))}),Math.floor(i)))},Ul.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},Ul.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},Ul.prototype.connReceiver_=function(t){var e=this;return function(n){2!==e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},Ul.prototype.sendRequest=function(t){this.sendData_({t:"d",d:t})},Ul.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},Ul.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},Ul.prototype.onSecondaryMessageReceived_=function(t){var e=zs("t",t),n=zs("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},Ul.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},Ul.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},Ul.prototype.onPrimaryMessageReceived_=function(t){var e=zs("t",t),n=zs("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)},Ul.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},Ul.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},Ul.prototype.onControl_=function(t){var e=zs("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?js("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):js("Unknown control packet command: "+e)}},Ul.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&Qs("Protocol version mismatch detected"),this.tryStartUpgrade_())},Ul.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},Ul.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),hu((function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())}),Math.floor(6e4))},Ul.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},Ul.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):hu((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},Ul.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},Ul.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},Ul.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Xs.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},Ul.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},Ul.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},Ul.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},Ul.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},Ul);function Ul(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Bs("c:"+this.id+":"),this.transportManager_=new Ll(e),this.log_("Connection created"),this.start_()}var ql=(Vl.prototype.put=function(t,e,n,r){},Vl.prototype.merge=function(t,e,n,r){},Vl.prototype.refreshAuthToken=function(t){},Vl.prototype.onDisconnectPut=function(t,e,n){},Vl.prototype.onDisconnectMerge=function(t,e,n){},Vl.prototype.onDisconnectCancel=function(t,e){},Vl.prototype.reportStats=function(t){},Vl);function Vl(){}var Bl,jl=(ha(Wl,Bl=ql),Wl.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(qa(i)),wa(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},Wl.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),wa(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),wa(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},Wl.prototype.sendListen_=function(t){var e=this,n=t.query,r=n.path.toString(),i=n.queryIdentifier();this.log_("Listen on "+r+" for "+i);var o={p:r};t.tag&&(o.q=n.queryObject(),o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,(function(o){var a=o.d,s=o.s;Wl.warnOnListenWarnings_(a,n),(e.listens.get(r)&&e.listens.get(r).get(i))===t&&(e.log_("listen response",o),"ok"!==s&&e.removeListen_(r,i),t.onComplete&&t.onComplete(s,a))}))},Wl.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Ba(t,"w")){var n=ja(t,"w");Array.isArray(n)&&~n.indexOf("no_index")&&Qs('Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ".indexOn": "'+e.getQueryParams().getIndex().toString()+'" at '+e.path.toString()+" to your security rules for better performance.")}},Wl.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(t)},Wl.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=Va(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},Wl.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=function(t){var e=Va(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(e)?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))}))}},Wl.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),wa(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},Wl.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},Wl.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},Wl.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},Wl.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},Wl.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,(function(t){r&&setTimeout((function(){r(t.s,t.d)}),Math.floor(0))}))},Wl.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},Wl.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},Wl.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+e)},Wl.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,(function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)}))},Wl.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,(function(t){"ok"!==t.s&&e.log_("reportStats","Error sending stats: "+t.d)}))}},Wl.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+qa(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},Wl.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):js("Unrecognized action received from server: "+qa(t)+"\nAre you using the latest client?")},Wl.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},Wl.prototype.scheduleConnect_=function(t){var e=this;wa(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){e.establishConnectionTimer_=null,e.establishConnection_()}),Math.floor(t))},Wl.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},Wl.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},Wl.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},Wl.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Wl.nextConnectionId_++,i=this,o=this.lastSessionId,a=!1,s=null,u=function(){s?s.close():(a=!0,n())};this.realtime_={close:u,sendRequest:function(t){wa(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(t)}};var c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(c).then((function(u){a?Vs("getToken() completed but was canceled"):(Vs("getToken() completed. Creating connection."),i.authToken_=u&&u.accessToken,s=new Fl(r,i.repoInfo_,t,e,n,(function(t){Qs(t+" ("+i.repoInfo_.toString()+")"),i.interrupt("server_kill")}),o))})).then(null,(function(t){i.log_("Failed to get token: "+t),a||u()}))}},Wl.prototype.interrupt=function(t){Vs("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},Wl.prototype.resume=function(t){Vs("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Wa(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},Wl.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},Wl.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},Wl.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map((function(t){return au(t)})).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},Wl.prototype.removeListen_=function(t,e){var n,r=new fu(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},Wl.prototype.onAuthRevoked_=function(t,e){Vs("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},Wl.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},Wl.prototype.restoreState_=function(){var t,e,n,r;this.tryAuth();try{for(var i=da(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,da(a.values())),u=s.next();!u.done;u=s.next())this.sendListen_(u.value)}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}for(var c=0;c<this.outstandingPuts_.length;c++)this.outstandingPuts_[c]&&this.sendPut_(c);for(;this.onDisconnectRequestQueue_.length;){var h=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(h.action,h.pathString,h.data,h.onComplete)}},Wl.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+Rl.replace(/\./g,"-")]=1,Da()?t["framework.cordova"]=1:ka()&&(t["framework.reactnative"]=1),this.reportStats(t)},Wl.prototype.shouldReconnect_=function(){var t=Tl.getInstance().currentlyOnline();return Wa(this.interruptReasons_)&&t},Wl.nextPersistentConnectionId_=0,Wl.nextConnectionId_=0,Wl);function Wl(t,e,n,r,i,o){var a=Bl.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=Wl.nextPersistentConnectionId_++,a.log_=Bs("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!Ra())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),bl.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&Tl.getInstance().on("online",a.onOnline_,a),a}var Ql,Kl=(ha(Hl,Ql=ql),Hl.prototype.reportStats=function(t){throw new Error("Method not implemented.")},Hl.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(wa(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},Hl.prototype.listen=function(t,e,n,r){var i=this,o=t.path.toString();this.log_("Listen called for "+o+" "+t.queryIdentifier());var a=Hl.getListenId_(t,n),s={};this.listens_[a]=s;var u=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(o+".json",u,(function(t,e){var u=e;404===t&&(t=u=null),null===t&&i.onDataUpdate_(o,u,!1,n),ja(i.listens_,a)===s&&r(t?401===t?"permission_denied":"rest_error:"+t:"ok",null)}))},Hl.prototype.unlisten=function(t,e){var n=Hl.getListenId_(t,e);delete this.listens_[n]},Hl.prototype.refreshAuthToken=function(t){},Hl.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken;o&&(e.auth=o);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+function(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach((function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))})):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1])}return e.length?"&"+e.join("&"):""}(e);r.log_("Sending REST request for "+a);var s=new XMLHttpRequest;s.onreadystatechange=function(){if(n&&4===s.readyState){r.log_("REST Response for "+a+" received. status:",s.status,"response:",s.responseText);var t=null;if(200<=s.status&&s.status<300){try{t=Ua(s.responseText)}catch(t){Qs("Failed to parse JSON response for "+a+": "+s.responseText)}n(null,t)}else 401!==s.status&&404!==s.status&&Qs("Got unsuccessful REST response for "+a+" Status: "+s.status),n(s.status);n=null}},s.open("GET",a,!0),s.send()}))},Hl);function Hl(t,e,n){var r=Ql.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=Bs("p:rest:"),r.listens_={},r}var zl="repo_interrupt",Gl=(Yl.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},Yl.prototype.name=function(){return this.repoInfo_.namespace},Yl.prototype.serverTime=function(){var t=this.infoData_.getNode(new fu(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},Yl.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},Yl.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new fu(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=Qa(e,(function(t){return qc(t)}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=qc(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=Qa(e,(function(t){return qc(t)}));o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=qc(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},Yl.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},Yl.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},Yl.prototype.onServerInfoUpdate_=function(t){var e=this;su(t,(function(t,n){e.updateInfo_(t,n)}))},Yl.prototype.updateInfo_=function(t,e){var n=new fu("/.info/"+t),r=qc(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},Yl.prototype.getNextWriteId_=function(){return this.nextWriteId_++},Yl.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),a=qc(e,n),s=ch(a,o),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),a.val(!0),(function(e,n){var o="ok"===e;o||Qs("set at "+t+" failed: "+e);var a=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,a),i.callOnCompleteCallback(r,e,n)}));var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},Yl.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),a={};if(su(e,(function(t,e){i=!1;var n=qc(e);a[t]=ch(n,o)})),i)Vs("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,a,s);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,(function(e,i){var o="ok"===e;o||Qs("update at "+t+" failed: "+e);var a=r.serverSyncTree_.ackUserWrite(s,!o),u=0<a.length?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,a),r.callOnCompleteCallback(n,e,i)})),su(e,(function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(t,[])}},Yl.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=function(t,e){var n=new ih;return t.forEachTree(new fu(""),(function(t,r){n.remember(t,ch(r,e))})),n}(this.onDisconnect_,e),r=[];n.forEachTree(fu.Empty,(function(e,n){r=r.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var i=t.abortTransactions_(e);t.rerunTransactions_(i)})),this.onDisconnect_=new ih,this.eventQueue_.raiseEventsForChangedPath(fu.Empty,r)},Yl.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)}))},Yl.prototype.onDisconnectSet=function(t,e,n){var r=this,i=qc(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),(function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)}))},Yl.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=qc(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),(function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)}))},Yl.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(Wa(e))return Vs("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,(function(i,o){"ok"===i&&su(e,(function(e,n){var i=qc(n);r.onDisconnect_.remember(t.child(e),i)})),r.callOnCompleteCallback(n,i,o)}))},Yl.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Yl.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Yl.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(zl)},Yl.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(zl)},Yl.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new cl(this.stats_)),this.statsListener_.get()):this.stats_.get();var n=Object.keys(e).reduce((function(t,e){return Math.max(e.length,t)}),0);su(e,(function(t,e){for(var r=t,i=t.length;i<n+2;i++)r+=" ";console.log(r+e)}))}},Yl.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},Yl.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Vs.apply(void 0,va([n],t))},Yl.prototype.callOnCompleteCallback=function(t,e,n){t&&cu((function(){if("ok"===e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}}))},Object.defineProperty(Yl.prototype,"database",{get:function(){return this.__database||(this.__database=new dp(this))},enumerable:!0,configurable:!0}),Yl);function Yl(t,e,n,r){var i=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new fl,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new ih,this.persistentConnection_=null;var o=new rl(n,r);if(this.stats_=sl.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new Kl(this.repoInfo_,this.onDataUpdate_.bind(this),o),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var a=n.options.databaseAuthVariableOverride;if(null!=a){if("object"!=typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{qa(a)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new jl(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),o,a),this.server_=this.persistentConnection_}o.addTokenChangeListener((function(t){i.server_.refreshAuthToken(t)})),this.statsReporter_=sl.getOrCreateReporter(t,(function(){return new ll(i.stats_,i.server_)})),this.transactionsInit_(),this.infoData_=new el,this.infoSyncTree_=new Zh({startListening:function(t,e,n,r){var o=[],a=i.infoData_.getNode(t.path);return a.isEmpty()||(o=i.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout((function(){r("ok")}),0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Zh({startListening:function(t,e,n,r){return i.server_.listen(t,n,e,(function(e,n){var o=r(e,n);i.eventQueue_.raiseEventsForChangedPath(t.path,o)})),[]},stopListening:function(t,e){i.server_.unlisten(t,e)}})}var Xl=(Jl.prototype.getStartPost=function(){return this.startPost_},Jl.prototype.getEndPost=function(){return this.endPost_},Jl.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},Jl.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new zu(e,n))||(n=Oc.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},Jl.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Oc.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Oc.EMPTY_NODE);var i=this;return e.forEachChild(pc,(function(t,e){i.matches(new zu(t,e))||(r=r.updateImmediateChild(t,Oc.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,r,n)},Jl.prototype.updatePriority=function(t,e){return t},Jl.prototype.filtersNodes=function(){return!0},Jl.prototype.getIndexedFilter=function(){return this.indexedFilter_},Jl.prototype.getIndex=function(){return this.index_},Jl.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},Jl.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},Jl);function Jl(t){this.indexedFilter_=new Dh(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Jl.getStartPost_(t),this.endPost_=Jl.getEndPost_(t)}var $l=(Zl.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new zu(e,n))||(n=Oc.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},Zl.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Oc.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Oc.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(Oc.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,Oc.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},Zl.prototype.updatePriority=function(t,e){return t},Zl.prototype.filtersNodes=function(){return!0},Zl.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},Zl.prototype.getIndex=function(){return this.index_},Zl.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;wa(s.numChildren()===this.limit_,"");var u=new zu(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),p=r.getChildAfterChild(this.index_,c,this.reverse_);null!=p&&(p.name===e||s.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var f=null==p?1:o(p,u);if(h&&!n.isEmpty()&&0<=f)return null!=i&&i.trackChildChange(Nh.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(Nh.childRemovedChange(e,l));var d=s.updateImmediateChild(e,Oc.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(Nh.childAddedChange(p.name,p.node)),d.updateImmediateChild(p.name,p.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(Nh.childRemovedChange(c.name,c.node)),i.trackChildChange(Nh.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,Oc.EMPTY_NODE)):t},Zl);function Zl(t){this.rangedFilter_=new Xl(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var tp=(ep.prototype.hasStart=function(){return this.startSet_},ep.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===ep.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},ep.prototype.getIndexStartValue=function(){return wa(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},ep.prototype.getIndexStartName=function(){return wa(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ru},ep.prototype.hasEnd=function(){return this.endSet_},ep.prototype.getIndexEndValue=function(){return wa(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},ep.prototype.getIndexEndName=function(){return wa(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:iu},ep.prototype.hasLimit=function(){return this.limitSet_},ep.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},ep.prototype.getLimit=function(){return wa(this.limitSet_,"Only valid if limit has been set"),this.limit_},ep.prototype.getIndex=function(){return this.index_},ep.prototype.copy_=function(){var t=new ep;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},ep.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},ep.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=ep.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},ep.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=ep.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},ep.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},ep.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},ep.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},ep.prototype.getQueryObject=function(){var t=ep.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==pc&&(e[t.INDEX]=this.index_.toString()),e},ep.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},ep.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===pc},ep.prototype.getNodeFilter=function(){return this.loadsAllData()?new Dh(this.getIndex()):this.hasLimit()?new $l(this):new Xl(this)},ep.prototype.toRestQueryStringParameters=function(){var t,e=ep.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===pc?e.PRIORITY_INDEX:this.index_===jc?e.VALUE_INDEX:this.index_===nc?e.KEY_INDEX:(wa(this.index_ instanceof Wc,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=qa(t),this.startSet_&&(n[e.START_AT]=qa(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+qa(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=qa(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+qa(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},ep.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},ep.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},ep.DEFAULT=new ep,ep);function ep(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=pc}var np,rp=(ha(ip,np=nh),ip.prototype.getKey=function(){return Ja("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},ip.prototype.child=function(t){return Ja("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof fu||(null===this.path.getFront()?function(t,e,n,r){Ru("Reference.child",1,n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),!1)}(0,0,t):Ru("Reference.child",1,t,!1)),new ip(this.repo,this.path.child(t))},ip.prototype.getParent=function(){Ja("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new ip(this.repo,t)},ip.prototype.getRoot=function(){Ja("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},ip.prototype.databaseProp=function(){return this.repo.database},ip.prototype.set=function(t,e){Ja("Reference.set",1,2,arguments.length),Pu("Reference.set",this.path),Iu("Reference.set",1,t,this.path,!1),Za("Reference.set",2,e,!0);var n=new Ia;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},ip.prototype.update=function(t,e){if(Ja("Reference.update",1,2,arguments.length),Pu("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Qs("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Nu("Reference.update",1,t,this.path,!1),Za("Reference.update",2,e,!0);var i=new Ia;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},ip.prototype.setWithPriority=function(t,e,n){if(Ja("Reference.setWithPriority",2,3,arguments.length),Pu("Reference.setWithPriority",this.path),Iu("Reference.setWithPriority",1,t,this.path,!1),Au("Reference.setWithPriority",2,e,!1),Za("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new Ia;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},ip.prototype.remove=function(t){return Ja("Reference.remove",0,1,arguments.length),Pu("Reference.remove",this.path),Za("Reference.remove",1,t,!0),this.set(null,t)},ip.prototype.transaction=function(t,e,n){if(Ja("Reference.transaction",1,3,arguments.length),Pu("Reference.transaction",this.path),Za("Reference.transaction",1,t,!1),Za("Reference.transaction",2,e,!0),function(t,e,n,r){if(void 0!==n&&"boolean"!=typeof n)throw new Error($a("Reference.transaction",3,!0)+"must be a boolean.")}(0,0,n),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new Ia;return"function"==typeof e&&r.promise.catch((function(){})),this.repo.startTransaction(this.path,t,(function(t,n,i){t?r.reject(t):r.resolve(new Bu(n,i)),"function"==typeof e&&e(t,n,i)}),n),r.promise},ip.prototype.setPriority=function(t,e){Ja("Reference.setPriority",1,2,arguments.length),Pu("Reference.setPriority",this.path),Au("Reference.setPriority",1,t,!1),Za("Reference.setPriority",2,e,!0);var n=new Ia;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},ip.prototype.push=function(t,e){Ja("Reference.push",0,2,arguments.length),Pu("Reference.push",this.path),Iu("Reference.push",1,t,this.path,!0),Za("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=Hu(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then((function(){return a})):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch((function(){})),o},ip.prototype.onDisconnect=function(){return Pu("Reference.onDisconnect",this.path),new qu(this.repo,this.path)},Object.defineProperty(ip.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(ip.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(ip.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(ip.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),ip);function ip(t,e){if(!(t instanceof Gl))throw new Error("new Reference() no longer supported - use app.database().");return np.call(this,t,e,tp.DEFAULT,!1)||this}nh.__referenceConstructor=rp,Kh.__referenceConstructor=rp;var op,ap,sp=function(){this.children={},this.childCount=0,this.value=null},up=(cp.prototype.subTree=function(t){for(var e=t instanceof fu?t:new fu(t),n=this,r=e.getFront();null!==r;)n=new cp(r,n,ja(n.node_.children,r)||new sp),r=(e=e.popFront()).getFront();return n},cp.prototype.getValue=function(){return this.node_.value},cp.prototype.setValue=function(t){wa(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},cp.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},cp.prototype.hasChildren=function(){return 0<this.node_.childCount},cp.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},cp.prototype.forEachChild=function(t){var e=this;su(this.node_.children,(function(n,r){t(new cp(n,e,r))}))},cp.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild((function(e){e.forEachDescendant(t,!0,n)})),e&&n&&t(this)},cp.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},cp.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild((function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)}))},cp.prototype.path=function(){return new fu(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},cp.prototype.name=function(){return this.name_},cp.prototype.parent=function(){return this.parent_},cp.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},cp.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Ba(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},cp);function cp(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new sp),this.name_=t,this.parent_=e,this.node_=n}(ap=op=op||{})[ap.RUN=0]="RUN",ap[ap.SENT=1]="SENT",ap[ap.COMPLETED=2]="COMPLETED",ap[ap.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",ap[ap.NEEDS_ABORT=4]="NEEDS_ABORT",Gl.MAX_TRANSACTION_RETRIES_=25,Gl.prototype.transactionsInit_=function(){this.transactionQueueTree_=new up},Gl.prototype.startTransaction=function(t,e,n,r){function i(){}this.log_("transaction on "+t);var o=new rp(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:Zs(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new Kc(a.currentInputSnapshot,new rp(this,a.path),pc);a.onComplete(null,!1,c)}}else{Uu("transaction failed: Data returned ",u,a.path),a.status=op.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var p=void 0;"object"==typeof u&&null!==u&&Ba(u,".priority")?(p=ja(u,".priority"),wa(Su(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(this.serverSyncTree_.calcCompleteEventCache(t)||Oc.EMPTY_NODE).getPriority().val(),p=p;var f=this.generateServerValues(),d=qc(u,p),y=ch(d,f);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var v=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,v),this.sendReadyTransactions_()}},Gl.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Oc.EMPTY_NODE},Gl.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);wa(0<n.length,"Sending zero length transaction queue"),n.every((function(t){return t.status===op.RUN}))&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild((function(t){e.sendReadyTransactions_(t)}))},Gl.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map((function(t){return t.currentWriteId})),i=this.getLatestState_(t,r),o=i,a=i.hash(),s=0;s<e.length;s++){var u=e[s];wa(u.status===op.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=op.SENT,u.retryCount++;var c=fu.relativePath(t,u.path);o=o.updateChild(c,u.currentOutputSnapshotRaw)}var h=o.val(!0),l=t;this.server_.put(l.toString(),h,(function(r){n.log_("transaction put response",{path:l.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<e.length;a++){if(e[a].status=op.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[a].currentWriteId)),e[a].onComplete){var s=e[a].currentOutputSnapshotResolved,u=new rp(n,e[a].path),c=new Kc(s,u,pc);o.push(e[a].onComplete.bind(null,null,!0,c))}e[a].unwatcher()}for(n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i),a=0;a<o.length;a++)cu(o[a])}else{if("datastale"===r)for(a=0;a<e.length;a++)e[a].status=e[a].status===op.SENT_NEEDS_ABORT?op.NEEDS_ABORT:op.RUN;else for(Qs("transaction at "+l.toString()+" failed: "+r),a=0;a<e.length;a++)e[a].status=op.NEEDS_ABORT,e[a].abortReason=r;n.rerunTransactions_(t)}}),a)},Gl.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Gl.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n=[],r=[],i=t.filter((function(t){return t.status===op.RUN})).map((function(t){return t.currentWriteId})),o=0;o<t.length;o++){var a=t[o],s=fu.relativePath(e,a.path),u=!1,c=void 0;if(wa(null!==s,"rerunTransactionsUnderNode_: relativePath should not be null."),a.status===op.NEEDS_ABORT)u=!0,c=a.abortReason,r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else if(a.status===op.RUN)if(a.retryCount>=Gl.MAX_TRANSACTION_RETRIES_)u=!0,c="maxretry",r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else{var h=this.getLatestState_(a.path,i);a.currentInputSnapshot=h;var l=t[o].update(h.val());if(void 0!==l){Uu("transaction failed: Data returned ",l,a.path);var p=qc(l);"object"==typeof l&&null!=l&&Ba(l,".priority")||(p=p.updatePriority(h.getPriority()));var f=a.currentWriteId,d=this.generateServerValues(),y=ch(p,d);a.currentOutputSnapshotRaw=p,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_(),i.splice(i.indexOf(f),1),r=(r=r.concat(this.serverSyncTree_.applyUserOverwrite(a.path,y,a.currentWriteId,a.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(f,!0))}else u=!0,c="nodata",r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,r),r=[],u&&(t[o].status=op.COMPLETED,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete))if("nodata"===c){var v=new rp(this,t[o].path),g=new Kc(t[o].currentInputSnapshot,v,pc);n.push(t[o].onComplete.bind(null,null,!1,g))}else n.push(t[o].onComplete.bind(null,new Error(c),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),o=0;o<n.length;o++)cu(n[o]);this.sendReadyTransactions_()}},Gl.prototype.getAncestorTransactionNode_=function(t){var e,n=this.transactionQueueTree_;for(e=t.getFront();null!==e&&null===n.getValue();)n=n.subTree(e),e=(t=t.popFront()).getFront();return n},Gl.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort((function(t,e){return t.order-e.order})),e},Gl.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild((function(t){n.aggregateTransactionQueuesForNode_(t,e)}))},Gl.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==op.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild((function(t){e.pruneCompletedTransactionsBelowNode_(t)}))},Gl.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor((function(t){e.abortTransactionsOnNode_(t)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(t){e.abortTransactionsOnNode_(t)})),n},Gl.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)e[o].status===op.SENT_NEEDS_ABORT||(e[o].status===op.SENT?(wa(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=op.SENT_NEEDS_ABORT,e[o].abortReason="set"):(wa(e[o].status===op.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete&&n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))));for(-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r),o=0;o<n.length;o++)cu(n[o])}};var hp,lp="databaseURL",pp=(fp.getInstance=function(){return hp=hp||new fp},fp.prototype.interrupt=function(){var t,e,n,r;try{for(var i=da(Object.keys(this.repos_)),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,da(Object.keys(this.repos_[a]))),u=s.next();!u.done;u=s.next())this.repos_[a][u.value].interrupt()}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},fp.prototype.resume=function(){var t,e,n,r;try{for(var i=da(Object.keys(this.repos_)),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,da(Object.keys(this.repos_[a]))),u=s.next();!u.done;u=s.next())this.repos_[a][u.value].resume()}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},fp.prototype.databaseFromApp=function(t,e,n){var r=n||t.options[lp];void 0===r&&Ws("Can't determine Firebase Database URL.  Be sure to include "+lp+" option when calling firebase.initializeApp().");var i=Eu(r),o=i.repoInfo,a=void 0;return"undefined"!=typeof process&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a&&(o=(i=Eu(r="http://"+a+"?ns="+o.namespace)).repoInfo),Ou("Invalid Firebase Database URL",1,i),i.path.isEmpty()||Ws("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(o,t,e).database},fp.prototype.deleteRepo=function(t){var e=ja(this.repos_,t.app.name);e&&ja(e,t.repoInfo_.toURLString())===t||Ws("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},fp.prototype.createRepo=function(t,e,n){var r=ja(this.repos_,e.name);r||(this.repos_[e.name]=r={});var i=ja(r,t.toURLString());return i&&Ws("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new Gl(t,this.useRestClient_,e,n),r[t.toURLString()]=i},fp.prototype.forceRestClient=function(t){this.useRestClient_=t},fp);function fp(){this.repos_={},this.useRestClient_=!1}var dp=(Object.defineProperty(yp.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),yp.prototype.ref=function(t){return this.checkDeleted_("ref"),Ja("database.ref",0,1,arguments.length),t instanceof rp?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},yp.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Ja(e,1,1,arguments.length);var n=Eu(t);Ou(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&Ws(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},yp.prototype.checkDeleted_=function(t){null===this.repo_&&Ws("Cannot call "+t+" on a deleted database.")},yp.prototype.goOffline=function(){Ja("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},yp.prototype.goOnline=function(){Ja("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},yp.ServerValue={TIMESTAMP:{".sv":"timestamp"}},yp);function yp(t){(this.repo_=t)instanceof Gl||Ws("Don't call new Database() directly - please use firebase.database()."),this.root_=new rp(t,fu.Empty),this.INTERNAL=new vp(this)}var vp=(gp.prototype.delete=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){return this.database.checkDeleted_("delete"),pp.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]}))}))},gp);function gp(t){this.database=t}var mp=Object.freeze({__proto__:null,forceLongPolling:function(){Ol.forceDisallow(),Nl.forceAllow()},forceWebSockets:function(){Nl.forceDisallow()},isWebSocketsAvailable:function(){return Ol.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),_p=jl;jl.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},jl.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var bp,wp,Ep=Object.freeze({__proto__:null,DataConnection:_p,RealTimeConnection:Fl,hijackHash:function(t){var e=jl.prototype.put;return jl.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){jl.prototype.put=e}},ConnectionTarget:bu,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){pp.getInstance().forceRestClient(t)}}),Tp=dp.ServerValue;bp=(wp=Ps).SDK_VERSION,Rl=bp,wp.INTERNAL.registerComponent(new ns("database",(function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return pp.getInstance().databaseFromApp(n,r,e)}),"PUBLIC").setServiceProps({Reference:rp,Query:nh,Database:dp,DataSnapshot:Kc,enableLogging:qs,INTERNAL:mp,ServerValue:Tp,TEST_ACCESS:Ep}).setMultipleInstances(!0)),wp.registerVersion("@firebase/database","0.5.19");var Cp,Sp="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ip=Ip||{},Np=Sp;function Ap(t){return"string"==typeof t}function Dp(t){return"number"==typeof t}function kp(t,e){t=t.split("."),e=e||Np;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function Rp(){}function Pp(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function Op(t){return"array"==Pp(t)}function xp(t){var e=Pp(t);return"array"==e||"object"==e&&"number"==typeof t.length}function Lp(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Mp="closure_uid_"+(1e9*Math.random()>>>0),Fp=0;function Up(t,e,n){return t.call.apply(t.bind,arguments)}function qp(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Vp(t,e,n){return(Vp=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Up:qp).apply(null,arguments)}function Bp(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=e.slice();return n.push.apply(n,arguments),t.apply(this,n)}}var jp=Date.now||function(){return+new Date};function Wp(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,(t.prototype.constructor=t).xb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function Qp(){this.j=this.j,this.i=this.i}Qp.prototype.j=!1,Qp.prototype.la=function(){!this.j&&(this.j=!0,this.G(),0)&&(this[Mp]||(this[Mp]=++Fp))},Qp.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Kp=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(Ap(t))return Ap(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Hp=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=Ap(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function zp(){return Array.prototype.concat.apply([],arguments)}function Gp(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Yp(t){return/^[\s\xa0]*$/.test(t)}var Xp,Jp=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function $p(t,e){return-1!=t.indexOf(e)}function Zp(t,e){return t<e?-1:e<t?1:0}t:{var tf=Np.navigator;if(tf){var ef=tf.userAgent;if(ef){Xp=ef;break t}}Xp=""}function nf(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function rf(t){var e,n={};for(e in t)n[e]=t[e];return n}var of="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function af(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<of.length;i++)e=of[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function sf(t){return sf[" "](t),t}sf[" "]=Rp;var uf,cf,hf=$p(Xp,"Opera"),lf=$p(Xp,"Trident")||$p(Xp,"MSIE"),pf=$p(Xp,"Edge"),ff=pf||lf,df=$p(Xp,"Gecko")&&!($p(Xp.toLowerCase(),"webkit")&&!$p(Xp,"Edge"))&&!($p(Xp,"Trident")||$p(Xp,"MSIE"))&&!$p(Xp,"Edge"),yf=$p(Xp.toLowerCase(),"webkit")&&!$p(Xp,"Edge");function vf(){var t=Np.document;return t?t.documentMode:void 0}t:{var gf="",mf=(cf=Xp,df?/rv:([^\);]+)(\)|;)/.exec(cf):pf?/Edge\/([\d\.]+)/.exec(cf):lf?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(cf):yf?/WebKit\/(\S+)/.exec(cf):hf?/(?:Version)[ \/]?(\S+)/.exec(cf):void 0);if(mf&&(gf=mf?mf[1]:""),lf){var _f=vf();if(null!=_f&&_f>parseFloat(gf)){uf=String(_f);break t}}uf=gf}var bf,wf={};function Ef(t){return function(e,n){var r=wf;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=function(){for(var e=0,n=Jp(String(uf)).split("."),r=Jp(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=Zp(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||Zp(0==a[2].length,0==s[2].length)||Zp(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}()}(t)}var Tf=Np.document;bf=Tf&&lf?vf()||("CSS1Compat"==Tf.compatMode?parseInt(uf,10):5):void 0;var Cf=!lf||9<=Number(bf),Sf=lf&&!Ef("9"),If=function(){if(!Np.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Np.addEventListener("test",Rp,e),Np.removeEventListener("test",Rp,e)}catch(t){}return t}();function Nf(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function Af(t,e){if(Nf.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(df){t:{try{sf(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=Ap(t.pointerType)?t.pointerType:Df[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Nf.prototype.b=function(){this.Ia=!1},Wp(Af,Nf);var Df={2:"touch",3:"pen",4:"mouse"};Af.prototype.b=function(){Af.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Sf)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var kf="closure_listenable_"+(1e6*Math.random()|0),Rf=0;function Pf(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Rf,this.X=this.Z=!1}function Of(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function xf(t){this.src=t,this.a={},this.b=0}function Lf(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=Kp(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Of(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Mf(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}xf.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Mf(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new Pf(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Ff="closure_lm_"+(1e6*Math.random()|0),Uf={};function qf(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Op(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}return r=Hf(r),e&&e[kf]?e.Aa(n,r,Lp(i)?!!i.capture:!!i,o):Vf(e,n,r,!0,i,o)}(t,e,n,r,i);if(Op(e)){for(var o=0;o<e.length;o++)qf(t,e[o],n,r,i);return null}return n=Hf(n),t&&t[kf]?t.za(e,n,Lp(r)?!!r.capture:!!r,i):Vf(t,e,n,!1,r,i)}function Vf(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=Lp(i)?!!i.capture:!!i;if(a&&!Cf)return null;var s=Qf(t);if(s||(t[Ff]=s=new xf(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=Wf,e=Cf?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)If||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(jf(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Bf(t){if(!Dp(t)&&t&&!t.X){var e=t.src;if(e&&e[kf])Lf(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(jf(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Qf(e))?(Lf(n,t),0==n.b&&(n.src=null,e[Ff]=null)):Of(t)}}}function jf(t){return t in Uf?Uf[t]:Uf[t]="on"+t}function Wf(t,e){return!!t.X||function(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Bf(t),n.call(r,e)}(t,Cf?new Af(e,this):e=new Af(e||kp("window.event"),this))}function Qf(t){return(t=t[Ff])instanceof xf?t:null}var Kf="__closure_events_fn_"+(1e9*Math.random()>>>0);function Hf(t){return"function"==Pp(t)?t:(t[Kf]||(t[Kf]=function(e){return t.handleEvent(e)}),t[Kf])}function zf(){Qp.call(this),this.c=new xf(this),(this.J=this).B=null}function Gf(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&Lf(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ia}Wp(zf,Qp),zf.prototype[kf]=!0,(Cp=zf.prototype).addEventListener=function(t,e,n,r){qf(this,t,e,n,r)},Cp.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Op(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=Lp(i)?!!i.capture:!!i,r=Hf(r),e&&e[kf]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Mf(a=e.a[n],r,i,o))&&(Of(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&Qf(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Mf(n,r,i,o)),(r=-1<e?n[e]:null)&&Bf(r))}(this,t,e,n,r)},Cp.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(Ap(t))t=new Nf(t,n);else if(t instanceof Nf)t.target=t.target||n;else{var i=t;af(t=new Nf(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Gf(a,r,!0,t)&&i}if(i=Gf(a=t.a=n,r,!0,t)&&i,i=Gf(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Gf(a=t.a=e[o],r,!1,t)&&i;return i},Cp.G=function(){if(zf.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Of(n[r]);delete e.a[t],e.b--}}this.B=null},Cp.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},Cp.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Yf=Np.JSON.stringify;function Xf(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Jf(){this.b=this.a=null}Xf.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var $f,Zf=new Xf((function(){return new td}),(function(t){t.reset()}));function td(){this.next=this.b=this.a=null}function ed(t){Np.setTimeout((function(){throw t}),0)}function nd(t,e){$f||function(){var t=Np.Promise.resolve(void 0);$f=function(){t.then(od)}}(),rd||($f(),rd=!0),id.add(t,e)}Jf.prototype.add=function(t,e){var n=Zf.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},td.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var rd=!(td.prototype.reset=function(){this.next=this.b=this.a=null}),id=new Jf;function od(){for(var t;r=n=void 0,r=null,(n=id).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){ed(t)}var e=Zf;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;rd=!1}function ad(t,e){zf.call(this),this.b=t||1,this.a=e||Np,this.f=Vp(this.fb,this),this.g=jp()}function sd(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function ud(t,e,n){if("function"==Pp(t))n&&(t=Vp(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Vp(t.handleEvent,t)}return 2147483647<Number(e)?-1:Np.setTimeout(t,e||0)}function cd(t,e,n){Qp.call(this),this.f=null!=n?Vp(t,n):t,this.c=e,this.b=Vp(this.$a,this),this.a=[]}function hd(t){t.U=ud(t.b,t.c),t.f.apply(null,t.a)}function ld(t){Qp.call(this),this.b=t,this.a={}}Wp(ad,zf),(Cp=ad.prototype).ba=!1,Cp.L=null,Cp.fb=function(){if(this.ba){var t=jp()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(sd(this),this.start()))}},Cp.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=jp())},Cp.G=function(){ad.N.G.call(this),sd(this),delete this.a},Wp(cd,Qp),(Cp=cd.prototype).ea=!1,Cp.U=null,Cp.Ta=function(t){this.a=arguments,this.U?this.ea=!0:hd(this)},Cp.G=function(){cd.N.G.call(this),this.U&&(Np.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},Cp.$a=function(){this.U=null,this.ea&&(this.ea=!1,hd(this))},Wp(ld,Qp);var pd=[];function fd(t,e,n,r){Op(n)||(n&&(pd[0]=n.toString()),n=pd);for(var i=0;i<n.length;i++){var o=qf(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function dd(t){nf(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Bf(t)}),t),t.a={}}function yd(){}ld.prototype.G=function(){ld.N.G.call(this),dd(this)},ld.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var vd=new zf;function gd(t){Nf.call(this,"serverreachability",t)}function md(t){vd.dispatchEvent(new gd(vd,t))}function _d(t){Nf.call(this,"statevent",t)}function bd(t){vd.dispatchEvent(new _d(vd,t))}function wd(t){Nf.call(this,"timingevent",t)}function Ed(t,e){if("function"!=Pp(t))throw Error("Fn must not be null and must be a function");return Np.setTimeout((function(){t()}),e)}Wp(gd,Nf),Wp(_d,Nf),Wp(wd,Nf);var Td={NO_ERROR:0,gb:1,nb:2,mb:3,jb:4,lb:5,ob:6,La:7,TIMEOUT:8,rb:9},Cd={ib:"complete",vb:"success",Ma:"error",La:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",kb:"downloadprogress",wb:"uploadprogress"};function Sd(){}function Id(){}Sd.prototype.a=null;var Nd,Ad={OPEN:"a",hb:"b",Ma:"c",qb:"d"};function Dd(){Nf.call(this,"d")}function kd(){Nf.call(this,"c")}function Rd(){}function Pd(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new ld(this),this.O=Od,this.P=new ad(t=ff?125:void 0),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}Wp(Dd,Nf),Wp(kd,Nf),Wp(Rd,Sd),Nd=new Rd;var Od=45e3,xd={},Ld={};function Md(t,e,n){t.F=1,t.f=sy(ty(e)),t.l=n,t.H=!0,Ud(t,null)}function Fd(t,e,n,r){t.F=1,t.f=sy(ty(e)),t.l=null,t.H=n,Ud(t,r)}function Ud(t,e){t.v=jp(),Bd(t),t.D=ty(t.f),ay(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new cd(Vp(t.Ja,t,t.a),t.J)),fd(t.I,t.a,"readystatechange",t.cb),e=t.h?rf(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),md(1)}function qd(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Vd(t,n);if(i==Ld){4==e&&(t.c=4,bd(14),r=!1);break}if(i==xd){t.c=4,bd(15),r=!1;break}Hd(t,i)}4==e&&0==n.length&&(t.c=1,bd(16),r=!1),t.b=t.b&&r,r||(Kd(t),Qd(t))}function Vd(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Ld:(n=Number(e.substring(n,r)),isNaN(n)?xd:(r+=1)+n>e.length?Ld:(e=e.substr(r,n),t.A=r+n,e))}function Bd(t){t.R=jp()+t.O,jd(t,t.O)}function jd(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=Ed(Vp(t.ab,t),e)}function Wd(t){t.i&&(Np.clearTimeout(t.i),t.i=null)}function Qd(t){t.g.Ca()||t.m||t.g.na(t)}function Kd(t){Wd(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,sd(t.P),dd(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Hd(t,e){try{t.g.Fa(t,e),md(4)}catch(t){}}function zd(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(xp(t)||Ap(t))Hp(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(xp(t)||Ap(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(Ap(t))return t.split("");if(xp(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Gd(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Gd)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Yd(t,e){Jd(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Xd(t))}function Xd(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Jd(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Jd(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Jd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(Cp=Pd.prototype).setTimeout=function(t){this.O=t},Cp.cb=function(t){t=t.target;var e=this.B;e&&3==Zy(t)?e.Ta():this.Ja(t)},Cp.Ja=function(t){try{if(t==this.a)t:{var e=Zy(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!ff&&!this.a.aa())){this.m||4!=e||7==n||md(8==n||r<=0?3:2),Wd(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=tv(this.a,"X-HTTP-Initial-Response");if(a&&!Yp(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,bd(12),Kd(this),Qd(this);break t}this.s=!0,Hd(this,s)}this.H?(qd(this,e,o),ff&&this.b&&3==e&&(fd(this.I,this.P,"tick",this.bb),this.P.start())):Hd(this,o),4==e&&Kd(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Bd(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,bd(12)):(this.c=0,bd(13)),Kd(this),Qd(this)}}}catch(t){}},Cp.bb=function(){if(this.a){var t=Zy(this.a),e=this.a.aa();this.A<e.length&&(Wd(this),qd(this,t,e),this.b&&4!=t&&Bd(this))}},Cp.cancel=function(){this.m=!0,Kd(this)},Cp.ab=function(){this.i=null;var t=jp();0<=t-this.R?(2!=this.F&&(md(3),bd(17)),Kd(this),this.c=2,Qd(this)):jd(this,this.R-t)},(Cp=Gd.prototype).C=function(){Xd(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},Cp.K=function(){return Xd(this),this.a.concat()},Cp.get=function(t,e){return Jd(this.b,t)?this.b[t]:e},Cp.set=function(t,e){Jd(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},Cp.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var $d=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Zd(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Zd?(this.h=void 0!==e?e:t.h,ey(this,t.f),this.j=t.j,ny(this,t.b),ry(this,t.i),this.a=t.a,iy(this,wy(t.c)),this.g=t.g):t&&(n=String(t).match($d))?(this.h=!!e,ey(this,n[1]||"",!0),this.j=uy(n[2]||""),ny(this,n[3]||"",!0),ry(this,n[4]),this.a=uy(n[5]||"",!0),iy(this,n[6]||"",!0),this.g=uy(n[7]||"")):(this.h=!!e,this.c=new vy(null,this.h))}function ty(t){return new Zd(t)}function ey(t,e,n){t.f=n?uy(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function ny(t,e,n){t.b=n?uy(e,!0):e}function ry(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function iy(t,e,n){e instanceof vy?(t.c=e,function(t,e){e&&!t.f&&(gy(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(my(this,e),by(this,n,t))}),t)),t.f=e}(t.c,t.h)):(n||(e=cy(e,dy)),t.c=new vy(e,t.h))}function oy(t,e,n){t.c.set(e,n)}function ay(t,e,n){Op(n)||(n=[String(n)]),by(t.c,e,n)}function sy(t){return oy(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^jp()).toString(36)),t}function uy(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function cy(t,e,n){return Ap(t)?(t=encodeURI(t).replace(e,hy),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function hy(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Zd.prototype.toString=function(){var t=[],e=this.f;e&&t.push(cy(e,ly,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(cy(e,ly,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(cy(n,"/"==n.charAt(0)?fy:py,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",cy(n,yy)),t.join("")},Zd.prototype.resolve=function(t){var e=ty(this),n=!!t.f;n?ey(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?ny(e,t.b):n=null!=t.i;var r=t.a;if(n)ry(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if($p(i,"./")||$p(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?iy(e,wy(t.c)):n=!!t.g,n&&(e.g=t.g),e};var ly=/[#\/\?@]/g,py=/[#\?:]/g,fy=/[#\?]/g,dy=/[#\?@]/g,yy=/#/g;function vy(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function gy(t){t.a||(t.a=new Gd,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function my(t,e){gy(t),e=Ey(t,e),Jd(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Yd(t.a,e))}function _y(t,e){return gy(t),e=Ey(t,e),Jd(t.a.b,e)}function by(t,e,n){my(t,e),0<n.length&&(t.c=null,t.a.set(Ey(t,e),Gp(n)),t.b+=n.length)}function wy(t){var e=new vy;return e.c=t.c,t.a&&(e.a=new Gd(t.a),e.b=t.b),e}function Ey(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Ty(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Cy(t){var e=t.a.F.a;if(null!=e)bd(4),e?(bd(10),pv(t.a,t,!1)):(bd(11),pv(t.a,t,!0));else{t.b=new Pd(t,void 0,void 0),t.b.h=t.h,e=gv(e=t.a,e.Y()?t.f:null,t.i),bd(4),ay(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&oy(e,n,r),Fd(t.b,e,!1,t.f)}}function Sy(){this.a=this.b=null}function Iy(){this.a=new Gd}function Ny(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Mp]||(t[Mp]=++Fp)):e.charAt(0)+t}function Ay(t,e){this.b=t,this.a=e}function Dy(t){this.g=t||ky,t=Np.PerformanceNavigationTiming?0<(t=Np.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Np.ka&&Np.ka.Da&&Np.ka.Da()&&Np.ka.Da().yb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Iy),this.b=null,this.c=[]}(Cp=vy.prototype).add=function(t,e){gy(this),this.c=null,t=Ey(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},Cp.forEach=function(t,e){gy(this),this.a.forEach((function(n,r){Hp(n,(function(n){t.call(e,n,r,this)}),this)}),this)},Cp.K=function(){gy(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},Cp.C=function(t){gy(this);var e=[];if(Ap(t))_y(this,t)&&(e=zp(e,this.a.get(Ey(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=zp(e,t[n])}return e},Cp.set=function(t,e){return gy(this),this.c=null,_y(this,t=Ey(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},Cp.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},Cp.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Wp((function(){}),(function(){})),(Cp=Ty.prototype).M=null,Cp.$=function(t){return this.a.$(t)},Cp.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},Cp.Ca=function(){return!1},Cp.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=tv(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=tv(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void yv(e,2)}this.f=r[0]}else(e=this.a).m=this.c,yv(e,2)}else 1==this.M&&(this.g?bd(6):"11111"==e?(bd(5),this.g=!0,(!lf||10<=Number(bf))&&(this.c=200,this.b.cancel(),bd(11),pv(this.a,this,!0))):(bd(7),this.g=!1))},Cp.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Cy(this)):1==this.M&&(this.g?(bd(11),pv(this.a,this,!0)):(bd(10),pv(this.a,this,!1)));else{0==this.M?bd(8):1==this.M&&bd(9);var t=this.a;t.m=this.c,yv(t,2)}},Cp.Y=function(){return this.a.Y()},Cp.ma=function(){return this.a.ma()},Iy.prototype.add=function(t){this.a.set(Ny(t),t)},Iy.prototype.C=function(){return this.a.C()};var ky=10;function Ry(t,e){!t.a&&($p(e,"spdy")||$p(e,"quic")||$p(e,"h2"))&&(t.f=t.g,t.a=new Iy,t.b&&(Ly(t,t.b),t.b=null))}function Py(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Oy(t){return t.b?1:t.a?t.a.a.c:0}function xy(t,e){return t.b?t.b==e:!!t.a&&(e=Ny(e),Jd(t.a.a.b,e))}function Ly(t,e){t.a?t.a.add(e):t.b=e}function My(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=Ny(e),n=Jd(t.a.a.b,n)),n&&Yd(t.a.a,Ny(e)))}function Fy(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Gp(t.c);var e=t.c;return Hp(t.a.C(),(function(t){e=e.concat(t.j)})),e}function Uy(){}function qy(){this.a=new Uy}function Vy(t,e,n){var r=n||"";try{zd(t,(function(t,n){var i=t;Lp(t)&&(i=Yf(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function By(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Dy.prototype.cancel=function(){this.c=Fy(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Hp(this.a.C(),(function(t){t.cancel()})),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},Uy.prototype.stringify=function(t){return Np.JSON.stringify(t,void 0)},Uy.prototype.parse=function(t){return Np.JSON.parse(t,void 0)};var jy=Np.JSON.parse;function Wy(t){zf.call(this),this.headers=new Gd,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Qy,this.D=this.F=!1}Wp(Wy,zf);var Qy="",Ky=/^https?$/i,Hy=["POST","PUT"];function zy(t){return"content-type"==t.toLowerCase()}function Gy(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Yy(t),Jy(t)}function Yy(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Xy(t){if(t.b&&void 0!==Ip&&(!t.s[1]||4!=Zy(t)||2!=t.T()))if(t.l&&4==Zy(t))ud(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==Zy(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match($d)[1]||null;if(!o&&Np.self&&Np.self.location){var a=Np.self.location.protocol;o=a.substr(0,a.length-1)}i=!Ky.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var s=2<Zy(t)?t.a.statusText:""}catch(t){s=""}t.f=s+" ["+t.T()+"]",Yy(t)}}finally{Jy(t)}}}function Jy(t,e){if(t.a){$y(t);var n=t.a,r=t.s[0]?Rp:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function $y(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(Np.clearTimeout(t.m),t.m=null)}function Zy(t){return t.a?t.a.readyState:0}function tv(t,e){return t.a?t.a.getResponseHeader(e):null}function ev(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return nf(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),Ap(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return oy(t,e,n),t}function nv(t){this.f=[],this.F=new Sy,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!kp("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=kp("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=kp("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=kp("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=kp("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.zb||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new Dy(t&&t.concurrentRequestLimit),this.ja=new qy,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function rv(t){if(iv(t),3==t.u){var e=t.P++,n=ty(t.B);oy(n,"SID",t.H),oy(n,"RID",e),oy(n,"TYPE","terminate"),uv(t,n),(e=new Pd(t,e,void 0)).F=2,e.f=sy(ty(n)),n=!1,Np.navigator&&Np.navigator.sendBeacon&&(n=Np.navigator.sendBeacon(e.f.toString(),"")),!n&&Np.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=jp(),Bd(e)}vv(t)}function iv(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(Np.clearTimeout(t.l),t.l=null),fv(t),t.b.cancel(),t.h&&(Dp(t.h)&&Np.clearTimeout(t.h),t.h=null)}function ov(t,e){t.f.push(new Ay(t.Qa++,e)),3==t.u&&av(t)}function av(t){Py(t.b)||t.h||(t.h=!0,nd(t.Ha,t),t.A=0)}function sv(t,e){var n;n=e?e.W:t.P++;var r=ty(t.B);oy(r,"SID",t.H),oy(r,"RID",n),oy(r,"AID",t.O),uv(t,r),t.g&&t.i&&ev(r,t.g,t.i),n=new Pd(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=cv(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Ly(t.b,n),Md(n,r,e)}function uv(t,e){t.c&&zd({},(function(t,n){oy(e,n,t)}))}function cv(t,e,n){n=Math.min(t.f.length,n);var r=t.c?Vp(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?a.push("ofs="+(o=i[0].b)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Vy(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function hv(t){t.a||t.l||(t.S=1,nd(t.Ga,t),t.v=0)}function lv(t){return!(t.a||t.l||3<=t.v||(t.S++,t.l=Ed(Vp(t.Ga,t),dv(t,t.v)),t.v++,0))}function pv(t,e,n){var r=e.l;r&&Ry(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=gv(t,null,t.ha),av(t)}function fv(t){null!=t.s&&(Np.clearTimeout(t.s),t.s=null)}function dv(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function yv(t,e){if(2==e){var n=null;t.c&&(n=null);var r=Vp(t.eb,t);n||(n=new Zd("//www.google.com/images/cleardot.gif"),Np.location&&"http"==Np.location.protocol||ey(n,"https"),sy(n)),function(t,e){var n=new yd;if(Np.Image){var r=new Image;r.onload=Bp(By,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Bp(By,n,r,"TestLoadImage: error",!1,e),r.onabort=Bp(By,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Bp(By,n,r,"TestLoadImage: timeout",!1,e),Np.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else bd(2);t.u=0,t.c&&t.c.ta(e),vv(t),iv(t)}function vv(t){t.u=0,t.m=-1,t.c&&(0==Fy(t.b).length&&0==t.f.length||(t.b.c.length=0,Gp(t.f),t.f.length=0),t.c.sa())}function gv(t,e,n){var r=function(t){return t instanceof Zd?ty(t):new Zd(t,void 0)}(n);if(""!=r.b)e&&ny(r,e+"."+r.b),ry(r,r.i);else{var i=Np.location;r=function(t,e,n,r){var i=new Zd(null,void 0);return t&&ey(i,t),e&&ny(i,e),n&&ry(i,n),r&&(i.a=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&nf(t.V,(function(t,e){oy(r,e,t)})),n=t.I,(e=t.j)&&n&&oy(r,e,n),oy(r,"VER",t.wa),uv(t,r),r}function mv(){}function _v(){if(lf&&!(10<=Number(bf)))throw Error("Environmental error: no available transport.")}function bv(t,e){zf.call(this),this.a=new nv(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!Yp(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Yp(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new Tv(this)}function wv(t){Dd.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ev(){kd.call(this),this.status=1}function Tv(t){this.a=t}(Cp=Wy.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=function(t){var e;return(e=t.a)||(e=t.a={}),e}(this.H?this.H:Nd),this.a.onreadystatechange=Vp(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Gy(this,t)}t=n||"";var i=new Gd(this.headers);r&&zd(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=zy,n=t.length,r=Ap(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:Ap(t)?t.charAt(e):t[e]}(i.K()),n=Np.FormData&&t instanceof Np.FormData,0<=Kp(Hy,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{$y(this),0<this.o&&((this.D=function(t){return lf&&Ef(9)&&Dp(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=Vp(this.Ba,this)):this.m=ud(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Gy(this,t)}},Cp.Ba=function(){void 0!==Ip&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},Cp.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Jy(this))},Cp.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Jy(this,!0)),Wy.N.G.call(this)},Cp.Ea=function(){this.j||(this.w||this.l||this.g?Xy(this):this.Za())},Cp.Za=function(){Xy(this)},Cp.T=function(){try{return 2<Zy(this)?this.a.status:-1}catch(t){return-1}},Cp.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},Cp.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),jy(e)}},Cp.ya=function(){return this.h},Cp.Xa=function(){return Ap(this.f)?this.f:String(this.f)},(Cp=nv.prototype).wa=8,Cp.u=1,Cp.Ca=function(){return 0==this.u},Cp.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new Pd(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?af(r=rf(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&Ap(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=cv(this,n,e),oy(i=ty(this.B),"RID",t),oy(i,"CVER",22),this.o&&this.j&&oy(i,"X-HTTP-Session-Id",this.j),uv(this,i),this.g&&r&&ev(i,this.g,r),Ly(this.b,n),this.W?(oy(i,"$req",e),oy(i,"SID","null"),n.S=!0,Md(n,i,null)):Md(n,i,e),this.u=2}}else 3==this.u&&(t?sv(this,t):0==this.f.length||Py(this.b)||sv(this))},Cp.Ga=function(){this.l=null,this.a=new Pd(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=ty(this.pa);oy(t,"RID","rpc"),oy(t,"SID",this.H),oy(t,"CI",this.ia?"0":"1"),oy(t,"AID",this.O),uv(this,t),oy(t,"TYPE","xmlhttp"),this.g&&this.i&&ev(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Fd(this.a,t,!0,this.ga)},Cp.Fa=function(t,e){if(0!=this.u&&(this.a==t||xy(this.b,t)))if(this.m=t.o,!t.s&&xy(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(Op(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;fv(this),this.a.cancel(),this.a=null}lv(this),bd(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=Ed(Vp(this.Ya,this),6e3));if(Oy(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else yv(this,11)}else if(!t.s&&this.a!=t||fv(this),!Yp(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&Dp(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=tv(r,"X-Client-Wire-Protocol"))&&Ry(this.b,i),this.j&&(r=tv(r,"X-HTTP-Session-Id")))&&(this.I=r,oy(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=gv(this,this.Y()?this.ga:null,this.ha),r.s?(My(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Wd(r),Bd(r)),this.a=r):hv(this),0<this.f.length&&av(this)}else"stop"!=r[0]&&"close"!=r[0]||yv(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?yv(this,7):rv(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},Cp.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,lv(this),bd(19))},Cp.na=function(t){var e=null;if(this.a==t){fv(this),this.a=null;var n=2}else{if(!xy(this.b,t))return;e=t.j,My(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=jp()-t.v,vd.dispatchEvent(new wd(vd,t.l?t.l.length:0,e,this.A)),av(this)):hv(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(Oy(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa)||(t.h=Ed(Vp(t.Ha,t,e),dv(t,t.A)),t.A++,0)))}(this,t)||2==n&&lv(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:yv(this,5);break;case 4:yv(this,10);break;case 3:yv(this,6);break;default:yv(this,2)}}},Cp.eb=function(t){bd(t?2:1)},Cp.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Wy(this.Ka)).F=this.R,t},Cp.ma=function(){return!!this.c&&!0},Cp.Y=function(){return this.R},(Cp=mv.prototype).va=function(){},Cp.ua=function(){},Cp.ta=function(){},Cp.sa=function(){},Cp.Sa=function(){},_v.prototype.a=function(t,e){return new bv(t,e)},Wp(bv,zf),(Cp=bv.prototype).addEventListener=function(t,e,n,r){bv.N.addEventListener.call(this,t,e,n,r)},Cp.removeEventListener=function(t,e,n,r){bv.N.removeEventListener.call(this,t,e,n,r)},Cp.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;bd(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Ty(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=ev(e,t.g,t.i)),(t=t.w).i=n,e=gv(t.a,null,t.i),bd(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Cy(t)):(ay(e,"MODE","init"),!t.a.o&&t.a.j&&ay(e,"X-HTTP-Session-Id",t.a.j),t.b=new Pd(t,void 0,void 0),t.b.h=t.h,Fd(t.b,e,!1,null),t.M=0)},Cp.close=function(){rv(this.a)},Cp.Wa=function(t){if(Ap(t)){var e={};e.__data__=t,ov(this.a,e)}else this.h?((e={}).__data__=Yf(t),ov(this.a,e)):ov(this.a,t)},Cp.G=function(){this.a.c=null,delete this.f,rv(this.a),delete this.a,bv.N.G.call(this)},Wp(wv,Dd),Wp(Ev,kd),Wp(Tv,mv),Tv.prototype.va=function(){this.a.dispatchEvent("a")},Tv.prototype.ua=function(t){this.a.dispatchEvent(new wv(t))},Tv.prototype.ta=function(t){this.a.dispatchEvent(new Ev(t))},Tv.prototype.sa=function(){this.a.dispatchEvent("b")};var Cv=Bp((function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r}),_v);_v.prototype.createWebChannel=_v.prototype.a,bv.prototype.send=bv.prototype.Wa,bv.prototype.open=bv.prototype.Va,bv.prototype.close=bv.prototype.close,Td.NO_ERROR=0,Td.TIMEOUT=8,Td.HTTP_ERROR=6,Cd.COMPLETE="complete",(Id.EventType=Ad).OPEN="a",Ad.CLOSE="b",Ad.ERROR="c",Ad.MESSAGE="d",zf.prototype.listen=zf.prototype.za,Wy.prototype.listenOnce=Wy.prototype.Aa,Wy.prototype.getLastError=Wy.prototype.Xa,Wy.prototype.getLastErrorCode=Wy.prototype.ya,Wy.prototype.getStatus=Wy.prototype.T,Wy.prototype.getResponseJson=Wy.prototype.Ua,Wy.prototype.getResponseText=Wy.prototype.aa,Wy.prototype.send=Wy.prototype.ca;var Sv,Iv,Nv={createWebChannelTransport:Cv,ErrorCode:Td,EventType:Cd,WebChannel:Id,XhrIo:Wy},Av=Nv.createWebChannelTransport,Dv=Nv.ErrorCode,kv=Nv.EventType,Rv=Nv.WebChannel,Pv=Nv.XhrIo,Ov=Ps.SDK_VERSION,xv=new ys("@firebase/firestore");function Lv(){return xv.logLevel===ss.DEBUG?Sv.DEBUG:xv.logLevel===ss.SILENT?Sv.SILENT:Sv.ERROR}function Mv(t){switch(t){case Sv.DEBUG:xv.logLevel=ss.DEBUG;break;case Sv.ERROR:xv.logLevel=ss.ERROR;break;case Sv.SILENT:xv.logLevel=ss.SILENT;break;default:xv.error("Firestore ("+Ov+"): Invalid value passed to `setLogLevel`")}}function Fv(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(xv.logLevel<=ss.DEBUG){var i=n.map(qv);xv.debug.apply(xv,ga(["Firestore ("+Ov+") ["+t+"]: "+e],i))}}function Uv(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(xv.logLevel<=ss.ERROR){var r=e.map(qv);xv.error.apply(xv,ga(["Firestore ("+Ov+"): "+t],r))}}function qv(t){if("string"==typeof t)return t;var e=jv.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}function Vv(t){var e="FIRESTORE ("+Ov+") INTERNAL ASSERTION FAILED: "+t;throw Uv(e),new Error(e)}function Bv(t,e){t||Vv(e)}(Iv=Sv=Sv||{})[Iv.DEBUG=0]="DEBUG",Iv[Iv.ERROR=1]="ERROR",Iv[Iv.SILENT=2]="SILENT";var jv=(Wv.setPlatform=function(t){Wv.platform&&Vv("Platform already defined"),Wv.platform=t},Wv.getPlatform=function(){return Wv.platform||Vv("Platform not set"),Wv.platform},Wv);function Wv(){}function Qv(){return jv.getPlatform().emptyByteString}var Kv,Hv={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},zv=(ha(Gv,Kv=Error),Gv);function Gv(t,e){var n=Kv.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Yv(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new zv(Hv.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Xv(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Jv(t,e){return void 0!==t?t:e}function $v(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Zv(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function tg(t){for(var e in Bv(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function eg(t,e){if(0!==e.length)throw new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+mg(e.length,"argument")+".")}function ng(t,e,n){if(e.length!==n)throw new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() requires "+mg(n,"argument")+", but was called with "+mg(e.length,"argument")+".")}function rg(t,e,n){if(e.length<n)throw new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() requires at least "+mg(n,"argument")+", but was called with "+mg(e.length,"argument")+".")}function ig(t,e,n,r){if(e.length<n||e.length>r)throw new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+mg(e.length,"argument")+".")}function og(t,e,n,r){hg(t,e,gg(n)+" argument",r)}function ag(t,e,n,r){void 0!==r&&og(t,e,n,r)}function sg(t,e,n,r){hg(t,e,n+" option",r)}function ug(t,e,n,r){void 0!==r&&sg(t,e,n,r)}function cg(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(pg(u))}var c=pg(r);throw new zv(Hv.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function hg(t,e,n,r){if(!("object"===e?lg(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=pg(r);throw new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function lg(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function pg(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Vv("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function fg(t,e,n){if(void 0===n)throw new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+gg(e)+" argument, but it was undefined.")}function dg(t,e,n){Zv(e,(function(e,r){if(n.indexOf(e)<0)throw new zv(Hv.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function yg(t,e,n,r){var i=pg(r);return new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() requires its "+gg(n)+" argument to be a "+e+", but it was: "+i)}function vg(t,e,n){if(n<=0)throw new zv(Hv.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+gg(e)+" argument to be a positive number, but it was: "+n+".")}function gg(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function mg(t,e){return t+" "+e+(1===t?"":"s")}var _g=(bg.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Bv(20===e.length,"Invalid auto ID: "+e),e},bg);function bg(){}function wg(t,e){return t<e?-1:e<t?1:0}function Eg(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Tg(t){return t+"\0"}function Cg(){if("undefined"==typeof Uint8Array)throw new zv(Hv.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Sg(){if(!jv.getPlatform().base64Available)throw new zv(Hv.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ig=(Ng.fromBase64String=function(t){ng("Blob.fromBase64String",arguments,1),og("Blob.fromBase64String","string",1,t),Sg();try{return new Ng(jv.getPlatform().atob(t))}catch(t){throw new zv(Hv.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Ng.fromUint8Array=function(t){if(ng("Blob.fromUint8Array",arguments,1),Cg(),!(t instanceof Uint8Array))throw yg("Blob.fromUint8Array","Uint8Array",1,t);return new Ng(Array.prototype.map.call(t,(function(t){return String.fromCharCode(t)})).join(""))},Ng.prototype.toBase64=function(){return ng("Blob.toBase64",arguments,0),Sg(),jv.getPlatform().btoa(this._binaryString)},Ng.prototype.toUint8Array=function(){ng("Blob.toUint8Array",arguments,0),Cg();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},Ng.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Ng.prototype.isEqual=function(t){return this._binaryString===t._binaryString},Ng.prototype._compareTo=function(t){return wg(this._binaryString,t._binaryString)},Ng);function Ng(t){Sg(),this._binaryString=t}var Ag=Yv(Ig,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Dg=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},kg="(default)",Rg=(Object.defineProperty(Pg.prototype,"isDefaultDatabase",{get:function(){return this.database===kg},enumerable:!0,configurable:!0}),Pg.prototype.isEqual=function(t){return t instanceof Pg&&t.projectId===this.projectId&&t.database===this.database},Pg.prototype.compareTo=function(t){return wg(this.projectId,t.projectId)||wg(this.database,t.database)},Pg);function Pg(t,e){this.projectId=t,this.database=e||kg}var Og=(xg.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},xg.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},xg.INVALID=-1,xg);function xg(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var Lg="__name__",Mg=(Object.defineProperty(Fg.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),Fg.prototype.isEqual=function(t){return 0===Fg.comparator(this,t)},Fg.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Fg?t.forEach((function(t){e.push(t)})):e.push(t),this.construct(e)},Fg.prototype.limit=function(){return this.offset+this.length},Fg.prototype.popFirst=function(t){return Bv(this.length>=(t=void 0===t?1:t),"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},Fg.prototype.popLast=function(){return Bv(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},Fg.prototype.firstSegment=function(){return Bv(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},Fg.prototype.lastSegment=function(){return this.get(this.length-1)},Fg.prototype.get=function(t){return Bv(t<this.length,"Index out of range"),this.segments[this.offset+t]},Fg.prototype.isEmpty=function(){return 0===this.length},Fg.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Fg.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Fg.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Fg.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},Fg.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Fg);function Fg(t,e,n){void 0===e?e=0:e>t.length&&Vv("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Vv("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var Ug,qg=(ha(Vg,Ug=Mg),Vg.prototype.construct=function(t,e,n){return new Vg(t,e,n)},Vg.prototype.canonicalString=function(){return this.toArray().join("/")},Vg.prototype.toString=function(){return this.canonicalString()},Vg.fromString=function(t){if(0<=t.indexOf("//"))throw new zv(Hv.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Vg(t.split("/").filter((function(t){return 0<t.length})))},Vg.EMPTY_PATH=new Vg([]),Vg);function Vg(){return null!==Ug&&Ug.apply(this,arguments)||this}var Bg,jg=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Wg=(ha(Qg,Bg=Mg),Qg.prototype.construct=function(t,e,n){return new Qg(t,e,n)},Qg.isValidIdentifier=function(t){return jg.test(t)},Qg.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Qg.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},Qg.prototype.toString=function(){return this.canonicalString()},Qg.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===Lg},Qg.keyField=function(){return new Qg([Lg])},Qg.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new zv(Hv.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new zv(Hv.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new zv(Hv.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new zv(Hv.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Qg(e)},Qg.EMPTY_PATH=new Qg([]),Qg);function Qg(){return null!==Bg&&Bg.apply(this,arguments)||this}var Kg=(Hg.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Hg.prototype.isEqual=function(t){return null!==t&&0===qg.comparator(this.path,t.path)},Hg.prototype.toString=function(){return this.path.toString()},Hg.comparator=function(t,e){return qg.comparator(t.path,e.path)},Hg.isDocumentKey=function(t){return t.length%2==0},Hg.fromSegments=function(t){return new Hg(new qg(t.slice()))},Hg.fromPathString=function(t){return new Hg(qg.fromString(t))},Hg.EMPTY=new Hg(new qg([])),Hg);function Hg(t){this.path=t,Bv(Hg.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var zg,Gg,Yg=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))};(Gg=zg=zg||{}).All="all",Gg.ListenStreamIdle="listen_stream_idle",Gg.ListenStreamConnectionBackoff="listen_stream_connection_backoff",Gg.WriteStreamIdle="write_stream_idle",Gg.WriteStreamConnectionBackoff="write_stream_connection_backoff",Gg.OnlineStateTimeout="online_state_timeout",Gg.ClientMetadataRefresh="client_metadata_refresh",Gg.LruGarbageCollection="lru_garbage_collection",Gg.RetryTransaction="retry_transaction";var Xg=(Jg.createAndSchedule=function(t,e,n,r,i){var o=new Jg(t,e,Date.now()+n,r,i);return o.start(n),o},Jg.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},Jg.prototype.skipDelay=function(){return this.handleDelayElapsed()},Jg.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new zv(Hv.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Jg.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},Jg.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Jg);function Jg(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Yg,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}var $g=(Object.defineProperty(Zg.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),Zg.prototype.enqueueAndForget=function(t){this.enqueue(t)},Zg.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},Zg.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},Zg.prototype.enqueueAndInitiateShutdown=function(t){return pa(this,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},Zg.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise((function(t){})):this.enqueueInternal(t)},Zg.prototype.enqueueInternal=function(t){var e=this,n=this.tail.then((function(){return e.operationInProgress=!0,t().catch((function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw Uv("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout((function(){throw t}),0),t})).then((function(t){return e.operationInProgress=!1,t}))}));return this.tail=n},Zg.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Bv(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.timerIdsToSkip.indexOf(t)&&(e=0);var i=Xg.createAndSchedule(this,t,e,n,(function(t){return r.removeDelayedOperation(t)}));return this.delayedOperations.push(i),i},Zg.prototype.verifyNotFailed=function(){this.failure&&Vv("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},Zg.prototype.verifyOperationInProgress=function(){Bv(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},Zg.prototype.drain=function(){return this.enqueueEvenAfterShutdown((function(){return Promise.resolve()}))},Zg.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Zg.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then((function(){Bv(t===zg.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==zg.All&&i.timerId===t)break}return e.drain()}))},Zg.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},Zg.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Bv(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},Zg);function Zg(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}var tm="",em="",nm="",rm="";function im(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=am(e)),e=om(t.get(n),e);return am(e)}function om(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=tm+nm;break;case tm:n+=tm+rm;break;default:n+=o}}return n}function am(t){return t+tm+em}function sm(t){var e=t.length;if(Bv(2<=e,"Invalid path "+t),2===e)return Bv(t.charAt(0)===tm&&t.charAt(1)===em,"Non-empty path "+t+" had length 2"),qg.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(tm,o);switch((a<0||n<a)&&Vv('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case em:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case nm:i+=t.substring(o,a),i+="\0";break;case rm:i+=t.substring(o,a+1);break;default:Vv('Invalid encoded resource path: "'+t+'"')}o=a+2}return new qg(r)}var um=(cm.now=function(){return cm.fromMillis(Date.now())},cm.fromDate=function(t){return cm.fromMillis(t.getTime())},cm.fromMillis=function(t){var e=Math.floor(t/1e3);return new cm(e,1e6*(t-1e3*e))},cm.prototype.toDate=function(){return new Date(this.toMillis())},cm.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},cm.prototype._compareTo=function(t){return this.seconds===t.seconds?wg(this.nanoseconds,t.nanoseconds):wg(this.seconds,t.seconds)},cm.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},cm.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},cm);function cm(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new zv(Hv.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new zv(Hv.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new zv(Hv.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new zv(Hv.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var hm=(lm.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new lm(new um(e,t%1e6*1e3))},lm.fromTimestamp=function(t){return new lm(t)},lm.forDeletedDoc=function(){return lm.MIN},lm.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},lm.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},lm.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},lm.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},lm.prototype.toTimestamp=function(){return this.timestamp},lm.MIN=new lm(new um(0,0)),lm);function lm(t){this.timestamp=t}var pm=(fm.prototype.insert=function(t,e){return new fm(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,vm.BLACK,null,null))},fm.prototype.remove=function(t){return new fm(this.comparator,this.root.remove(t,this.comparator).copy(null,null,vm.BLACK,null,null))},fm.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},fm.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},fm.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(fm.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),fm.prototype.minKey=function(){return this.root.minKey()},fm.prototype.maxKey=function(){return this.root.maxKey()},fm.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},fm.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},fm.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},fm.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},fm.prototype.getIterator=function(){return new dm(this.root,null,this.comparator,!1)},fm.prototype.getIteratorFrom=function(t){return new dm(this.root,t,this.comparator,!1)},fm.prototype.getReverseIterator=function(){return new dm(this.root,null,this.comparator,!0)},fm.prototype.getReverseIteratorFrom=function(t){return new dm(this.root,t,this.comparator,!0)},fm);function fm(t,e){this.comparator=t,this.root=e||vm.EMPTY}var dm=(ym.prototype.getNext=function(){Bv(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},ym.prototype.hasNext=function(){return 0<this.nodeStack.length},ym.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},ym);function ym(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var vm=(gm.prototype.copy=function(t,e,n,r,i){return new gm(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},gm.prototype.isEmpty=function(){return!1},gm.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},gm.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},gm.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},gm.prototype.minKey=function(){return this.min().key},gm.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},gm.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},gm.prototype.removeMin=function(){if(this.left.isEmpty())return gm.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},gm.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return gm.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},gm.prototype.isRed=function(){return this.color},gm.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},gm.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},gm.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},gm.prototype.rotateLeft=function(){var t=this.copy(null,null,gm.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},gm.prototype.rotateRight=function(){var t=this.copy(null,null,gm.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},gm.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},gm.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},gm.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Vv("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Vv("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Vv("Black depths differ");return t+(this.isRed()?0:1)},gm.EMPTY=null,gm.RED=!0,gm.BLACK=!1,gm);function gm(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:gm.RED,this.left=null!=r?r:gm.EMPTY,this.right=null!=i?i:gm.EMPTY,this.size=this.left.size+1+this.right.size}var mm=(Object.defineProperty(_m.prototype,"key",{get:function(){throw Vv("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(_m.prototype,"value",{get:function(){throw Vv("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(_m.prototype,"color",{get:function(){throw Vv("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(_m.prototype,"left",{get:function(){throw Vv("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(_m.prototype,"right",{get:function(){throw Vv("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),_m.prototype.copy=function(t,e,n,r,i){return this},_m.prototype.insert=function(t,e,n){return new vm(t,e)},_m.prototype.remove=function(t,e){return this},_m.prototype.isEmpty=function(){return!0},_m.prototype.inorderTraversal=function(t){return!1},_m.prototype.reverseTraversal=function(t){return!1},_m.prototype.minKey=function(){return null},_m.prototype.maxKey=function(){return null},_m.prototype.isRed=function(){return!1},_m.prototype.checkMaxDepth=function(){return!0},_m.prototype.check=function(){return 0},_m);function _m(){this.size=0}vm.EMPTY=new mm;var bm=(wm.fromMapKeys=function(t){var e=new wm(t.comparator);return t.forEach((function(t){e=e.add(t)})),e},wm.prototype.has=function(t){return null!==this.data.get(t)},wm.prototype.first=function(){return this.data.minKey()},wm.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(wm.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),wm.prototype.indexOf=function(t){return this.data.indexOf(t)},wm.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},wm.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},wm.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},wm.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},wm.prototype.getIterator=function(){return new Em(this.data.getIterator())},wm.prototype.getIteratorFrom=function(t){return new Em(this.data.getIteratorFrom(t))},wm.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},wm.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},wm.prototype.isEmpty=function(){return this.data.isEmpty()},wm.prototype.unionWith=function(t){var e=this;return t.forEach((function(t){e=e.add(t)})),e},wm.prototype.isEqual=function(t){if(!(t instanceof wm))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},wm.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},wm.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},wm.prototype.copy=function(t){var e=new wm(this.comparator);return e.data=t,e},wm);function wm(t){this.comparator=t,this.data=new pm(this.comparator)}var Em=(Tm.prototype.getNext=function(){return this.iter.getNext().key},Tm.prototype.hasNext=function(){return this.iter.hasNext()},Tm);function Tm(t){this.iter=t}var Cm=new pm(Kg.comparator);function Sm(){return Cm}function Im(){return Sm()}var Nm=new pm(Kg.comparator);function Am(){return Nm}var Dm=new pm(Kg.comparator);function km(){return Dm}var Rm=new bm(Kg.comparator);function Pm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Rm,r=0,i=t;r<i.length;r++)n=n.add(i[r]);return n}var Om=new bm(wg);function xm(){return Om}var Lm=(Mm.prototype.applyToRemoteDocument=function(t,e,n){e&&Bv(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Bv(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=o.applyToRemoteDocument(e,r[i]))}return e},Mm.prototype.applyToLocalView=function(t,e){e&&Bv(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},Mm.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))})),n},Mm.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Pm())},Mm.prototype.isEqual=function(t){return this.batchId===t.batchId&&Eg(this.mutations,t.mutations)&&Eg(this.baseMutations,t.baseMutations)},Mm);function Mm(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Bv(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var Fm=(Um.from=function(t,e,n,r){Bv(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=km(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new Um(t,e,n,r,i)},Um);function Um(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var qm=(Vm.prototype.catch=function(t){return this.next(void 0,t)},Vm.prototype.next=function(t,e){var n=this;return this.callbackAttached&&Vv("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Vm((function(r,i){n.nextCallback=function(e){n.wrapSuccess(t,e).next(r,i)},n.catchCallback=function(t){n.wrapFailure(e,t).next(r,i)}}))},Vm.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},Vm.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Vm?e:Vm.resolve(e)}catch(t){return Vm.reject(t)}},Vm.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):Vm.resolve(e)},Vm.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):Vm.reject(e)},Vm.resolve=function(t){return new Vm((function(e,n){e(t)}))},Vm.reject=function(t){return new Vm((function(e,n){n(t)}))},Vm.waitFor=function(t){return new Vm((function(e,n){var r=0,i=0,o=!1;t.forEach((function(t){++r,t.next((function(){++i,o&&i===r&&e()}),(function(t){return n(t)}))})),o=!0,i===r&&e()}))},Vm.or=function(t){for(var e=Vm.resolve(!1),n=function(t){e=e.next((function(e){return e?Vm.resolve(e):t()}))},r=0,i=t;r<i.length;r++)n(i[r]);return e},Vm.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},Vm);function Vm(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}var Bm="SimpleDb",jm=(Wm.openOrCreate=function(t,e,n){return Bv(Wm.isAvailable(),"IndexedDB not supported in current environment."),Fv(Bm,"Opening database:",t),new qm((function(r,i){var o=window.indexedDB.open(t,e);o.onsuccess=function(t){r(new Wm(t.target.result))},o.onblocked=function(){i(new zv(Hv.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},o.onerror=function(t){var e=t.target.error;i("VersionError"===e.name?new zv(Hv.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):e)},o.onupgradeneeded=function(e){Fv(Bm,'Database "'+t+'" requires upgrade from version:',e.oldVersion),n.createOrUpgrade(e.target.result,o.transaction,e.oldVersion,hw).next((function(){Fv(Bm,"Database upgrade to version "+hw+" complete")}))}})).toPromise()},Wm.delete=function(t){return Fv(Bm,"Removing database:",t),Xm(window.indexedDB.deleteDatabase(t)).toPromise()},Wm.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Wm.isMockPersistence())return!0;if(void 0===window.navigator)return!1;var t=Aa(),e=Wm.getIOSVersion(t),n=0<e&&e<10,r=Wm.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Wm.isMockPersistence=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.USE_MOCK_PERSISTENCE)},Wm.getStore=function(t,e){return t.store(e)},Wm.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Wm.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Wm.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},Wm.prototype.runTransaction=function(t,e,n){return pa(this,void 0,void 0,(function(){var r,i,o,a,s,u;return fa(this,(function(c){switch(c.label){case 0:r=t.startsWith("readonly"),i=t.endsWith("idempotent"),o=0,a=function(){var t,a,u,c;return fa(this,(function(h){switch(h.label){case 0:++o,t=Hm.open(s.db,r?"readonly":"readwrite",e),h.label=1;case 1:return h.trys.push([1,3,,4]),(a=n(t).catch((function(e){return t.abort(e),qm.reject(e)})).toPromise()).catch((function(){})),[4,t.completionPromise];case 2:return h.sent(),[2,{value:a}];case 3:return u=h.sent(),Fv(Bm,"Transaction failed with error: %s. Retrying: %s.",u.message,c=i&&"FirebaseError"!==u.name&&o<3),c?[3,4]:[2,{value:Promise.reject(u)}];case 4:return[2]}}))},s=this,c.label=1;case 1:return[5,a()];case 2:return"object"==typeof(u=c.sent())?[2,u.value]:[3,1];case 3:return[2]}}))}))},Wm.prototype.close=function(){this.db.close()},Wm);function Wm(t){this.db=t,12.2===Wm.getIOSVersion(Aa())&&Uv("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var Qm=(Object.defineProperty(Km.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(Km.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(Km.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),Km.prototype.done=function(){this.shouldStop=!0},Km.prototype.skip=function(t){this.nextKey=t},Km.prototype.delete=function(){return Xm(this.dbCursor.delete())},Km);function Km(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var Hm=(zm.open=function(t,e,n){return new zm(t.transaction(n,e))},Object.defineProperty(zm.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),zm.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Fv(Bm,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},zm.prototype.store=function(t){var e=this.transaction.objectStore(t);return Bv(!!e,"Object store not part of transaction: "+t),new Gm(e)},zm);function zm(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Yg,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){var n=$m(t.target.error);e.completionDeferred.reject(n)}}var Gm=(Ym.prototype.put=function(t,e){return Xm(void 0!==e?(Fv(Bm,"PUT",this.store.name,t,e),this.store.put(e,t)):(Fv(Bm,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Ym.prototype.add=function(t){return Fv(Bm,"ADD",this.store.name,t,t),Xm(this.store.add(t))},Ym.prototype.get=function(t){var e=this;return Xm(this.store.get(t)).next((function(n){return void 0===n&&(n=null),Fv(Bm,"GET",e.store.name,t,n),n}))},Ym.prototype.delete=function(t){return Fv(Bm,"DELETE",this.store.name,t),Xm(this.store.delete(t))},Ym.prototype.count=function(){return Fv(Bm,"COUNT",this.store.name),Xm(this.store.count())},Ym.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,(function(t,e){r.push(e)})).next((function(){return r}))},Ym.prototype.deleteAll=function(t,e){Fv(Bm,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,(function(t,e,n){return n.delete()}))},Ym.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},Ym.prototype.iterateSerial=function(t){var e=this.cursor({});return new qm((function(n,r){e.onerror=function(t){var e=$m(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},Ym.prototype.iterateCursor=function(t,e){var n=[];return new qm((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Qm(i),a=e(i.primaryKey,i.value,o);if(a instanceof qm){var s=a.catch((function(t){return o.done(),qm.reject(t)}));n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}})).next((function(){return qm.waitFor(n)}))},Ym.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Bv(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},Ym.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Ym);function Ym(t){this.store=t}function Xm(t){return new qm((function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=$m(t.target.error);n(e)}}))}var Jm=!1;function $m(t){var e=jm.getIOSVersion(Aa());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new zv("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Jm||(Jm=!0,setTimeout((function(){throw r}),0)),r}}return t}var Zm,t_,e_=(n_.forUser=function(t,e,n,r){return Bv(""!==t.uid,"UserID must not be an empty string."),new n_(t.isAuthenticated()?t.uid:"",e,n,r)},n_.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return a_(t).iterate({index:mw.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},n_.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next((function(e){return e.lastStreamToken=o_(n),u_(t).put(e)}))},n_.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next((function(t){return t.lastStreamToken}))},n_.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next((function(n){return n.lastStreamToken=o_(e),u_(t).put(n)}))},n_.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=s_(t),a=a_(t);return a.add({}).next((function(s){Bv("number"==typeof s,"Auto-generated key is not a number");for(var u=new Lm(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u),h=[],l=new bm((function(t,e){return wg(t.canonicalString(),e.canonicalString())})),p=0,f=r;p<f.length;p++){var d=f[p],y=bw.key(i.userId,d.key.path,s);l=l.add(d.key.path.popLast()),h.push(a.put(c)),h.push(o.put(y,bw.PLACEHOLDER))}return l.forEach((function(e){h.push(i.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.documentKeysByBatchId[s]=u.keys()})),qm.waitFor(h).next((function(){return u}))}))},n_.prototype.lookupMutationBatch=function(t,e){var n=this;return a_(t).get(e).next((function(t){return t?(Bv(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null}))},n_.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?qm.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r}return null}))},n_.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return a_(t).iterate({index:mw.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Bv(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()})).next((function(){return o}))},n_.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return a_(t).iterate({index:mw.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},n_.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return a_(t).loadAll(mw.userMutationsIndex,n).next((function(t){return t.map((function(t){return e.serializer.fromDbMutationBatch(t)}))}))},n_.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=bw.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return s_(t).iterate({range:i},(function(r,i,a){var s=r[0],u=r[2],c=sm(r[1]);if(s===n.userId&&e.path.isEqual(c))return a_(t).get(u).next((function(t){if(!t)throw Vv("Dangling document-mutation reference found: "+r+" which points to "+u);Bv(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+u),o.push(n.serializer.fromDbMutationBatch(t))}));a.done()})).next((function(){return o}))},n_.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new bm(wg),i=[];return e.forEach((function(e){var o=bw.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=s_(t).iterate({range:a},(function(t,i,o){var a=t[0],s=t[2],u=sm(t[1]);a===n.userId&&e.path.isEqual(u)?r=r.add(s):o.done()}));i.push(s)})),qm.waitFor(i).next((function(){return n.lookupMutationBatches(t,r)}))},n_.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;Bv(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Bv(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=bw.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new bm(wg);return s_(t).iterate({range:a},(function(t,e,o){var a=t[0],u=t[2],c=sm(t[1]);a===n.userId&&r.isPrefixOf(c)?c.length===i&&(s=s.add(u)):o.done()})).next((function(){return n.lookupMutationBatches(t,s)}))},n_.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(a_(t).get(e).next((function(t){if(null===t)throw Vv("Dangling document-mutation reference found, which points to "+e);Bv(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))})))})),qm.waitFor(i).next((function(){return r}))},n_.prototype.removeMutationBatch=function(t,e){var n=this;return i_(t.simpleDbTransaction,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.removeCachedMutationKeys(e.batchId)})),qm.forEach(r,(function(e){return n.referenceDelegate.removeMutationReference(t,e)}))}))},n_.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},n_.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return qm.resolve();var r=IDBKeyRange.lowerBound(bw.prefixForUser(e.userId)),i=[];return s_(t).iterate({range:r},(function(t,n,r){if(t[0]===e.userId){var o=sm(t[1]);i.push(o)}else r.done()})).next((function(){Bv(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map((function(t){return t.canonicalString()})))}))}))},n_.prototype.containsKey=function(t,e){return r_(t,this.userId,e)},n_.prototype.getMutationQueueMetadata=function(t){var e=this;return u_(t).get(this.userId).next((function(t){return t||new vw(e.userId,-1,"")}))},n_);function n_(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function r_(t,e,n){var r=bw.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return s_(t).iterate({range:o,keysOnly:!0},(function(t,n,r){t[0]===e&&t[1]===i&&(a=!0),r.done()})).next((function(){return a}))}function i_(t,e,n){var r=t.store(mw.store),i=t.store(bw.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},(function(t,e,n){return s++,n.delete()}));o.push(u.next((function(){Bv(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var p=l[h],f=bw.key(e,p.key.path,n.batchId);o.push(i.delete(f)),c.push(p.key)}return qm.waitFor(o).next((function(){return c}))}function o_(t){return t instanceof Uint8Array?(Bv(jm.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function a_(t){return fE.getStore(t,mw.store)}function s_(t){return fE.getStore(t,bw.store)}function u_(t){return fE.getStore(t,vw.store)}(t_=Zm=Zm||{})[t_.QueryCache=0]="QueryCache",t_[t_.SyncEngine=1]="SyncEngine";var c_=(h_.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},h_.prototype.after=function(t){return this.seek(t+2),this.next()},h_.prototype.seek=function(t){Bv((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},h_.forTargetCache=function(){return new h_(Zm.QueryCache,2)},h_.forSyncEngine=function(){return new h_(Zm.SyncEngine)},h_);function h_(t,e){Bv((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var l_=(p_.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next((function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next((function(){return n.highestTargetId}))}))},p_.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next((function(t){return hm.fromTimestamp(new um(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},p_.prototype.getHighestSequenceNumber=function(t){return y_(t.simpleDbTransaction)},p_.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)}))},p_.prototype.addTargetData=function(t,e){var n=this;return this.saveTargetData(t,e).next((function(){return n.retrieveMetadata(t).next((function(r){return r.targetCount+=1,n.updateMetadataFromTargetData(e,r),n.saveMetadata(t,r)}))}))},p_.prototype.updateTargetData=function(t,e){return this.saveTargetData(t,e)},p_.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return f_(t).delete(e.targetId)})).next((function(){return n.retrieveMetadata(t)})).next((function(e){return Bv(0<e.targetCount,"Removing from an empty target cache"),e.targetCount-=1,n.saveMetadata(t,e)}))},p_.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return f_(t).iterate((function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return qm.waitFor(o)})).next((function(){return i}))},p_.prototype.forEachTarget=function(t,e){var n=this;return f_(t).iterate((function(t,r){var i=n.serializer.fromDbTarget(r);e(i)}))},p_.prototype.retrieveMetadata=function(t){return d_(t.simpleDbTransaction)},p_.prototype.saveMetadata=function(t,e){return function(t){return fE.getStore(t,Pw.store)}(t).put(Pw.key,e)},p_.prototype.saveTargetData=function(t,e){return f_(t).put(this.serializer.toDbTarget(e))},p_.prototype.updateMetadataFromTargetData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},p_.prototype.getTargetCount=function(t){return this.retrieveMetadata(t).next((function(t){return t.targetCount}))},p_.prototype.getTargetData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return f_(t).iterate({range:i,index:Aw.queryTargetsIndexName},(function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.target)&&(o=a,i.done())})).next((function(){return o}))},p_.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=v_(t);return e.forEach((function(e){var a=im(e.path);i.push(o.put(new kw(n,a))),i.push(r.referenceDelegate.addReference(t,e))})),qm.waitFor(i)},p_.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=v_(t);return qm.forEach(e,(function(e){var o=im(e.path);return qm.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])}))},p_.prototype.removeMatchingKeysForTargetId=function(t,e){var n=v_(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},p_.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=v_(t),i=Pm();return r.iterate({range:n,keysOnly:!0},(function(t,e,n){var r=sm(t[1]),o=new Kg(r);i=i.add(o)})).next((function(){return i}))},p_.prototype.containsKey=function(t,e){var n=im(e.path),r=IDBKeyRange.bound([n],[Tg(n)],!1,!0),i=0;return v_(t).iterate({index:kw.documentTargetsIndex,keysOnly:!0,range:r},(function(t,e,n){0!==t[0]&&(i++,n.done())})).next((function(){return 0<i}))},p_.prototype.getTargetDataForTarget=function(t,e){var n=this;return f_(t).get(e).next((function(t){return t?n.serializer.fromDbTarget(t):null}))},p_);function p_(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=c_.forTargetCache()}function f_(t){return fE.getStore(t,Aw.store)}function d_(t){return jm.getStore(t,Pw.store).get(Pw.key).next((function(t){return Bv(null!==t,"Missing metadata row."),t}))}function y_(t){return d_(t).next((function(t){return t.highestListenSequenceNumber}))}function v_(t){return fE.getStore(t,kw.store)}var g_=(m_.fromSet=function(t){return new m_(t)},m_.fromArray=function(t){var e=new bm(Wg.comparator);return t.forEach((function(t){return e=e.add(t)})),new m_(e)},m_.prototype.covers=function(t){var e=!1;return this.fields.forEach((function(n){n.isPrefixOf(t)&&(e=!0)})),e},m_.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},m_);function m_(t){this.fields=t}var __=(b_.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},b_);function b_(t,e){this.field=t,this.transform=e}var w_,E_,T_=function(t,e){this.version=t,this.transformResults=e};(E_=w_=w_||{})[E_.Set=0]="Set",E_[E_.Patch=1]="Patch",E_[E_.Transform=2]="Transform",E_[E_.Delete=3]="Delete",E_[E_.Verify=4]="Verify";var C_=(S_.exists=function(t){return new S_(void 0,t)},S_.updateTime=function(t){return new S_(t)},Object.defineProperty(S_.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),S_.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Vb&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Vb:(Bv(this.isNone,"Precondition should be empty"),!0)},S_.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},S_.NONE=new S_,S_);function S_(t,e){this.updateTime=t,this.exists=e,Bv(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var I_=(N_.prototype.verifyKeyMatches=function(t){null!=t&&Bv(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},N_.getPostMutationVersion=function(t){return t instanceof Vb?t.version:hm.MIN},N_);function N_(){}var A_,D_=(ha(k_,A_=I_),k_.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Bv(null==e.transformResults,"Transform results received by SetMutation."),new Vb(this.key,e.version,{hasCommittedMutations:!0},this.value)},k_.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=I_.getPostMutationVersion(t);return new Vb(this.key,r,{hasLocalMutations:!0},this.value)},k_.prototype.extractBaseValue=function(t){return null},k_.prototype.isEqual=function(t){return t instanceof k_&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},k_);function k_(t,e,n){var r=A_.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=w_.Set,r}var R_,P_=(ha(O_,R_=I_),O_.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Bv(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Hb(this.key,e.version);var n=this.patchDocument(t);return new Vb(this.key,e.version,{hasCommittedMutations:!0},n)},O_.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=I_.getPostMutationVersion(t),i=this.patchDocument(t);return new Vb(this.key,r,{hasLocalMutations:!0},i)},O_.prototype.extractBaseValue=function(t){return null},O_.prototype.isEqual=function(t){return t instanceof O_&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},O_.prototype.patchDocument=function(t){var e;return e=t instanceof Vb?t.data():Pb.EMPTY,this.patchObject(e)},O_.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}})),t},O_);function O_(t,e,n,r){var i=R_.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=w_.Patch,i}var x_,L_=(ha(M_,x_=I_),M_.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Bv(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Hb(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new Vb(this.key,i,{hasCommittedMutations:!0},o)},M_.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new Vb(this.key,r.version,{hasLocalMutations:!0},o)},M_.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Vb?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Pb.EMPTY.set(i.field,a):e.set(i.field,a))}return e},M_.prototype.isEqual=function(t){return t instanceof M_&&this.key.isEqual(t.key)&&Eg(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},M_.prototype.requireDocument=function(t){return Bv(t instanceof Vb,"Unknown MaybeDocument type "+t),Bv(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},M_.prototype.serverTransformResults=function(t,e){var n=[];Bv(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof Vb&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},M_.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof Vb&&(u=e.field(a.field)),null===u&&n instanceof Vb&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},M_.prototype.transformObject=function(t,e){Bv(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++)t=t.set(this.fieldTransforms[n].field,e[n]);return t},M_);function M_(t,e){var n=x_.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=w_.Transform,n.precondition=C_.exists(!0),n}var F_,U_=(ha(q_,F_=I_),q_.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Bv(null==e.transformResults,"Transform results received by DeleteMutation."),new Wb(this.key,e.version,{hasCommittedMutations:!0})},q_.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Bv(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Wb(this.key,hm.forDeletedDoc())):t},q_.prototype.extractBaseValue=function(t){return null},q_.prototype.isEqual=function(t){return t instanceof q_&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},q_);function q_(t,e){var n=F_.call(this)||this;return n.key=t,n.precondition=e,n.type=w_.Delete,n}var V_,B_,j_,W_,Q_,K_=(ha(H_,V_=I_),H_.prototype.applyToRemoteDocument=function(t,e){Vv("VerifyMutation should only be used in Transactions.")},H_.prototype.applyToLocalView=function(t,e,n){Vv("VerifyMutation should only be used in Transactions.")},H_.prototype.extractBaseValue=function(t){Vv("VerifyMutation should only be used in Transactions.")},H_.prototype.isEqual=function(t){return t instanceof H_&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},H_);function H_(t,e){var n=V_.call(this)||this;return n.key=t,n.precondition=e,n.type=w_.Verify,n}(j_=B_=B_||{})[j_.NullValue=0]="NullValue",j_[j_.BooleanValue=1]="BooleanValue",j_[j_.NumberValue=2]="NumberValue",j_[j_.TimestampValue=3]="TimestampValue",j_[j_.StringValue=4]="StringValue",j_[j_.BlobValue=5]="BlobValue",j_[j_.RefValue=6]="RefValue",j_[j_.GeoPointValue=7]="GeoPointValue",j_[j_.ArrayValue=8]="ArrayValue",j_[j_.ObjectValue=9]="ObjectValue",(Q_=W_=W_||{})[Q_.Default=0]="Default",Q_[Q_.Estimate=1]="Estimate",Q_[Q_.Previous=2]="Previous";var z_=(G_.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new G_(W_.Estimate,e);case"previous":return new G_(W_.Previous,e);case"none":case void 0:return new G_(W_.Default,e);default:return Vv("fromSnapshotOptions() called with invalid options.")}},G_);function G_(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var Y_=(X_.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},X_.prototype.defaultCompareTo=function(t){return Bv(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),wg(this.typeOrder,t.typeOrder)},X_);function X_(){}var J_,$_=(ha(Z_,J_=Y_),Z_.prototype.value=function(t){return null},Z_.prototype.isEqual=function(t){return t instanceof Z_},Z_.prototype.compareTo=function(t){return t instanceof Z_?0:this.defaultCompareTo(t)},Z_.INSTANCE=new Z_,Z_);function Z_(){var t=J_.call(this)||this;return t.typeOrder=B_.NullValue,t.internalValue=null,t}var tb,eb=(ha(nb,tb=Y_),nb.prototype.value=function(t){return this.internalValue},nb.prototype.isEqual=function(t){return t instanceof nb&&this.internalValue===t.internalValue},nb.prototype.compareTo=function(t){return t instanceof nb?wg(this,t):this.defaultCompareTo(t)},nb.of=function(t){return t?nb.TRUE:nb.FALSE},nb.TRUE=new nb(!0),nb.FALSE=new nb(!1),nb);function nb(t){var e=tb.call(this)||this;return e.internalValue=t,e.typeOrder=B_.BooleanValue,e}var rb,ib=(ha(ob,rb=Y_),ob.prototype.value=function(t){return this.internalValue},ob.prototype.compareTo=function(t){return t instanceof ob?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},ob);function ob(t){var e=rb.call(this)||this;return e.internalValue=t,e.typeOrder=B_.NumberValue,e}function ab(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var sb,ub=(ha(cb,sb=ib),cb.prototype.isEqual=function(t){return t instanceof cb&&ab(this.internalValue,t.internalValue)},cb);function cb(){return null!==sb&&sb.apply(this,arguments)||this}var hb,lb=(ha(pb,hb=ib),pb.prototype.isEqual=function(t){return t instanceof pb&&ab(this.internalValue,t.internalValue)},pb.NAN=new pb(NaN),pb.POSITIVE_INFINITY=new pb(1/0),pb.NEGATIVE_INFINITY=new pb(-1/0),pb);function pb(){return null!==hb&&hb.apply(this,arguments)||this}var fb,db=(ha(yb,fb=Y_),yb.prototype.value=function(t){return this.internalValue},yb.prototype.isEqual=function(t){return t instanceof yb&&this.internalValue===t.internalValue},yb.prototype.compareTo=function(t){return t instanceof yb?wg(this.internalValue,t.internalValue):this.defaultCompareTo(t)},yb);function yb(t){var e=fb.call(this)||this;return e.internalValue=t,e.typeOrder=B_.StringValue,e}var vb,gb=(ha(mb,vb=Y_),mb.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},mb.prototype.isEqual=function(t){return t instanceof mb&&this.internalValue.isEqual(t.internalValue)},mb.prototype.compareTo=function(t){return t instanceof mb?this.internalValue._compareTo(t.internalValue):t instanceof bb?-1:this.defaultCompareTo(t)},mb);function mb(t){var e=vb.call(this)||this;return e.internalValue=t,e.typeOrder=B_.TimestampValue,e}var _b,bb=(ha(wb,_b=Y_),wb.prototype.value=function(t){return t&&t.serverTimestampBehavior===W_.Estimate?new gb(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===W_.Previous&&this.previousValue?this.previousValue.value(t):null},wb.prototype.isEqual=function(t){return t instanceof wb&&this.localWriteTime.isEqual(t.localWriteTime)},wb.prototype.compareTo=function(t){return t instanceof wb?this.localWriteTime._compareTo(t.localWriteTime):t instanceof gb?1:this.defaultCompareTo(t)},wb.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},wb);function wb(t,e){var n=_b.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=B_.TimestampValue,n}var Eb,Tb=(ha(Cb,Eb=Y_),Cb.prototype.value=function(t){return this.internalValue},Cb.prototype.isEqual=function(t){return t instanceof Cb&&this.internalValue.isEqual(t.internalValue)},Cb.prototype.compareTo=function(t){return t instanceof Cb?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Cb);function Cb(t){var e=Eb.call(this)||this;return e.internalValue=t,e.typeOrder=B_.BlobValue,e}var Sb,Ib=(ha(Nb,Sb=Y_),Nb.prototype.value=function(t){return this.key},Nb.prototype.isEqual=function(t){return t instanceof Nb&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},Nb.prototype.compareTo=function(t){if(t instanceof Nb){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:Kg.comparator(this.key,t.key)}return this.defaultCompareTo(t)},Nb);function Nb(t,e){var n=Sb.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=B_.RefValue,n}var Ab,Db=(ha(kb,Ab=Y_),kb.prototype.value=function(t){return this.internalValue},kb.prototype.isEqual=function(t){return t instanceof kb&&this.internalValue.isEqual(t.internalValue)},kb.prototype.compareTo=function(t){return t instanceof kb?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},kb);function kb(t){var e=Ab.call(this)||this;return e.internalValue=t,e.typeOrder=B_.GeoPointValue,e}var Rb,Pb=(ha(Ob,Rb=Y_),Ob.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal((function(n,r){e[n]=r.value(t)})),e},Ob.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},Ob.prototype.isEqual=function(t){if(t instanceof Ob){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},Ob.prototype.compareTo=function(t){if(t instanceof Ob){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=wg(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return wg(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},Ob.prototype.set=function(t,e){if(Bv(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof Ob||(n=Ob.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},Ob.prototype.delete=function(t){if(Bv(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new Ob(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof Ob){var n=e.delete(t.popFirst());return new Ob(this.internalValue.insert(t.firstSegment(),n))}return this},Ob.prototype.contains=function(t){return null!==this.field(t)},Ob.prototype.field=function(t){Bv(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach((function(t){e=e instanceof Ob?e.internalValue.get(t):null})),e},Ob.prototype.fieldMask=function(){var t=new bm(Wg.comparator);return this.internalValue.forEach((function(e,n){var r=new Wg([e]);if(n instanceof Ob){var i=n.fieldMask().fields;i.isEmpty()?t=t.add(r):i.forEach((function(e){t=t.add(r.child(e))}))}else t=t.add(r)})),g_.fromSet(t)},Ob.prototype.toString=function(){return this.internalValue.toString()},Ob.prototype.child=function(t){return this.internalValue.get(t)||void 0},Ob.prototype.setChild=function(t,e){return new Ob(this.internalValue.insert(t,e))},Ob.EMPTY=new Ob(new pm(wg)),Ob);function Ob(t){var e=Rb.call(this)||this;return e.internalValue=t,e.typeOrder=B_.ObjectValue,e}var xb,Lb=(ha(Mb,xb=Y_),Mb.prototype.value=function(t){return this.internalValue.map((function(e){return e.value(t)}))},Mb.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Mb.prototype.forEach=function(t){this.internalValue.forEach(t)},Mb.prototype.isEqual=function(t){if(t instanceof Mb){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},Mb.prototype.compareTo=function(t){if(t instanceof Mb){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return wg(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},Mb.prototype.toString=function(){return"["+this.internalValue.map((function(t){return t.toString()})).join(",")+"]"},Mb);function Mb(t){var e=xb.call(this)||this;return e.internalValue=t,e.typeOrder=B_.ArrayValue,e}var Fb=(Ub.compareByKey=function(t,e){return Kg.comparator(t.key,e.key)},Ub);function Ub(t,e){this.key=t,this.version=e}var qb,Vb=(ha(Bb,qb=Fb),Bb.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},Bb.prototype.data=function(){var t=this;if(!this.objectValue){var e=Pb.EMPTY;Zv(this.proto.fields||{},(function(n,r){e=e.set(new Wg([n]),t.converter(r))})),this.objectValue=e,this.fieldValueCache=void 0}return this.objectValue},Bb.prototype.value=function(){return this.data().value()},Bb.prototype.isEqual=function(t){return t instanceof Bb&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},Bb.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Bb.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Bb.prototype.getProtoField=function(t){Bv(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.firstSegment()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},Bb.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Vv("Trying to compare documents on fields that don't exist")},Bb);function Bb(t,e,n,r,i,o){var a=qb.call(this,t,e)||this;return a.objectValue=r,a.proto=i,a.converter=o,Bv(void 0!==a.objectValue||void 0!==a.proto&&void 0!==a.converter,"If objectValue is not defined, proto and converter need to be set."),a.hasLocalMutations=!!n.hasLocalMutations,a.hasCommittedMutations=!!n.hasCommittedMutations,a}var jb,Wb=(ha(Qb,jb=Fb),Qb.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Qb.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Qb.prototype.isEqual=function(t){return t instanceof Qb&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Qb);function Qb(t,e,n){var r=jb.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var Kb,Hb=(ha(zb,Kb=Fb),zb.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(zb.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),zb.prototype.isEqual=function(t){return t instanceof zb&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},zb);function zb(){return null!==Kb&&Kb.apply(this,arguments)||this}var Gb=(Yb.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[1];if(o[0].isEqual(t))return a}},Yb.prototype.has=function(t){return void 0!==this.get(t)},Yb.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},Yb.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},Yb.prototype.forEach=function(t){Zv(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}}))},Yb.prototype.isEmpty=function(){return tg(this.inner)},Yb);function Yb(t){this.mapKeyFn=t,this.inner={}}var Xb=(Object.defineProperty(Jb.prototype,"readTime",{get:function(){return Bv(void 0!==this._readTime,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this._readTime},set:function(t){Bv(void 0===this._readTime||this._readTime.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this._readTime=t},enumerable:!0,configurable:!0}),Jb.prototype.addEntry=function(t,e){this.assertNotApplied(),this.readTime=e,this.changes.set(t.key,t)},Jb.prototype.removeEntry=function(t,e){this.assertNotApplied(),e&&(this.readTime=e),this.changes.set(t,null)},Jb.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?qm.resolve(n):this.getFromCache(t,e)},Jb.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},Jb.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},Jb.prototype.assertNotApplied=function(){Bv(!this.changesApplied,"Changes have already been applied.")},Jb);function Jb(){this.changes=new Gb((function(t){return t.toString()})),this.changesApplied=!1}var $b,Zb=(tw.prototype.addEntry=function(t,e,n){return rw(t).put(iw(e),n)},tw.prototype.removeEntry=function(t,e){var n=rw(t),r=iw(e);return n.delete(r)},tw.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.setMetadata(t,r)}))},tw.prototype.getEntry=function(t,e){var n=this;return rw(t).get(iw(e)).next((function(t){return n.maybeDecodeDocument(t)}))},tw.prototype.getSizedEntry=function(t,e){var n=this;return rw(t).get(iw(e)).next((function(t){var e=n.maybeDecodeDocument(t);return e?{maybeDocument:e,size:ow(t)}:null}))},tw.prototype.getEntries=function(t,e){var n=this,r=Im();return this.forEachDbEntry(t,e,(function(t,e){var i=n.maybeDecodeDocument(e);r=r.insert(t,i)})).next((function(){return r}))},tw.prototype.getSizedEntries=function(t,e){var n=this,r=Im(),i=new pm(Kg.comparator);return this.forEachDbEntry(t,e,(function(t,e){var o=n.maybeDecodeDocument(e);i=o?(r=r.insert(t,o),i.insert(t,ow(e))):(r=r.insert(t,null),i.insert(t,0))})).next((function(){return{maybeDocuments:r,sizeMap:i}}))},tw.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return qm.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return rw(t).iterate({range:r},(function(t,e,r){for(var a=Kg.fromSegments(t);o&&Kg.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},tw.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this;Bv(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var i=Am(),o=e.path.length+1,a={};if(n.isEqual(hm.MIN)){var s=e.path.toArray();a.range=IDBKeyRange.lowerBound(s)}else{var u=e.path.toArray(),c=this.serializer.toDbTimestampKey(n);a.range=IDBKeyRange.lowerBound([u,c],!0),a.index=Cw.collectionReadTimeIndex}return rw(t).iterate(a,(function(t,n,a){if(t.length===o){var s=r.serializer.fromDbRemoteDocument(n);e.path.isPrefixOf(s.key.path)?s instanceof Vb&&e.matches(s)&&(i=i.insert(s.key,s)):a.done()}})).next((function(){return i}))},tw.prototype.getNewDocumentChanges=function(t,e){var n=this,r=Sm(),i=this.serializer.toDbTimestampKey(e),o=rw(t),a=IDBKeyRange.lowerBound(i,!0);return o.iterate({index:Cw.readTimeIndex,range:a},(function(t,e){var o=n.serializer.fromDbRemoteDocument(e);r=r.insert(o.key,o),i=e.readTime})).next((function(){return{changedDocs:r,readTime:n.serializer.fromDbTimestampKey(i)}}))},tw.prototype.getLastDocumentChange=function(t){var e,n=this,r=rw(t),i=hm.MIN;return r.iterate({index:Cw.readTimeIndex,reverse:!0},(function(t,r,o){e=n.serializer.fromDbRemoteDocument(r),r.readTime&&(i=n.serializer.fromDbTimestampKey(r.readTime)),o.done()})).next((function(){return{changedDoc:e,readTime:i}}))},tw.prototype.newChangeBuffer=function(t){return new tw.RemoteDocumentChangeBuffer(this,!!t&&t.trackRemovals)},tw.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},tw.prototype.getMetadata=function(t){return nw(t).get(Iw.key).next((function(t){return Bv(!!t,"Missing document cache metadata"),t}))},tw.prototype.setMetadata=function(t,e){return nw(t).put(Iw.key,e)},tw.prototype.maybeDecodeDocument=function(t){if(t){var e=this.serializer.fromDbRemoteDocument(t);return e instanceof Wb&&e.version.isEqual(hm.forDeletedDoc())?null:e}return null},tw.RemoteDocumentChangeBuffer=(ha(ew,$b=Xb),ew.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new bm((function(t,e){return wg(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,a){var s=e.documentSizes.get(o);if(Bv(void 0!==s,"Cannot modify a document that wasn't read (for "+o+")"),a){Bv(!e.readTime.isEqual(hm.MIN),"Cannot add a document with a read time of zero");var u=e.documentCache.serializer.toDbRemoteDocument(a,e.readTime);i=i.add(o.path.popLast());var c=ow(u);r+=c-s,n.push(e.documentCache.addEntry(t,o,u))}else if(r-=s,e.trackRemovals){var h=e.documentCache.serializer.toDbRemoteDocument(new Wb(o,hm.forDeletedDoc()),e.readTime);n.push(e.documentCache.addEntry(t,o,h))}else n.push(e.documentCache.removeEntry(t,o))})),i.forEach((function(r){n.push(e.documentCache.indexManager.addToCollectionParentIndex(t,r))})),n.push(this.documentCache.updateMetadata(t,r)),qm.waitFor(n)},ew.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next((function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)}))},ew.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next((function(t){var e=t.maybeDocuments;return t.sizeMap.forEach((function(t,e){n.documentSizes.set(t,e)})),e}))},ew),tw);function tw(t,e){this.serializer=t,this.indexManager=e}function ew(t,e){var n=$b.call(this)||this;return n.documentCache=t,n.trackRemovals=e,n.documentSizes=new Gb((function(t){return t.toString()})),n}function nw(t){return fE.getStore(t,Iw.store)}function rw(t){return fE.getStore(t,Cw.store)}function iw(t){return t.path.toArray()}function ow(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Vv("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var aw=(sw.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),qm.resolve()},sw.prototype.getCollectionParents=function(t,e){return qm.resolve(this.collectionParentIndex.getEntries(e))},sw);function sw(){this.collectionParentIndex=new uw}var uw=(cw.prototype.add=function(t){Bv(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new bm(qg.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},cw.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},cw.prototype.getEntries=function(t){return(this.index[t]||new bm(qg.comparator)).toArray()},cw);function cw(){this.index={}}var hw=9,lw=(pw.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Bv(n<r&&0<=n&&r<=hw,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");var o=new Hm(e);n<1&&1<=r&&(function(t){t.createObjectStore(dw.store)}(t),function(t){t.createObjectStore(vw.store,{keyPath:vw.keyPath}),t.createObjectStore(mw.store,{keyPath:mw.keyPath,autoIncrement:!0}).createIndex(mw.userMutationsIndex,mw.userMutationsKeyPath,{unique:!0}),t.createObjectStore(bw.store)}(t),Mw(t),function(t){t.createObjectStore(Cw.store)}(t));var a=qm.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(kw.store),t.deleteObjectStore(Aw.store),t.deleteObjectStore(Pw.store)}(t),Mw(t)),a=a.next((function(){return function(t){var e=t.store(Pw.store),n=new Pw(0,0,hm.MIN.toTimestamp(),0);return e.put(Pw.key,n)}(o)}))),n<4&&4<=r&&(0!==n&&(a=a.next((function(){return function(t,e){return e.store(mw.store).loadAll().next((function(n){t.deleteObjectStore(mw.store),t.createObjectStore(mw.store,{keyPath:mw.keyPath,autoIncrement:!0}).createIndex(mw.userMutationsIndex,mw.userMutationsKeyPath,{unique:!0});var r=e.store(mw.store),i=n.map((function(t){return r.put(t)}));return qm.waitFor(i)}))}(t,o)}))),a=a.next((function(){!function(t){t.createObjectStore(Fw.store,{keyPath:Fw.keyPath})}(t)}))),n<5&&5<=r&&(a=a.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&6<=r&&(a=a.next((function(){return function(t){t.createObjectStore(Iw.store)}(t),i.addDocumentGlobal(o)}))),n<7&&7<=r&&(a=a.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&8<=r&&(a=a.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&9<=r&&(a=a.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Cw.store);e.createIndex(Cw.readTimeIndex,Cw.readTimeIndexPath,{unique:!1}),e.createIndex(Cw.collectionReadTimeIndex,Cw.collectionReadTimeIndexPath,{unique:!1})}(e)}))),a},pw.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Cw.store).iterate((function(t,n){e+=ow(n)})).next((function(){var n=new Iw(e);return t.store(Iw.store).put(Iw.key,n)}))},pw.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(vw.store),r=t.store(mw.store);return n.loadAll().next((function(n){return qm.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(mw.userMutationsIndex,i).next((function(r){return qm.forEach(r,(function(r){Bv(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return i_(t,n.userId,i).next((function(){}))}))}))}))}))},pw.prototype.ensureSequenceNumbers=function(t){var e=t.store(kw.store),n=t.store(Cw.store);return y_(t).next((function(t){var r=[];return n.iterate((function(n,i){var o=new qg(n),a=function(t){return[0,im(t)]}(o);r.push(e.get(a).next((function(n){return n?qm.resolve():function(n){return e.put(new kw(0,im(n),t))}(o)})))})).next((function(){return qm.waitFor(r)}))}))},pw.prototype.createCollectionParentIndex=function(t,e){function n(t){if(i.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:im(n)})}}t.createObjectStore(xw.store,{keyPath:xw.keyPath});var r=e.store(xw.store),i=new uw;return e.store(Cw.store).iterate({keysOnly:!0},(function(t,e){return n(new qg(t).popLast())})).next((function(){return e.store(bw.store).iterate({keysOnly:!0},(function(t,e){return n(sm(t[1]).popLast())}))}))},pw);function pw(t){this.serializer=t}var fw=function(t,e){this.seconds=t,this.nanoseconds=e},dw=(yw.store="owner",yw.key="owner",yw);function yw(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var vw=(gw.store="mutationQueues",gw.keyPath="userId",gw);function gw(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var mw=(_w.store="mutations",_w.keyPath="batchId",_w.userMutationsIndex="userMutationsIndex",_w.userMutationsKeyPath=["userId","batchId"],_w);function _w(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var bw=(ww.prefixForUser=function(t){return[t]},ww.prefixForPath=function(t,e){return[t,im(e)]},ww.key=function(t,e,n){return[t,im(e),n]},ww.store="documentMutations",ww.PLACEHOLDER=new ww,ww);function ww(){}var Ew=function(t,e){this.path=t,this.readTime=e},Tw=function(t,e){this.path=t,this.version=e},Cw=(Sw.store="remoteDocuments",Sw.readTimeIndex="readTimeIndex",Sw.readTimeIndexPath="readTime",Sw.collectionReadTimeIndex="collectionReadTimeIndex",Sw.collectionReadTimeIndexPath=["parentPath","readTime"],Sw);function Sw(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var Iw=(Nw.store="remoteDocumentGlobal",Nw.key="remoteDocumentGlobalKey",Nw);function Nw(t){this.byteSize=t}var Aw=(Dw.store="targets",Dw.keyPath="targetId",Dw.queryTargetsIndexName="queryTargetsIndex",Dw.queryTargetsKeyPath=["canonicalId","targetId"],Dw);function Dw(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}var kw=(Rw.store="targetDocuments",Rw.keyPath=["targetId","path"],Rw.documentTargetsIndex="documentTargetsIndex",Rw.documentTargetsKeyPath=["path","targetId"],Rw);function Rw(t,e,n){this.targetId=t,this.path=e,Bv(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var Pw=(Ow.key="targetGlobalKey",Ow.store="targetGlobal",Ow);function Ow(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var xw=(Lw.store="collectionParents",Lw.keyPath=["collectionId","parent"],Lw);function Lw(t,e){this.collectionId=t,this.parent=e}function Mw(t){t.createObjectStore(kw.store,{keyPath:kw.keyPath}).createIndex(kw.documentTargetsIndex,kw.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Aw.store,{keyPath:Aw.keyPath}).createIndex(Aw.queryTargetsIndexName,Aw.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Pw.store)}var Fw=(Uw.store="clientMetadata",Uw.keyPath="clientId",Uw);function Uw(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var qw,Vw,Bw=ga(ga(ga([vw.store,mw.store,bw.store,Cw.store,Aw.store,dw.store,Pw.store,kw.store],[Fw.store]),[Iw.store]),[xw.store]),jw=(Ww.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(Bv(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.has(e))return qm.resolve();var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.collectionParentsCache.add(e)}));var o={collectionId:r,parent:im(i)};return Qw(t).put(o)},Ww.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Tg(e),""],!1,!0);return Qw(t).loadAll(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(sm(o.parent))}return n}))},Ww);function Ww(){this.collectionParentsCache=new uw}function Qw(t){return fE.getStore(t,xw.store)}(Vw=qw=qw||{})[Vw.Listen=0]="Listen",Vw[Vw.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",Vw[Vw.LimboResolution=2]="LimboResolution";var Kw=(Hw.prototype.withSequenceNumber=function(t){return new Hw(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Hw.prototype.withResumeToken=function(t,e){return new Hw(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Hw.prototype.withLastLimboFreeSnapshotVersion=function(t){return new Hw(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},Hw.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.target.isEqual(t.target)},Hw);function Hw(t,e,n,r,i,o,a){void 0===i&&(i=hm.MIN),void 0===o&&(o=hm.MIN),void 0===a&&(a=Qv()),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}var zw=(Gw.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Kg.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Wb(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Kg.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new Hb(e,n)):Vv("Unexpected DbRemoteDocument")},Gw.prototype.toDbRemoteDocument=function(t,e){var n=this.toDbTimestampKey(e),r=t.key.path.popLast().toArray();if(t instanceof Vb){var i=t.proto?t.proto:this.remoteSerializer.toDocument(t),o=t.hasCommittedMutations;return new Cw(null,null,i,o,n,r)}if(t instanceof Wb){var a=t.key.path.toArray(),s=this.toDbTimestamp(t.version);return o=t.hasCommittedMutations,new Cw(null,new Ew(a,s),null,o,n,r)}if(t instanceof Hb){a=t.key.path.toArray();var u=this.toDbTimestamp(t.version);return new Cw(new Tw(a,u),null,null,!0,n,r)}return Vv("Unexpected MaybeDocument")},Gw.prototype.toDbTimestampKey=function(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]},Gw.prototype.fromDbTimestampKey=function(t){var e=new um(t[0],t[1]);return hm.fromTimestamp(e)},Gw.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new fw(e.seconds,e.nanoseconds)},Gw.prototype.fromDbTimestamp=function(t){var e=new um(t.seconds,t.nanoseconds);return hm.fromTimestamp(e)},Gw.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map((function(t){return n.remoteSerializer.toMutation(t)})),i=e.mutations.map((function(t){return n.remoteSerializer.toMutation(t)}));return new mw(t,e.batchId,e.localWriteTime.toMillis(),r,i)},Gw.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map((function(t){return e.remoteSerializer.fromMutation(t)})),r=t.mutations.map((function(t){return e.remoteSerializer.fromMutation(t)})),i=um.fromMillis(t.localWriteTimeMs);return new Lm(t.batchId,i,n,r)},Gw.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach((function(t){e.push(im(t.path))})),e},Gw.prototype.fromDbResourcePaths=function(t){for(var e=Pm(),n=0,r=t;n<r.length;n++)e=e.add(new Kg(sm(r[n])));return e},Gw.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.fromDbTimestamp(t.lastLimboFreeSnapshotVersion):hm.MIN,i=t.resumeToken;return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new Kw(e,t.targetId,qw.Listen,t.lastListenSequenceNumber,n,r,i)},Gw.prototype.toDbTarget=function(t){Bv(qw.Listen===t.purpose,"Only queries with purpose "+qw.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion),i=this.toDbTimestamp(t.lastLimboFreeSnapshotVersion);return e=t.target.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.target):this.remoteSerializer.toQueryTarget(t.target),n=t.resumeToken instanceof Uint8Array?(Bv(jm.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new Aw(t.targetId,t.target.canonicalId(),r,n,t.sequenceNumber,i,e)},Gw);function Gw(t){this.remoteSerializer=t}function Yw(t,e){var n=t[1],r=e[1],i=wg(t[0],e[0]);return 0===i?wg(n,r):i}var Xw=(Jw.prototype.nextIndex=function(){return++this.previousIndex},Jw.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Yw(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Jw.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Jw);function Jw(t){this.maxElements=t,this.buffer=new bm(Yw),this.previousIndex=0}var $w={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Zw=(tE.withCacheSize=function(t){return new tE(t,tE.DEFAULT_COLLECTION_PERCENTILE,tE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},tE.COLLECTION_DISABLED=-1,tE.MINIMUM_CACHE_SIZE_BYTES=1048576,tE.DEFAULT=new tE(tE.DEFAULT_CACHE_SIZE_BYTES=41943040,tE.DEFAULT_COLLECTION_PERCENTILE=10,tE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),tE.DISABLED=new tE(tE.COLLECTION_DISABLED,0,0),tE);function tE(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var eE=(nE.prototype.start=function(){Bv(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Zw.COLLECTION_DISABLED&&this.scheduleGC()},nE.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(nE.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),nE.prototype.scheduleGC=function(){var t=this;Bv(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Fv("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(zg.LruGarbageCollection,e,(function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then((function(){return t.scheduleGC()})).catch(yE)}))},nE);function nE(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var rE=(iE.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next((function(t){return Math.floor(e/100*t)}))},iE.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return qm.resolve(Og.INVALID);var r=new Xw(e);return this.delegate.forEachTarget(t,(function(t){return r.addElement(t.sequenceNumber)})).next((function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,(function(t){return r.addElement(t)}))})).next((function(){return r.maxValue}))},iE.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},iE.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},iE.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===Zw.COLLECTION_DISABLED?(Fv("LruGarbageCollector","Garbage collection skipped; disabled"),qm.resolve($w)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(Fv("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),$w):n.runGarbageCollection(t,e)}))},iE.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},iE.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return r=e>c.params.maximumSequenceNumbersToCollect?(Fv("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),c.params.maximumSequenceNumbersToCollect):e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,s=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),Lv()<=Sv.DEBUG&&Fv("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(s-a)+"ms\n\tRemoved "+t+" documents in "+(u-s)+"ms\nTotal Duration: "+(u-h)+"ms"),qm.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},iE);function iE(t,e){this.delegate=t,this.params=e}var oE=(aE.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},aE.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},aE);function aE(){this.onCommittedListeners=[]}var sE,uE="IndexedDbPersistence",cE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",hE="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",lE=(ha(pE,sE=oE),pE);function pE(t,e){var n=sE.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var fE=(dE.getStore=function(t,e){if(t instanceof lE)return jm.getStore(t.simpleDbTransaction,e);throw Vv("IndexedDbPersistence must use instances of IndexedDbTransaction")},dE.createIndexedDbPersistence=function(t){return pa(this,void 0,void 0,(function(){var e;return fa(this,(function(n){switch(n.label){case 0:if(!dE.isAvailable())throw new zv(Hv.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new dE(t.allowTabSynchronization,t.persistenceKey,t.clientId,t.platform,t.lruParams,t.queue,t.serializer,t.sequenceNumberSyncer)).start()];case 1:return n.sent(),[2,e]}}))}))},dE.prototype.start=function(){var t=this;return Bv(!this.started,"IndexedDbPersistence double-started!"),Bv(null!==this.window,"Expected 'window' to be defined"),jm.openOrCreate(this.dbName,hw,new lw(this.serializer)).then((function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()})).then((function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.simpleDb.runTransaction("readonly-idempotent",[Pw.store],(function(t){return y_(t)}))})).then((function(e){t.listenSequence=new Og(e,t.sequenceNumberSyncer)})).then((function(){t._started=!0})).catch((function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)}))},dE.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return pa(e,void 0,void 0,(function(){return fa(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},dE.prototype.setDatabaseDeletedListener=function(t){var e=this;this.simpleDb.setVersionChangeListener((function(n){return pa(e,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},dE.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget((function(){return pa(e,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},dE.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite-idempotent",Bw,(function(e){return gE(e).put(new Fw(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next((function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget((function(){return t.primaryStateListener(!1)})))}))})).next((function(){return t.canActAsPrimary(e)})).next((function(n){return t.isPrimary&&!n?t.releasePrimaryLeaseIfHeld(e).next((function(){return!1})):!!n&&t.acquireOrExtendPrimaryLease(e).next((function(){return!0}))}))})).catch((function(e){if(!t.allowTabSynchronization)throw e;return Fv(uE,"Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.queue.enqueueAndForget((function(){return t.primaryStateListener(e)})),t.isPrimary=e}))},dE.prototype.verifyPrimaryLease=function(t){var e=this;return vE(t).get(dw.key).next((function(t){return qm.resolve(e.isLocalClient(t))}))},dE.prototype.removeClientMetadata=function(t){return gE(t).delete(this.clientId)},dE.prototype.maybeGarbageCollectMultiClientState=function(){return pa(this,void 0,void 0,(function(){var t=this;return fa(this,(function(e){switch(e.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",(function(e){var n=dE.getStore(e,Fw.store);return n.loadAll().next((function(e){var r=t.filterActiveClients(e,18e5),i=e.filter((function(t){return-1===r.indexOf(t)}));return qm.forEach(i,(function(t){return n.delete(t.clientId)})).next((function(){return i}))}))}))]);case 1:e.sent().forEach((function(e){t.window.localStorage.removeItem(t.zombiedClientLocalStorageKey(e.clientId))})),e.label=2;case 2:return[2]}}))}))},dE.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(zg.ClientMetadataRefresh,4e3,(function(){return t.updateClientMetadataAndTryBecomePrimary().then((function(){return t.maybeGarbageCollectMultiClientState()})).then((function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()}))}))},dE.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},dE.prototype.canActAsPrimary=function(t){var e=this;return vE(t).get(dw.key).next((function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new zv(Hv.FAILED_PRECONDITION,hE);return!1}}return!(!e.networkEnabled||!e.inForeground)||gE(t).loadAll().next((function(t){return void 0===e.filterActiveClients(t,5e3).find((function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))}))}))})).next((function(t){return e.isPrimary!==t&&Fv(uE,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},dE.prototype.shutdown=function(){return pa(this,void 0,void 0,(function(){var t=this;return fa(this,(function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite-idempotent",[dw.store,Fw.store],(function(e){return t.releasePrimaryLeaseIfHeld(e).next((function(){return t.removeClientMetadata(e)}))}))];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}}))}))},dE.prototype.filterActiveClients=function(t,e){var n=this;return t.filter((function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)}))},dE.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly-idempotent",[Fw.store],(function(e){return gE(e).loadAll().next((function(e){return t.filterActiveClients(e,18e5).map((function(t){return t.clientId}))}))}))},dE.clearPersistence=function(t){return pa(this,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:return dE.isAvailable()?[4,jm.delete(t+dE.MAIN_DATABASE)]:[2,Promise.resolve()];case 1:return e.sent(),[2]}}))}))},Object.defineProperty(dE.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),dE.prototype.getMutationQueue=function(t){return Bv(this.started,"Cannot initialize MutationQueue before persistence is started."),e_.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},dE.prototype.getTargetCache=function(){return Bv(this.started,"Cannot initialize TargetCache before persistence is started."),this.targetCache},dE.prototype.getRemoteDocumentCache=function(){return Bv(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},dE.prototype.getIndexManager=function(){return Bv(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},dE.prototype.runTransaction=function(t,e,n){var r=this;Fv(uE,"Starting transaction:",t);var i,o=e.endsWith("idempotent"),a=e.startsWith("readonly")?o?"readonly-idempotent":"readonly":o?"readwrite-idempotent":"readwrite";return this.simpleDb.runTransaction(a,Bw,(function(o){return i=new lE(o,r.listenSequence.next()),"readwrite-primary"===e||"readwrite-primary-idempotent"===e?r.verifyPrimaryLease(o).next((function(t){return!!t||r.canActAsPrimary(o)})).next((function(e){if(!e)throw Uv("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget((function(){return r.primaryStateListener(!1)})),new zv(Hv.FAILED_PRECONDITION,cE);return n(i)})).next((function(t){return r.acquireOrExtendPrimaryLease(o).next((function(){return t}))})):r.verifyAllowTabSynchronization(o).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},dE.prototype.verifyAllowTabSynchronization=function(t){var e=this;return vE(t).get(dw.key).next((function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new zv(Hv.FAILED_PRECONDITION,hE)}))},dE.prototype.acquireOrExtendPrimaryLease=function(t){var e=new dw(this.clientId,this.allowTabSynchronization,Date.now());return vE(t).put(dw.key,e)},dE.isAvailable=function(){return jm.isAvailable()},dE.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},dE.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=vE(t);return n.get(dw.key).next((function(t){return e.isLocalClient(t)?(Fv(uE,"Releasing primary lease."),n.delete(dw.key)):qm.resolve()}))},dE.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Uv("Detected an update time that is in the future: "+t+" > "+n),1))},dE.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()}))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},dE.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Bv(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},dE.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("unload",this.windowUnloadHandler))},dE.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Bv("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},dE.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Fv(uE,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Uv(uE,"Failed to get zombied client id.",t),!1}},dE.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Uv("Failed to set zombie client id.",t)}},dE.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},dE.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},dE.MAIN_DATABASE="main",dE);function dE(t,e,n,r,i,o,a,s){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.queue=o,this.sequenceNumberSyncer=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new mE(this,i),this.dbName=e+dE.MAIN_DATABASE,this.serializer=new zw(a),this.document=r.document,this.targetCache=new l_(this.referenceDelegate,this.serializer),this.indexManager=new jw,this.remoteDocumentCache=new Zb(this.serializer,this.indexManager),!r.window||!r.window.localStorage)throw new zv(Hv.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}function yE(t){return pa(this,void 0,void 0,(function(){return fa(this,(function(e){if(!function(t){return t.code===Hv.FAILED_PRECONDITION&&t.message===cE}(t))throw t;return Fv(uE,"Unexpectedly lost primary lease"),[2]}))}))}function vE(t){return t.store(dw.store)}function gE(t){return t.store(Fw.store)}var mE=(_E.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},_E.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,(function(t){e++})).next((function(){return e}))},_E.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},_E.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,(function(t,n){return e(n)}))},_E.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},_E.prototype.addReference=function(t,e){return bE(t,e)},_E.prototype.removeReference=function(t,e){return bE(t,e)},_E.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},_E.prototype.removeMutationReference=function(t,e){return bE(t,e)},_E.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?qm.resolve(!0):function(t,e){var n=!1;return u_(t).iterateSerial((function(r){return r_(t,r,e).next((function(t){return t&&(n=!0),qm.resolve(!t)}))})).next((function(){return n}))}(t,e)},_E.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.forEachOrphanedDocument(t,(function(a,s){if(s<=e){var u=n.isPinned(t,a).next((function(e){if(!e)return o++,r.getEntry(t,a).next((function(){return r.removeEntry(a),v_(t).delete(function(t){return[0,im(t.path)]}(a))}))}));i.push(u)}})).next((function(){return qm.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},_E.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},_E.prototype.updateLimboDocument=function(t,e){return bE(t,e)},_E.prototype.forEachOrphanedDocument=function(t,e){var n,r=v_(t),i=Og.INVALID;return r.iterate({index:kw.documentTargetsIndex},(function(t,r){var o=r.path,a=r.sequenceNumber;0===t[0]?(i!==Og.INVALID&&e(new Kg(sm(n)),i),i=a,n=o):i=Og.INVALID})).next((function(){i!==Og.INVALID&&e(new Kg(sm(n)),i)}))},_E.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},_E);function _E(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new rE(this,e)}function bE(t,e){return v_(t).put(function(t,e){return new kw(0,im(t.path),e)}(e,t.currentSequenceNumber))}var wE=Number,EE=wE.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),TE=wE.MAX_SAFE_INTEGER||Math.pow(2,53)-1,CE=wE.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function SE(t){return null==t}function IE(t){return CE(t)&&t<=TE&&EE<=t}var NE,AE,DE=(kE.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";SE(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},kE.prototype.toString=function(){var t=this.path.canonicalString();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),SE(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},kE.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},kE.prototype.isDocumentQuery=function(){return Kg.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},kE);function kE(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}(AE=NE=NE||{}).First="F",AE.Last="L";var RE=(PE.atPath=function(t){return new PE(t)},Object.defineProperty(PE.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)this.memoizedOrderBy=t.isKeyField()?[oT]:[new rT(t),oT];else{Bv(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}n||this.memoizedOrderBy.push((0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:ZE.ASCENDING)===ZE.ASCENDING?oT:aT)}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),PE.prototype.addFilter=function(t){Bv(null==this.getInequalityFilterField()||!(t instanceof ME)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Bv(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new PE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.limitType,this.startAt,this.endAt)},PE.prototype.addOrderBy=function(t){Bv(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new PE(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},PE.prototype.withLimitToFirst=function(t){return new PE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,NE.First,this.startAt,this.endAt)},PE.prototype.withLimitToLast=function(t){return new PE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,NE.Last,this.startAt,this.endAt)},PE.prototype.withStartAt=function(t){return new PE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,t,this.endAt)},PE.prototype.withEndAt=function(t){return new PE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,t)},PE.prototype.asCollectionQueryAtPath=function(t){return new PE(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},PE.prototype.matchesAllDocuments=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.explicitOrderBy.length||1===this.explicitOrderBy.length&&this.explicitOrderBy[0].field.isKeyField())},PE.prototype.canonicalId=function(){return this.toTarget().canonicalId()+"|lt:"+this.limitType},PE.prototype.toString=function(){return"Query(target="+this.toTarget().toString()+"; limitType="+this.limitType+")"},PE.prototype.isEqual=function(t){return this.toTarget().isEqual(t.toTarget())&&this.limitType===t.limitType},PE.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Bv(n,"orderBy used that doesn't compare on key field"),0},PE.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},PE.prototype.hasLimitToFirst=function(){return!SE(this.limit)&&this.limitType===NE.First},PE.prototype.hasLimitToLast=function(){return!SE(this.limit)&&this.limitType===NE.Last},PE.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},PE.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof ME&&n.isInequality())return n.field}return null},PE.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof ME&&0<=t.indexOf(r.op))return r.op}return null},PE.prototype.isDocumentQuery=function(){return this.toTarget().isDocumentQuery()},PE.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},PE.prototype.toTarget=function(){if(!this.memoizedTarget)if(this.limitType===NE.First)this.memoizedTarget=new DE(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e];t.push(new rT(r.field,r.dir===ZE.DESCENDING?ZE.ASCENDING:ZE.DESCENDING))}var i=this.endAt?new eT(this.endAt.position,!this.endAt.before):null,o=this.startAt?new eT(this.startAt.position,!this.startAt.before):null;this.memoizedTarget=new DE(this.path,this.collectionGroup,t,this.filters,this.limit,i,o)}return this.memoizedTarget},PE.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):Kg.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},PE.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},PE.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},PE.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},PE.prototype.assertValidBound=function(t){Bv(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},PE);function PE(t,e,n,r,i,o,a,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=NE.First),void 0===a&&(a=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}var OE=(xE.fromString=function(t){switch(t){case"<":return xE.LESS_THAN;case"<=":return xE.LESS_THAN_OR_EQUAL;case"==":return xE.EQUAL;case">=":return xE.GREATER_THAN_OR_EQUAL;case">":return xE.GREATER_THAN;case"array-contains":return xE.ARRAY_CONTAINS;case"in":return xE.IN;case"array-contains-any":return xE.ARRAY_CONTAINS_ANY;default:return Vv("Unknown FieldFilter operator: "+t)}},xE.prototype.toString=function(){return this.name},xE.prototype.isEqual=function(t){return this.name===t.name},xE.LESS_THAN=new xE("<"),xE.LESS_THAN_OR_EQUAL=new xE("<="),xE.EQUAL=new xE("=="),xE.GREATER_THAN=new xE(">"),xE.GREATER_THAN_OR_EQUAL=new xE(">="),xE.ARRAY_CONTAINS=new xE("array-contains"),xE.IN=new xE("in"),xE.ARRAY_CONTAINS_ANY=new xE("array-contains-any"),xE);function xE(t){this.name=t}var LE,ME=(ha(FE,LE=function(){}),FE.create=function(t,e,n){if(t.isKeyField())return e===OE.IN?(Bv(n instanceof Lb,"Comparing on key with IN, but filter value not an ArrayValue"),Bv(n.internalValue.every((function(t){return t instanceof Ib})),"Comparing on key with IN, but an array value was not a RefValue"),new jE(t,n)):(Bv(n instanceof Ib,"Comparing on key, but filter value not a RefValue"),Bv(e!==OE.ARRAY_CONTAINS&&e!==OE.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new qE(t,e,n));if(n.isEqual($_.INSTANCE)){if(e!==OE.EQUAL)throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new FE(t,e,n)}if(n.isEqual(lb.NAN)){if(e!==OE.EQUAL)throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new FE(t,e,n)}return e===OE.ARRAY_CONTAINS?new KE(t,n):e===OE.IN?(Bv(n instanceof Lb,"IN filter has invalid value: "+n.toString()),new GE(t,n)):e===OE.ARRAY_CONTAINS_ANY?(Bv(n instanceof Lb,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new JE(t,n)):new FE(t,e,n)},FE.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},FE.prototype.matchesComparison=function(t){switch(this.op){case OE.LESS_THAN:return t<0;case OE.LESS_THAN_OR_EQUAL:return t<=0;case OE.EQUAL:return 0===t;case OE.GREATER_THAN:return 0<t;case OE.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Vv("Unknown FieldFilter operator: "+this.op)}},FE.prototype.isInequality=function(){return 0<=[OE.LESS_THAN,OE.LESS_THAN_OR_EQUAL,OE.GREATER_THAN,OE.GREATER_THAN_OR_EQUAL].indexOf(this.op)},FE.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},FE.prototype.isEqual=function(t){return t instanceof FE&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},FE.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},FE);function FE(t,e,n){var r=LE.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var UE,qE=(ha(VE,UE=ME),VE.prototype.matches=function(t){var e=Kg.comparator(t.key,this.value.key);return this.matchesComparison(e)},VE);function VE(){return null!==UE&&UE.apply(this,arguments)||this}var BE,jE=(ha(WE,BE=ME),WE.prototype.matches=function(t){return this.value.internalValue.some((function(e){return t.key.isEqual(e.key)}))},WE);function WE(t,e){var n=BE.call(this,t,OE.IN,e)||this;return n.value=e,n}var QE,KE=(ha(HE,QE=ME),HE.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Lb&&e.contains(this.value)},HE);function HE(t,e){return QE.call(this,t,OE.ARRAY_CONTAINS,e)||this}var zE,GE=(ha(YE,zE=ME),YE.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},YE);function YE(t,e){var n=zE.call(this,t,OE.IN,e)||this;return n.value=e,n}var XE,JE=(ha($E,XE=ME),$E.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Lb&&n.internalValue.some((function(t){return e.value.contains(t)}))},$E);function $E(t,e){var n=XE.call(this,t,OE.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var ZE=(tT.prototype.toString=function(){return this.name},tT.ASCENDING=new tT("asc"),tT.DESCENDING=new tT("desc"),tT);function tT(t){this.name=t}var eT=(nT.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},nT.prototype.sortsBeforeDocument=function(t,e){Bv(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Bv(o instanceof Ib,"Bound has a non-key value where the key path is being used."),n=Kg.comparator(o.key,e.key);else{var a=e.field(i.field);Bv(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===ZE.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},nT.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!this.position[e].isEqual(t.position[e]))return!1;return!0},nT);function nT(t,e){this.position=t,this.before=e}var rT=(iT.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Vb.compareByKey(t,e):Vb.compareByField(this.field,t,e);switch(this.dir){case ZE.ASCENDING:return n;case ZE.DESCENDING:return-1*n;default:return Vv("Unknown direction: "+this.dir)}},iT.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},iT.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},iT.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},iT);function iT(t,e){this.field=t,void 0===e&&(e=ZE.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var oT=new rT(Wg.keyField(),ZE.ASCENDING),aT=new rT(Wg.keyField(),ZE.DESCENDING),sT=(uT.prototype.setLocalDocumentsView=function(t){this.localDocumentsView=t},uT.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return Bv(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),e.matchesAllDocuments()?this.executeFullCollectionScan(t,e):n.isEqual(hm.MIN)?this.executeFullCollectionScan(t,e):this.localDocumentsView.getDocuments(t,r).next((function(o){var a=i.applyQuery(e,o);return(e.hasLimitToFirst()||e.hasLimitToLast())&&i.needsRefill(e.limitType,a,r,n)?i.executeFullCollectionScan(t,e):(Lv()<=Sv.DEBUG&&Fv("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),e.toString()),i.localDocumentsView.getDocumentsMatchingQuery(t,e,n).next((function(t){return a.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},uT.prototype.applyQuery=function(t,e){var n=new bm((function(e,n){return t.docComparator(e,n)}));return e.forEach((function(e,r){r instanceof Vb&&t.matches(r)&&(n=n.add(r))})),n},uT.prototype.needsRefill=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===NE.First?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))},uT.prototype.executeFullCollectionScan=function(t,e){return Lv()<=Sv.DEBUG&&Fv("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.localDocumentsView.getDocumentsMatchingQuery(t,e,hm.MIN)},uT);function uT(){}var cT=(hT.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.getDocumentInternal(t,e,r)}))},hT.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t}))},hT.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=Im();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].applyToLocalView(t,e);r=r.insert(t,e)})),r},hT.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next((function(e){return n.getLocalViewOfDocuments(t,e)}))},hT.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=Sm();return i.forEach((function(t,e){e=e||new Wb(t,hm.forDeletedDoc()),o=o.insert(t,e)})),o}))},hT.prototype.getDocumentsMatchingQuery=function(t,e,n){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)},hT.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Kg(e)).next((function(t){var e=Am();return t instanceof Vb&&(e=e.insert(t.key,t)),e}))},hT.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e,n){var r=this;Bv(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var i=e.collectionGroup,o=Am();return this.indexManager.getCollectionParents(t,i).next((function(a){return qm.forEach(a,(function(a){var s=e.asCollectionQueryAtPath(a.child(i));return r.getDocumentsMatchingCollectionQuery(t,s,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},hT.prototype.getDocumentsMatchingCollectionQuery=function(t,e,n){var r,i,o=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return o.addMissingBaseDocuments(t,i=e,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,h=r.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);r=l instanceof Vb?r.insert(c,l):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){e.matches(n)||(r=r.remove(t))})),r}))},hT.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Pm(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof P_&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof Vb&&(c=c.insert(t,e))})),c}))},hT);function hT(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var lT=(pT.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},pT.prototype.addReference=function(t,e){var n=new fT(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},pT.prototype.addReferences=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},pT.prototype.removeReference=function(t,e){this.removeRef(new fT(t,e))},pT.prototype.removeReferences=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},pT.prototype.removeReferencesForId=function(t){var e=this,n=Kg.EMPTY,r=new fT(n,t),i=new fT(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],(function(t){e.removeRef(t),o.push(t.key)})),o},pT.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach((function(e){return t.removeRef(e)}))},pT.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},pT.prototype.referencesForId=function(t){var e=Kg.EMPTY,n=new fT(e,t),r=new fT(e,t+1),i=Pm();return this.refsByTarget.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},pT.prototype.containsKey=function(t){var e=new fT(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},pT);function pT(){this.refsByKey=new bm(fT.compareByKey),this.refsByTarget=new bm(fT.compareByTargetId)}var fT=(dT.compareByKey=function(t,e){return Kg.comparator(t.key,e.key)||wg(t.targetOrBatchId,e.targetOrBatchId)},dT.compareByTargetId=function(t,e){return wg(t.targetOrBatchId,e.targetOrBatchId)||Kg.comparator(t.key,e.key)},dT);function dT(t,e){this.key=t,this.targetOrBatchId=e}var yT=(vT.prototype.start=function(){return this.synchronizeLastDocumentChangeReadTime()},vT.prototype.handleUserChange=function(t){return pa(this,void 0,void 0,(function(){var e,n,r,i=this;return fa(this,(function(o){switch(o.label){case 0:return e=this.mutationQueue,n=this.localDocuments,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",(function(r){var o;return i.mutationQueue.getAllMutationBatches(r).next((function(a){return o=a,e=i.persistence.getMutationQueue(t),n=new cT(i.remoteDocuments,e,i.persistence.getIndexManager()),e.getAllMutationBatches(r)})).next((function(t){for(var e=[],i=[],a=Pm(),s=0,u=o;s<u.length;s++){var c=u[s];e.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var p=l[h];a=a.add(p.key)}}for(var f=0,d=t;f<d.length;f++){i.push((c=d[f]).batchId);for(var y=0,v=c.mutations;y<v.length;y++)a=a.add((p=v[y]).key)}return n.getDocuments(r,a).next((function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:i}}))}))}))];case 1:return r=o.sent(),this.mutationQueue=e,this.localDocuments=n,this.queryEngine.setLocalDocumentsView(this.localDocuments),[2,r]}}))}))},vT.prototype.localWrite=function(t){var e,n=this,r=um.now(),i=t.reduce((function(t,e){return t.add(e.key)}),Pm());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",(function(o){return n.localDocuments.getDocuments(o,i).next((function(i){e=i;for(var a=[],s=0,u=t;s<u.length;s++){var c=u[s],h=c.extractBaseValue(e.get(c.key));null!=h&&a.push(new P_(c.key,h,h.fieldMask(),C_.exists(!0)))}return n.mutationQueue.addMutationBatch(o,r,a,t)}))})).then((function(t){var n=t.applyToLocalDocumentSet(e);return{batchId:t.batchId,changes:n}}))},vT.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",(function(n){return e.mutationQueue.lookupMutationKeys(n,t).next((function(t){return t?e.localDocuments.getDocuments(n,t):qm.resolve(null)}))}))},vT.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",(function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer({trackRemovals:!0});return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next((function(){return e.applyWriteToRemoteDocuments(n,t,i)})).next((function(){return i.apply(n)})).next((function(){return e.mutationQueue.performConsistencyCheck(n)})).next((function(){return e.localDocuments.getDocuments(n,r)}))}))},vT.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",(function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next((function(t){return Bv(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)})).next((function(){return e.mutationQueue.performConsistencyCheck(n)})).next((function(){return e.localDocuments.getDocuments(n,r)}))}))},vT.prototype.getHighestUnacknowledgedBatchId=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",(function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)}))},vT.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",(function(e){return t.mutationQueue.getLastStreamToken(e)}))},vT.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",(function(n){return e.mutationQueue.setLastStreamToken(n,t)}))},vT.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",(function(e){return t.targetCache.getLastRemoteSnapshotVersion(e)}))},vT.prototype.applyRemoteEvent=function(t){var e=this,n=t.snapshotVersion,r=this.targetDataByTarget;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",(function(i){var o=e.remoteDocuments.newChangeBuffer({trackRemovals:!0});r=e.targetDataByTarget;var a=[];$v(t.targetChanges,(function(t,o){var s=r.get(t);if(s){a.push(e.targetCache.removeMatchingKeys(i,o.removedDocuments,t).next((function(){return e.targetCache.addMatchingKeys(i,o.addedDocuments,t)})));var u=o.resumeToken;if(0<u.length){var c=s.withResumeToken(u,n).withSequenceNumber(i.currentSequenceNumber);r=r.insert(t,c),vT.shouldPersistTargetData(s,c,o)&&a.push(e.targetCache.updateTargetData(i,c))}}}));var s=Sm(),u=Pm();if(t.documentUpdates.forEach((function(t,e){u=u.add(t)})),a.push(o.getEntries(i,u).next((function(r){t.documentUpdates.forEach((function(u,c){var h=r.get(u);c instanceof Wb&&c.version.isEqual(hm.MIN)?(o.removeEntry(u,n),s=s.insert(u,c)):null==h||0<c.version.compareTo(h.version)||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(Bv(!hm.MIN.isEqual(n),"Cannot add a document when the remote version is zero"),o.addEntry(c,n),s=s.insert(u,c)):Fv("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),t.resolvedLimboDocuments.has(u)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(i,u))}))}))),!n.isEqual(hm.MIN)){var c=e.targetCache.getLastRemoteSnapshotVersion(i).next((function(t){return Bv(0<=n.compareTo(t),"Watch stream reverted to previous snapshot?? "+n+" < "+t),e.targetCache.setTargetsMetadata(i,i.currentSequenceNumber,n)}));a.push(c)}return qm.waitFor(a).next((function(){return o.apply(i)})).next((function(){return e.localDocuments.getLocalViewOfDocuments(i,s)}))})).then((function(t){return e.targetDataByTarget=r,t}))},vT.shouldPersistTargetData=function(t,e,n){return Bv(0<e.resumeToken.length,"Attempted to persist target data with no resume token"),0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size},vT.prototype.notifyLocalViewChanges=function(t){for(var e=this,n=0,r=t;n<r.length;n++){var i=r[n],o=i.targetId;if(this.localViewReferences.addReferences(i.addedKeys,o),this.localViewReferences.removeReferences(i.removedKeys,o),!i.fromCache){var a=this.targetDataByTarget.get(o);Bv(null!==a,"Can't set limbo-free snapshot version for unknown target: "+o);var s=a.withLastLimboFreeSnapshotVersion(a.snapshotVersion);this.targetDataByTarget=this.targetDataByTarget.insert(o,s)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",(function(n){return qm.forEach(t,(function(t){return qm.forEach(t.removedKeys,(function(t){return e.persistence.referenceDelegate.removeReference(n,t)}))}))}))},vT.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",(function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)}))},vT.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly-idempotent",(function(n){return e.localDocuments.getDocument(n,t)}))},vT.prototype.allocateTarget=function(t){var e=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",(function(n){var r;return e.targetCache.getTargetData(n,t).next((function(i){return i?qm.resolve(r=i):e.targetCache.allocateTargetId(n).next((function(i){return r=new Kw(t,i,qw.Listen,n.currentSequenceNumber),e.targetCache.addTargetData(n,r).next((function(){return r}))}))}))})).then((function(n){return null===e.targetDataByTarget.get(n.targetId)&&(e.targetDataByTarget=e.targetDataByTarget.insert(n.targetId,n),e.targetIdByTarget.set(t,n.targetId)),n}))},vT.prototype.getTargetData=function(t,e){var n=this.targetIdByTarget.get(e);return void 0!==n?qm.resolve(this.targetDataByTarget.get(n)):this.targetCache.getTargetData(t,e)},vT.prototype.releaseTarget=function(t,e){var n=this,r=this.targetDataByTarget.get(t);return Bv(null!==r,"Tried to release nonexistent target: "+t),this.persistence.runTransaction("Release target",e?"readwrite-idempotent":"readwrite-primary-idempotent",(function(i){var o=n.localViewReferences.removeReferencesForId(t);return e?qm.resolve():qm.forEach(o,(function(t){return n.persistence.referenceDelegate.removeReference(i,t)})).next((function(){n.persistence.referenceDelegate.removeTarget(i,r)}))})).then((function(){n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(r.target)}))},vT.prototype.executeQuery=function(t,e){var n=this,r=hm.MIN,i=Pm();return this.persistence.runTransaction("Execute query","readonly-idempotent",(function(o){return n.getTargetData(o,t.toTarget()).next((function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(o,t.targetId).next((function(t){i=t}))})).next((function(){return n.queryEngine.getDocumentsMatchingQuery(o,t,e?r:hm.MIN,e?i:Pm())})).next((function(t){return{documents:t,remoteKeys:i}}))}))},vT.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",(function(n){return e.targetCache.getMatchingKeysForTargetId(n,t)}))},vT.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},vT.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},vT.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},vT.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=qm.resolve();return o.forEach((function(r){a=a.next((function(){return n.getEntry(t,r)})).next((function(t){var o=t,a=e.docVersions.get(r);Bv(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o,e.commitVersion):Bv(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))}))})),a.next((function(){return r.mutationQueue.removeMutationBatch(t,i)}))},vT.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",(function(n){return t.collect(n,e.targetDataByTarget)}))},vT.prototype.getTarget=function(t){var e=this,n=this.targetDataByTarget.get(t);return n?Promise.resolve(n.target):this.persistence.runTransaction("Get target data","readonly-idempotent",(function(n){return e.targetCache.getTargetDataForTarget(n,t).next((function(t){return t?t.target:null}))}))},vT.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",(function(e){return t.remoteDocuments.getNewDocumentChanges(e,t.lastDocumentChangeReadTime)})).then((function(e){var n=e.changedDocs;return t.lastDocumentChangeReadTime=e.readTime,n}))},vT.prototype.synchronizeLastDocumentChangeReadTime=function(){return pa(this,void 0,void 0,(function(){var t,e=this;return fa(this,(function(n){return this.remoteDocuments instanceof Zb?(t=this.remoteDocuments,[2,this.persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",(function(e){return t.getLastDocumentChange(e)})).then((function(t){e.lastDocumentChangeReadTime=t.readTime}))]):[2]}))}))},vT.RESUME_TOKEN_MAX_AGE_MICROS=3e8,vT);function vT(t,e,n){this.persistence=t,this.queryEngine=e,this.localViewReferences=new lT,this.targetDataByTarget=new pm(wg),this.targetIdByTarget=new Gb((function(t){return t.canonicalId()})),this.lastDocumentChangeReadTime=hm.MIN,Bv(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(n),this.remoteDocuments=t.getRemoteDocumentCache(),this.targetCache=t.getTargetCache(),this.localDocuments=new cT(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.queryEngine.setLocalDocumentsView(this.localDocuments)}var gT=(mT.prototype.checkEmpty=function(t){return qm.resolve(0===this.mutationQueue.length)},mT.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Bv(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Bv(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,qm.resolve()},mT.prototype.getLastStreamToken=function(t){return qm.resolve(this.lastStreamToken)},mT.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,qm.resolve()},mT.prototype.addMutationBatch=function(t,e,n,r){Bv(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Bv(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Lm(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new fT(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return qm.resolve(o)},mT.prototype.lookupMutationBatch=function(t,e){return qm.resolve(this.findMutationBatch(e))},mT.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Bv(null!=n,"Failed to find local mutation batch."),qm.resolve(n.keys())},mT.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.indexOfBatchId(e+1),r=n<0?0:n;return qm.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)},mT.prototype.getHighestUnacknowledgedBatchId=function(){return qm.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},mT.prototype.getAllMutationBatches=function(t){return qm.resolve(this.mutationQueue.slice())},mT.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new fT(e,0),i=new fT(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],(function(t){Bv(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);Bv(null!==r,"Batches in the index must exist in the main table"),o.push(r)})),qm.resolve(o)},mT.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new bm(wg);return e.forEach((function(t){var e=new fT(t,0),i=new fT(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],(function(e){Bv(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)}))})),qm.resolve(this.findMutationBatches(r))},mT.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Bv(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Kg.isDocumentKey(i)||(i=i.child(""));var o=new fT(new Kg(i),0),a=new bm(wg);return this.batchesByDocumentKey.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)}),o),qm.resolve(this.findMutationBatches(a))},mT.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)})),n},mT.prototype.removeMutationBatch=function(t,e){var n=this;Bv(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return qm.forEach(e.mutations,(function(i){var o=new fT(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)})).next((function(){n.batchesByDocumentKey=r}))},mT.prototype.removeCachedMutationKeys=function(t){},mT.prototype.containsKey=function(t,e){var n=new fT(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return qm.resolve(e.isEqual(r&&r.key))},mT.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Bv(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),qm.resolve()},mT.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Bv(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},mT.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},mT.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Bv(n.batchId===t,"If found batch must match"),n},mT);function mT(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Qv(),this.batchesByDocumentKey=new bm(fT.compareByKey)}var _T,bT=(wT.prototype.addEntry=function(t,e,n){Bv(!n.isEqual(hm.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.sizer(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:a,readTime:n}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())},wT.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},wT.prototype.getEntry=function(t,e){var n=this.docs.get(e);return qm.resolve(n?n.maybeDocument:null)},wT.prototype.getEntries=function(t,e){var n=this,r=Im();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)})),qm.resolve(r)},wT.prototype.getDocumentsMatchingQuery=function(t,e,n){Bv(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=Am(),i=new Kg(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.value,u=s.maybeDocument,c=s.readTime;if(!e.path.isPrefixOf(a.key.path))break;c.compareTo(n)<=0||u instanceof Vb&&e.matches(u)&&(r=r.insert(u.key,u))}return qm.resolve(r)},wT.prototype.forEachDocumentKey=function(t,e){return qm.forEach(this.docs,(function(t){return e(t)}))},wT.prototype.getNewDocumentChanges=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},wT.prototype.newChangeBuffer=function(t){return new wT.RemoteDocumentChangeBuffer(this)},wT.prototype.getSize=function(t){return qm.resolve(this.size)},wT.RemoteDocumentChangeBuffer=(ha(ET,_T=Xb),ET.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i?n.push(e.documentCache.addEntry(t,i,e.readTime)):e.documentCache.removeEntry(r)})),qm.waitFor(n)},ET.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},ET.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},ET),wT);function wT(t,e){this.indexManager=t,this.sizer=e,this.docs=new pm(Kg.comparator),this.size=0}function ET(t){var e=_T.call(this)||this;return e.documentCache=t,e}var TT=(CT.prototype.forEachTarget=function(t,e){return this.targets.forEach((function(t,n){return e(n)})),qm.resolve()},CT.prototype.getLastRemoteSnapshotVersion=function(t){return qm.resolve(this.lastRemoteSnapshotVersion)},CT.prototype.getHighestSequenceNumber=function(t){return qm.resolve(this.highestSequenceNumber)},CT.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,qm.resolve(e)},CT.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),qm.resolve()},CT.prototype.saveTargetData=function(t){this.targets.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},CT.prototype.addTargetData=function(t,e){return Bv(!this.targets.has(e.target),"Adding a target that already exists"),this.saveTargetData(e),this.targetCount+=1,qm.resolve()},CT.prototype.updateTargetData=function(t,e){return Bv(this.targets.has(e.target),"Updating a non-existent target"),this.saveTargetData(e),qm.resolve()},CT.prototype.removeTargetData=function(t,e){return Bv(0<this.targetCount,"Removing a target from an empty cache"),Bv(this.targets.has(e.target),"Removing a non-existent target from the cache"),this.targets.delete(e.target),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,qm.resolve()},CT.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.targets.forEach((function(a,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.targets.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)})),qm.waitFor(o).next((function(){return i}))},CT.prototype.getTargetCount=function(t){return qm.resolve(this.targetCount)},CT.prototype.getTargetData=function(t,e){var n=this.targets.get(e)||null;return qm.resolve(n)},CT.prototype.getTargetDataForTarget=function(t,e){return Vv("Not yet implemented.")},CT.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.addReference(t,e))})),qm.waitFor(i)},CT.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.removeReference(t,e))})),qm.waitFor(i)},CT.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),qm.resolve()},CT.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return qm.resolve(n)},CT.prototype.containsKey=function(t,e){return qm.resolve(this.references.containsKey(e))},CT);function CT(t){this.persistence=t,this.targets=new Gb((function(t){return t.canonicalId()})),this.lastRemoteSnapshotVersion=hm.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new lT,this.targetCount=0,this.targetIdGenerator=c_.forTargetCache()}var ST=(IT.createLruPersistence=function(t,e,n){return new IT(t,(function(t){return new PT(t,new zw(e),n)}))},IT.createEagerPersistence=function(t){return new IT(t,(function(t){return new kT(t)}))},IT.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(IT.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),IT.prototype.getActiveClients=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){return[2,[this.clientId]]}))}))},IT.prototype.setPrimaryStateListener=function(t){return t(!0)},IT.prototype.setDatabaseDeletedListener=function(){},IT.prototype.setNetworkEnabled=function(t){},IT.prototype.getIndexManager=function(){return this.indexManager},IT.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new gT(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},IT.prototype.getTargetCache=function(){return this.targetCache},IT.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},IT.prototype.runTransaction=function(t,e,n){var r=this;Fv("MemoryPersistence","Starting transaction:",t);var i=new AT(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next((function(t){return r.referenceDelegate.onTransactionCommitted(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},IT.prototype.mutationQueuesContainKey=function(t,e){return qm.or(function(t){var e=[];return Zv(t,(function(t,n){return e.push(n)})),e}(this.mutationQueues).map((function(n){return function(){return n.containsKey(t,e)}})))},IT);function IT(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Og(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new TT(this),this.indexManager=new aw,this.remoteDocumentCache=new bT(this.indexManager,(function(t){return n.referenceDelegate.documentSize(t)}))}var NT,AT=(ha(DT,NT=oE),DT);function DT(t){var e=NT.call(this)||this;return e.currentSequenceNumber=t,e}var kT=(Object.defineProperty(RT.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Vv("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),RT.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},RT.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),qm.resolve()},RT.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),qm.resolve()},RT.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),qm.resolve()},RT.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.orphanedDocuments.add(t)}))})).next((function(){return r.removeTargetData(t,e)}))},RT.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},RT.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return qm.forEach(this.orphanedDocuments,(function(r){return e.isReferenced(t,r).next((function(t){t||n.removeEntry(r)}))})).next((function(){return e._orphanedDocuments=null,n.apply(t)}))},RT.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next((function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)}))},RT.prototype.documentSize=function(t){return 0},RT.prototype.isReferenced=function(t,e){var n=this;return qm.or([function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return qm.resolve(n.inMemoryPins.containsKey(e))}])},RT);function RT(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var PT=(OT.prototype.onTransactionStarted=function(){},OT.prototype.onTransactionCommitted=function(t){return qm.resolve()},OT.prototype.forEachTarget=function(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)},OT.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},OT.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,(function(t){e++})).next((function(){return e}))},OT.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return qm.forEach(this.orphanedSequenceNumbers,(function(r,i){return n.isPinned(t,r,i).next((function(t){return t?qm.resolve():e(i)}))}))},OT.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},OT.prototype.removeTargets=function(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)},OT.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.forEachDocumentKey(t,(function(i){return n.isPinned(t,i,e).next((function(t){t||(r++,o.removeEntry(i))}))})).next((function(){return o.apply(t)})).next((function(){return r}))},OT.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),qm.resolve()},OT.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)},OT.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),qm.resolve()},OT.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),qm.resolve()},OT.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),qm.resolve()},OT.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t,t.version);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Vv("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},OT.prototype.isPinned=function(t,e,n){var r=this;return qm.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return qm.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getTargetCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return qm.resolve(void 0!==t&&n<t)}])},OT.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},OT);function OT(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new Gb((function(t){return im(t.path)})),this.garbageCollector=new rE(this,n)}var xT=(LT.prototype.reset=function(){this.currentBaseMs=0},LT.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},LT.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&Fv("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,(function(){return e.lastAttemptTime=Date.now(),t()})),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},LT.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},LT.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},LT);function LT(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var MT,FT,UT="PersistentStream";(FT=MT=MT||{})[FT.Initial=0]="Initial",FT[FT.Starting=1]="Starting",FT[FT.Open=2]="Open",FT[FT.Error=3]="Error",FT[FT.Backoff=4]="Backoff";var qT=(VT.prototype.isStarted=function(){return this.state===MT.Starting||this.state===MT.Open||this.state===MT.Backoff},VT.prototype.isOpen=function(){return this.state===MT.Open},VT.prototype.start=function(){this.state!==MT.Error?(Bv(this.state===MT.Initial,"Already started"),this.auth()):this.performBackoff()},VT.prototype.stop=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(MT.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},VT.prototype.inhibitBackoff=function(){Bv(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=MT.Initial,this.backoff.reset()},VT.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,(function(){return t.handleIdleCloseTimer()})))},VT.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},VT.prototype.handleIdleCloseTimer=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){return this.isOpen()?[2,this.close(MT.Initial)]:[2]}))}))},VT.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},VT.prototype.close=function(t,e){return pa(this,void 0,void 0,(function(){return fa(this,(function(n){switch(n.label){case 0:return Bv(this.isStarted(),"Only started streams should be closed."),Bv(t===MT.Error||SE(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==MT.Error?this.backoff.reset():e&&e.code===Hv.RESOURCE_EXHAUSTED?(Uv(e.toString()),Uv("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===Hv.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}}))}))},VT.prototype.tearDown=function(){},VT.prototype.auth=function(){var t=this;Bv(this.state===MT.Initial,"Must be in initial state to auth"),this.state=MT.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then((function(e){t.closeCount===n&&t.startStream(e)}),(function(n){e((function(){var e=new zv(Hv.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)}))}))},VT.prototype.startStream=function(t){var e=this;Bv(this.state===MT.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen((function(){n((function(){return Bv(e.state===MT.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=MT.Open,e.listener.onOpen()}))})),this.stream.onClose((function(t){n((function(){return e.handleStreamClose(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},VT.prototype.performBackoff=function(){var t=this;Bv(this.state===MT.Error,"Should only perform backoff when in Error state"),this.state=MT.Backoff,this.backoff.backoffAndRun((function(){return pa(t,void 0,void 0,(function(){return fa(this,(function(t){return Bv(this.state===MT.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=MT.Initial,this.start(),Bv(this.isStarted(),"PersistentStream should have started"),[2]}))}))}))},VT.prototype.handleStreamClose=function(t){return Bv(this.isStarted(),"Can't handle server close on non-started stream"),Fv(UT,"close with error: "+t),this.stream=null,this.close(MT.Error,t)},VT.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget((function(){return e.closeCount===t?n():(Fv(UT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},VT);function VT(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=MT.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new xT(t,e)}var BT,jT=(ha(WT,BT=qT),WT.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},WT.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},WT.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},WT.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},WT);function WT(t,e,n,r,i){var o=BT.call(this,t,zg.ListenStreamConnectionBackoff,zg.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var QT,KT=(ha(HT,QT=qT),Object.defineProperty(HT.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),HT.prototype.start=function(){this.handshakeComplete_=!1,QT.prototype.start.call(this)},HT.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},HT.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},HT.prototype.onMessage=function(t){if(Bv(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Bv(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},HT.prototype.writeHandshake=function(){Bv(this.isOpen(),"Writing handshake requires an opened stream"),Bv(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},HT.prototype.writeMutations=function(t){var e=this;Bv(this.isOpen(),"Writing mutations requires an opened stream"),Bv(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Bv(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map((function(t){return e.serializer.toMutation(t)}))};this.sendRequest(n)},HT);function HT(t,e,n,r,i){var o=QT.call(this,t,zg.WriteStreamConnectionBackoff,zg.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=Qv(),o}var zT=(GT.prototype.newPersistentWriteStream=function(t){return new KT(this.queue,this.connection,this.credentials,this.serializer,t)},GT.prototype.newPersistentWatchStream=function(t){return new jT(this.queue,this.connection,this.credentials,this.serializer,t)},GT.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map((function(t){return e.serializer.toMutation(t)}))};return this.invokeRPC("Commit",n).then((function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)}))},GT.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map((function(t){return e.serializer.toName(t)}))};return this.invokeStreamingRPC("BatchGetDocuments",n).then((function(n){var r=Sm();n.forEach((function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)}));var i=[];return t.forEach((function(t){var e=r.get(t);Bv(!!e,"Missing entity in write response for "+t),i.push(e)})),i}))},GT.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.invokeRPC(t,e,r)})).catch((function(t){throw t.code===Hv.UNAUTHENTICATED&&n.credentials.invalidateToken(),t}))},GT.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.invokeStreamingRPC(t,e,r)})).catch((function(t){throw t.code===Hv.UNAUTHENTICATED&&n.credentials.invalidateToken(),t}))},GT);function GT(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var YT,XT,JT,$T,ZT=(tC.prototype.lookup=function(t){return pa(this,void 0,void 0,(function(){var e,n=this;return fa(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new zv(Hv.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(t)];case 1:return(e=r.sent()).forEach((function(t){t instanceof Wb||t instanceof Vb?n.recordVersion(t):Vv("Document in a transaction was a "+t.constructor.name)})),[2,e]}}))}))},tC.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},tC.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},tC.prototype.delete=function(t){this.write([new U_(t,this.precondition(t))]),this.writtenDocs.add(t)},tC.prototype.commit=function(){return pa(this,void 0,void 0,(function(){var t,e=this;return fa(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t=t.remove(e.key)})),t.forEach((function(t,n){e.mutations.push(new K_(t,e.precondition(t)))})),[4,this.datastore.commit(this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},tC.prototype.recordVersion=function(t){var e;if(t instanceof Vb)e=t.version;else{if(!(t instanceof Wb))throw Vv("Document in a transaction was a "+t.constructor.name);e=hm.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new zv(Hv.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},tC.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?C_.updateTime(e):C_.NONE},tC.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return C_.exists(!0);if(e.isEqual(hm.forDeletedDoc()))throw new zv(Hv.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return C_.updateTime(e)},tC.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},tC.prototype.ensureCommitNotCalled=function(){Bv(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},tC);function tC(t){this.datastore=t,this.readVersions=km(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(XT=YT=YT||{})[XT.Unknown=0]="Unknown",XT[XT.Online=1]="Online",XT[XT.Offline=2]="Offline",($T=JT=JT||{})[$T.RemoteStore=0]="RemoteStore",$T[$T.SharedClientState=1]="SharedClientState";var eC,nC,rC=(iC.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(YT.Unknown),Bv(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(zg.OnlineStateTimeout,1e4,(function(){return t.onlineStateTimer=null,Bv(t.state===YT.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(YT.Offline),Promise.resolve()})))},iC.prototype.handleWatchStreamFailure=function(t){this.state===YT.Online?(this.setAndBroadcast(YT.Unknown),Bv(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Bv(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(YT.Offline)))},iC.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===YT.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},iC.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},iC.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Uv(e),this.shouldWarnClientIsOffline=!1):Fv("OnlineStateTracker",e)},iC.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},iC);function iC(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=YT.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function oC(t){switch(t){case Hv.OK:return Vv("Treated status OK as error");case Hv.CANCELLED:case Hv.UNKNOWN:case Hv.DEADLINE_EXCEEDED:case Hv.RESOURCE_EXHAUSTED:case Hv.INTERNAL:case Hv.UNAVAILABLE:case Hv.UNAUTHENTICATED:return!1;case Hv.INVALID_ARGUMENT:case Hv.NOT_FOUND:case Hv.ALREADY_EXISTS:case Hv.PERMISSION_DENIED:case Hv.FAILED_PRECONDITION:case Hv.ABORTED:case Hv.OUT_OF_RANGE:case Hv.UNIMPLEMENTED:case Hv.DATA_LOSS:return!0;default:return Vv("Unknown status code: "+t)}}function aC(t){if(void 0===t)return Uv("GRPC error has no .code"),Hv.UNKNOWN;switch(t){case eC.OK:return Hv.OK;case eC.CANCELLED:return Hv.CANCELLED;case eC.UNKNOWN:return Hv.UNKNOWN;case eC.DEADLINE_EXCEEDED:return Hv.DEADLINE_EXCEEDED;case eC.RESOURCE_EXHAUSTED:return Hv.RESOURCE_EXHAUSTED;case eC.INTERNAL:return Hv.INTERNAL;case eC.UNAVAILABLE:return Hv.UNAVAILABLE;case eC.UNAUTHENTICATED:return Hv.UNAUTHENTICATED;case eC.INVALID_ARGUMENT:return Hv.INVALID_ARGUMENT;case eC.NOT_FOUND:return Hv.NOT_FOUND;case eC.ALREADY_EXISTS:return Hv.ALREADY_EXISTS;case eC.PERMISSION_DENIED:return Hv.PERMISSION_DENIED;case eC.FAILED_PRECONDITION:return Hv.FAILED_PRECONDITION;case eC.ABORTED:return Hv.ABORTED;case eC.OUT_OF_RANGE:return Hv.OUT_OF_RANGE;case eC.UNIMPLEMENTED:return Hv.UNIMPLEMENTED;case eC.DATA_LOSS:return Hv.DATA_LOSS;default:return Vv("Unknown status code: "+t)}}(nC=eC=eC||{})[nC.OK=0]="OK",nC[nC.CANCELLED=1]="CANCELLED",nC[nC.UNKNOWN=2]="UNKNOWN",nC[nC.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",nC[nC.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",nC[nC.NOT_FOUND=5]="NOT_FOUND",nC[nC.ALREADY_EXISTS=6]="ALREADY_EXISTS",nC[nC.PERMISSION_DENIED=7]="PERMISSION_DENIED",nC[nC.UNAUTHENTICATED=16]="UNAUTHENTICATED",nC[nC.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",nC[nC.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",nC[nC.ABORTED=10]="ABORTED",nC[nC.OUT_OF_RANGE=11]="OUT_OF_RANGE",nC[nC.UNIMPLEMENTED=12]="UNIMPLEMENTED",nC[nC.INTERNAL=13]="INTERNAL",nC[nC.UNAVAILABLE=14]="UNAVAILABLE",nC[nC.DATA_LOSS=15]="DATA_LOSS";var sC,uC,cC,hC,lC=(pC.emptySet=function(t){return new pC(t.comparator)},pC.prototype.has=function(t){return null!=this.keyedMap.get(t)},pC.prototype.get=function(t){return this.keyedMap.get(t)},pC.prototype.first=function(){return this.sortedSet.minKey()},pC.prototype.last=function(){return this.sortedSet.maxKey()},pC.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},pC.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(pC.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),pC.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},pC.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},pC.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},pC.prototype.isEqual=function(t){if(!(t instanceof pC))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},pC.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},pC.prototype.copy=function(t,e){var n=new pC;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},pC);function pC(t){this.comparator=t?function(e,n){return t(e,n)||Kg.comparator(e.key,n.key)}:function(t,e){return Kg.comparator(t.key,e.key)},this.keyedMap=Am(),this.sortedSet=new pm(this.comparator)}(uC=sC=sC||{})[uC.Added=0]="Added",uC[uC.Removed=1]="Removed",uC[uC.Modified=2]="Modified",uC[uC.Metadata=3]="Metadata",(hC=cC=cC||{})[hC.Local=0]="Local",hC[hC.Synced=1]="Synced";var fC=(dC.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==sC.Added&&n.type===sC.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===sC.Metadata&&n.type!==sC.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===sC.Modified&&n.type===sC.Modified?this.changeMap=this.changeMap.insert(e,{type:sC.Modified,doc:t.doc}):t.type===sC.Modified&&n.type===sC.Added?this.changeMap=this.changeMap.insert(e,{type:sC.Added,doc:t.doc}):t.type===sC.Removed&&n.type===sC.Added?this.changeMap=this.changeMap.remove(e):t.type===sC.Removed&&n.type===sC.Modified?this.changeMap=this.changeMap.insert(e,{type:sC.Removed,doc:n.doc}):t.type===sC.Added&&n.type===sC.Removed?this.changeMap=this.changeMap.insert(e,{type:sC.Modified,doc:t.doc}):Vv("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},dC.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal((function(e,n){t.push(n)})),t},dC);function dC(){this.changeMap=new pm(Kg.comparator)}var yC=(vC.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach((function(t){i.push({type:sC.Added,doc:t})})),new vC(t,e,lC.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(vC.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),vC.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},vC);function vC(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var gC=(mC.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=_C.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new mC(hm.MIN,r,xm(),Sm(),Pm())},mC);function mC(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var _C=(bC.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new bC(Qv(),e,Pm(),Pm(),Pm())},bC);function bC(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var wC,EC,TC=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},CC=function(t,e){this.targetId=t,this.existenceFilter=e};(EC=wC=wC||{})[EC.NoChange=0]="NoChange",EC[EC.Added=1]="Added",EC[EC.Removed=2]="Removed",EC[EC.Current=3]="Current",EC[EC.Reset=4]="Reset";var SC=function(t,e,n,r){void 0===n&&(n=Qv()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},IC=(Object.defineProperty(NC.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(NC.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(NC.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(NC.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),NC.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},NC.prototype.toTargetChange=function(){var t=Pm(),e=Pm(),n=Pm();return this.documentChanges.forEach((function(r,i){switch(i){case sC.Added:t=t.add(r);break;case sC.Modified:e=e.add(r);break;case sC.Removed:n=n.add(r);break;default:Vv("Encountered invalid change type: "+i)}})),new _C(this._resumeToken,this._current,t,e,n)},NC.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=RC()},NC.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},NC.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},NC.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},NC.prototype.recordTargetResponse=function(){this.pendingResponses-=1},NC.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},NC);function NC(){this.pendingResponses=0,this.documentChanges=RC(),this._resumeToken=Qv(),this._current=!1,this._hasPendingChanges=!0}var AC=(DC.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Vb?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof Wb&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.removeDocumentFromTarget(r=o[i],t.key,t.newDoc)},DC.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.ensureTargetState(n);switch(t.state){case wC.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case wC.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case wC.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),Bv(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case wC.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case wC.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:Vv("Unknown target watch change state: "+t.state)}}))},DC.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):$v(this.targetStates,e)},DC.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.targetDataForActiveTarget(e);if(r){var i=r.target;if(i.isDocumentQuery())if(0===n){var o=new Kg(i.path);this.removeDocumentFromTarget(e,o,new Wb(o,hm.forDeletedDoc()))}else Bv(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},DC.prototype.createRemoteEvent=function(t){var e=this,n={};$v(this.targetStates,(function(r,i){var o=e.targetDataForActiveTarget(r);if(o){if(i.current&&o.target.isDocumentQuery()){var a=new Kg(o.target.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new Wb(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}}));var r=Pm();this.pendingDocumentTargetMapping.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.targetDataForActiveTarget(t);return!n||n.purpose===qw.LimboResolution||(i=!1)})),i&&(r=r.add(t))}));var i=new gC(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Sm(),this.pendingDocumentTargetMapping=kC(),this.pendingTargetResets=new bm(wg),i},DC.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?sC.Modified:sC.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},DC.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,sC.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},DC.prototype.removeTarget=function(t){delete this.targetStates[t]},DC.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},DC.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},DC.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new IC),this.targetStates[t]},DC.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new bm(wg),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},DC.prototype.isActiveTarget=function(t){var e=null!==this.targetDataForActiveTarget(t);return e||Fv("WatchChangeAggregator","Detected inactive target",t),e},DC.prototype.targetDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getTargetDataForTarget(t)},DC.prototype.resetTarget=function(t){var e=this;Bv(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new IC,this.metadataProvider.getRemoteKeysForTarget(t).forEach((function(n){e.removeDocumentFromTarget(t,n,null)}))},DC.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},DC);function DC(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=Sm(),this.pendingDocumentTargetMapping=kC(),this.pendingTargetResets=new bm(wg)}function kC(){return new pm(Kg.comparator)}function RC(){return new pm(Kg.comparator)}var PC="RemoteStore",OC=(xC.prototype.start=function(){return this.enableNetwork()},xC.prototype.enableNetwork=function(){return pa(this,void 0,void 0,(function(){var t;return fa(this,(function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(YT.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},xC.prototype.disableNetwork=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(YT.Offline),[2]}}))}))},xC.prototype.disableNetworkInternal=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(Fv(PC,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}}))}))},xC.prototype.shutdown=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return Fv(PC,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(YT.Unknown),[2]}}))}))},xC.prototype.listen=function(t){Xv(this.listenTargets,t.targetId)||(this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t))},xC.prototype.unlisten=function(t){Bv(Xv(this.listenTargets,t),"unlisten called on target no currently watched: "+t),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),tg(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(YT.Unknown))},xC.prototype.getTargetDataForTarget=function(t){return this.listenTargets[t]||null},xC.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},xC.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},xC.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},xC.prototype.startWatchStream=function(){Bv(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new AC(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},xC.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!tg(this.listenTargets)},xC.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},xC.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},xC.prototype.onWatchStreamOpen=function(){return pa(this,void 0,void 0,(function(){var t=this;return fa(this,(function(e){return $v(this.listenTargets,(function(e,n){t.sendWatchRequest(n)})),[2]}))}))},xC.prototype.onWatchStreamClose=function(t){return pa(this,void 0,void 0,(function(){return fa(this,(function(e){return void 0===t&&Bv(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(YT.Unknown),[2]}))}))},xC.prototype.onWatchStreamChange=function(t,e){return pa(this,void 0,void 0,(function(){var n;return fa(this,(function(r){switch(r.label){case 0:return this.onlineStateTracker.set(YT.Online),t instanceof SC&&t.state===wC.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof TC?this.watchChangeAggregator.handleDocumentChange(t):t instanceof CC?this.watchChangeAggregator.handleExistenceFilter(t):(Bv(t instanceof SC,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(hm.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),0<=e.compareTo(n)?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},xC.prototype.raiseWatchSnapshot=function(t){var e=this;Bv(!t.isEqual(hm.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return $v(n.targetChanges,(function(n,r){if(0<r.resumeToken.length){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.withResumeToken(r.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.withResumeToken(Qv(),n.snapshotVersion),e.sendUnwatchRequest(t);var r=new Kw(n.target,t,qw.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}})),this.syncEngine.applyRemoteEvent(n)},xC.prototype.handleTargetError=function(t){var e=this;Bv(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach((function(t){r=r.then((function(){return pa(e,void 0,void 0,(function(){return fa(this,(function(e){return Xv(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]}))}))}))})),r},xC.prototype.fillWritePipeline=function(){return pa(this,void 0,void 0,(function(){var t;return fa(this,(function(e){switch(e.label){case 0:return this.canAddToWritePipeline()?[4,this.localStore.nextMutationBatch(0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1)]:[3,4];case 1:return null!==(t=e.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(t),[4,this.fillWritePipeline()];case 3:e.sent(),e.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}}))}))},xC.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},xC.prototype.outstandingWrites=function(){return this.writePipeline.length},xC.prototype.addToWritePipeline=function(t){Bv(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},xC.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},xC.prototype.startWriteStream=function(){Bv(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},xC.prototype.onWriteStreamOpen=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){return this.writeStream.writeHandshake(),[2]}))}))},xC.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then((function(){for(var e=0,n=t.writePipeline;e<n.length;e++)t.writeStream.writeMutations(n[e].mutations)})).catch(yE)},xC.prototype.onMutationResult=function(t,e){var n=this;Bv(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Fm.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then((function(){return n.fillWritePipeline()}))},xC.prototype.onWriteStreamClose=function(t){return pa(this,void 0,void 0,(function(){var e=this;return fa(this,(function(n){return void 0===t&&Bv(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then((function(){e.shouldStartWriteStream()&&e.startWriteStream()}))]:[2]}))}))},xC.prototype.handleHandshakeError=function(t){return pa(this,void 0,void 0,(function(){return fa(this,(function(e){return oC(t.code)?(Fv(PC,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Qv(),[2,this.localStore.setLastStreamToken(Qv()).catch(yE)]):[2]}))}))},xC.prototype.handleWriteError=function(t){return pa(this,void 0,void 0,(function(){var e,n=this;return fa(this,(function(r){return function(t){return oC(t)&&t!==Hv.ABORTED}(t.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then((function(){return n.fillWritePipeline()}))]):[2]}))}))},xC.prototype.createTransaction=function(){return new ZT(this.datastore)},xC.prototype.restartNetwork=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(YT.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}}))}))},xC.prototype.handleCredentialChange=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return this.canUseNetwork()?(Fv(PC,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},xC.prototype.applyPrimaryState=function(t){return pa(this,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:return(this.isPrimary=t)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(YT.Unknown),e.label=4;case 4:return[2]}}))}))},xC);function xC(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback((function(t){n.enqueueAndForget((function(){return pa(o,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return this.canUseNetwork()?(Fv(PC,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.onlineStateTracker=new rC(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var LC=(Object.defineProperty(MC.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(MC.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),MC.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},MC.prototype._compareTo=function(t){return wg(this._lat,t._lat)||wg(this._long,t._long)},MC);function MC(t,e){if(ng("GeoPoint",arguments,2),og("GeoPoint","number",1,t),og("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new zv(Hv.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new zv(Hv.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var FC=(UC.prototype.applyToLocalView=function(t,e){return new bb(e,t)},UC.prototype.applyToRemoteDocument=function(t,e){return e},UC.prototype.computeBaseValue=function(t){return null},UC.prototype.isEqual=function(t){return t instanceof UC},UC.instance=new UC,UC);function UC(){}var qC=(VC.prototype.applyToLocalView=function(t,e){return this.apply(t)},VC.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},VC.prototype.apply=function(t){for(var e=KC(t),n=function(t){e.find((function(e){return e.isEqual(t)}))||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Lb(e)},VC.prototype.computeBaseValue=function(t){return null},VC.prototype.isEqual=function(t){return t instanceof VC&&Eg(t.elements,this.elements)},VC);function VC(t){this.elements=t}var BC=(jC.prototype.applyToLocalView=function(t,e){return this.apply(t)},jC.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},jC.prototype.apply=function(t){for(var e=KC(t),n=function(t){e=e.filter((function(e){return!e.isEqual(t)}))},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Lb(e)},jC.prototype.computeBaseValue=function(t){return null},jC.prototype.isEqual=function(t){return t instanceof jC&&Eg(t.elements,this.elements)},jC);function jC(t){this.elements=t}var WC=(QC.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof ub&&this.operand instanceof ub){var r=n.internalValue+this.operand.internalValue;return new ub(r)}return new lb(r=n.internalValue+this.operand.internalValue)},QC.prototype.applyToRemoteDocument=function(t,e){return Bv(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},QC.prototype.computeBaseValue=function(t){return t instanceof ib?t:new ub(0)},QC.prototype.isEqual=function(t){return t instanceof QC&&this.operand.isEqual(t.operand)},QC);function QC(t){this.operand=t}function KC(t){return t instanceof Lb?t.internalValue.slice():[]}var HC=(zC.prototype.isEqual=function(t){return t&&t.count===this.count},zC);function zC(t){this.count=t}var GC,YC,XC=((GC={})[ZE.ASCENDING.name]="ASCENDING",GC[ZE.DESCENDING.name]="DESCENDING",GC),JC=((YC={})[OE.LESS_THAN.name]="LESS_THAN",YC[OE.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",YC[OE.GREATER_THAN.name]="GREATER_THAN",YC[OE.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",YC[OE.EQUAL.name]="EQUAL",YC[OE.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",YC[OE.IN.name]="IN",YC[OE.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",YC),$C=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ZC(t,e){Bv(!SE(t),e+" is missing")}function tS(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Vv("can't parse "+t)}var eS=(nS.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},nS.prototype.unsafeCastProtoByteString=function(t){return t},nS.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Hv.UNKNOWN:aC(t.code);return new zv(e,t.message||"")},nS.prototype.toInt32Value=function(t){return this.options.useProto3Json||SE(t)?t:{value:t}},nS.prototype.fromInt32Value=function(t){var e;return SE(e="object"==typeof t?t.value:t)?null:e},nS.prototype.toTimestamp=function(t){return this.options.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},nS.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Bv(!!t,"Cannot deserialize null or undefined timestamp.");var e=tS(t.seconds||"0");return new um(e,t.nanos||0)},nS.prototype.fromIso8601String=function(t){var e=0,n=$C.exec(t);if(Bv(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new um(o,e)},nS.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},nS.prototype.fromBlob=function(t){return"string"==typeof t?(Bv(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ig.fromBase64String(t)):(Bv(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ig.fromUint8Array(t))},nS.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},nS.prototype.fromVersion=function(t){return Bv(!!t,"Trying to deserialize version that isn't set"),hm.fromTimestamp(this.fromTimestamp(t))},nS.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},nS.prototype.fromResourceName=function(t){var e=qg.fromString(t);return Bv(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},nS.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},nS.prototype.fromName=function(t){var e=this.fromResourceName(t);return Bv(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Bv(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Kg(this.extractLocalPathFromResourceName(e))},nS.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},nS.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?qg.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(nS.prototype,"encodedDatabaseId",{get:function(){return new qg(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),nS.prototype.fullyQualifiedPrefixPath=function(t){return new qg(["projects",t.projectId,"databases",t.database])},nS.prototype.extractLocalPathFromResourceName=function(t){return Bv(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},nS.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},nS.prototype.toValue=function(t){if(t instanceof $_)return{nullValue:"NULL_VALUE"};if(t instanceof eb)return{booleanValue:t.value()};if(t instanceof ub)return{integerValue:""+t.value()};if(t instanceof lb){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof db?{stringValue:t.value()}:t instanceof Pb?{mapValue:this.toMapValue(t)}:t instanceof Lb?{arrayValue:this.toArrayValue(t)}:t instanceof gb?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Db?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Tb?{bytesValue:this.toBytes(t.value())}:t instanceof Ib?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Vv("Unknown FieldValue "+JSON.stringify(t))},nS.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return $_.INSTANCE;if("booleanValue"in t)return eb.of(t.booleanValue);if("integerValue"in t)return new ub(tS(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return lb.NAN;if("Infinity"===t.doubleValue)return lb.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return lb.NEGATIVE_INFINITY}return new lb(t.doubleValue)}if("stringValue"in t)return new db(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t)return ZC(t.arrayValue,"arrayValue"),new Lb((t.arrayValue.values||[]).map((function(t){return e.fromValue(t)})));if("timestampValue"in t)return ZC(t.timestampValue,"timestampValue"),new gb(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t)return ZC(t.geoPointValue,"geoPointValue"),new Db(new LC(t.geoPointValue.latitude||0,t.geoPointValue.longitude||0));if("bytesValue"in t){ZC(t.bytesValue,"bytesValue");var n=this.fromBlob(t.bytesValue);return new Tb(n)}if("referenceValue"in t){ZC(t.referenceValue,"referenceValue");var r=this.fromResourceName(t.referenceValue),i=new Rg(r.get(1),r.get(3)),o=new Kg(this.extractLocalPathFromResourceName(r));return new Ib(i,o)}return Vv("Unknown Value proto "+JSON.stringify(t))},nS.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},nS.prototype.toDocument=function(t){return Bv(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},nS.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new Vb(r,i,{hasCommittedMutations:!!e},void 0,t,(function(t){return n.fromValue(t)}))},nS.prototype.toFields=function(t){var e=this,n={};return t.forEach((function(t,r){n[t]=e.toValue(r)})),n},nS.prototype.fromFields=function(t){var e=this,n=Pb.EMPTY;return Zv(t,(function(t,r){n=n.set(new Wg([t]),e.fromValue(r))})),n},nS.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},nS.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.toValue(t))})),{values:n}},nS.prototype.fromFound=function(t){var e=this;Bv(!!t.found,"Tried to deserialize a found document from a missing document."),ZC(t.found.name,"doc.found.name"),ZC(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new Vb(n,r,{},void 0,t.found,(function(t){return e.fromValue(t)}))},nS.prototype.fromMissing=function(t){Bv(!!t.missing,"Tried to deserialize a missing document from a found document."),Bv(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Wb(e,n)},nS.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Vv("invalid batch get response: "+JSON.stringify(t))},nS.prototype.toWatchTargetChangeState=function(t){switch(t){case wC.Added:return"ADD";case wC.Current:return"CURRENT";case wC.NoChange:return"NO_CHANGE";case wC.Removed:return"REMOVE";case wC.Reset:return"RESET";default:return Vv("Unknown WatchTargetChangeState: "+t)}},nS.prototype.toTestWatchChange=function(t){if(t instanceof CC)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof TC){if(t.newDoc instanceof Vb){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Wb)return{documentDelete:{document:this.toName((e=t.newDoc).key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof SC){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return eC.OK;switch(t){case Hv.OK:return eC.OK;case Hv.CANCELLED:return eC.CANCELLED;case Hv.UNKNOWN:return eC.UNKNOWN;case Hv.DEADLINE_EXCEEDED:return eC.DEADLINE_EXCEEDED;case Hv.RESOURCE_EXHAUSTED:return eC.RESOURCE_EXHAUSTED;case Hv.INTERNAL:return eC.INTERNAL;case Hv.UNAVAILABLE:return eC.UNAVAILABLE;case Hv.UNAUTHENTICATED:return eC.UNAUTHENTICATED;case Hv.INVALID_ARGUMENT:return eC.INVALID_ARGUMENT;case Hv.NOT_FOUND:return eC.NOT_FOUND;case Hv.ALREADY_EXISTS:return eC.ALREADY_EXISTS;case Hv.PERMISSION_DENIED:return eC.PERMISSION_DENIED;case Hv.FAILED_PRECONDITION:return eC.FAILED_PRECONDITION;case Hv.ABORTED:return eC.ABORTED;case Hv.OUT_OF_RANGE:return eC.OUT_OF_RANGE;case Hv.UNIMPLEMENTED:return eC.UNIMPLEMENTED;case Hv.DATA_LOSS:return eC.DATA_LOSS;default:return Vv("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Vv("Unrecognized watch change: "+JSON.stringify(t))},nS.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){ZC(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new SC(r,i,o,s||null)}else if("documentChange"in t){ZC(t.documentChange,"documentChange");var u=t.documentChange;ZC(u.document,"documentChange.name"),ZC(u.document.name,"documentChange.document.name"),ZC(u.document.updateTime,"documentChange.document.updateTime");var c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new Vb(c,h,{},void 0,u.document,(function(t){return n.fromValue(t)})),p=u.removedTargetIds||[];e=new TC(u.targetIds||[],p,l.key,l)}else if("documentDelete"in t){ZC(t.documentDelete,"documentDelete");var f=t.documentDelete;ZC(f.document,"documentDelete.document"),c=this.fromName(f.document),h=f.readTime?this.fromVersion(f.readTime):hm.forDeletedDoc(),l=new Wb(c,h),e=new TC([],p=f.removedTargetIds||[],l.key,l)}else if("documentRemove"in t){ZC(t.documentRemove,"documentRemove");var d=t.documentRemove;ZC(d.document,"documentRemove"),c=this.fromName(d.document),e=new TC([],p=d.removedTargetIds||[],c,null)}else{if(!("filter"in t))return Vv("Unknown change type "+JSON.stringify(t));ZC(t.filter,"filter");var y=t.filter;ZC(y.targetId,"filter.targetId");var v=new HC(y.count||0);e=new CC(y.targetId,v)}return e},nS.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?wC.NoChange:"ADD"===t?wC.Added:"REMOVE"===t?wC.Removed:"CURRENT"===t?wC.Current:"RESET"===t?wC.Reset:Vv("Got unexpected TargetChange.state: "+t)},nS.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return hm.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?hm.MIN:e.readTime?this.fromVersion(e.readTime):hm.MIN},nS.prototype.toMutation=function(t){var e,n=this;if(t instanceof D_)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof U_)e={delete:this.toName(t.key)};else if(t instanceof P_)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else if(t instanceof L_)e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map((function(t){return n.toFieldTransform(t)}))}};else{if(!(t instanceof K_))return Vv("Unknown mutation type "+t.type);e={verify:this.toName(t.key)}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},nS.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):C_.NONE;if(t.update){ZC(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new P_(r,i,o,n)}return new D_(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new U_(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map((function(t){return e.fromFieldTransform(t)}));return Bv(!0===n.exists,'Transforms only support precondition "exists == true"'),new L_(r,a)}return t.verify?(r=this.fromName(t.verify),new K_(r,n)):Vv("unknown mutation proto: "+JSON.stringify(t))},nS.prototype.toPrecondition=function(t){return Bv(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Vv("Unknown precondition")},nS.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?C_.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?C_.exists(t.exists):C_.NONE},nS.prototype.fromWriteResult=function(t,e){var n=this,r=this.fromVersion(t.updateTime?t.updateTime:e);r.isEqual(hm.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map((function(t){return n.fromValue(t)}))),new T_(r,i)},nS.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Bv(void 0!==e,"Received a write result without a commit time"),t.map((function(t){return n.fromWriteResult(t,e)}))):[]},nS.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof FC)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof qC)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map((function(t){return e.toValue(t)}))}};if(n instanceof BC)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map((function(t){return e.toValue(t)}))}};if(n instanceof WC)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Vv("Unknown transform: "+t.transform)},nS.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Bv("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=FC.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new qC(r.map((function(t){return e.fromValue(t)})))}else if("removeAllFromArray"in t)n=new BC((r=t.removeAllFromArray.values||[]).map((function(t){return e.fromValue(t)})));else if("increment"in t){var i=this.fromValue(t.increment);Bv(i instanceof ib,"NUMERIC_ADD transform requires a NumberValue"),n=new WC(i)}else Vv("Unknown transform proto: "+JSON.stringify(t));var o=Wg.fromServerFormat(t.fieldPath);return new __(o,n)},nS.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},nS.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;return Bv(1===e,"DocumentsTarget contained other than 1 document: "+e),RE.atPath(this.fromQueryPath(t.documents[0])).toTarget()},nS.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Bv(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Bv(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},nS.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Bv(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new RE(e,i,s,a,u,NE.First,c,h).toTarget()},nS.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},nS.prototype.toLabel=function(t){switch(t){case qw.Listen:return null;case qw.ExistenceFilterMismatch:return"existence-filter-mismatch";case qw.LimboResolution:return"limbo-document";default:return Vv("Unrecognized query purpose: "+t)}},nS.prototype.toTarget=function(t){var e,n=t.target;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},nS.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map((function(t){return t instanceof ME?e.toUnaryOrFieldFilter(t):Vv("Unrecognized filter: "+JSON.stringify(t))}));return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},nS.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return e.fromFilter(t)})).reduce((function(t,e){return t.concat(e)})):Vv("Unknown filter: "+JSON.stringify(t)):[]},nS.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map((function(t){return e.toPropertyOrder(t)}))},nS.prototype.fromOrder=function(t){var e=this;return t.map((function(t){return e.fromPropertyOrder(t)}))},nS.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map((function(t){return e.toValue(t)}))}},nS.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map((function(t){return e.fromValue(t)}));return new eT(r,n)},nS.prototype.toDirection=function(t){return XC[t.name]},nS.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return ZE.ASCENDING;case"DESCENDING":return ZE.DESCENDING;default:return}},nS.prototype.toOperatorName=function(t){return JC[t.name]},nS.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return OE.EQUAL;case"GREATER_THAN":return OE.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return OE.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return OE.LESS_THAN;case"LESS_THAN_OR_EQUAL":return OE.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return OE.ARRAY_CONTAINS;case"IN":return OE.IN;case"ARRAY_CONTAINS_ANY":return OE.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Vv("Unspecified operator");default:return Vv("Unknown operator")}},nS.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},nS.prototype.fromFieldPathReference=function(t){return Wg.fromServerFormat(t.fieldPath)},nS.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},nS.prototype.fromPropertyOrder=function(t){return new rT(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},nS.prototype.fromFieldFilter=function(t){return ME.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},nS.prototype.toUnaryOrFieldFilter=function(t){if(t.op===OE.EQUAL){if(t.value.isEqual(lb.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual($_.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},nS.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return ME.create(e,OE.EQUAL,lb.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return ME.create(n,OE.EQUAL,$_.INSTANCE);case"OPERATOR_UNSPECIFIED":return Vv("Unspecified filter");default:return Vv("Unknown filter")}},nS.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}},nS.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map((function(t){return Wg.fromServerFormat(t)}));return g_.fromArray(e)},nS);function nS(t,e){this.databaseId=t,this.options=e}var rS=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},iS=(oS.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new rS,this.queries.set(e,r)),r.listeners.push(t),Bv(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),!r.viewSnap||t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent(),n?this.syncEngine.listen(e).then((function(t){return r.targetId=t})):Promise.resolve(r.targetId)},oS.prototype.unlisten=function(t){return pa(this,void 0,void 0,(function(){var e,n,r,i;return fa(this,(function(o){return n=!1,(r=this.queries.get(e=t.query))&&0<=(i=r.listeners.indexOf(t))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]}))}))},oS.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=this.queries.get(i.query);if(o){for(var a=0,s=o.listeners;a<s.length;a++)s[a].onViewSnapshot(i)&&(e=!0);o.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},oS.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},oS.prototype.onOnlineStateChange=function(t){this.onlineState=t;var e=!1;this.queries.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].applyOnlineStateChange(t)&&(e=!0)})),e&&this.raiseSnapshotsInSyncEvent()},oS.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},oS.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},oS.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach((function(t){t.next()}))},oS);function oS(t){this.syncEngine=t,this.queries=new Gb((function(t){return t.canonicalId()})),this.onlineState=YT.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}var aS=(sS.prototype.onViewSnapshot=function(t){if(Bv(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==sC.Metadata&&e.push(i)}t=new yC(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},sS.prototype.onError=function(t){this.queryObserver.error(t)},sS.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},sS.prototype.shouldRaiseInitialEvent=function(t,e){return Bv(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache||(this.options.waitForSyncWhenOnline&&e!==YT.Offline?(Bv(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===YT.Offline)},sS.prototype.shouldRaiseEvent=function(t){return 0<t.docChanges.length||!!(t.syncStateChanged||this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},sS.prototype.raiseInitialEvent=function(t){Bv(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=yC.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},sS);function sS(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=YT.Unknown,this.options=n||{}}var uS=(cS.fromSnapshot=function(t,e){for(var n=Pm(),r=Pm(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case sC.Added:n=n.add(a.doc.key);break;case sC.Removed:r=r.add(a.doc.key)}}return new cS(t,e.fromCache,n,r)},cS);function cS(t,e,n,r){this.targetId=t,this.fromCache=e,this.addedKeys=n,this.removedKeys=r}var hS=function(t){this.key=t},lS=function(t){this.key=t},pS=(Object.defineProperty(fS.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),fS.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new fC,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimitToFirst()&&i.size===this.query.limit?i.last():null,c=this.query.hasLimitToLast()&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=e instanceof Vb?e:null;l&&(Bv(t.isEqual(l.key),"Mismatching keys found in document changes: "+t+" != "+l.key),l=n.query.matches(l)?l:null);var p=!!h&&n.mutatedKeys.has(h.key),f=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data().isEqual(l.data())?p!==f&&(r.track({type:sC.Metadata,doc:l}),d=!0):n.shouldWaitForSyncedDocument(h,l)||(r.track({type:sC.Modified,doc:l}),d=!0,(u&&0<n.query.docComparator(l,u)||c&&n.query.docComparator(l,c)<0)&&(s=!0)):!h&&l?(r.track({type:sC.Added,doc:l}),d=!0):h&&!l&&(r.track({type:sC.Removed,doc:h}),d=!0,(u||c)&&(s=!0)),d&&(o=l?(a=a.add(l),f?o.add(t):o.delete(t)):(a=a.delete(t),o.delete(t)))})),this.query.hasLimitToFirst()||this.query.hasLimitToLast())for(;a.size>this.query.limit;){var h=this.query.hasLimitToFirst()?a.last():a.first();a=a.delete(h.key),o=o.delete(h.key),r.track({type:sC.Removed,doc:h})}return Bv(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},fS.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},fS.prototype.applyChanges=function(t,e,n){var r=this;Bv(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort((function(t,e){return function(t,e){function n(t){switch(t){case sC.Added:return 1;case sC.Modified:case sC.Metadata:return 2;case sC.Removed:return 0;default:return Vv("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)})),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?cC.Synced:cC.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new yC(this.query,t.documentSet,i,o,t.mutatedKeys,s===cC.Local,u,!1),limboChanges:a}:{limboChanges:a}},fS.prototype.applyOnlineStateChange=function(t){return this.current&&t===YT.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new fC,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},fS.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},fS.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e._syncedDocuments=e._syncedDocuments.add(t)})),t.modifiedDocuments.forEach((function(t){return Bv(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")})),t.removedDocuments.forEach((function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)})),this.current=t.current)},fS.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=Pm(),this.documentSet.forEach((function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))}));var n=[];return e.forEach((function(e){t.limboDocuments.has(e)||n.push(new lS(e))})),this.limboDocuments.forEach((function(t){e.has(t)||n.push(new hS(t))})),n},fS.prototype.synchronizeWithPersistedState=function(t){this._syncedDocuments=t.remoteKeys,this.limboDocuments=Pm();var e=this.computeDocChanges(t.documents);return this.applyChanges(e,!0)},fS.prototype.computeInitialSnapshot=function(){return yC.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===cC.Local)},fS);function fS(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Pm(),this.mutatedKeys=Pm(),this.documentSet=new lC(t.docComparator.bind(t))}var dS=(yS.prototype.run=function(){this.runWithBackOff()},yS.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun((function(){return pa(t,void 0,void 0,(function(){var t,e,n=this;return fa(this,(function(r){return t=this.remoteStore.createTransaction(),(e=this.tryRunUpdateFunction(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.handleTransactionError(t)}))}))})).catch((function(t){n.handleTransactionError(t)})),[2]}))}))}))},yS.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!SE(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},yS.prototype.handleTransactionError=function(t){var e=this;0<this.retries&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget((function(){return e.runWithBackOff(),Promise.resolve()}))):this.deferred.reject(t)},yS.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!oC(e)},yS);function yS(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new xT(this.asyncQueue,zg.RetryTransaction)}var vS="SyncEngine",gS=function(t,e,n){this.query=t,this.targetId=e,this.view=n},mS=function(t){this.key=t,this.receivedDocument=!1},_S=(Object.defineProperty(bS.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),bS.prototype.subscribe=function(t){Bv(null!==t,"SyncEngine listener cannot be null"),Bv(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},bS.prototype.listen=function(t){return pa(this,void 0,void 0,(function(){var e,n,r,i,o;return fa(this,(function(a){switch(a.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(this.sharedClientState.addLocalQueryTarget(e=r.targetId),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateTarget(t.toTarget())];case 2:return i=a.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),[4,this.initializeViewAndComputeSnapshot(t,e=i.targetId,"current"===o)];case 3:n=a.sent(),this.isPrimary&&this.remoteStore.listen(i),a.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}}))}))},bS.prototype.initializeViewAndComputeSnapshot=function(t,e,n){return pa(this,void 0,void 0,(function(){var r,i,o,a,s,u;return fa(this,(function(c){switch(c.label){case 0:return[4,this.localStore.executeQuery(t,!0)];case 1:return r=c.sent(),i=new pS(t,r.remoteKeys),o=i.computeDocChanges(r.documents),a=_C.createSynthesizedTargetChangeForCurrentChange(e,n&&this.onlineState!==YT.Offline),Bv(0===(s=i.applyChanges(o,!0===this.isPrimary,a)).limboChanges.length,"View returned limbo docs before target ack from the server."),Bv(!!s.snapshot,"applyChanges for new view should always return a snapshot"),u=new gS(t,e,i),this.queryViewsByQuery.set(t,u),this.queriesByTarget[e]||(this.queriesByTarget[e]=[]),this.queriesByTarget[e].push(t),[2,s.snapshot]}}))}))},bS.prototype.synchronizeViewAndComputeSnapshot=function(t){return pa(this,void 0,void 0,(function(){var e,n;return fa(this,(function(r){switch(r.label){case 0:return[4,this.localStore.executeQuery(t.query,!0)];case 1:return e=r.sent(),n=t.view.synchronizeWithPersistedState(e),this.isPrimary&&this.updateTrackedLimbos(t.targetId,n.limboChanges),[2,n]}}))}))},bS.prototype.unlisten=function(t){return pa(this,void 0,void 0,(function(){var e,n,r=this;return fa(this,(function(i){switch(i.label){case 0:return this.assertSubscribed("unlisten()"),Bv(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),1<(n=this.queriesByTarget[e.targetId]).length?(this.queriesByTarget[e.targetId]=n.filter((function(e){return!e.isEqual(t)})),this.queryViewsByQuery.delete(t),[2]):this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseTarget(e.targetId,!1).then((function(){r.sharedClientState.clearQueryState(e.targetId),r.remoteStore.unlisten(e.targetId),r.removeAndCleanupTarget(e.targetId)})).catch(yE)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupTarget(e.targetId),[4,this.localStore.releaseTarget(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},bS.prototype.write=function(t,e){return pa(this,void 0,void 0,(function(){var n;return fa(this,(function(r){switch(r.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(t)];case 1:return n=r.sent(),this.sharedClientState.addPendingMutation(n.batchId),this.addMutationCallback(n.batchId,e),[4,this.emitNewSnapsAndNotifyLocalStore(n.changes)];case 2:return r.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return r.sent(),[2]}}))}))},bS.prototype.runTransaction=function(t,e,n){new dS(t,this.remoteStore,e,n).run()},bS.prototype.applyRemoteEvent=function(t){return pa(this,void 0,void 0,(function(){var e,n=this;return fa(this,(function(r){switch(r.label){case 0:this.assertSubscribed("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(t)];case 2:return e=r.sent(),Zv(t.targetChanges,(function(t,e){var r=n.limboResolutionsByTarget[Number(t)];r&&(Bv(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?r.receivedDocument=!0:0<e.modifiedDocuments.size?Bv(r.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Bv(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))})),[4,this.emitNewSnapsAndNotifyLocalStore(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,yE(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},bS.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===JT.RemoteStore||!this.isPrimary&&e===JT.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var n=[];this.queryViewsByQuery.forEach((function(e,r){var i=r.view.applyOnlineStateChange(t);Bv(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)})),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},bS.prototype.rejectListen=function(t,e){return pa(this,void 0,void 0,(function(){var n,r,i,o,a,s=this;return fa(this,(function(u){switch(u.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),(r=(n=this.limboResolutionsByTarget[t])&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new pm(Kg.comparator)).insert(r,new Wb(r,hm.forDeletedDoc())),o=Pm().add(r),a=new gC(hm.MIN,{},new bm(wg),i,o),[2,this.applyRemoteEvent(a)]):[3,1];case 1:return[4,this.localStore.releaseTarget(t,!1).then((function(){return s.removeAndCleanupTarget(t,e)})).catch(yE)];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))},bS.prototype.applyBatchState=function(t,e,n){return pa(this,void 0,void 0,(function(){var r;return fa(this,(function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(Fv(vS,"Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):Vv("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}}))}))},bS.prototype.applySuccessfulWrite=function(t){return pa(this,void 0,void 0,(function(){var e,n;return fa(this,(function(r){switch(r.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),this.processUserCallback(e=t.batch.batchId,null),this.triggerPendingWritesCallbacks(e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,yE(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},bS.prototype.rejectFailedWrite=function(t,e){return pa(this,void 0,void 0,(function(){var n;return fa(this,(function(r){switch(r.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.triggerPendingWritesCallbacks(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(t,"rejected",e),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,yE(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},bS.prototype.registerPendingWritesCallback=function(t){return pa(this,void 0,void 0,(function(){var e,n;return fa(this,(function(r){switch(r.label){case 0:return this.remoteStore.canUseNetwork()||Fv(vS,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=r.sent())?t.resolve():((n=this.pendingWritesCallbacks.get(e)||[]).push(t),this.pendingWritesCallbacks.set(e,n)),[2]}}))}))},bS.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach((function(t){t.resolve()})),this.pendingWritesCallbacks.delete(t)},bS.prototype.rejectOutstandingPendingWritesCallbacks=function(t){this.pendingWritesCallbacks.forEach((function(e){e.forEach((function(e){e.reject(new zv(Hv.CANCELLED,t))}))})),this.pendingWritesCallbacks.clear()},bS.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new pm(wg)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},bS.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Bv(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},bS.prototype.removeAndCleanupTarget=function(t,e){var n=this;void 0===e&&(e=null),this.sharedClientState.removeLocalQueryTarget(t),Bv(this.queriesByTarget[t]&&0!==this.queriesByTarget[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.queriesByTarget[t];r<i.length;r++){var o=i[r];this.queryViewsByQuery.delete(o),e&&this.syncEngineListener.onWatchError(o,e)}if(delete this.queriesByTarget[t],this.isPrimary){var a=this.limboDocumentRefs.referencesForId(t);this.limboDocumentRefs.removeReferencesForId(t),a.forEach((function(t){n.limboDocumentRefs.containsKey(t)||n.removeLimboTarget(t)}))}},bS.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},bS.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof hS?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof lS?(Fv(vS,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Vv("Unknown limbo change: "+JSON.stringify(i))}},bS.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Fv(vS,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=RE.atPath(e.path);this.limboResolutionsByTarget[n]=new mS(e),this.remoteStore.listen(new Kw(r.toTarget(),n,qw.LimboResolution,Og.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},bS.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},bS.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return pa(this,void 0,void 0,(function(){var n,r,i,o=this;return fa(this,(function(a){switch(a.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach((function(a,s){i.push(Promise.resolve().then((function(){var e=s.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(s.query,!1).then((function(t){return s.view.computeDocChanges(t.documents,e)})):e})).then((function(t){var i=s.view.applyChanges(t,!0===o.isPrimary,e&&e.targetChanges[s.targetId]);if(o.updateTrackedLimbos(s.targetId,i.limboChanges),i.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(s.targetId,i.snapshot.fromCache?"not-current":"current"),n.push(i.snapshot);var a=uS.fromSnapshot(s.targetId,i.snapshot);r.push(a)}})))})),[4,Promise.all(i)];case 1:return a.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return a.sent(),[2]}}))}))},bS.prototype.assertSubscribed=function(t){Bv(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},bS.prototype.handleCredentialChange=function(t){return pa(this,void 0,void 0,(function(){var e,n;return fa(this,(function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(t)]):[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}}))}))},bS.prototype.applyPrimaryState=function(t){return pa(this,void 0,void 0,(function(){var e,n,r,i,o,a,s=this;return fa(this,(function(u){switch(u.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return u.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=u.sent(),r=0,i=n;r<i.length;r++)this.remoteStore.listen(i[r]);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,o=[],a=Promise.resolve(),$v(this.queriesByTarget,(function(t,e){s.sharedClientState.isLocalQueryTarget(t)?o.push(t):a=a.then((function(){return s.removeAndCleanupTarget(t),s.localStore.releaseTarget(t,!0)})),s.remoteStore.unlisten(t)})),[4,a]);case 4:return u.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(o)];case 5:return u.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:u.sent(),u.label=7;case 7:return[2]}}))}))},bS.prototype.resetLimboDocuments=function(){var t=this;$v(this.limboResolutionsByTarget,(function(e){t.remoteStore.unlisten(e)})),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new pm(Kg.comparator)},bS.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){return pa(this,void 0,void 0,(function(){var e,n,r,i,o,a,s,u,c,h,l,p,f;return fa(this,(function(d){switch(d.label){case 0:e=[],n=[],r=0,i=t,d.label=1;case 1:return r<i.length?(a=void 0,(s=this.queriesByTarget[o=i[r]])&&0!==s.length?[4,this.localStore.releaseTarget(o,!0)]:[3,8]):[3,14];case 2:return d.sent(),[4,this.localStore.allocateTarget(s[0].toTarget())];case 3:a=d.sent(),u=0,c=s,d.label=4;case 4:return u<c.length?(Bv(!!(l=this.queryViewsByQuery.get(h=c[u])),"No query view found for "+h),[4,this.synchronizeViewAndComputeSnapshot(l)]):[3,7];case 5:(p=d.sent()).snapshot&&n.push(p.snapshot),d.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return Bv(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.localStore.getTarget(o)];case 9:return Bv(!!(f=d.sent()),"Target for id "+o+" not found"),[4,this.localStore.allocateTarget(f)];case 10:return a=d.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(f),o,!1)];case 11:d.sent(),d.label=12;case 12:e.push(a),d.label=13;case 13:return r++,[3,1];case 14:return this.syncEngineListener.onWatchChange(n),[2,e]}}))}))},bS.prototype.synthesizeTargetToQuery=function(t){return new RE(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,NE.First,t.startAt,t.endAt)},bS.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},bS.prototype.applyTargetState=function(t,e,n){return pa(this,void 0,void 0,(function(){var r,i;return fa(this,(function(o){switch(o.label){case 0:if(this.isPrimary)return Fv(vS,"Ignoring unexpected query state notification."),[2];if(!this.queriesByTarget[t])return[3,7];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.localStore.getNewDocumentChanges()];case 2:return r=o.sent(),i=gC.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(r,i)];case 3:return o.sent(),[3,7];case 4:return[4,this.localStore.releaseTarget(t,!0)];case 5:return o.sent(),this.removeAndCleanupTarget(t,n),[3,7];case 6:Vv("Unexpected target state: "+e),o.label=7;case 7:return[2]}}))}))},bS.prototype.applyActiveTargetsChange=function(t,e){return pa(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,h,l=this;return fa(this,(function(p){switch(p.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,p.label=1;case 1:return n<r.length?(Bv(!this.queriesByTarget[h=r[n]],"Trying to add an already active target"),[4,this.localStore.getTarget(h)]):[3,6];case 2:return Bv(!!(i=p.sent()),"Query data for active target "+h+" not found"),[4,this.localStore.allocateTarget(i)];case 3:return o=p.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(i),o.targetId,!1)];case 4:p.sent(),this.remoteStore.listen(o),p.label=5;case 5:return n++,[3,1];case 6:a=function(t){return fa(this,(function(e){switch(e.label){case 0:return s.queriesByTarget[t]?[4,s.localStore.releaseTarget(t,!1).then((function(){l.remoteStore.unlisten(t),l.removeAndCleanupTarget(t)})).catch(yE)]:[2,"continue"];case 1:return e.sent(),[2]}}))},s=this,u=0,c=e,p.label=7;case 7:return u<c.length?[5,a(h=c[u])]:[3,10];case 8:p.sent(),p.label=9;case 9:return u++,[3,7];case 10:return[2]}}))}))},bS.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},bS.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},bS.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];if(e&&e.receivedDocument)return Pm().add(e.key);var n=Pm(),r=this.queriesByTarget[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var a=o[i],s=this.queryViewsByQuery.get(a);Bv(!!s,"No query view found for "+a),n=n.unionWith(s.view.syncedDocuments)}return n},bS);function bS(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Gb((function(t){return t.canonicalId()})),this.queriesByTarget={},this.limboTargetsByKey=new pm(Kg.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new lT,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=c_.forSyncEngine(),this.isPrimary=void 0,this.onlineState=YT.Unknown}var wS=(ES.prototype.isAuthenticated=function(){return null!=this.uid},ES.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},ES.prototype.isEqual=function(t){return t.uid===this.uid},ES.UNAUTHENTICATED=new ES(null),ES.GOOGLE_CREDENTIALS=new ES("google-credentials-uid"),ES.FIRST_PARTY=new ES("first-party-uid"),ES);function ES(t){this.uid=t}var TS="firestore_clients";function CS(t,e){return Bv(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),TS+"_"+t+"_"+e}var SS="firestore_mutations";function IS(t,e,n){var r=SS+"_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}var NS="firestore_targets";function AS(t,e){return NS+"_"+t+"_"+e}var DS="firestore_online_state",kS="firestore_sequence_number",RS="SharedClientState",PS=(OS.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new zv(r.error.code,r.error.message)),i?new OS(t,e,r.state,o):(Uv(RS,"Failed to parse mutation state for ID '"+e+"': "+n),null)},OS.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},OS);function OS(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Bv(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var xS=(LS.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new zv(n.error.code,n.error.message)),r?new LS(t,n.state,i):(Uv(RS,"Failed to parse target state for ID '"+t+"': "+e),null)},LS.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},LS);function LS(t,e,n){this.targetId=t,this.state=e,Bv(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var MS=(FS.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=xm(),o=0;r&&o<n.activeTargetIds.length;++o)r=IE(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new FS(t,i):(Uv(RS,"Failed to parse client data for instance '"+t+"': "+e),null)},FS);function FS(t,e){this.clientId=t,this.activeTargetIds=e}var US=(qS.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in YT&&"string"==typeof e.clientId?new qS(e.clientId,YT[e.onlineState]):(Uv(RS,"Failed to parse online state: "+t),null)},qS);function qS(t,e){this.clientId=t,this.onlineState=e}var VS=(BS.prototype.addQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},BS.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},BS.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},BS);function BS(){this.activeTargetIds=xm()}var jS=(WS.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},WS.prototype.start=function(){return pa(this,void 0,void 0,(function(){var t,e,n,r,i,o,a,s,u,c,h=this;return fa(this,(function(l){switch(l.label){case 0:return Bv(!this.started,"WebStorageSharedClientState already started"),Bv(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Bv(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(CS(this.persistenceKey,r)))&&(o=MS.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(a=this.storage.getItem(this.onlineStateKey))&&(s=this.fromWebStorageOnlineState(a))&&this.handleOnlineStateEvent(s),u=0,c=this.earlyEvents;u<c.length;u++)this.handleWebStorageEvent(c[u]);return this.earlyEvents=[],this.platform.window.addEventListener("unload",(function(){return h.shutdown()})),this.started=!0,[2]}}))}))},WS.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},WS.prototype.getAllActiveQueryTargets=function(){var t=xm();return Zv(this.activeClients,(function(e,n){t=t.unionWith(n.activeTargetIds)})),t},WS.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},WS.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},WS.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},WS.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(AS(this.persistenceKey,t));if(n){var r=xS.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},WS.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},WS.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},WS.prototype.clearQueryState=function(t){this.removeItem(AS(this.persistenceKey,t))},WS.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},WS.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.removeMutationState(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},WS.prototype.setOnlineState=function(t){this.persistOnlineState(t)},WS.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},WS.prototype.getItem=function(t){var e=this.storage.getItem(t);return Fv(RS,"READ",t,e),e},WS.prototype.setItem=function(t,e){Fv(RS,"SET",t,e),this.storage.setItem(t,e)},WS.prototype.removeItem=function(t){Fv(RS,"REMOVE",t),this.storage.removeItem(t)},WS.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(Fv(RS,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void Uv("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget((function(){return pa(e,void 0,void 0,(function(){var e,n,r,i,o,a;return fa(this,(function(s){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(Bv(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=Og.INVALID;if(null!=t)try{var n=JSON.parse(t);Bv("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Uv(RS,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==Og.INVALID&&this.sequenceNumberHandler(a));return[2]}))}))}))}},Object.defineProperty(WS.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),WS.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},WS.prototype.persistMutationState=function(t,e,n){var r=new PS(this.currentUser,t,e,n),i=IS(this.persistenceKey,this.currentUser,t);this.setItem(i,r.toWebStorageJSON())},WS.prototype.removeMutationState=function(t){var e=IS(this.persistenceKey,this.currentUser,t);this.removeItem(e)},WS.prototype.persistOnlineState=function(t){this.storage.setItem(this.onlineStateKey,JSON.stringify({clientId:this.localClientId,onlineState:YT[t]}))},WS.prototype.persistQueryTargetState=function(t,e,n){var r=AS(this.persistenceKey,t),i=new xS(t,e,n);this.setItem(r,i.toWebStorageJSON())},WS.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},WS.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Bv(null!==n,"Cannot parse client state key '"+t+"'"),MS.fromWebStorageEntry(n,e)},WS.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Bv(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]);return PS.fromWebStorageEntry(new wS(void 0!==n[2]?n[2]:null),r,e)},WS.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Bv(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return xS.fromWebStorageEntry(r,e)},WS.prototype.fromWebStorageOnlineState=function(t){return US.fromWebStorageEntry(t)},WS.prototype.handleMutationBatchEvent=function(t){return pa(this,void 0,void 0,(function(){return fa(this,(function(e){return t.user.uid!==this.currentUser.uid?(Fv(RS,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]}))}))},WS.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},WS.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach((function(t){return pa(n,void 0,void 0,(function(){return fa(this,(function(e){return r.has(t)||o.push(t),[2]}))}))})),r.forEach((function(t){return pa(n,void 0,void 0,(function(){return fa(this,(function(e){return i.has(t)||a.push(t),[2]}))}))})),this.syncEngine.applyActiveTargetsChange(o,a)},WS.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},WS);function WS(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!WS.isAvailable(this.platform))throw new zv(Hv.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=CS(this.persistenceKey,this.localClientId),this.sequenceNumberKey=function(t){return kS+"_"+t}(this.persistenceKey),this.activeClients[this.localClientId]=new VS,this.clientStateKeyRe=new RegExp("^"+TS+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+SS+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+NS+"_"+o+"_(\\d+)$"),this.onlineStateKey=function(t){return DS+"_"+t}(this.persistenceKey),this.platform.window.addEventListener("storage",this.storageListener)}var QS=(KS.prototype.addPendingMutation=function(t){},KS.prototype.updateMutationState=function(t,e,n){},KS.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},KS.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},KS.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},KS.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},KS.prototype.clearQueryState=function(t){delete this.queryState[t]},KS.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},KS.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},KS.prototype.start=function(){return this.localState=new VS,Promise.resolve()},KS.prototype.handleUserChange=function(t,e,n){},KS.prototype.setOnlineState=function(t){},KS.prototype.shutdown=function(){},KS.prototype.writeSequenceNumber=function(t){},KS);function KS(){this.localState=new VS,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var HS="FirestoreClient",zS=(GS.prototype.lruParams=function(){return Zw.withCacheSize(this.cacheSizeBytes)},GS);function GS(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var YS=function(){},XS=(JS.prototype.start=function(t){var e=this;this.verifyNotTerminated();var n=new Yg,r=new Yg,i=!1;return this.credentials.setChangeListener((function(o){i?e.asyncQueue.enqueueAndForget((function(){return e.handleCredentialChange(o)})):(i=!0,e.initializePersistence(t,r,o).then((function(t){return e.initializeRest(o,t)})).then(n.resolve,n.reject))})),this.asyncQueue.enqueueAndForget((function(){return n.promise})),r.promise},JS.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return t.syncEngine.enableNetwork()}))},JS.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof zS?this.startIndexedDbPersistence(n,t).then((function(t){return e.resolve(),t})).catch((function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()})):(e.resolve(),this.startMemoryPersistence())},JS.prototype.canFallback=function(t){return t instanceof zv?t.code===Hv.FAILED_PRECONDITION||t.code===Hv.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},JS.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new zv(Hv.FAILED_PRECONDITION,"The client has already been terminated.")},JS.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=fE.buildStoragePrefix(this.databaseInfo),i=new eS(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then((function(){return pa(n,void 0,void 0,(function(){var n,o;return fa(this,(function(a){switch(a.label){case 0:if(e.synchronizeTabs&&!jS.isAvailable(this.platform))throw new zv(Hv.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=e.lruParams(),this.sharedClientState=e.synchronizeTabs?new jS(this.asyncQueue,this.platform,r,this.clientId,t):new QS,[4,fE.createIndexedDbPersistence({allowTabSynchronization:e.synchronizeTabs,persistenceKey:r,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:i,lruParams:n,sequenceNumberSyncer:this.sharedClientState})];case 1:return o=a.sent(),[2,(this.persistence=o).referenceDelegate.garbageCollector]}}))}))}))},JS.prototype.startMemoryPersistence=function(){return this.persistence=ST.createEagerPersistence(this.clientId),this.sharedClientState=new QS,Promise.resolve(null)},JS.prototype.initializeRest=function(t,e){var n=this;return Fv(HS,"Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then((function(r){return pa(n,void 0,void 0,(function(){var n,i,o,a,s,u=this;return fa(this,(function(c){switch(c.label){case 0:return n=new sT,this.localStore=new yT(this.persistence,n,t),[4,this.localStore.start()];case 1:return c.sent(),e&&(this.lruScheduler=new eE(e,this.asyncQueue,this.localStore)),i=this.platform.newConnectivityMonitor(),o=this.platform.newSerializer(this.databaseInfo.databaseId),a=new zT(this.asyncQueue,r,this.credentials,o),s=function(t){return u.syncEngine.applyOnlineStateChange(t,JT.SharedClientState)},this.remoteStore=new OC(this.localStore,a,this.asyncQueue,(function(t){return u.syncEngine.applyOnlineStateChange(t,JT.RemoteStore)}),i),this.syncEngine=new _S(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=s,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new iS(this.syncEngine),[4,this.sharedClientState.start()];case 2:return c.sent(),[4,this.remoteStore.start()];case 3:return c.sent(),[4,this.persistence.setPrimaryStateListener((function(t){return pa(u,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}}))}))}))];case 4:return c.sent(),[4,this.persistence.setDatabaseDeletedListener((function(){return pa(u,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))}))];case 5:return c.sent(),[2]}}))}))}))},JS.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Fv(HS,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},JS.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return t.syncEngine.disableNetwork()}))},JS.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown((function(){return pa(t,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}}))}))}))},JS.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new Yg;return this.asyncQueue.enqueueAndForget((function(){return t.syncEngine.registerPendingWritesCallback(e)})),e.promise},JS.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new aS(t,e,n);return this.asyncQueue.enqueueAndForget((function(){return r.eventMgr.listen(i)})),i},JS.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget((function(){return e.eventMgr.unlisten(t)}))},JS.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return e.localStore.readDocument(t)})).then((function(t){if(t instanceof Vb)return t;if(t instanceof Wb)return null;throw new zv(Hv.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")}))},JS.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return pa(e,void 0,void 0,(function(){var e,n,r;return fa(this,(function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t,!0)];case 1:return e=i.sent(),n=new pS(t,e.remoteKeys),r=n.computeDocChanges(e.documents),[2,n.applyChanges(r,!1).snapshot]}}))}))}))},JS.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new Yg;return this.asyncQueue.enqueueAndForget((function(){return e.syncEngine.write(t,n)})),n.promise},JS.prototype.databaseId=function(){return this.databaseInfo.databaseId},JS.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget((function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()}))},JS.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(JS.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),JS.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new Yg;return this.asyncQueue.enqueueAndForget((function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()})),n.promise},JS);function JS(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=_g.newId()}var $S=(ZS.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},ZS.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},ZS.prototype.mute=function(){this.muted=!0},ZS.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},ZS);function ZS(t){this.observer=t,this.muted=!1}var tI=(eI.documentId=function(){return eI._DOCUMENT_ID},eI.prototype.isEqual=function(t){if(!(t instanceof eI))throw yg("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},eI._DOCUMENT_ID=new eI(Wg.keyField().canonicalString()),eI);function eI(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new zv(Hv.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+mg(1,"element")+".")}(0,t);for(var n=0;n<t.length;++n)if(og("FieldPath","string",n,t[n]),0===t[n].length)throw new zv(Hv.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Wg(t)}var nI=new RegExp("[~\\*/\\[\\]]"),rI=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},iI=(oI.prototype.getToken=function(){return Promise.resolve(null)},oI.prototype.invalidateToken=function(){},oI.prototype.setChangeListener=function(t){Bv(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(wS.UNAUTHENTICATED)},oI.prototype.removeChangeListener=function(){Bv(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},oI);function oI(){this.changeListener=null}var aI=(sI.prototype.getToken=function(){var t=this;Bv(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){if(t.tokenCounter!==e)throw new zv(Hv.ABORTED,"getToken aborted due to token change.");return n?(Bv("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new rI(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},sI.prototype.invalidateToken=function(){this.forceRefresh=!0},sI.prototype.setChangeListener=function(t){Bv(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},sI.prototype.removeChangeListener=function(){Bv(null!=this.tokenListener,"removeChangeListener() called twice"),Bv(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},sI.prototype.getUser=function(){var t=this.auth&&this.auth.getUid();return Bv(null===t||"string"==typeof t,"Received invalid UID: "+t),new wS(t)},sI);function sI(t){var e=this;this.tokenListener=null,this.currentUser=wS.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.tokenListener):(this.tokenListener(null),t.get().then((function(t){e.auth=t,e.tokenListener&&e.auth.addAuthTokenListener(e.tokenListener)}),(function(){})))}var uI=(Object.defineProperty(cI.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),cI);function cI(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=wS.FIRST_PARTY}var hI=(lI.prototype.getToken=function(){return Promise.resolve(new uI(this.gapi,this.sessionIndex))},lI.prototype.setChangeListener=function(t){t(wS.FIRST_PARTY)},lI.prototype.removeChangeListener=function(){},lI.prototype.invalidateToken=function(){},lI);function lI(t,e){this.gapi=t,this.sessionIndex=e}function pI(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var fI=(dI.delete=function(){return eg("FieldValue.delete",arguments),vI.instance},dI.serverTimestamp=function(){return eg("FieldValue.serverTimestamp",arguments),_I.instance},dI.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return rg("FieldValue.arrayUnion",arguments,1),new EI(t)},dI.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return rg("FieldValue.arrayRemove",arguments,1),new SI(t)},dI.increment=function(t){return og("FieldValue.increment","number",1,t),ng("FieldValue.increment",arguments,1),new AI(t)},dI.prototype.isEqual=function(t){return this===t},dI);function dI(t){this._methodName=t}var yI,vI=(ha(gI,yI=fI),gI.instance=new gI,gI);function gI(){return yI.call(this,"FieldValue.delete")||this}var mI,_I=(ha(bI,mI=fI),bI.instance=new bI,bI);function bI(){return mI.call(this,"FieldValue.serverTimestamp")||this}var wI,EI=(ha(TI,wI=fI),TI);function TI(t){var e=wI.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var CI,SI=(ha(II,CI=fI),II);function II(t){var e=CI.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var NI,AI=(ha(DI,NI=fI),DI);function DI(t){var e=NI.call(this,"FieldValue.increment")||this;return e._operand=t,e}var kI=Yv(fI,"Use FieldValue.<field>() instead."),RI=/^__.*__$/,PI=(OI.prototype.toMutations=function(t,e){var n=[];return n.push(null!==this.fieldMask?new P_(t,this.data,this.fieldMask,e):new D_(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new L_(t,this.fieldTransforms)),n},OI);function OI(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var xI,LI,MI=(FI.prototype.toMutations=function(t,e){var n=[new P_(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new L_(t,this.fieldTransforms)),n},FI);function FI(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function UI(t){switch(t){case xI.Set:case xI.MergeSet:case xI.Update:return!0;case xI.Argument:case xI.ArrayArgument:return!1;default:throw Vv("Unexpected case for UserDataSource: "+t)}}(LI=xI=xI||{})[LI.Set=0]="Set",LI[LI.Update=1]="Update",LI[LI.MergeSet=2]="MergeSet",LI[LI.Argument=3]="Argument",LI[LI.ArrayArgument=4]="ArrayArgument";var qI=(VI.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new VI(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},VI.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new VI(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},VI.prototype.childContextForArray=function(t){return new VI(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},VI.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new zv(Hv.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},VI.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},VI.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},VI.prototype.validatePathSegment=function(t){if(0===t.length)throw this.createError("Document fields must not be empty");if(UI(this.dataSource)&&RI.test(t))throw this.createError('Document fields cannot begin and end with "__"')},VI);function VI(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var BI=function(t,e){this.databaseId=t,this.key=e},jI=(WI.prototype.parseSetData=function(t,e){var n=new qI(xI.Set,t,Wg.EMPTY_PATH);KI("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new PI(r,null,n.fieldTransforms)},WI.prototype.parseMergeData=function(t,e,n){var r=new qI(xI.MergeSet,t,Wg.EMPTY_PATH);KI("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new bm(Wg.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof tI)l=h._internalPath;else{if("string"!=typeof h)throw Vv("Expected stringOrFieldPath to be a string or a FieldPath");l=zI(t,h)}if(!r.contains(l))throw new zv(Hv.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=g_.fromSet(s),o=r.fieldTransforms.filter((function(t){return i.covers(t.field)}))}else i=g_.fromArray(r.fieldMask),o=r.fieldTransforms;return new PI(a,i,o)},WI.prototype.parseUpdateData=function(t,e){var n=this,r=new qI(xI.Update,t,Wg.EMPTY_PATH);KI("Data must be an object, but it was:",r,e);var i=new bm(Wg.comparator),o=Pb.EMPTY;Zv(e,(function(e,a){var s=zI(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof vI)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}}));var a=g_.fromSet(i);return new MI(o,a,r.fieldTransforms)},WI.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new qI(xI.Update,t,Wg.EMPTY_PATH),o=[HI(t,e)],a=[n];if(r.length%2!=0)throw new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(HI(t,r[s])),a.push(r[s+1]);var u=new bm(Wg.comparator),c=Pb.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),p=this.runPreConverter(a[s],l);if(p instanceof vI)u=u.add(h);else{var f=this.parseData(p,l);null!=f&&(u=u.add(h),c=c.set(h,f))}}var d=g_.fromSet(u);return new MI(c,d,i.fieldTransforms)},WI.prototype.parseQueryValue=function(t,e,n){void 0===n&&(n=!1);var r=new qI(n?xI.ArrayArgument:xI.Argument,t,Wg.EMPTY_PATH),i=this.parseData(e,r);return Bv(null!=i,"Parsed data should not be null."),Bv(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},WI.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=GI(t);throw e.createError(n)}},WI.prototype.parseData=function(t,e){if(QI(t=this.runPreConverter(t,e)))return KI("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof fI)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement&&e.dataSource!==xI.ArrayArgument)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},WI.prototype.parseObject=function(t,e){var n=this,r=new pm(wg);return tg(t)?e.path&&0<e.path.length&&e.fieldMask.push(e.path):Zv(t,(function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))})),new Pb(r)},WI.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=this.parseData(o[i],e.childContextForArray(r));null==a&&(a=$_.INSTANCE),n.push(a),r++}return new Lb(n)},WI.prototype.parseSentinelFieldValue=function(t,e){if(!UI(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof vI){if(e.dataSource!==xI.MergeSet)throw e.dataSource===xI.Update?(Bv(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof _I)e.fieldTransforms.push(new __(e.path,FC.instance));else if(t instanceof EI){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new qC(n);e.fieldTransforms.push(new __(e.path,r))}else if(t instanceof SI){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new BC(n);e.fieldTransforms.push(new __(e.path,i))}else if(t instanceof AI){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new WC(o);e.fieldTransforms.push(new __(e.path,a))}else Vv("Unknown FieldValue type: "+t)},WI.prototype.parseScalarValue=function(t,e){if(null===t)return $_.INSTANCE;if("number"==typeof t)return IE(t)?new ub(t):new lb(t);if("boolean"==typeof t)return eb.of(t);if("string"==typeof t)return new db(t);if(t instanceof Date)return new gb(um.fromDate(t));if(t instanceof um)return new gb(new um(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof LC)return new Db(t);if(t instanceof Ig)return new Tb(t);if(t instanceof BI)return new Ib(t.databaseId,t.key);throw e.createError("Unsupported field value: "+pg(t))},WI.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map((function(e,r){var i=new qI(xI.Argument,t,Wg.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))}))},WI);function WI(t){this.preConverter=t}function QI(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof um||t instanceof LC||t instanceof Ig||t instanceof BI||t instanceof fI)}function KI(t,e,n){if(!QI(n)||!lg(n)){var r=pg(n);throw e.createError("an object"===r?t+" a custom object":t+" "+r)}}function HI(t,e){if(e instanceof tI)return e._internalPath;if("string"==typeof e)return zI(t,e);throw new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function zI(t,e){try{return function(t){if(0<=t.search(nI))throw new zv(Hv.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(tI.bind.apply(tI,ga([void 0],t.split("."))))}catch(e){throw new zv(Hv.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=GI(e);throw new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function GI(t){return t instanceof Error?t.message:t.toString()}var YI=Zw.COLLECTION_DISABLED,XI=(JI.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},JI);function JI(t){if(void 0===t.host){if(void 0!==t.ssl)throw new zv(Hv.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else sg("settings","non-empty string","host",t.host),this.host=t.host,ug("settings","boolean","ssl",t.ssl),this.ssl=Jv(t.ssl,!0);if(dg("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),ug("settings","object","credentials",t.credentials),this.credentials=t.credentials,ug("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Uv("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Uv("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Jv(t.timestampsInSnapshots,!0),ug("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Zw.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==YI&&t.cacheSizeBytes<Zw.MINIMUM_CACHE_SIZE_BYTES)throw new zv(Hv.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Zw.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}ug("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var $I=(ZI.prototype.settings=function(t){if(ng("Firestore.settings",arguments,1),og("Firestore.settings","object",1,t),Xv(t,"persistence"))throw new zv(Hv.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new XI(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new zv(Hv.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new iI;switch(t.type){case"gapi":var e=t.client;return Bv(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new hI(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new zv(Hv.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},ZI.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},ZI.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},ZI.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new zv(Hv.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Uv("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Jv(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new zS(this._settings.cacheSizeBytes,e))},ZI.prototype.clearPersistence=function(){var t=this,e=fE.buildStoragePrefix(this.makeDatabaseInfo()),n=new Yg;return this._queue.enqueueAndForgetEvenAfterShutdown((function(){return pa(t,void 0,void 0,(function(){var t;return fa(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new zv(Hv.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,fE.clearPersistence(e)];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}}))}))})),n.promise},ZI.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(ZI.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),ZI.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},ZI.prototype.onSnapshotsInSync=function(t){return this.ensureClientConfigured(),pI(t)?this.onSnapshotsInSyncInternal(t):(og("Firestore.onSnapshotsInSync","function",1,t),this.onSnapshotsInSyncInternal({next:t}))},ZI.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new $S({next:function(){t.next&&t.next()},error:function(t){throw Vv("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},ZI.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new YS),this._firestoreClient},ZI.prototype.makeDatabaseInfo=function(){return new Dg(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},ZI.prototype.configureClient=function(t){Bv(!!this._settings.host,"FirestoreSettings.host is not set"),Bv(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new XS(jv.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},ZI.prototype.createDataConverter=function(t){return new jI((function(e){if(e instanceof iN){var n=t,r=e.firestore._databaseId;if(!r.isEqual(n))throw new zv(Hv.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new BI(t,e._key)}return e}))},ZI.databaseIdFromApp=function(t){var e=t.options;if(!Xv(e,"projectId"))throw new zv(Hv.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new zv(Hv.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Rg(n)},Object.defineProperty(ZI.prototype,"app",{get:function(){if(!this._firebaseApp)throw new zv(Hv.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),ZI.prototype.collection=function(t){return ng("Firestore.collection",arguments,1),og("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new mN(qg.fromString(t),this)},ZI.prototype.doc=function(t){return ng("Firestore.doc",arguments,1),og("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),iN.forPath(qg.fromString(t),this)},ZI.prototype.collectionGroup=function(t){if(ng("Firestore.collectionGroup",arguments,1),og("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new zv(Hv.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new fN(new RE(qg.EMPTY_PATH,t),this)},ZI.prototype.runTransaction=function(t){var e=this;return ng("Firestore.runTransaction",arguments,1),og("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction((function(n){return t(new tN(e,n))}))},ZI.prototype.batch=function(){return this.ensureClientConfigured(),new nN(this)},Object.defineProperty(ZI,"logLevel",{get:function(){switch(Lv()){case Sv.DEBUG:return"debug";case Sv.ERROR:return"error";case Sv.SILENT:return"silent";default:return Vv("Unknown log level: "+Lv())}},enumerable:!0,configurable:!0}),ZI.setLogLevel=function(t){switch(ng("Firestore.setLogLevel",arguments,1),og("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Mv(Sv.DEBUG);break;case"error":Mv(Sv.ERROR);break;case"silent":Mv(Sv.SILENT);break;default:throw new zv(Hv.INVALID_ARGUMENT,"Invalid log level: "+t)}},ZI.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},ZI);function ZI(t,e){var n=this;if(this._firebaseApp=null,this._queue=new $g,this.INTERNAL={delete:function(){return pa(n,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof t.options){var r=t;this._firebaseApp=r,this._databaseId=ZI.databaseIdFromApp(r),this._persistenceKey=r.name,this._credentials=new aI(e)}else{var i=t;if(!i.projectId)throw new zv(Hv.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new Rg(i.projectId,i.database),this._persistenceKey="[DEFAULT]",this._credentials=new iI}this._settings=new XI({}),this._dataConverter=this.createDataConverter(this._databaseId)}var tN=(eN.prototype.get=function(t){var e=this;ng("Transaction.get",arguments,1);var n=TN("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Vv("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof Wb)return new uN(e._firestore,n._key,null,!1,!1,n._converter);if(r instanceof Vb)return new uN(e._firestore,n._key,r,!1,!1,n._converter);throw Vv("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)}))},eN.prototype.set=function(t,e,n){ig("Transaction.set",arguments,2,3);var r=TN("Transaction.set",t,this._firestore);n=bN("Transaction.set",n);var i=CN(r._converter,e,"Transaction.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._transaction.set(r._key,s),this},eN.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof tI?(rg("Transaction.update",arguments,3),r=TN("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(ng("Transaction.update",arguments,2),r=TN("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},eN.prototype.delete=function(t){ng("Transaction.delete",arguments,1);var e=TN("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},eN);function eN(t,e){this._firestore=t,this._transaction=e}var nN=(rN.prototype.set=function(t,e,n){ig("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=TN("WriteBatch.set",t,this._firestore);n=bN("WriteBatch.set",n);var i=CN(r._converter,e,"WriteBatch.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._mutations=this._mutations.concat(s.toMutations(r._key,C_.NONE)),this},rN.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof tI?(rg("WriteBatch.update",arguments,3),r=TN("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(ng("WriteBatch.update",arguments,2),r=TN("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,C_.exists(!0))),this},rN.prototype.delete=function(t){ng("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=TN("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new U_(e._key,C_.NONE)),this},rN.prototype.commit=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]}))}))},rN.prototype.verifyNotCommitted=function(){if(this._committed)throw new zv(Hv.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},rN);function rN(t){this._firestore=t,this._mutations=[],this._committed=!1}var iN=(oN.forPath=function(t,e,n){if(t.length%2!=0)throw new zv(Hv.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new oN(new Kg(t),e,n)},Object.defineProperty(oN.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(oN.prototype,"parent",{get:function(){return new mN(this._key.path.popLast(),this.firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(oN.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),oN.prototype.collection=function(t){if(ng("DocumentReference.collection",arguments,1),og("DocumentReference.collection","non-empty string",1,t),!t)throw new zv(Hv.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=qg.fromString(t);return new mN(this._key.path.child(e),this.firestore)},oN.prototype.isEqual=function(t){if(!(t instanceof oN))throw yg("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)&&this._converter===t._converter},oN.prototype.set=function(t,e){ig("DocumentReference.set",arguments,1,2),e=bN("DocumentReference.set",e);var n=CN(this._converter,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore._dataConverter.parseMergeData(i,r,e.mergeFields):this.firestore._dataConverter.parseSetData(i,r);return this._firestoreClient.write(o.toMutations(this._key,C_.NONE))},oN.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof tI?(rg("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(ng("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,C_.exists(!0)))},oN.prototype.delete=function(){return ng("DocumentReference.delete",arguments,0),this._firestoreClient.write([new U_(this._key,C_.NONE)])},oN.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ig("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||pI(t[i])||(dg("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),ug("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=pI(t[i])?t[i]:(og("DocumentReference.onSnapshot","function",i,t[i]),ag("DocumentReference.onSnapshot","function",i+1,t[i+1]),ag("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},oN.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new $S({next:function(t){if(e.next){Bv(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new uN(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites,n._converter))}},error:r}),o=this._firestoreClient.listen(RE.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},oN.prototype.get=function(t){var e=this;return ig("DocumentReference.get",arguments,0,1),EN("DocumentReference.get",t),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then((function(t){n(new uN(e.firestore,e._key,t,!0,t instanceof Vb&&t.hasLocalMutations,e._converter))}),r):e.getViaSnapshotListener(n,r,t)}))},oN.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new zv(Hv.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new zv(Hv.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},oN.prototype.withConverter=function(t){return new oN(this._key,this.firestore,t)},oN);function oN(t,e,n){this._key=t,this.firestore=e,this._converter=n,this._firestoreClient=this.firestore.ensureClientConfigured()}var aN=(sN.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},sN);function sN(t,e){this.hasPendingWrites=t,this.fromCache=e}var uN=(cN.prototype.data=function(t){if(ig("DocumentSnapshot.data",arguments,0,1),t=wN("DocumentSnapshot.data",t),this._document){if(this._converter){var e=new lN(this._firestore,this._key,this._document,this._fromCache,this._hasPendingWrites);return this._converter.fromFirestore(e,t)}return this.toJSObject(this._document.data(),z_.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled()))}},cN.prototype.get=function(t,e){if(ig("DocumentSnapshot.get",arguments,1,2),e=wN("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(HI("DocumentSnapshot.get",t));if(null!==n)return this.toJSValue(n,z_.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(cN.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(cN.prototype,"ref",{get:function(){return new iN(this._key,this._firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(cN.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(cN.prototype,"metadata",{get:function(){return new aN(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),cN.prototype.isEqual=function(t){if(!(t instanceof cN))throw yg("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))&&this._converter===t._converter},cN.prototype.toJSObject=function(t,e){var n=this,r={};return t.forEach((function(t,i){r[t]=n.toJSValue(i,e)})),r},cN.prototype.toJSValue=function(t,e){if(t instanceof Pb)return this.toJSObject(t,e);if(t instanceof Lb)return this.toJSArray(t,e);if(t instanceof Ib){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Uv("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new iN(n,this._firestore,this._converter)}return t.value(e)},cN.prototype.toJSArray=function(t,e){var n=this;return t.internalValue.map((function(t){return n.toJSValue(t,e)}))},cN);function cN(t,e,n,r,i,o){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i,this._converter=o}var hN,lN=(ha(pN,hN=uN),pN.prototype.data=function(t){var e=hN.prototype.data.call(this,t);return Bv(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},pN);function pN(){return null!==hN&&hN.apply(this,arguments)||this}var fN=(dN.prototype.where=function(t,e,n){var r;ng("Query.where",arguments,3),fg("Query.where",3,n),function(t,e,n,r){if(!e.some((function(t){return t===r})))throw new zv(Hv.INVALID_ARGUMENT,"Invalid value "+pg(r)+" provided to function Query.where() for its "+gg(2)+" argument. Acceptable values: "+e.join(", "))}(0,["<","<=","==",">=",">","array-contains","in","array-contains-any"],0,e);var i=HI("Query.where",t),o=OE.fromString(e);if(i.isKeyField()){if(o===OE.ARRAY_CONTAINS||o===OE.ARRAY_CONTAINS_ANY)throw new zv(Hv.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===OE.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new Lb(a)}else r=this.parseDocumentIdValue(n)}else o!==OE.IN&&o!==OE.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n,o===OE.IN);var h=ME.create(i,o,r);return this.validateNewFilter(h),new dN(this._query.addFilter(h),this.firestore,this._converter)},dN.prototype.orderBy=function(t,e){var n;if(ig("Query.orderBy",arguments,1,2),ag("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=ZE.ASCENDING;else{if("desc"!==e)throw new zv(Hv.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=ZE.DESCENDING}if(null!==this._query.startAt)throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=HI("Query.orderBy",t),i=new rT(r,n);return this.validateNewOrderBy(i),new dN(this._query.addOrderBy(i),this.firestore,this._converter)},dN.prototype.limit=function(t){return ng("Query.limit",arguments,1),og("Query.limit","number",1,t),vg("Query.limit",1,t),new dN(this._query.withLimitToFirst(t),this.firestore,this._converter)},dN.prototype.limitToLast=function(t){return ng("Query.limitToLast",arguments,1),og("Query.limitToLast","number",1,t),vg("Query.limitToLast",1,t),new dN(this._query.withLimitToLast(t),this.firestore,this._converter)},dN.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];rg("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new dN(this._query.withStartAt(r),this.firestore,this._converter)},dN.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];rg("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new dN(this._query.withStartAt(r),this.firestore,this._converter)},dN.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];rg("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new dN(this._query.withEndAt(r),this.firestore,this._converter)},dN.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];rg("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new dN(this._query.withEndAt(r),this.firestore,this._converter)},dN.prototype.isEqual=function(t){if(!(t instanceof dN))throw yg("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},dN.prototype.withConverter=function(t){return new dN(this._query,this.firestore,t)},dN.prototype.boundFromDocOrFields=function(t,e,n,r){if(fg(t,1,e),e instanceof uN){if(0<n.length)throw new zv(Hv.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new zv(Hv.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},dN.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Ib(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof bb)throw new zv(Hv.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new eT(r,n)},dN.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new zv(Hv.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(qg.fromString(a));if(!Kg.isDocumentKey(s))throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Kg(s);i.push(new Ib(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new eT(i,n)},dN.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ig("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||pI(t[i])||(dg("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),ug("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=pI(t[i])?t[i]:(og("Query.onSnapshot","function",i,t[i]),ag("Query.onSnapshot","function",i+1,t[i+1]),ag("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.validateHasExplicitOrderByForLimitToLast(this._query),this.onSnapshotInternal(r,n)},dN.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new $S({next:function(t){e.next&&e.next(new yN(n.firestore,n._query,t,n._converter))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},dN.prototype.validateHasExplicitOrderByForLimitToLast=function(t){if(t.hasLimitToLast()&&0===t.explicitOrderBy.length)throw new zv(Hv.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},dN.prototype.get=function(t){var e=this;return ig("Query.get",arguments,0,1),EN("Query.get",t),this.validateHasExplicitOrderByForLimitToLast(this._query),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then((function(t){n(new yN(e.firestore,e._query,t,e._converter))}),r):e.getViaSnapshotListener(n,r,t)}))},dN.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new zv(Hv.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},dN.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(qg.fromString(t));if(!Kg.isDocumentKey(e))throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Ib(this.firestore._databaseId,new Kg(e))}if(t instanceof iN)return new Ib(this.firestore._databaseId,t._key);throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+pg(t)+".")},dN.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new zv(Hv.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new zv(Hv.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new zv(Hv.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter((function(t){return Number.isNaN(t)})).length)throw new zv(Hv.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},dN.prototype.validateNewFilter=function(t){if(t instanceof ME){var e=[OE.ARRAY_CONTAINS,OE.ARRAY_CONTAINS_ANY],n=[OE.IN,OE.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw new zv(Hv.INVALID_ARGUMENT,s===t.op?"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter.":"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},dN.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},dN.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new zv(Hv.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},dN);function dN(t,e,n){this._query=t,this.firestore=e,this._converter=n}var yN=(Object.defineProperty(vN.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!0,configurable:!0}),Object.defineProperty(vN.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(vN.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),vN.prototype.forEach=function(t,e){var n=this;ig("QuerySnapshot.forEach",arguments,1,2),og("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach((function(r){t.call(e,n.convertToDocumentImpl(r))}))},Object.defineProperty(vN.prototype,"query",{get:function(){return new fN(this._originalQuery,this._firestore,this._converter)},enumerable:!0,configurable:!0}),vN.prototype.docChanges=function(t){t&&(dg("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),ug("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new zv(Hv.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n,r){if(n.oldDocs.isEmpty()){var i,o=0;return n.docChanges.map((function(e){var a=new lN(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key),r);return Bv(e.type===sC.Added,"Invalid event type for first snapshot"),Bv(!i||n.query.docComparator(i,e.doc)<0,"Got added events in wrong order"),i=e.doc,{type:"added",doc:a,oldIndex:-1,newIndex:o++}}))}var a=n.oldDocs;return n.docChanges.filter((function(t){return e||t.type!==sC.Metadata})).map((function(e){var i=new lN(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key),r),o=-1,s=-1;return e.type!==sC.Added&&(Bv(0<=(o=a.indexOf(e.doc.key)),"Index for document not found"),a=a.delete(e.doc.key)),e.type!==sC.Removed&&(s=(a=a.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case sC.Added:return"added";case sC.Modified:case sC.Metadata:return"modified";case sC.Removed:return"removed";default:return Vv("Unknown change type: "+t)}}(e.type),doc:i,oldIndex:o,newIndex:s}}))}(this._firestore,e,this._snapshot,this._converter),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},vN.prototype.isEqual=function(t){if(!(t instanceof vN))throw yg("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)&&this._converter===t._converter},vN.prototype.convertToDocumentImpl=function(t){return new lN(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key),this._converter)},vN);function vN(t,e,n,r){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._converter=r,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new aN(n.hasPendingWrites,n.fromCache)}ga(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach((function(t){try{Object.defineProperty(yN.prototype.docChanges,t,{get:function(){return function(){throw new zv(Hv.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}}));var gN,mN=(ha(_N,gN=fN),Object.defineProperty(_N.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(_N.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new iN(new Kg(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(_N.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),_N.prototype.doc=function(t){if(ig("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=_g.newId()),og("CollectionReference.doc","non-empty string",1,t),""===t)throw new zv(Hv.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=qg.fromString(t);return iN.forPath(this._query.path.child(e),this.firestore,this._converter)},_N.prototype.add=function(t){ng("CollectionReference.add",arguments,1),og("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then((function(){return e}))},_N.prototype.withConverter=function(t){return new _N(this._path,this.firestore,t)},_N);function _N(t,e,n){var r=gN.call(this,RE.atPath(t),e,n)||this;if((r._path=t).length%2!=1)throw new zv(Hv.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return r}function bN(t,e){if(void 0===e)return{merge:!1};if(dg(t,e,["merge","mergeFields"]),ug(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+pg(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new zv(Hv.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+o+" was: "+pg(r[o]))}(t,"mergeFields",0,r,(function(t){return"string"==typeof t||t instanceof tI}))}(t,0,0,e.mergeFields),void 0!==e.mergeFields&&void 0!==e.merge)throw new zv(Hv.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function wN(t,e){return void 0===e?{}:(dg(t,e,["serverTimestamps"]),cg(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function EN(t,e){ag(t,"object",1,e),e&&(dg(t,e,["source"]),cg(t,0,"source",e.source,["default","server","cache"]))}function TN(t,e,n){if(e instanceof iN){if(e.firestore!==n)throw new zv(Hv.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw yg(t,"DocumentReference",1,e)}function CN(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var SN=Yv($I,"Use firebase.firestore() instead."),IN=Yv(tN,"Use firebase.firestore().runTransaction() instead."),NN=Yv(nN,"Use firebase.firestore().batch() instead."),AN=Yv(iN,"Use firebase.firestore().doc() instead."),DN=Yv(uN),kN=Yv(lN),RN=Yv(fN),PN=Yv(yN),ON=Yv(mN,"Use firebase.firestore().collection() instead."),xN={Firestore:SN,GeoPoint:LC,Timestamp:um,Blob:Ag,Transaction:IN,WriteBatch:NN,DocumentReference:AN,DocumentSnapshot:DN,Query:RN,QueryDocumentSnapshot:kN,QuerySnapshot:PN,CollectionReference:ON,FieldPath:tI,FieldValue:kI,setLogLevel:$I.setLogLevel,CACHE_SIZE_UNLIMITED:YI},LN=(MN.prototype.addCallback=function(t){},MN.prototype.shutdown=function(){},MN);function MN(){}var FN="ConnectivityMonitor",UN=(qN.prototype.addCallback=function(t){this.callbacks.push(t)},qN.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},qN.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},qN.prototype.onNetworkAvailable=function(){Fv(FN,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},qN.prototype.onNetworkUnavailable=function(){Fv(FN,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},qN.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},qN);function qN(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var VN=(BN.prototype.onOpen=function(t){Bv(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},BN.prototype.onClose=function(t){Bv(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},BN.prototype.onMessage=function(t){Bv(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},BN.prototype.close=function(){this.closeFn()},BN.prototype.send=function(t){this.sendFn(t)},BN.prototype.callOnOpen=function(){Bv(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},BN.prototype.callOnClose=function(t){Bv(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},BN.prototype.callOnMessage=function(t){Bv(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},BN);function BN(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var jN="Connection",WN={BatchGetDocuments:"batchGet",Commit:"commit"},QN="gl-js/ fire/"+Ov,KN=(HN.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=QN},HN.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise((function(o,a){var s=new Pv;s.listenOnce(kv.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case Dv.NO_ERROR:var e=s.getResponseJson();Fv(jN,"XHR received:",JSON.stringify(e)),o(e);break;case Dv.TIMEOUT:Fv(jN,'RPC "'+t+'" timed out'),a(new zv(Hv.DEADLINE_EXCEEDED,"Request time out"));break;case Dv.HTTP_ERROR:var n=s.getStatus();if(Fv(jN,'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),0<n){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var i=function(t){var e=t.toLowerCase().replace("_","-");return 0<=Object.values(Hv).indexOf(e)?e:Hv.UNKNOWN}(r.status);a(new zv(i,r.message))}else a(new zv(Hv.UNKNOWN,"Server responded with status "+s.getStatus()))}else Fv(jN,'RPC "'+t+'" failed'),a(new zv(Hv.UNAVAILABLE,"Connection failed."));break;default:Vv('RPC "'+t+'" failed with unanticipated webchannel error '+s.getLastErrorCode()+": "+s.getLastError()+", giving up.")}}finally{Fv(jN,'RPC "'+t+'" completed.')}}));var u=la({},e);delete u.database;var c=JSON.stringify(u);Fv(jN,"XHR sending: ",i+" "+c);var h={"Content-Type":"text/plain"};r.modifyHeadersForRequest(h,n),s.send(i,"POST",c,h,15)}))},HN.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},HN.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Av(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),ka()||0<=Aa().indexOf("Electron/")||function(){var t=Aa();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=Aa().indexOf("MSAppHost/")||function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){s.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))}Fv(jN,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new VN({sendFn:function(t){c?Fv(jN,"Not sending because WebChannel is closed:",t):(u||(Fv(jN,"Opening WebChannel transport."),s.open(),u=!0),Fv(jN,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}});return a(Rv.EventType.OPEN,(function(){c||Fv(jN,"WebChannel transport opened.")})),a(Rv.EventType.CLOSE,(function(){c||(c=!0,Fv(jN,"WebChannel transport closed"),h.callOnClose())})),a(Rv.EventType.ERROR,(function(t){c||(c=!0,Fv(jN,"WebChannel transport errored:",t),h.callOnClose(new zv(Hv.UNAVAILABLE,"The operation could not be completed")))})),a(Rv.EventType.MESSAGE,(function(t){var e;if(!c){var n=t.data[0];Bv(!!n,"Got a webchannel message without data.");var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Fv(jN,"WebChannel received error:",r);var i=r.status,o=function(t){var e=eC[t];if(void 0!==e)return aC(e)}(i),a=r.message;void 0===o&&(o=Hv.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new zv(o,a)),s.close()}else Fv(jN,"WebChannel received:",n),h.callOnMessage(n)}})),setTimeout((function(){h.callOnOpen()}),0),h},HN.prototype.makeUrl=function(t){var e=WN[t];return Bv(void 0!==e,"Unknown REST mapping for: "+t),this.baseUrl+"/v1/projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents:"+e},HN);function HN(t){this.databaseId=t.databaseId,this.baseUrl=(t.ssl?"https":"http")+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var zN,GN=(Object.defineProperty(YN.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(YN.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),YN.prototype.loadConnection=function(t){return Promise.resolve(new KN(t))},YN.prototype.newConnectivityMonitor=function(){return UN.isAvailable()?new UN:new LN},YN.prototype.newSerializer=function(t){return new eS(t,{useProto3Json:!0})},YN.prototype.formatJSON=function(t){return JSON.stringify(t)},YN.prototype.atob=function(t){return atob(t)},YN.prototype.btoa=function(t){return btoa(t)},YN);function YN(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}jv.setPlatform(new GN),function(t){t.INTERNAL.registerComponent(new ns("firestore",(function(t){var e=t.getProvider("app").getImmediate();return new $I(e,t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(function(t){Bv(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(xN)))}(zN=Ps),zN.registerVersion("@firebase/firestore","1.9.3");var XN,JN={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},$N=(ha(ZN,XN=Error),ZN);function ZN(t,e,n){var r=XN.call(this,e)||this;return Object.setPrototypeOf(r,ZN.prototype),r.code=t,r.details=n,r}var tA=(eA.prototype.getAuthToken=function(){return pa(this,void 0,void 0,(function(){var t;return fa(this,(function(e){switch(e.label){case 0:if(!this.auth)return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 3:return e.sent(),[2,void 0];case 4:return[2]}}))}))},eA.prototype.getInstanceIdToken=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){if(!(this.messaging&&"Notification"in self&&"granted"===Notification.permission))return[2,void 0];try{return[2,this.messaging.getToken()]}catch(t){return[2,void 0]}return[2]}))}))},eA.prototype.getContext=function(){return pa(this,void 0,void 0,(function(){var t,e;return fa(this,(function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}}))}))},eA);function eA(t,e){var n=this;this.auth=null,this.messaging=null,this.auth=t.getImmediate({optional:!0}),this.messaging=e.getImmediate({optional:!0}),this.auth||t.get().then((function(t){return n.auth=t}),(function(){})),this.messaging||e.get().then((function(t){return n.messaging=t}),(function(){}))}function nA(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var rA=(iA.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map((function(t){return e.encode(t)}));if("function"==typeof t||"object"==typeof t)return nA(t,(function(t){return e.encode(t)}));throw new Error("Data cannot be encoded in JSON: "+t)},iA.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map((function(t){return e.decode(t)})):"function"==typeof t||"object"==typeof t?nA(t,(function(t){return e.decode(t)})):t},iA);function iA(){}var oA,aA=(Object.defineProperty(sA.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),sA.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},sA.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},sA.prototype.httpsCallable=function(t,e){var n=this;return function(r){return n.call(t,r,e||{})}},sA.prototype.postJSON=function(t,e,n){return pa(this,void 0,void 0,(function(){var r,i;return fa(this,(function(o){switch(o.label){case 0:n.append("Content-Type","application/json"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return r=o.sent(),[3,4];case 3:return o.sent(),[2,{status:0,json:null}];case 4:i=null,o.label=5;case 5:return o.trys.push([5,7,,8]),[4,r.json()];case 6:return i=o.sent(),[3,8];case 7:return o.sent(),[3,8];case 8:return[2,{status:r.status,json:i}]}}))}))},sA.prototype.call=function(t,e,n){return pa(this,void 0,void 0,(function(){var r,i,o,a,s,u,c,h;return fa(this,(function(l){switch(l.label){case 0:return r=this._url(t),e=this.serializer.encode(e),i={data:e},o=new Headers,[4,this.contextProvider.getContext()];case 1:return(a=l.sent()).authToken&&o.append("Authorization","Bearer "+a.authToken),a.instanceIdToken&&o.append("Firebase-Instance-ID-Token",a.instanceIdToken),s=n.timeout||7e4,[4,Promise.race([this.postJSON(r,i,o),function(t){return new Promise((function(e,n){setTimeout((function(){n(new $N("deadline-exceeded","deadline-exceeded"))}),t)}))}(s),this.cancelAllRequests])];case 2:if(!(u=l.sent()))throw new $N("cancelled","Firebase Functions instance was deleted.");if(c=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!JN[s])return new $N("internal","internal");r=JN[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new $N(r,i,o)}(u.status,u.json,this.serializer))throw c;if(!u.json)throw new $N("internal","Response is not valid JSON object.");if(void 0===(h=u.json.data)&&(h=u.json.result),void 0===h)throw new $N("internal","Response is missing data field.");return[2,{data:this.serializer.decode(h)}]}}))}))},sA);function sA(t,e,n,r){var i=this;void 0===r&&(r="us-central1"),this.app_=t,this.region_=r,this.serializer=new rA,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return i.deleteService()}},this.contextProvider=new tA(e,n),this.cancelAllRequests=new Promise((function(t){i.deleteService=function(){return t()}}))}function uA(t){return new Promise((function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function cA(t,e,n){var r,i=new Promise((function(i,o){uA(r=t[e].apply(t,n)).then(i,o)}));return i.request=r,i}function hA(t,e,n){n.forEach((function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})}))}function lA(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return cA(this[e],r,arguments)})}))}function pA(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})}))}function fA(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return function(t,e,n){var r=cA(t,e,n);return r.then((function(t){if(t)return new yA(t,r.request)}))}(this[e],r,arguments)})}))}function dA(t){this._index=t}function yA(t,e){this._cursor=t,this._request=e}function vA(t){this._store=t}function gA(t){this._tx=t,this.complete=new Promise((function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}}))}function mA(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new gA(n)}function _A(t){this._db=t}function bA(t,e,n){var r=cA(indexedDB,"open",[t,e]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new mA(i.result,t.oldVersion,i.transaction))}),r.then((function(t){return new _A(t)}))}function wA(t){return cA(indexedDB,"deleteDatabase",[t])}oA={Functions:aA},Ps.INTERNAL.registerComponent(new ns("functions",(function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("messaging");return new aA(n,r,i,e)}),"PUBLIC").setServiceProps(oA).setMultipleInstances(!0)),Ps.registerVersion("@firebase/functions","0.4.30"),hA(dA,"_index",["name","keyPath","multiEntry","unique"]),lA(dA,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),fA(dA,"_index",IDBIndex,["openCursor","openKeyCursor"]),hA(yA,"_cursor",["direction","key","primaryKey","value"]),lA(yA,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(t){t in IDBCursor.prototype&&(yA.prototype[t]=function(){var e=this,n=arguments;return Promise.resolve().then((function(){return e._cursor[t].apply(e._cursor,n),uA(e._request).then((function(t){if(t)return new yA(t,e._request)}))}))})})),vA.prototype.createIndex=function(){return new dA(this._store.createIndex.apply(this._store,arguments))},vA.prototype.index=function(){return new dA(this._store.index.apply(this._store,arguments))},hA(vA,"_store",["name","keyPath","indexNames","autoIncrement"]),lA(vA,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),fA(vA,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),pA(vA,"_store",IDBObjectStore,["deleteIndex"]),gA.prototype.objectStore=function(){return new vA(this._tx.objectStore.apply(this._tx,arguments))},hA(gA,"_tx",["objectStoreNames","mode"]),pA(gA,"_tx",IDBTransaction,["abort"]),mA.prototype.createObjectStore=function(){return new vA(this._db.createObjectStore.apply(this._db,arguments))},hA(mA,"_db",["name","version","objectStoreNames"]),pA(mA,"_db",IDBDatabase,["deleteObjectStore","close"]),_A.prototype.transaction=function(){return new gA(this._db.transaction.apply(this._db,arguments))},hA(_A,"_db",["name","version","objectStoreNames"]),pA(_A,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(t){[vA,dA].forEach((function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e=function(t){return Array.prototype.slice.call(t)}(arguments),n=e[e.length-1],r=this._store||this._index,i=r[t].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})}))})),[dA,vA].forEach((function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise((function(i){n.iterateCursor(t,(function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():i(r)):i(r)}))}))})}));var EA,TA=1e4,CA="w:0.4.0",SA="FIS_v2",IA="https://firebaseinstallations.googleapis.com/v1",NA=36e5,AA=((EA={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',EA["not-registered"]="Firebase Installation is not registered.",EA["installation-not-found"]="Firebase Installation not found.",EA["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',EA["app-offline"]="Could not process request. Application offline.",EA["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",EA),DA=new La("installations","Installations",AA);function kA(t){return t instanceof Oa&&t.code.includes("request-failed")}function RA(t){return IA+"/projects/"+t.projectId+"/installations"}function PA(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function OA(t,e){return pa(this,void 0,void 0,(function(){var n,r;return fa(this,(function(i){switch(i.label){case 0:return[4,e.json()];case 1:return n=i.sent(),[2,DA.create("request-failed",{requestName:t,serverCode:(r=n.error).code,serverMessage:r.message,serverStatus:r.status})]}}))}))}function xA(t){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey})}function LA(t,e){var n=e.refreshToken,r=xA(t);return r.append("Authorization",function(t){return SA+" "+t}(n)),r}function MA(t){return pa(this,void 0,void 0,(function(){var e;return fa(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return 500<=(e=n.sent()).status&&e.status<600?[2,t()]:[2,e]}}))}))}function FA(t){return new Promise((function(e){setTimeout(e,t)}))}var UA=/^[cdef][\w-]{21}$/,qA="";function VA(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,va(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return UA.test(e)?e:qA}catch(t){return qA}}function BA(t){return t.appName+"!"+t.appId}var jA=new Map;function WA(t,e){var n=BA(t);QA(n,e),function(t,e){var n=HA();n&&n.postMessage({key:t,fid:e}),zA()}(n,e)}function QA(t,e){var n,r,i=jA.get(t);if(i)try{for(var o=da(i),a=o.next();!a.done;a=o.next())(0,a.value)(e)}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}var KA=null;function HA(){return!KA&&"BroadcastChannel"in self&&((KA=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(t){QA(t.data.key,t.data.fid)}),KA}function zA(){0===jA.size&&KA&&(KA.close(),KA=null)}var GA,YA,XA="firebase-installations-database",JA=1,$A="firebase-installations-store",ZA=null;function tD(){return ZA=ZA||bA(XA,JA,(function(t){switch(t.oldVersion){case 0:t.createObjectStore($A)}}))}function eD(t,e){return pa(this,void 0,void 0,(function(){var n,r,i,o,a;return fa(this,(function(s){switch(s.label){case 0:return n=BA(t),[4,tD()];case 1:return r=s.sent(),i=r.transaction($A,"readwrite"),[4,(o=i.objectStore($A)).get(n)];case 2:return a=s.sent(),[4,o.put(e,n)];case 3:return s.sent(),[4,i.complete];case 4:return s.sent(),a&&a.fid===e.fid||WA(t,e.fid),[2,e]}}))}))}function nD(t){return pa(this,void 0,void 0,(function(){var e,n,r;return fa(this,(function(i){switch(i.label){case 0:return e=BA(t),[4,tD()];case 1:return n=i.sent(),[4,(r=n.transaction($A,"readwrite")).objectStore($A).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}}))}))}function rD(t,e){return pa(this,void 0,void 0,(function(){var n,r,i,o,a,s;return fa(this,(function(u){switch(u.label){case 0:return n=BA(t),[4,tD()];case 1:return r=u.sent(),i=r.transaction($A,"readwrite"),[4,(o=i.objectStore($A)).get(n)];case 2:return a=u.sent(),void 0!==(s=e(a))?[3,4]:[4,o.delete(n)];case 3:return u.sent(),[3,6];case 4:return[4,o.put(s,n)];case 5:u.sent(),u.label=6;case 6:return[4,i.complete];case 7:return u.sent(),!s||a&&a.fid===s.fid||WA(t,s.fid),[2,s]}}))}))}function iD(t){return pa(this,void 0,void 0,(function(){var e,n,r;return fa(this,(function(i){switch(i.label){case 0:return[4,rD(t,(function(n){var r=function(t){return aD(t||{fid:VA(),registrationStatus:0})}(n),i=function(t,e){if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(t){return pa(this,void 0,void 0,(function(){var e,n,r,i;return fa(this,(function(o){switch(o.label){case 0:return[4,oD(t)];case 1:e=o.sent(),o.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,FA(100)];case 3:return o.sent(),[4,oD(t)];case 4:return e=o.sent(),[3,2];case 5:return 0!==e.registrationStatus?[3,7]:[4,iD(t)];case 6:return n=o.sent(),r=n.installationEntry,(i=n.registrationPromise)?[2,i]:[2,r];case 7:return[2,e]}}))}))}(t)}:{installationEntry:e};if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(DA.create("app-offline"))};var n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:function(t,e){return pa(this,void 0,void 0,(function(){var n,r;return fa(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,7]),[4,function(t,e){var n=e.fid;return pa(this,void 0,void 0,(function(){var e,r,i,o,a;return fa(this,(function(s){switch(s.label){case 0:return e=RA(t),r=xA(t),i={method:"POST",headers:r,body:JSON.stringify({fid:n,authVersion:SA,appId:t.appId,sdkVersion:CA})},[4,MA((function(){return fetch(e,i)}))];case 1:return(o=s.sent()).ok?[4,o.json()]:[3,3];case 2:return[2,{fid:(a=s.sent()).fid||n,registrationStatus:2,refreshToken:a.refreshToken,authToken:PA(a.authToken)}];case 3:return[4,OA("Create Installation",o)];case 4:throw s.sent()}}))}))}(t,e)];case 1:return n=i.sent(),[2,eD(t,n)];case 2:return kA(r=i.sent())&&409===r.serverCode?[4,nD(t)]:[3,4];case 3:return i.sent(),[3,6];case 4:return[4,eD(t,{fid:e.fid,registrationStatus:0})];case 5:i.sent(),i.label=6;case 6:throw r;case 7:return[2]}}))}))}(t,n)}}(t,r);return e=i.registrationPromise,i.installationEntry}))];case 1:return(n=i.sent()).fid!==qA?[3,3]:(r={},[4,e]);case 2:return[2,(r.installationEntry=i.sent(),r)];case 3:return[2,{installationEntry:n,registrationPromise:e}]}}))}))}function oD(t){return rD(t,(function(t){if(!t)throw DA.create("installation-not-found");return aD(t)}))}function aD(t){return function(t){return 1===t.registrationStatus&&t.registrationTime+TA<Date.now()}(t)?{fid:t.fid,registrationStatus:0}:t}function sD(t,e){var n=t.appConfig,r=t.platformLoggerProvider;return pa(this,void 0,void 0,(function(){var t,i,o,a,s;return fa(this,(function(u){switch(u.label){case 0:return t=function(t,e){var n=e.fid;return RA(t)+"/"+n+"/authTokens:generate"}(n,e),i=LA(n,e),(o=r.getImmediate({optional:!0}))&&i.append("x-firebase-client",o.getPlatformInfoString()),a={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:CA}})},[4,MA((function(){return fetch(t,a)}))];case 1:return(s=u.sent()).ok?[4,s.json()]:[3,3];case 2:return[2,PA(u.sent())];case 3:return[4,OA("Generate Auth Token",s)];case 4:throw u.sent()}}))}))}function uD(t,e){return void 0===e&&(e=!1),pa(this,void 0,void 0,(function(){var n,r,i;return fa(this,(function(o){switch(o.label){case 0:return[4,rD(t.appConfig,(function(r){if(!hD(r))throw DA.create("not-registered");var i=r.authToken;if(!e&&function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+NA}(t)}(i))return r;if(1===i.requestStatus)return n=function(t,e){return pa(this,void 0,void 0,(function(){var n,r;return fa(this,(function(i){switch(i.label){case 0:return[4,cD(t.appConfig)];case 1:n=i.sent(),i.label=2;case 2:return 1!==n.authToken.requestStatus?[3,5]:[4,FA(100)];case 3:return i.sent(),[4,cD(t.appConfig)];case 4:return n=i.sent(),[3,2];case 5:return 0===(r=n.authToken).requestStatus?[2,uD(t,e)]:[2,r]}}))}))}(t,e),r;if(!navigator.onLine)throw DA.create("app-offline");var o=function(t){var e={requestStatus:1,requestTime:Date.now()};return la(la({},t),{authToken:e})}(r);return n=function(t,e){return pa(this,void 0,void 0,(function(){var n,r,i;return fa(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,8]),[4,sD(t,e)];case 1:return n=o.sent(),i=la(la({},e),{authToken:n}),[4,eD(t.appConfig,i)];case 2:return o.sent(),[2,n];case 3:return!kA(r=o.sent())||401!==r.serverCode&&404!==r.serverCode?[3,5]:[4,nD(t.appConfig)];case 4:return o.sent(),[3,7];case 5:return i=la(la({},e),{authToken:{requestStatus:0}}),[4,eD(t.appConfig,i)];case 6:o.sent(),o.label=7;case 7:throw r;case 8:return[2]}}))}))}(t,o),o}))];case 1:return r=o.sent(),n?[4,n]:[3,3];case 2:return i=o.sent(),[3,4];case 3:i=r.authToken,o.label=4;case 4:return[2,i]}}))}))}function cD(t){return rD(t,(function(t){if(!hD(t))throw DA.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+TA<Date.now()}(t.authToken)?la(la({},t),{authToken:{requestStatus:0}}):t}))}function hD(t){return void 0!==t&&2===t.registrationStatus}function lD(t,e){return pa(this,void 0,void 0,(function(){var n,r,i,o;return fa(this,(function(a){switch(a.label){case 0:return n=function(t,e){var n=e.fid;return RA(t)+"/"+n}(t,e),r=LA(t,e),i={method:"DELETE",headers:r},[4,MA((function(){return fetch(n,i)}))];case 1:return(o=a.sent()).ok?[3,3]:[4,OA("Delete Installation",o)];case 2:throw a.sent();case 3:return[2]}}))}))}function pD(t){return DA.create("missing-app-config-values",{valueName:t})}(GA=Ps).INTERNAL.registerComponent(new ns("installations",(function(t){var e=t.getProvider("app").getImmediate(),n={appConfig:function(t){var e,n;if(!t||!t.options)throw pD("App Configuration");if(!t.name)throw pD("App Name");try{for(var r=da(["projectId","apiKey","appId"]),i=r.next();!i.done;i=r.next()){var o=i.value;if(!t.options[o])throw pD(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e),platformLoggerProvider:t.getProvider("platform-logger")};return{app:e,getId:function(){return function(t){return pa(this,void 0,void 0,(function(){var e,n,r;return fa(this,(function(i){switch(i.label){case 0:return[4,iD(t.appConfig)];case 1:return e=i.sent(),n=e.installationEntry,(r=e.registrationPromise)?r.catch(console.error):uD(t).catch(console.error),[2,n.fid]}}))}))}(n)},getToken:function(t){return function(t,e){return void 0===e&&(e=!1),pa(this,void 0,void 0,(function(){return fa(this,(function(n){switch(n.label){case 0:return[4,function(t){return pa(this,void 0,void 0,(function(){var e;return fa(this,(function(n){switch(n.label){case 0:return[4,iD(t)];case 1:return(e=n.sent().registrationPromise)?[4,e]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))}(t.appConfig)];case 1:return n.sent(),[4,uD(t,e)];case 2:return[2,n.sent().token]}}))}))}(n,t)},delete:function(){return function(t){return pa(this,void 0,void 0,(function(){var e,n;return fa(this,(function(r){switch(r.label){case 0:return[4,rD(e=t.appConfig,(function(t){if(!t||0!==t.registrationStatus)return t}))];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw DA.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw DA.create("app-offline");case 3:return[4,lD(e,n)];case 4:return r.sent(),[4,nD(e)];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))}(n)},onIdChange:function(t){return function(t,e){var n=t.appConfig;return function(t,e){HA();var n=BA(t),r=jA.get(n);r||(r=new Set,jA.set(n,r)),r.add(e)}(n,e),function(){!function(t,e){var n=BA(t),r=jA.get(n);r&&(r.delete(e),0===r.size&&jA.delete(n),zA())}(n,e)}}(n,t)}}}),"PUBLIC")),GA.registerVersion("@firebase/installations","0.4.0");var fD=((YA={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',YA["only-available-in-window"]="This method is available in a Window context.",YA["only-available-in-sw"]="This method is available in a service worker context.",YA["permission-default"]="The notification permission was not granted and dismissed instead.",YA["permission-blocked"]="The notification permission was not granted and blocked instead.",YA["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",YA["failed-service-worker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",YA["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",YA["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",YA["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",YA["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",YA["token-update-no-token"]="FCM returned no token when updating the user to push.",YA["use-sw-after-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",YA["invalid-sw-registration"]="The input to useServiceWorker() must be a ServiceWorkerRegistration.",YA["invalid-bg-handler"]="The input to setBackgroundMessageHandler() must be a function.",YA["invalid-vapid-key"]="The public VAPID key must be a string.",YA["use-vapid-key-after-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",YA),dD=new La("messaging","Messaging",fD);function yD(t){return dD.create("missing-app-config-values",{valueName:t})}function vD(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,va(e))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}var gD="fcm_token_details_db",mD=5,_D="fcm_token_object_Store";function bD(t){return pa(this,void 0,void 0,(function(){var e,n=this;return fa(this,(function(r){switch(r.label){case 0:return"databases"in indexedDB?[4,indexedDB.databases()]:[3,2];case 1:if(!r.sent().map((function(t){return t.name})).includes(gD))return[2,null];r.label=2;case 2:return e=null,[4,bA(gD,mD,(function(r){return pa(n,void 0,void 0,(function(){var n,i,o,a;return fa(this,(function(s){switch(s.label){case 0:return r.oldVersion<2?[2]:r.objectStoreNames.contains(_D)?[4,(n=r.transaction.objectStore(_D)).index("fcmSenderId").get(t)]:[2];case 1:return i=s.sent(),[4,n.clear()];case 2:if(s.sent(),!i)return[2];if(2===r.oldVersion){if(!(o=i).auth||!o.p256dh||!o.endpoint)return[2];e={token:o.fcmToken,createTime:(a=o.createTime,null!=a?a:Date.now()),subscriptionOptions:{auth:o.auth,p256dh:o.p256dh,endpoint:o.endpoint,swScope:o.swScope,vapidKey:"string"==typeof o.vapidKey?o.vapidKey:vD(o.vapidKey)}}}else 3===r.oldVersion?e={token:(o=i).fcmToken,createTime:o.createTime,subscriptionOptions:{auth:vD(o.auth),p256dh:vD(o.p256dh),endpoint:o.endpoint,swScope:o.swScope,vapidKey:vD(o.vapidKey)}}:4===r.oldVersion&&(e={token:(o=i).fcmToken,createTime:o.createTime,subscriptionOptions:{auth:vD(o.auth),p256dh:vD(o.p256dh),endpoint:o.endpoint,swScope:o.swScope,vapidKey:vD(o.vapidKey)}});return[2]}}))}))}))];case 3:return r.sent().close(),[4,wA(gD)];case 4:return r.sent(),[4,wA("fcm_vapid_details_db")];case 5:return r.sent(),[4,wA("undefined")];case 6:return r.sent(),[2,function(t){if(!t||!t.subscriptionOptions)return!1;var e=t.subscriptionOptions;return"number"==typeof t.createTime&&0<t.createTime&&"string"==typeof t.token&&0<t.token.length&&"string"==typeof e.auth&&0<e.auth.length&&"string"==typeof e.p256dh&&0<e.p256dh.length&&"string"==typeof e.endpoint&&0<e.endpoint.length&&"string"==typeof e.swScope&&0<e.swScope.length&&"string"==typeof e.vapidKey&&0<e.vapidKey.length}(e)?e:null]}}))}))}var wD="firebase-messaging-database",ED=1,TD="firebase-messaging-store",CD=null;function SD(){return CD=CD||bA(wD,ED,(function(t){switch(t.oldVersion){case 0:t.createObjectStore(TD)}}))}function ID(t){return pa(this,void 0,void 0,(function(){var e,n,r;return fa(this,(function(i){switch(i.label){case 0:return e=AD(t),[4,SD()];case 1:return[4,i.sent().transaction(TD).objectStore(TD).get(e)];case 2:return(n=i.sent())?[2,n]:[3,3];case 3:return[4,bD(t.appConfig.senderId)];case 4:return(r=i.sent())?[4,ND(t,r)]:[3,6];case 5:return i.sent(),[2,r];case 6:return[2]}}))}))}function ND(t,e){return pa(this,void 0,void 0,(function(){var n,r,i;return fa(this,(function(o){switch(o.label){case 0:return n=AD(t),[4,SD()];case 1:return r=o.sent(),[4,(i=r.transaction(TD,"readwrite")).objectStore(TD).put(e,n)];case 2:return o.sent(),[4,i.complete];case 3:return o.sent(),[2,e]}}))}))}function AD(t){return t.appConfig.appId}var DD,kD,RD="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",PD="https://fcmregistrations.googleapis.com/v1",OD="FCM_MSG",xD="google.c.a.c_id";function LD(t,e){return pa(this,void 0,void 0,(function(){var n,r,i,o;return fa(this,(function(a){switch(a.label){case 0:return[4,FD(t)];case 1:n=a.sent(),r={method:"DELETE",headers:n},a.label=2;case 2:return a.trys.push([2,5,,6]),[4,fetch(MD(t.appConfig)+"/"+e,r)];case 3:return[4,a.sent().json()];case 4:if((i=a.sent()).error)throw dD.create("token-unsubscribe-failed",{errorInfo:i.error.message});return[3,6];case 5:throw o=a.sent(),dD.create("token-unsubscribe-failed",{errorInfo:o});case 6:return[2]}}))}))}function MD(t){return PD+"/projects/"+t.projectId+"/registrations"}function FD(t){var e=t.appConfig,n=t.installations;return pa(this,void 0,void 0,(function(){var t;return fa(this,(function(r){switch(r.label){case 0:return[4,n.getToken()];case 1:return t=r.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})]}}))}))}function UD(t){var e=t.vapidKey,n={web:{endpoint:t.endpoint,auth:t.auth,p256dh:t.p256dh}};return e!==RD&&(n.web.applicationPubKey=e),n}function qD(t,e,n){return pa(this,void 0,void 0,(function(){var r,i,o,a;return fa(this,(function(s){switch(s.label){case 0:if("granted"!==Notification.permission)throw dD.create("permission-blocked");return[4,function(t,e){return pa(this,void 0,void 0,(function(){var n;return fa(this,(function(r){switch(r.label){case 0:return[4,t.pushManager.getSubscription()];case 1:return(n=r.sent())?[2,n]:[2,t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})]}}))}))}(e,n)];case 1:return r=s.sent(),[4,ID(t)];case 2:return i=s.sent(),o={vapidKey:n,swScope:e.scope,endpoint:r.endpoint,auth:vD(r.getKey("auth")),p256dh:vD(r.getKey("p256dh"))},i?[3,3]:[2,BD(t,o)];case 3:if(function(t,e){return e.vapidKey===t.vapidKey&&e.endpoint===t.endpoint&&e.auth===t.auth&&e.p256dh===t.p256dh}(i.subscriptionOptions,o))return[3,8];s.label=4;case 4:return s.trys.push([4,6,,7]),[4,LD(t,i.token)];case 5:return s.sent(),[3,7];case 6:return a=s.sent(),console.warn(a),[3,7];case 7:return[2,BD(t,o)];case 8:return Date.now()>=i.createTime+6048e5?[2,function(t,e,n){return pa(this,void 0,void 0,(function(){var r,i,o;return fa(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,5]),[4,function(t,e){return pa(this,void 0,void 0,(function(){var n,r,i,o,a;return fa(this,(function(s){switch(s.label){case 0:return[4,FD(t)];case 1:n=s.sent(),r=UD(e.subscriptionOptions),i={method:"PATCH",headers:n,body:JSON.stringify(r)},s.label=2;case 2:return s.trys.push([2,5,,6]),[4,fetch(MD(t.appConfig)+"/"+e.token,i)];case 3:return[4,s.sent().json()];case 4:return o=s.sent(),[3,6];case 5:throw a=s.sent(),dD.create("token-update-failed",{errorInfo:a});case 6:if(o.error)throw dD.create("token-update-failed",{errorInfo:o.error.message});if(!o.token)throw dD.create("token-update-no-token");return[2,o.token]}}))}))}(e,t)];case 1:return r=a.sent(),i=la({token:r,createTime:Date.now()},t),[4,ND(e,i)];case 2:return a.sent(),[2,r];case 3:return o=a.sent(),[4,VD(e,n)];case 4:throw a.sent(),o;case 5:return[2]}}))}))}({token:i.token,createTime:Date.now(),subscriptionOptions:o},t,e)]:[2,i.token];case 9:return[2]}}))}))}function VD(t,e){return pa(this,void 0,void 0,(function(){var n,r;return fa(this,(function(i){switch(i.label){case 0:return[4,ID(t)];case 1:return(n=i.sent())?[4,LD(t,n.token)]:[3,4];case 2:return i.sent(),[4,function(t){return pa(this,void 0,void 0,(function(){var e,n,r;return fa(this,(function(i){switch(i.label){case 0:return e=AD(t),[4,SD()];case 1:return n=i.sent(),[4,(r=n.transaction(TD,"readwrite")).objectStore(TD).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}}))}))}(t)];case 3:i.sent(),i.label=4;case 4:return[4,e.pushManager.getSubscription()];case 5:return(r=i.sent())?[2,r.unsubscribe()]:[2,!0]}}))}))}function BD(t,e){return pa(this,void 0,void 0,(function(){var n,r;return fa(this,(function(i){switch(i.label){case 0:return[4,function(t,e){return pa(this,void 0,void 0,(function(){var n,r,i,o,a;return fa(this,(function(s){switch(s.label){case 0:return[4,FD(t)];case 1:n=s.sent(),r=UD(e),i={method:"POST",headers:n,body:JSON.stringify(r)},s.label=2;case 2:return s.trys.push([2,5,,6]),[4,fetch(MD(t.appConfig),i)];case 3:return[4,s.sent().json()];case 4:return o=s.sent(),[3,6];case 5:throw a=s.sent(),dD.create("token-subscribe-failed",{errorInfo:a});case 6:if(o.error)throw dD.create("token-subscribe-failed",{errorInfo:o.error.message});if(!o.token)throw dD.create("token-subscribe-no-token");return[2,o.token]}}))}))}(t,e)];case 1:return n=i.sent(),r={token:n,createTime:Date.now(),subscriptionOptions:e},[4,ND(t,r)];case 2:return i.sent(),[2,r.token]}}))}))}function jD(t){return"object"==typeof t&&!!t&&xD in t}(kD=DD=DD||{}).PUSH_RECEIVED="push-received",kD.NOTIFICATION_CLICKED="notification-clicked";var WD=(Object.defineProperty(QD.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!0,configurable:!0}),QD.prototype.getToken=function(){return pa(this,void 0,void 0,(function(){var t;return fa(this,(function(e){switch(e.label){case 0:return this.vapidKey||(this.vapidKey=RD),[4,this.getServiceWorkerRegistration()];case 1:return t=e.sent(),"default"!==Notification.permission?[3,3]:[4,Notification.requestPermission()];case 2:e.sent(),e.label=3;case 3:if("granted"!==Notification.permission)throw dD.create("permission-blocked");return[2,qD(this.firebaseDependencies,t,this.vapidKey)]}}))}))},QD.prototype.deleteToken=function(){return pa(this,void 0,void 0,(function(){var t;return fa(this,(function(e){switch(e.label){case 0:return[4,this.getServiceWorkerRegistration()];case 1:return t=e.sent(),[2,VD(this.firebaseDependencies,t)]}}))}))},QD.prototype.requestPermission=function(){return pa(this,void 0,void 0,(function(){var t;return fa(this,(function(e){switch(e.label){case 0:return"granted"===Notification.permission?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw dD.create("denied"===t?"permission-blocked":"permission-default")}}))}))},QD.prototype.usePublicVapidKey=function(t){if(null!==this.vapidKey)throw dD.create("use-vapid-key-after-get-token");if("string"!=typeof t||0===t.length)throw dD.create("invalid-vapid-key");this.vapidKey=t},QD.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw dD.create("invalid-sw-registration");if(this.swRegistration)throw dD.create("use-sw-after-get-token");this.swRegistration=t},QD.prototype.onMessage=function(t){var e=this;return this.onMessageCallback="function"==typeof t?t:t.next,function(){e.onMessageCallback=null}},QD.prototype.setBackgroundMessageHandler=function(){throw dD.create("only-available-in-sw")},QD.prototype.onTokenRefresh=function(){return function(){}},QD.prototype.getServiceWorkerRegistration=function(){return pa(this,void 0,void 0,(function(){var t,e;return fa(this,(function(n){switch(n.label){case 0:if(this.swRegistration)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),t=this,[4,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"})];case 2:return t.swRegistration=n.sent(),[3,4];case 3:throw e=n.sent(),dD.create("failed-service-worker-registration",{browserErrorMessage:e.message});case 4:return[2,this.swRegistration]}}))}))},QD.prototype.messageEventListener=function(t){var e;return pa(this,void 0,void 0,(function(){var n,r,i,o;return fa(this,(function(a){switch(a.label){case 0:return(null===(e=t.data)||void 0===e?void 0:e.firebaseMessaging)?(r=(n=t.data.firebaseMessaging).type,i=n.payload,this.onMessageCallback&&r===DD.PUSH_RECEIVED&&this.onMessageCallback(i),jD(o=i.data)&&"1"===o["google.c.a.e"]?[4,this.logEvent(r,o)]:[3,2]):[2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))},QD.prototype.logEvent=function(t,e){return pa(this,void 0,void 0,(function(){var n;return fa(this,(function(r){switch(r.label){case 0:return n=function(t){switch(t){case DD.NOTIFICATION_CLICKED:return"notification_open";case DD.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t),[4,this.firebaseDependencies.analyticsProvider.get()];case 1:return r.sent().logEvent(n,{message_id:e[xD],message_name:e["google.c.a.c_l"],message_time:e["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)}),[2]}}))}))},QD);function QD(t){var e=this;this.firebaseDependencies=t,this.vapidKey=null,this.onMessageCallback=null,navigator.serviceWorker.addEventListener("message",(function(t){return e.messageEventListener(t)}))}var KD=(Object.defineProperty(HD.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!0,configurable:!0}),HD.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw dD.create("invalid-bg-handler");this.bgMessageHandler=t},HD.prototype.getToken=function(){var t,e,n;return pa(this,void 0,void 0,(function(){var r;return fa(this,(function(i){switch(i.label){case 0:return this.vapidKey?[3,2]:[4,ID(this.firebaseDependencies)];case 1:r=i.sent(),this.vapidKey=null!=(n=null===(e=null===(t=r)||void 0===t?void 0:t.subscriptionOptions)||void 0===e?void 0:e.vapidKey)?n:RD,i.label=2;case 2:return[2,qD(this.firebaseDependencies,self.registration,this.vapidKey)]}}))}))},HD.prototype.deleteToken=function(){return VD(this.firebaseDependencies,self.registration)},HD.prototype.requestPermission=function(){throw dD.create("only-available-in-window")},HD.prototype.usePublicVapidKey=function(t){if(null!==this.vapidKey)throw dD.create("use-vapid-key-after-get-token");if("string"!=typeof t||0===t.length)throw dD.create("invalid-vapid-key");this.vapidKey=t},HD.prototype.useServiceWorker=function(){throw dD.create("only-available-in-window")},HD.prototype.onMessage=function(){throw dD.create("only-available-in-window")},HD.prototype.onTokenRefresh=function(){throw dD.create("only-available-in-window")},HD.prototype.onPush=function(t){return pa(this,void 0,void 0,(function(){var e,n,r;return fa(this,(function(i){switch(i.label){case 0:return(e=function(t){var e=t.data;if(!e)return null;try{return e.json()}catch(t){return null}}(t))?[4,zD()]:[2];case 1:return function(t){return t.some((function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")}))}(n=i.sent())?[2,function(t,e){var n,r,i=GD(DD.PUSH_RECEIVED,e);try{for(var o=da(t),a=o.next();!a.done;a=o.next())a.value.postMessage(i)}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}(n,e)]:(r=function(t){var e;if(t&&"object"==typeof t.notification){var n=la({},t.notification);return n.data=la(la({},t.notification.data),((e={})[OD]=t,e)),n}}(e))?[4,function(t){var e,n=null!==(e=t.title)&&void 0!==e?e:"",r=t.actions,i=Notification.maxActions;return r&&i&&r.length>i&&console.warn("This browser only supports "+i+" actions. The remaining actions will not be displayed."),self.registration.showNotification(n,t)}(r)]:[3,3];case 2:return i.sent(),[3,5];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},HD.prototype.onSubChange=function(t){var e,n,r;return pa(this,void 0,void 0,(function(){var i;return fa(this,(function(o){switch(o.label){case 0:return t.newSubscription?[3,2]:[4,VD(this.firebaseDependencies,self.registration)];case 1:return o.sent(),[2];case 2:return[4,ID(this.firebaseDependencies)];case 3:return i=o.sent(),[4,VD(this.firebaseDependencies,self.registration)];case 4:return o.sent(),[4,qD(this.firebaseDependencies,self.registration,(r=null===(n=null===(e=i)||void 0===e?void 0:e.subscriptionOptions)||void 0===n?void 0:n.vapidKey,null!=r?r:RD))];case 5:return o.sent(),[2]}}))}))},HD.prototype.onNotificationClick=function(t){var e,n;return pa(this,void 0,void 0,(function(){var r,i,o,a;return fa(this,(function(s){switch(s.label){case 0:return(r=null===(n=null===(e=t.notification)||void 0===e?void 0:e.data)||void 0===n?void 0:n[OD])?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(i=function(t){var e,n,r;return(null!==(n=null===(e=t.fcmOptions)||void 0===e?void 0:e.link)&&void 0!==n?n:null===(r=t.notification)||void 0===r?void 0:r.click_action)||(jD(t.data)?self.location.origin:null)}(r))?[4,function(t){return pa(this,void 0,void 0,(function(){var e,n,r,i,o,a,s;return fa(this,(function(u){switch(u.label){case 0:return e=new URL(t,self.location.href).href,[4,zD()];case 1:n=u.sent();try{for(r=da(n),i=r.next();!i.done;i=r.next())if(o=i.value,new URL(o.url,self.location.href).href===e)return[2,o]}catch(u){a={error:u}}finally{try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(a)throw a.error}}return[2,null]}}))}))}(i)]:[2]):[2];case 1:return(o=s.sent())?[3,4]:[4,self.clients.openWindow(i)];case 2:return o=s.sent(),[4,new Promise((function(t){setTimeout(t,3e3)}))];case 3:return s.sent(),[3,6];case 4:return[4,o.focus()];case 5:o=s.sent(),s.label=6;case 6:return o?(a=GD(DD.NOTIFICATION_CLICKED,r),[2,o.postMessage(a)]):[2]}}))}))},HD);function HD(t){var e=this;this.firebaseDependencies=t,this.vapidKey=null,this.bgMessageHandler=null,self.addEventListener("push",(function(t){t.waitUntil(e.onPush(t))})),self.addEventListener("pushsubscriptionchange",(function(t){t.waitUntil(e.onSubChange(t))})),self.addEventListener("notificationclick",(function(t){t.waitUntil(e.onNotificationClick(t))}))}function zD(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function GD(t,e){return{firebaseMessaging:{type:t,payload:e}}}var YD={isSupported:XD};function XD(){return self&&"ServiceWorkerGlobalScope"in self?"indexedDB"in self&&null!==indexedDB&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"indexedDB"in window&&null!==indexedDB&&navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}Ps.INTERNAL.registerComponent(new ns("messaging",(function(t){var e=t.getProvider("app").getImmediate(),n={app:e,appConfig:function(t){var e,n;if(!t||!t.options)throw yD("App Configuration Object");if(!t.name)throw yD("App Name");var r=t.options;try{for(var i=da(["projectId","apiKey","appId","messagingSenderId"]),o=i.next();!o.done;o=i.next()){var a=o.value;if(!r[a])throw yD(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return{appName:t.name,projectId:r.projectId,apiKey:r.apiKey,appId:r.appId,senderId:r.messagingSenderId}}(e),installations:t.getProvider("installations").getImmediate(),analyticsProvider:t.getProvider("analytics-internal")};if(!XD())throw dD.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new KD(n):new WD(n)}),"PUBLIC").setServiceProps(YD));var JD="firebasestorage.googleapis.com",$D="storageBucket",ZD=(tk.prototype.codeProp=function(){return this.code},tk.prototype.codeEquals=function(t){return nk(t)===this.codeProp()},tk.prototype.serverResponseProp=function(){return this.serverResponse_},tk.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(tk.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(tk.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(tk.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(tk.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),tk);function tk(t,e){this.code_=nk(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}var ek={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function nk(t){return"storage/"+t}function rk(){return new ZD(ek.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function ik(){return new ZD(ek.CANCELED,"User canceled the upload/download.")}function ok(){return new ZD(ek.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function ak(t,e,n){return new ZD(ek.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function sk(){return new ZD(ek.APP_DELETED,"The Firebase app was deleted.")}function uk(t,e){return new ZD(ek.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function ck(t){throw new ZD(ek.INTERNAL_ERROR,"Internal error: "+t)}var hk={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function lk(t){switch(t){case hk.RAW:case hk.BASE64:case hk.BASE64URL:case hk.DATA_URL:return;default:throw"Expected one of the event types: ["+hk.RAW+", "+hk.BASE64+", "+hk.BASE64URL+", "+hk.DATA_URL+"]."}}var pk=function(t,e){this.data=t,this.contentType=e||null};function fk(t,e){switch(t){case hk.RAW:return new pk(dk(e));case hk.BASE64:case hk.BASE64URL:return new pk(yk(t,e));case hk.DATA_URL:return new pk(function(t){var e=new mk(t);return e.base64?yk(hk.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw uk(hk.DATA_URL,"Malformed data URL.")}return dk(e)}(e.rest)}(e),function(t){return new mk(t).contentType}(e))}throw rk()}function dk(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);r<=127?e.push(r):r<=2047?e.push(192|r>>6,128|63&r):55296==(64512&r)?n<t.length-1&&56320==(64512&t.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):e.push(239,191,189):56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function yk(t,e){switch(t){case hk.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw uk(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case hk.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw uk(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(e){throw uk(t,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var vk,gk,mk=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw uk(hk.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)},_k={STATE_CHANGED:"state_changed"},bk="running",wk="pausing",Ek="paused",Tk="success",Ck="canceling",Sk="canceled",Ik="error",Nk={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Ak(t){switch(t){case bk:case wk:case Ck:return Nk.RUNNING;case Ek:return Nk.PAUSED;case Tk:return Nk.SUCCESS;case Sk:return Nk.CANCELED;case Ik:default:return Nk.ERROR}}function Dk(t){return null!=t}function kk(t){return void 0!==t}function Rk(t){return"function"==typeof t}function Pk(t){return"object"==typeof t}function Ok(t){return"string"==typeof t||t instanceof String}function xk(t){return"number"==typeof t||t instanceof Number}function Lk(t){return Mk()&&t instanceof Blob}function Mk(){return"undefined"!=typeof Blob}(gk=vk=vk||{})[gk.NO_ERROR=0]="NO_ERROR",gk[gk.NETWORK_ERROR=1]="NETWORK_ERROR",gk[gk.ABORT=2]="ABORT";var Fk=(Uk.prototype.send=function(t,e,n,r){if(this.sent_)throw ck("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),Dk(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return Dk(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},Uk.prototype.getErrorCode=function(){if(!this.sent_)throw ck("cannot .getErrorCode() before sending");return this.errorCode_},Uk.prototype.getStatus=function(){if(!this.sent_)throw ck("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},Uk.prototype.getResponseText=function(){if(!this.sent_)throw ck("cannot .getResponseText() before sending");return this.xhr_.responseText},Uk.prototype.abort=function(){this.xhr_.abort()},Uk.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},Uk.prototype.addUploadProgressListener=function(t){Dk(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},Uk.prototype.removeUploadProgressListener=function(t){Dk(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},Uk);function Uk(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=vk.NO_ERROR,this.sendPromise_=new Promise((function(e){t.xhr_.addEventListener("abort",(function(){t.errorCode_=vk.ABORT,e(t)})),t.xhr_.addEventListener("error",(function(){t.errorCode_=vk.NETWORK_ERROR,e(t)})),t.xhr_.addEventListener("load",(function(){e(t)}))}))}var qk=(Vk.prototype.createXhrIo=function(){return new Fk},Vk);function Vk(){}function Bk(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Mk())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var jk=(Wk.prototype.size=function(){return this.size_},Wk.prototype.type=function(){return this.type_},Wk.prototype.slice=function(t,e){if(Lk(this.data_)){var n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new Wk(n)}return new Wk(new Uint8Array(this.data_.buffer,t,e-t),!0)},Wk.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(Mk()){var n=t.map((function(t){return t instanceof Wk?t.data_:t}));return new Wk(Bk.apply(null,n))}var r=t.map((function(t){return Ok(t)?fk(hk.RAW,t).data:t.data_})),i=0;r.forEach((function(t){i+=t.byteLength}));var o=new Uint8Array(i),a=0;return r.forEach((function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]})),new Wk(o,!0)},Wk.prototype.uploadData=function(){return this.data_},Wk);function Wk(t,e){var n=0,r="";Lk(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}var Qk=(Object.defineProperty(Kk.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(Kk.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),Kk.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},Kk.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},Kk.makeFromBucketSpec=function(t){var e;try{e=Kk.makeFromUrl(t)}catch(e){return new Kk(t,"")}if(""===e.path)return e;throw function(t){return new ZD(ek.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(t)},Kk.makeFromUrl=function(t){for(var e=null,n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i"),i=JD.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(t);if(u){var c=u[s.indices.path];e=new Kk(u[s.indices.bucket],c=c||""),s.postModify(e);break}}if(null==e)throw function(t){return new ZD(ek.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return e},Kk);function Kk(t,e){this.bucket=t,this.path_=e}function Hk(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return Pk(t)&&!Array.isArray(t)}(e)?e:null}function zk(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function Gk(t){return"https://"+JD+"/v0"+t}function Yk(t){var e=encodeURIComponent,n="?";for(var r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n.slice(0,-1)}function Xk(t,e){return e}var Jk=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||Xk},$k=null;function Zk(t,e,n){var r=Hk(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=new Qk(t.bucket,t.fullPath);return e.makeStorageReference(n)}})}(r,t),r}(t,r,n)}function tR(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function eR(t){if(!Pk(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!Pk(n))throw"Expected object for 'customMetadata' mapping."}else if(Pk(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var nR="maxResults",rR=1e3,iR="pageToken",oR="prefixes",aR="items";function sR(t){if(!Pk(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===nR){if(!xk(n=t[nR])||!Number.isInteger(n)||t[nR]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[nR])throw"Expected maxResults to be less than or equal to "+rR+"."}else{if(e!==iR)throw"Unknown option: "+e;if(t[iR]&&!Ok(t[iR]))throw"Expected pageToken to be string."}var n}var uR=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function cR(t){if(!t)throw rk()}function hR(t,e){return function(n,r){var i=Zk(t,r,e);return cR(null!==i),i}}function lR(t){return function(e,n){var r=function(t,e){var n=Hk(e);return null===n?null:function(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new ZD(ek.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+$D+"' property when initializing the app?");if(e[oR])for(var i=0,o=e[oR];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new Qk(r,a));n.prefixes.push(s)}if(e[aR])for(var u=0,c=e[aR];u<c.length;u++)s=t.makeStorageReference(new Qk(r,c[u].name)),n.items.push(s);return n}(t,n)}(t,n);return cR(null!==r),r}}function pR(t,e){return function(n,r){var i=Zk(t,r,e);return cR(null!==i),function(t,e){var n=Hk(e);if(null===n)return null;if(!Ok(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map((function(e){var n=t.fullPath;return Gk("/b/"+i(t.bucket)+"/o/"+i(n))+Yk({alt:"media",token:e})}))[0]}(i,r)}}function fR(t){return function(e,n){var r;return(r=401===e.getStatus()?new ZD(ek.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?function(t){return new ZD(ek.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(t.bucket):403===e.getStatus()?function(t){return new ZD(ek.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(t.path):n).setServerResponseProp(n.serverResponseProp()),r}}function dR(t){var e=fR(t);return function(n,r){var i=e(n,r);return 404===n.getStatus()&&(i=function(t){return new ZD(ek.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(t.path)),i.setServerResponseProp(r.serverResponseProp()),i}}function yR(t,e,n){var r=Gk(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new uR(r,"GET",hR(t,n),i);return o.errorHandler=dR(e),o}function vR(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),r}var gR=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function mR(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){cR(!1)}return cR(!!n&&-1!==(e||["active"]).indexOf(n)),n}var _R=function(t,e,n){if(Rk(t)||Dk(e)||Dk(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},bR=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function wR(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,o;return o=t===e?1===(i=t)?"argument":"arguments":(i="between "+t+" and "+e,"arguments"),new ZD(ek.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+o+", received "+r+".")}(r,i,t,n.length);for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(e){throw e instanceof Error?ak(o,t,e.message):ak(o,t,e)}}var ER=function(t,e){var n=this;this.validator=function(e){n.optional&&!kk(e)||t(e)},this.optional=!!e};function TR(t,e){function n(t){if(!Ok(t))throw"Expected string."}var r;return r=t?function(t,e){return function(n){t(n),e(n)}}(n,t):n,new ER(r,e)}function CR(){return new ER((function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Mk()&&t instanceof Blob))throw"Expected Blob or File."}))}function SR(t){return new ER(eR,t)}function IR(){return new ER((function(t){if(!(xk(t)&&0<=t))throw"Expected a number 0 or greater."}))}function NR(t,e){return new ER((function(e){if(!(null===e||Dk(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)}),e)}function AR(t){return new ER((function(t){if(null!==t&&!Rk(t))throw"Expected a Function."}),t)}function DR(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then((function(){return t.apply(void 0,e)}))}}var kR=(RR.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n){return t.updateProgress_(e+n)}},RR.prototype.shouldDoResumable_=function(t){return 262144<t.size()},RR.prototype.start_=function(){this.state_===bk&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},RR.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then((function(n){switch(e.state_){case bk:t(n);break;case Ck:e.transition_(Sk);break;case wk:e.transition_(Ek)}}))},RR.prototype.createResumable_=function(){var t=this;this.resolveToken_((function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=vR(e,r,i),s={name:a.fullPath},u=Gk(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=tR(a,n),l=t.maxUploadRetryTime(),p=new uR(u,"POST",(function(t){var e;mR(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){cR(!1)}return cR(Ok(e)),e}),l);return p.urlParams=s,p.headers=c,p.body=h,p.errorHandler=fR(e),p}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then((function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()}),t.errorHandler_)}))},RR.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_((function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime(),o=new uR(n,"POST",(function(t){var e=mR(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){cR(!1)}n||cR(!1);var i=Number(n);return cR(!isNaN(i)),new gR(i,r.size(),"final"===e)}),i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=fR(e),o}(t.authWrapper_,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);(t.request_=i).getPromise().then((function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()}),t.errorHandler_)}))},RR.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new gR(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_((function(i){var o;try{o=function(t,e,n,r,i,o,a,s){var u=new gR(0,0);if(a?(u.current=a.current,u.total=a.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new ZD(ek.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;0<i&&(h=Math.min(h,i));var l=u.current,p={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},f=r.slice(l,l+h);if(null===f)throw ok();var d=e.maxUploadRetryTime(),y=new uR(n,"POST",(function(t,n){var i,a=mR(t,["active","final"]),s=u.current+h,c=r.size();return i="final"===a?hR(e,o)(t,n):null,new gR(s,c,"final"===a,i)}),d);return y.headers=p,y.body=f.uploadData(),y.progressCallback=s||null,y.errorHandler=fR(t),y}(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(i){return t.error_=i,void t.transition_(Ik)}var a=t.authWrapper_.makeRequest(o,i);(t.request_=a).getPromise().then((function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(Tk)):t.completeTransitions_()}),t.errorHandler_)}))},RR.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},RR.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_((function(e){var n=yR(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then((function(e){t.request_=null,t.metadata_=e,t.transition_(Tk)}),t.metadataErrorHandler_)}))},RR.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_((function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=vR(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+tR(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h=jk.getBlob(c,r,"\r\n--"+s+"--");if(null===h)throw ok();var l={name:u.fullPath},p=Gk(o),f=t.maxUploadRetryTime(),d=new uR(p,"POST",hR(t,n),f);return d.urlParams=l,d.headers=a,d.body=h.uploadData(),d.errorHandler=fR(e),d}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then((function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(Tk)}),t.errorHandler_)}))},RR.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},RR.prototype.transition_=function(t){if(this.state_!==t)switch(t){case Ck:case wk:this.state_=t,null!==this.request_&&this.request_.cancel();break;case bk:var e=this.state_===Ek;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case Ek:this.state_=t,this.notifyObservers_();break;case Sk:this.error_=ik(),this.state_=t,this.notifyObservers_();break;case Ik:case Tk:this.state_=t,this.notifyObservers_()}},RR.prototype.completeTransitions_=function(){switch(this.state_){case wk:this.transition_(Ek);break;case Ck:this.transition_(Sk);break;case bk:this.start_()}},Object.defineProperty(RR.prototype,"snapshot",{get:function(){var t=Ak(this.state_);return new bR(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),RR.prototype.on=function(t,e,n,r){var i="Expected a function or an Object with one of `next`, `error`, `complete` properties.",o=AR(!0).validator,a=NR(null,!0).validator;function s(t){try{return void o(t)}catch(t){}try{if(a(t),!(kk(t.next)||kk(t.error)||kk(t.complete)))throw"";return}catch(t){throw i}}wR("on",[TR((function(){if(t!==_k.STATE_CHANGED)throw"Expected one of the event types: ["+_k.STATE_CHANGED+"]."})),NR(s,!0),AR(!0),AR(!0)],arguments);var u=this;function c(t){return function(e,n,i){null!==t&&wR("on",t,arguments);var o=new _R(e,n,r);return u.addObserver_(o),function(){u.removeObserver_(o)}}}var h=[NR((function(t){if(null===t)throw i;s(t)})),AR(!0),AR(!0)];return kk(e)||kk(n)||kk(r)?c(null)(e,n,r):c(h)},RR.prototype.then=function(t,e){return this.promise_.then(t,e)},RR.prototype.catch=function(t){return this.then(null,t)},RR.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},RR.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},RR.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),this.observers_.slice().forEach((function(e){t.notifyObserver_(e)}))},RR.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(Ak(this.state_)){case Nk.SUCCESS:DR(this.resolve_.bind(null,this.snapshot))();break;case Nk.CANCELED:case Nk.ERROR:DR(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},RR.prototype.notifyObserver_=function(t){switch(Ak(this.state_)){case Nk.RUNNING:case Nk.PAUSED:t.next&&DR(t.next.bind(t,this.snapshot))();break;case Nk.SUCCESS:t.complete&&DR(t.complete.bind(t))();break;case Nk.CANCELED:case Nk.ERROR:t.error&&DR(t.error.bind(t,this.error_))();break;default:t.error&&DR(t.error.bind(t,this.error_))()}},RR.prototype.resume=function(){wR("resume",[],arguments);var t=this.state_===Ek||this.state_===wk;return t&&this.transition_(bk),t},RR.prototype.pause=function(){wR("pause",[],arguments);var t=this.state_===bk;return t&&this.transition_(wk),t},RR.prototype.cancel=function(){wR("cancel",[],arguments);var t=this.state_===bk||this.state_===wk;return t&&this.transition_(Ck),t},RR);function RR(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=bk,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(ek.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(Ik))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(ek.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(Ik))},this.promise_=new Promise((function(t,e){a.resolve_=t,a.reject_=e,a.start_()})),this.promise_.then(null,(function(){}))}var PR=(OR.prototype.toString=function(){return wR("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},OR.prototype.newRef=function(t,e){return new OR(t,e)},OR.prototype.mappings=function(){return function(){if($k)return $k;var t=[];t.push(new Jk("bucket")),t.push(new Jk("generation")),t.push(new Jk("metageneration")),t.push(new Jk("name","fullPath",!0));var e=new Jk("name");e.xform=function(t,e){return function(t){return!Ok(t)||t.length<2?t:zk(t)}(e)},t.push(e);var n=new Jk("size");return n.xform=function(t,e){return Dk(e)?Number(e):e},t.push(n),t.push(new Jk("timeCreated")),t.push(new Jk("updated")),t.push(new Jk("md5Hash",null,!0)),t.push(new Jk("cacheControl",null,!0)),t.push(new Jk("contentDisposition",null,!0)),t.push(new Jk("contentEncoding",null,!0)),t.push(new Jk("contentLanguage",null,!0)),t.push(new Jk("contentType",null,!0)),t.push(new Jk("metadata","customMetadata",!0)),$k=t}()},OR.prototype.child=function(t){wR("child",[TR()],arguments);var e=function(t,e){var n=e.split("/").filter((function(t){return 0<t.length})).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new Qk(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(OR.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new Qk(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(OR.prototype,"root",{get:function(){var t=new Qk(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(OR.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(OR.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(OR.prototype,"name",{get:function(){return zk(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(OR.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),OR.prototype.put=function(t,e){return void 0===e&&(e=null),wR("put",[CR(),SR(!0)],arguments),this.throwIfRoot_("put"),new kR(this,this.authWrapper,this.location,this.mappings(),new jk(t),e)},OR.prototype.putString=function(t,e,n){void 0===e&&(e=hk.RAW),wR("putString",[TR(),TR(lk,!0),SR(!0)],arguments),this.throwIfRoot_("putString");var r=fk(e,t),i=Object.assign({},n);return!Dk(i.contentType)&&Dk(r.contentType)&&(i.contentType=r.contentType),new kR(this,this.authWrapper,this.location,this.mappings(),new jk(r.data,!0),i)},OR.prototype.delete=function(){var t=this;return wR("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then((function(e){var n=function(t,e){var n=Gk(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new uR(n,"DELETE",(function(t,e){}),r);return i.successCodes=[200,204],i.errorHandler=dR(e),i}(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()}))},OR.prototype.listAll=function(){wR("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then((function(){return t}))},OR.prototype.listAllHelper=function(t,e){return pa(this,void 0,void 0,(function(){var n,r,i;return fa(this,(function(o){switch(o.label){case 0:return[4,this.list({pageToken:e})];case 1:return n=o.sent(),(r=t.prefixes).push.apply(r,n.prefixes),(i=t.items).push.apply(i,n.items),null==n.nextPageToken?[3,3]:[4,this.listAllHelper(t,n.nextPageToken)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))},OR.prototype.list=function(t){wR("list",[new ER(sR,!0)],arguments);var e=this;return this.authWrapper.getAuthToken().then((function(n){var r=t||{},i=function(t,e,n,r,i){var o={};o.prefix=e.isRoot?"":e.path+"/",0<"/".length&&(o.delimiter="/"),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=Gk(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new uR(a,"GET",lR(t),s);return u.urlParams=o,u.errorHandler=fR(e),u}(e.authWrapper,e.location,0,r.pageToken,r.maxResults);return e.authWrapper.makeRequest(i,n).getPromise()}))},OR.prototype.getMetadata=function(){var t=this;return wR("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then((function(e){var n=yR(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()}))},OR.prototype.updateMetadata=function(t){var e=this;return wR("updateMetadata",[SR()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then((function(n){var r=function(t,e,n,r){var i=Gk(e.fullServerUrl()),o=tR(n,r),a=t.maxOperationRetryTime(),s=new uR(i,"PATCH",hR(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=dR(e),s}(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()}))},OR.prototype.getDownloadURL=function(){var t=this;return wR("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then((function(e){var n=function(t,e,n){var r=Gk(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new uR(r,"GET",pR(t,n),i);return o.errorHandler=dR(e),o}(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then((function(t){if(null===t)throw new ZD(ek.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t}))}))},OR.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new ZD(ek.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},OR);function OR(t,e){this.authWrapper=t,this.location=e instanceof Qk?e:Qk.makeFromUrl(e)}var xR=(LR.prototype.getPromise=function(){return this.promise_},LR.prototype.cancel=function(t){},LR);function LR(t){this.promise_=Promise.reject(t)}var MR=(FR.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then((function(){return e.map.delete(n)}),(function(){return e.map.delete(n)}))},FR.prototype.clear=function(){this.map.forEach((function(t){t&&t.cancel(!0)})),this.map.clear()},FR);function FR(){this.map=new Map,this.id=-9007199254740991}var UR=(qR.extractBucket_=function(t){var e=t[$D]||null;return null==e?null:Qk.makeFromBucketSpec(e).bucket},qR.prototype.getAuthToken=function(){var t=this.authProvider_.getImmediate({optional:!0});return t?t.getToken().then((function(t){return null!==t?t.accessToken:null}),(function(){return null})):Promise.resolve(null)},qR.prototype.bucket=function(){if(this.deleted_)throw sk();return this.bucket_},qR.prototype.service=function(){return this.service_},qR.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},qR.prototype.makeRequest=function(t,e){if(this.deleted_)return new xR(sk());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},qR.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},qR.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},qR.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},qR.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},qR.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},qR);function qR(t,e,n,r,i,o){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var a=this.app_.options;Dk(a)&&(this.bucket_=qR.extractBucket_(a))}this.authProvider_=e,this.storageRefMaker_=n,this.requestMaker_=r,this.pool_=o,this.service_=i,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e5,this.requestMap_=new MR}var VR=(BR.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,a=n.xhr;if(n.wasSuccessCode)try{var s=t.callback_(a,a.getResponseText());kk(s)?i(s):i()}catch(e){o(e)}else null!==a?((r=rk()).setServerResponseProp(a.getResponseText()),o(t.errorCallback_?t.errorCallback_(a,r):r)):o(r=n.canceled?t.appDelete_?sk():ik():new ZD(ek.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new jR(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];u||(u=!0,e.apply(null,t))}function h(e){i=setTimeout((function(){i=null,t(l,s())}),e)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,ga([null,t],e)):s()||o?c.call.apply(c,ga([null,t],e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var p=!1;function f(t){p||(p=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout((function(){f(o=!0)}),n),f}((function(e,n){if(n)e(!1,new jR(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then((function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===vk.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var a=-1!==t.successCodes_.indexOf(o);e(!0,new jR(a,n))}else{var s=n.getErrorCode()===vk.ABORT;e(!1,new jR(!1,null,s))}}))}function i(e){null!==t.progressCallback_&&t.progressCallback_(e.loaded,e.lengthComputable?e.total:-1)}}),e,this.timeout_)},BR.prototype.getPromise=function(){return this.promise_},BR.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},BR.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},BR);function BR(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise((function(t,e){l.resolve_=t,l.reject_=e,l.start_()}))}var jR=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function WR(t,e,n){var r=Yk(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&0<e.length&&(t.Authorization="Firebase "+e)}(o,e),function(t){t["X-Firebase-Storage-Version"]="webjs/"+(void 0!==Ps?Ps.SDK_VERSION:"AppManager")}(o),new VR(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var QR=(KR.prototype.ref=function(t){if(wR("ref",[TR((function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."}),!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new PR(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},KR.prototype.refFromURL=function(t){return wR("refFromURL",[TR((function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{Qk.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}}),!1)],arguments),new PR(this.authWrapper_,t)},Object.defineProperty(KR.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),KR.prototype.setMaxUploadRetryTime=function(t){wR("setMaxUploadRetryTime",[IR()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},KR.prototype.setMaxOperationRetryTime=function(t){wR("setMaxOperationRetryTime",[IR()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(KR.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(KR.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),KR);function KR(t,e,n,r){if(this.bucket_=null,this.authWrapper_=new UR(t,e,(function(t,e){return new PR(t,e)}),WR,this,n),this.app_=t,null!=r)this.bucket_=Qk.makeFromBucketSpec(r);else{var i=this.authWrapper_.bucket();null!=i&&(this.bucket_=new Qk(i,""))}this.internals_=new GR(this)}var HR,zR,GR=(YR.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},YR);function YR(t){this.service_=t}zR={TaskState:Nk,TaskEvent:_k,StringFormat:hk,Storage:QR,Reference:PR},(HR=Ps).INTERNAL.registerComponent(new ns("storage",(function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return new QR(n,r,new qk,e)}),"PUBLIC").setServiceProps(zR).setMultipleInstances(!0)),HR.registerVersion("@firebase/storage","0.3.24");var XR,JR,$R,ZR,tP="0.2.30",eP="FB-PERF-TRACE-MEASURE",nP="@firebase/performance/config",rP="@firebase/performance/configexpire",iP="Performance",oP=((XR={})["trace started"]="Trace {$traceName} was started before.",XR["trace stopped"]="Trace {$traceName} is not running.",XR["no window"]="Window is not available.",XR["no app id"]="App id is not available.",XR["no project id"]="Project id is not available.",XR["no api key"]="Api key is not available.",XR["invalid cc log"]="Attempted to queue invalid cc event",XR["FB not default"]="Performance can only start when Firebase app instance is the default one.",XR["RC response not ok"]="RC response is not ok",XR["invalid attribute name"]="Attribute name {$attributeName} is invalid.",XR["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",XR["invalide custom metric name"]="Custom metric name {$customMetricName} is invalid",XR),aP=new La("performance",iP,oP),sP=(uP.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},uP.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},uP.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},uP.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},uP.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},uP.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},uP.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},uP.prototype.setupObserver=function(t,e){this.PerformanceObserver&&new this.PerformanceObserver((function(t){for(var n=0,r=t.getEntries();n<r.length;n++)e(r[n])})).observe({entryTypes:[t]})},uP.getInstance=function(){return void 0===JR&&(JR=new uP($R)),JR},uP);function uP(t){if(!(this.window=t))throw aP.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}var cP,hP,lP,pP=(fP.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw aP.create("no app id");return t},fP.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw aP.create("no project id");return t},fP.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw aP.create("no api key");return t},fP.getInstance=function(){return void 0===ZR&&(ZR=new fP),ZR},fP);function fP(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function dP(){return cP}(lP=hP=hP||{})[lP.UNKNOWN=0]="UNKNOWN",lP[lP.VISIBLE=1]="VISIBLE",lP[lP.HIDDEN=2]="HIDDEN";var yP=["firebase_","google_","ga_"],vP=new RegExp("^[a-zA-Z]\\w*$");function gP(){switch(sP.getInstance().document.visibilityState){case"visible":return hP.VISIBLE;case"hidden":return hP.HIDDEN;default:return hP.UNKNOWN}}var mP=new ys(iP);mP.logLevel=ss.INFO;var _P="0.0.1",bP={loggingEnabled:!0},wP="FIREBASE_INSTALLATIONS_AUTH",EP="Could not fetch config, will use default configs";function TP(t){if(!t)return t;var e=pP.getInstance(),n=t.entries||{};return e.loggingEnabled=void 0!==n.fpr_enabled?"true"===String(n.fpr_enabled):bP.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=CP(e.tracesSamplingRate),e.logNetworkAfterSampling=CP(e.networkRequestsSamplingRate),t}function CP(t){return Math.random()<=t}var SP,IP=1;function NP(){return IP=2,SP=SP||function(){var t=sP.getInstance().document;return new Promise((function(e){if(t&&"complete"!==t.readyState){var n=function(){"complete"===t.readyState&&(t.removeEventListener("readystatechange",n),e())};t.addEventListener("readystatechange",n)}else e()}))}().then((function(){return function(){var t=pP.getInstance().installationsService.getId();return t.then((function(t){cP=t})),t}()})).then((function(t){return function(t){var e=function(){var t=sP.getInstance().localStorage;if(t){var e=t.getItem(rP);if(e&&function(t){return Number(t)>Date.now()}(e)){var n=t.getItem(nP);if(n)try{return JSON.parse(n)}catch(t){return}}}}();return e?(TP(e),Promise.resolve()):function(t){return function(){var t=pP.getInstance().installationsService.getToken();return t.then((function(t){})),t}().then((function(e){var n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+pP.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+pP.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:wP+" "+e},body:JSON.stringify({app_instance_id:t,app_instance_id_token:e,app_id:pP.getInstance().getAppId(),app_version:tP,sdk_version:_P})});return fetch(r).then((function(t){if(t.ok)return t.json();throw aP.create("RC response not ok")}))})).catch((function(){mP.info(EP)}))}(t).then((function(t){return TP(t)})).then((function(t){return function(t){var e=sP.getInstance().localStorage;t&&e&&(e.setItem(nP,JSON.stringify(t)),e.setItem(rP,String(Date.now()+60*pP.getInstance().configTimeToLive*60*1e3)))}(t)}),(function(){}))}(t)})).then((function(){return AP()}),(function(){return AP()}))}function AP(){IP=3}var DP,kP=1e4,RP=5500,PP=3,OP=PP,xP=[],LP=!1;function MP(t,e){(DP=DP||function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];!function(t){if(!t.eventTime||!t.message)throw aP.create("invalid cc log");xP=ga(xP,[t])}({message:t.apply(void 0,e),eventTime:Date.now()})}}(qP))(t,e)}function FP(t){var e=pP.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&sP.getInstance().requiredApisAvailable()&&(t.isAuto&&gP()!==hP.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===IP?UP(t):NP().then((function(){return UP(t)}),(function(){return UP(t)}))))}function UP(t){dP()&&setTimeout((function(){return MP(t,1)}),0)}function qP(t,e){return 0===e?function(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:VP(),network_request_metric:e};return JSON.stringify(n)}(t):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=t.counters);var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=n);var r={application_info:VP(),trace_metric:e};return JSON.stringify(r)}(t)}function VP(){return{google_app_id:pP.getInstance().getAppId(),app_instance_id:dP(),web_app_info:{sdk_version:tP,page_url:sP.getInstance().getUrl(),service_worker_status:function(){var t=sP.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}(),visibility_state:gP(),effective_connection_type:function(){var t=sP.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}var BP=["_fp","_fcp","_fid"],jP=(WP.prototype.start=function(){if(1!==this.state)throw aP.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},WP.prototype.stop=function(){if(2!==this.state)throw aP.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),FP(this)},WP.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=la({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}FP(this)},WP.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&this.putMetric(t,0),this.counters[t]+=e},WP.prototype.putMetric=function(t,e){if(!function(t,e){return!(0===t.length||100<t.length)&&(e&&e.startsWith("_wt_")&&-1<BP.indexOf(t)||!t.startsWith("_"))}(t,this.name))throw aP.create("invalide custom metric name",{customMetricName:t});this.counters[t]=e},WP.prototype.getMetric=function(t){return this.counters[t]||0},WP.prototype.putAttribute=function(t,e){var n=function(t){return!(0===t.length||40<t.length||yP.some((function(e){return t.startsWith(e)}))||!t.match(vP))}(t),r=function(t){return 0!==t.length&&t.length<=100}(e);if(n&&r)this.customAttributes[t]=e;else{if(!n)throw aP.create("invalid attribute name",{attributeName:t});if(!r)throw aP.create("invalid attribute value",{attributeValue:e})}},WP.prototype.getAttribute=function(t){return this.customAttributes[t]},WP.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},WP.prototype.getAttributes=function(){return la({},this.customAttributes)},WP.prototype.setStartTime=function(t){this.startTimeUs=t},WP.prototype.setDuration=function(t){this.durationUs=t},WP.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},WP.createOobTrace=function(t,e,n){var r=sP.getInstance().getUrl();if(r){var i=new WP("_wt_"+r,!0),o=Math.floor(1e3*sP.getInstance().getTimeOrigin());if(i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),e){var a=e.find((function(t){return"first-paint"===t.name}));a&&a.startTime&&i.putMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find((function(t){return"first-contentful-paint"===t.name}));s&&s.startTime&&i.putMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.putMetric("_fid",Math.floor(1e3*n))}FP(i)}},WP.createUserTimingTrace=function(t){FP(new WP(t,!1,t))},WP);function WP(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=sP.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||eP+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function QP(t){var e=t;if(e&&void 0!==e.responseStart){var n=sP.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=pP.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout((function(){return MP(t,0)}),0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var KP=5e3;function HP(){dP()&&(setTimeout((function(){return function(){var t=sP.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout((function(){jP.createOobTrace(e,n),r=void 0}),KP);t.onFirstInputDelay((function(t){r&&(clearTimeout(r),jP.createOobTrace(e,n,t))}))}else jP.createOobTrace(e,n)}()}),0),setTimeout((function(){return function(){for(var t=sP.getInstance(),e=0,n=t.getEntriesByType("resource");e<n.length;e++)QP(n[e]);t.setupObserver("resource",QP)}()}),0),setTimeout((function(){return function(){for(var t=sP.getInstance(),e=0,n=t.getEntriesByType("measure");e<n.length;e++)zP(n[e]);t.setupObserver("measure",zP)}()}),0))}function zP(t){var e=t.name;e.substring(0,eP.length)!==eP&&jP.createUserTimingTrace(e)}var GP,YP=(XP.prototype.trace=function(t){return new jP(t)},Object.defineProperty(XP.prototype,"instrumentationEnabled",{get:function(){return pP.getInstance().instrumentationEnabled},set:function(t){pP.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(XP.prototype,"dataCollectionEnabled",{get:function(){return pP.getInstance().dataCollectionEnabled},set:function(t){pP.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),XP);function XP(t){this.app=t,sP.getInstance().requiredApisAvailable()?(LP||(function t(e){setTimeout((function(){if(0!==OP){if(!xP.length)return t(kP);var e=ga(xP);xP=[];var n=e.map((function(t){return{source_extension_json_proto3:t.message,event_time_ms:String(t.eventTime)}})),r={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:pP.getInstance().logSource,log_event:n};fetch(pP.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(r)}).then((function(t){return t.ok||mP.info("Call to Firebase backend failed."),t.json()})).then((function(e){var n=Number(e.next_request_wait_millis),r=isNaN(n)?kP:Math.max(kP,n);OP=PP,t(r)})).catch((function(){xP=ga(e,xP),mP.info("Tries left: "+--OP+"."),t(kP)}))}}),e)}(RP),LP=!0),NP().then(HP,HP)):mP.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}(GP=Ps).INTERNAL.registerComponent(new ns("performance",(function(t){return function(t,e){if("[DEFAULT]"!==t.name)throw aP.create("FB not default");if("undefined"==typeof window)throw aP.create("no window");return function(t){$R=t}(window),pP.getInstance().firebaseAppInstance=t,pP.getInstance().installationsService=e,new YP(t)}(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())}),"PUBLIC")),GP.registerVersion("@firebase/performance","0.2.30");var JP,$P,ZP,tO,eO,nO="measurementId",rO="https://www.googletagmanager.com/gtag/js";($P=JP=JP||{}).EVENT="event",$P.SET="set",$P.CONFIG="config",(tO=ZP=ZP||{}).ADD_PAYMENT_INFO="add_payment_info",tO.ADD_TO_CART="add_to_cart",tO.ADD_TO_WISHLIST="add_to_wishlist",tO.BEGIN_CHECKOUT="begin_checkout",tO.CHECKOUT_PROGRESS="checkout_progress",tO.EXCEPTION="exception",tO.GENERATE_LEAD="generate_lead",tO.LOGIN="login",tO.PAGE_VIEW="page_view",tO.PURCHASE="purchase",tO.REFUND="refund",tO.REMOVE_FROM_CART="remove_from_cart",tO.SCREEN_VIEW="screen_view",tO.SEARCH="search",tO.SELECT_CONTENT="select_content",tO.SET_CHECKOUT_OPTION="set_checkout_option",tO.SHARE="share",tO.SIGN_UP="sign_up",tO.TIMING_COMPLETE="timing_complete",tO.VIEW_ITEM="view_item",tO.VIEW_ITEM_LIST="view_item_list",tO.VIEW_PROMOTION="view_promotion",tO.VIEW_SEARCH_RESULTS="view_search_results";var iO,oO,aO,sO=((eO={})["no-ga-id"]='"'+nO+'" field is empty in Firebase config. Firebase Analytics requires this field to contain a valid measurement ID.',eO["already-exists"]="A Firebase Analytics instance with the measurement ID ${id}  already exists. Only one Firebase Analytics instance can be created for each measurement ID.",eO["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",eO["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate",eO),uO=new La("analytics","Analytics",sO),cO={},hO="dataLayer",lO="gtag",pO=!1,fO="analytics";(aO=Ps).INTERNAL.registerComponent(new ns(fO,(function(t){return function(t,e){var n=t.options[nO];if(!n)throw uO.create("no-ga-id");if(null!=cO[n])throw uO.create("already-exists",{id:n});if(!pO){!function(){for(var t=window.document.getElementsByTagName("script"),e=0,n=Object.values(t);e<n.length;e++){var r=n[e];if(r.src&&r.src.includes(rO))return r}return null}()&&function(t){var e=document.createElement("script");e.src=rO+"?l="+t,e.async=!0,document.head.appendChild(e)}(hO),function(t){var e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(hO);var r=function(t,e,n){var r=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];window[e].push(arguments)};return window[n]&&"function"==typeof window[n]&&(r=window[n]),window[n]=function(t,e){return function(n,r,i){if(n===JP.EVENT){var o=[];if(i&&i.send_to){var a=i.send_to;Array.isArray(a)||(a=[a]);for(var s=0,u=a;s<u.length;s++){var c=e[u[s]];if(!c){o=[];break}o.push(c)}}if(0===o.length)for(var h=0,l=Object.values(e);h<l.length;h++)o.push(l[h]);Promise.all(o).then((function(){return t(JP.EVENT,r,i||{})})).catch((function(t){return console.error(t)}))}else n===JP.CONFIG?(e[r]||Promise.resolve()).then((function(){t(JP.CONFIG,r,i)})).catch((function(t){return console.error(t)})):t(JP.SET,r)}}(r,t),{gtagCore:r,wrappedGtag:window[n]}}(cO,hO,lO);oO=r.wrappedGtag,iO=r.gtagCore,pO=!0}return cO[n]=function(t,e,n){return pa(this,void 0,void 0,(function(){var r,i;return fa(this,(function(o){switch(o.label){case 0:return[4,e.getId()];case 1:return r=o.sent(),n("js",new Date),n(JP.CONFIG,t.options[nO],((i={}).firebase_id=r,i.origin="firebase",i.update=!0,i)),[2]}}))}))}(t,e,iO),{app:t,logEvent:function(t,e,r){return function(t,e,n,r,i){var o=r||{};i&&i.global||(o=la(la({},r),{send_to:e})),t(JP.EVENT,n,o||{})}(oO,n,t,e,r)},setCurrentScreen:function(t,e){return function(t,e,n,r){r&&r.global?t(JP.SET,{screen_name:n}):t(JP.CONFIG,e,{update:!0,screen_name:n})}(oO,n,t,e)},setUserId:function(t,e){return function(t,e,n,r){r&&r.global?t(JP.SET,{user_id:n}):t(JP.CONFIG,e,{update:!0,user_id:n})}(oO,n,t,e)},setUserProperties:function(t,e){return function(t,e,n,r){if(r&&r.global){for(var i={},o=0,a=Object.keys(n);o<a.length;o++){var s=a[o];i["user_properties."+s]=n[s]}t(JP.SET,i)}else t(JP.CONFIG,e,{update:!0,user_properties:n})}(oO,n,t,e)},setAnalyticsCollectionEnabled:function(t){return function(t,e){window["ga-disable-"+t]=!e}(n,t)}}}(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())}),"PUBLIC").setServiceProps({settings:function(t){if(pO)throw uO.create("already-initialized");t.dataLayerName&&(hO=t.dataLayerName),t.gtagName&&(lO=t.gtagName)},EventName:ZP})),aO.INTERNAL.registerComponent(new ns("analytics-internal",(function(t){try{return{logEvent:t.getProvider(fO).getImmediate().logEvent}}catch(t){throw uO.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),aO.registerVersion("@firebase/analytics","0.2.11");var dO,yO=(vO.prototype.isCachedDataFresh=function(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-e,r=n<=t;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+t+". Is cache hit: "+r+"."),r},vO.prototype.fetch=function(t){return pa(this,void 0,void 0,(function(){var e,n,r,i,o;return fa(this,(function(a){switch(a.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return e=a.sent(),n=e[0],(r=e[1])&&this.isCachedDataFresh(t.cacheMaxAgeMillis,n)?[2,r]:(t.eTag=r&&r.eTag,[4,this.client.fetch(t)]);case 2:return i=a.sent(),o=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===i.status&&o.push(this.storage.setLastSuccessfulFetchResponse(i)),[4,Promise.all(o)];case 3:return a.sent(),[2,i]}}))}))},vO);function vO(t,e,n,r){this.client=t,this.storage=e,this.storageCache=n,this.logger=r}var gO=((dO={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",dO["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",dO["registration-api-key"]="Undefined API key. Check Firebase app initialization.",dO["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",dO["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",dO["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",dO["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",dO["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",dO["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",dO["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',dO["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',dO["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",dO["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",dO),mO=new La("remoteconfig","Remote Config",gO),_O=(bO.prototype.fetch=function(t){return pa(this,void 0,void 0,(function(){var e,n,r,i,o,a,s,u,c,h,l,p,f,d,y,v,g;return fa(this,(function(m){switch(m.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:e=m.sent(),n=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",r=n+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,i={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":t.eTag||"*"},o={sdk_version:this.sdkVersion,app_instance_id:e[0],app_instance_id_token:e[1],app_id:this.appId,language_code:function(t){return void 0===t&&(t=navigator),t.languages&&t.languages[0]||t.language}()},a={method:"POST",headers:i,body:JSON.stringify(o)},s=fetch(r,a),u=new Promise((function(e,n){t.signal.addEventListener((function(){var t=new Error("The operation was aborted.");t.name="AbortError",n(t)}))})),m.label=2;case 2:return m.trys.push([2,5,,6]),[4,Promise.race([s,u])];case 3:return m.sent(),[4,s];case 4:return c=m.sent(),[3,6];case 5:throw h=m.sent(),l="fetch-client-network","AbortError"===h.name&&(l="fetch-timeout"),mO.create(l,{originalErrorMessage:h.message});case 6:if(p=c.status,f=c.headers.get("ETag")||void 0,200!==c.status)return[3,11];v=void 0,m.label=7;case 7:return m.trys.push([7,9,,10]),[4,c.json()];case 8:return v=m.sent(),[3,10];case 9:throw g=m.sent(),mO.create("fetch-client-parse",{originalErrorMessage:g.message});case 10:d=v.entries,y=v.state,m.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===y?p=500:"NO_CHANGE"===y?p=304:"NO_TEMPLATE"!==y&&"EMPTY_CONFIG"!==y||(d={}),304!==p&&200!==p)throw mO.create("fetch-status",{httpStatus:p});return[2,{status:p,eTag:f,config:d}]}}))}))},bO);function bO(t,e,n,r,i,o){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=o}var wO=(EO.prototype.addEventListener=function(t){this.listeners.push(t)},EO.prototype.abort=function(){this.listeners.forEach((function(t){return t()}))},EO);function EO(){this.listeners=[]}var TO=["1","true","t","yes","y","on"],CO=(SO.prototype.asString=function(){return this._value},SO.prototype.asBoolean=function(){return"static"!==this._source&&0<=TO.indexOf(this._value.toLowerCase())},SO.prototype.asNumber=function(){if("static"===this._source)return 0;var t=Number(this._value);return isNaN(t)&&(t=0),t},SO.prototype.getSource=function(){return this._source},SO);function SO(t,e){void 0===e&&(e=""),this._source=t,this._value=e}var IO=(NO.prototype.setLogLevel=function(t){switch(t){case"debug":this._logger.logLevel=ss.DEBUG;break;case"silent":this._logger.logLevel=ss.SILENT;break;default:this._logger.logLevel=ss.ERROR}},Object.defineProperty(NO.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!0,configurable:!0}),Object.defineProperty(NO.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!0,configurable:!0}),NO.prototype.activate=function(){return pa(this,void 0,void 0,(function(){var t,e,n;return fa(this,(function(r){switch(r.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return t=r.sent(),n=t[1],(e=t[0])&&e.config&&e.eTag&&e.eTag!==n?[4,Promise.all([this._storageCache.setActiveConfig(e.config),this._storage.setActiveConfigEtag(e.eTag)])]:[2,!1];case 2:return r.sent(),[2,!0]}}))}))},NO.prototype.ensureInitialized=function(){var t=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then((function(){t._isInitializationComplete=!0}))),this._initializePromise},NO.prototype.fetch=function(){return pa(this,void 0,void 0,(function(){var t,e,n,r=this;return fa(this,(function(i){switch(i.label){case 0:t=new wO,setTimeout((function(){return pa(r,void 0,void 0,(function(){return fa(this,(function(e){return t.abort(),[2]}))}))}),this.settings.fetchTimeoutMillis),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:t})];case 2:return i.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return i.sent(),[3,6];case 4:return e=i.sent(),n=function(t,e){return t instanceof Oa&&-1!==t.code.indexOf("fetch-throttle")}(e)?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(n)];case 5:throw i.sent(),e;case 6:return[2]}}))}))},NO.prototype.fetchAndActivate=function(){return pa(this,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return[4,this.fetch()];case 1:return t.sent(),[2,this.activate()]}}))}))},NO.prototype.getAll=function(){var t=this;return function(t,e){return void 0===t&&(t={}),void 0===e&&(e={}),Object.keys(la(la({},t),e))}(this._storageCache.getActiveConfig(),this.defaultConfig).reduce((function(e,n){return e[n]=t.getValue(n),e}),{})},NO.prototype.getBoolean=function(t){return this.getValue(t).asBoolean()},NO.prototype.getNumber=function(t){return this.getValue(t).asNumber()},NO.prototype.getString=function(t){return this.getValue(t).asString()},NO.prototype.getValue=function(t){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+t+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var e=this._storageCache.getActiveConfig();return e&&void 0!==e[t]?new CO("remote",e[t]):this.defaultConfig&&void 0!==this.defaultConfig[t]?new CO("default",String(this.defaultConfig[t])):(this._logger.debug('Returning static value for key "'+t+'". Define a default or remote value if this is unintentional.'),new CO("static"))},NO);function NO(t,e,n,r,i){this.app=t,this._client=e,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}function AO(t,e){var n=t.target.error||void 0;return mO.create(e,{originalErrorMessage:n&&n.message})}var DO="app_namespace_store",kO="firebase_remote_config",RO=1,PO=(OO.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},OO.prototype.setLastFetchStatus=function(t){return this.set("last_fetch_status",t)},OO.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},OO.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.set("last_successful_fetch_timestamp_millis",t)},OO.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},OO.prototype.setLastSuccessfulFetchResponse=function(t){return this.set("last_successful_fetch_response",t)},OO.prototype.getActiveConfig=function(){return this.get("active_config")},OO.prototype.setActiveConfig=function(t){return this.set("active_config",t)},OO.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},OO.prototype.setActiveConfigEtag=function(t){return this.set("active_config_etag",t)},OO.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},OO.prototype.setThrottleMetadata=function(t){return this.set("throttle_metadata",t)},OO.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},OO.prototype.get=function(t){return pa(this,void 0,void 0,(function(){var e,n=this;return fa(this,(function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise((function(r,i){var o=e.transaction([DO],"readonly").objectStore(DO),a=n.createCompositeKey(t);try{var s=o.get(a);s.onerror=function(t){i(AO(t,"storage-get"))},s.onsuccess=function(t){var e=t.target.result;r(e?e.value:void 0)}}catch(o){i(mO.create("storage-get",{originalErrorMessage:o&&o.message}))}}))]}}))}))},OO.prototype.set=function(t,e){return pa(this,void 0,void 0,(function(){var n,r=this;return fa(this,(function(i){switch(i.label){case 0:return[4,this.openDbPromise];case 1:return n=i.sent(),[2,new Promise((function(i,o){var a=n.transaction([DO],"readwrite").objectStore(DO),s=r.createCompositeKey(t);try{var u=a.put({compositeKey:s,value:e});u.onerror=function(t){o(AO(t,"storage-set"))},u.onsuccess=function(){i()}}catch(i){o(mO.create("storage-set",{originalErrorMessage:i&&i.message}))}}))]}}))}))},OO.prototype.delete=function(t){return pa(this,void 0,void 0,(function(){var e,n=this;return fa(this,(function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise((function(r,i){var o=e.transaction([DO],"readwrite").objectStore(DO),a=n.createCompositeKey(t);try{var s=o.delete(a);s.onerror=function(t){i(AO(t,"storage-delete"))},s.onsuccess=function(){r()}}catch(r){i(mO.create("storage-delete",{originalErrorMessage:r&&r.message}))}}))]}}))}))},OO.prototype.createCompositeKey=function(t){return[this.appId,this.appName,this.namespace,t].join()},OO);function OO(t,e,n,r){void 0===r&&(r=new Promise((function(t,e){var n=indexedDB.open(kO,RO);n.onerror=function(t){e(AO(t,"storage-open"))},n.onsuccess=function(e){t(e.target.result)},n.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore(DO,{keyPath:"compositeKey"})}}}))),this.appId=t,this.appName=e,this.namespace=n,this.openDbPromise=r}var xO=(LO.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},LO.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},LO.prototype.getActiveConfig=function(){return this.activeConfig},LO.prototype.loadFromStorage=function(){return pa(this,void 0,void 0,(function(){var t,e,n,r,i,o;return fa(this,(function(a){switch(a.label){case 0:return t=this.storage.getLastFetchStatus(),e=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),[4,t];case 1:return(r=a.sent())&&(this.lastFetchStatus=r),[4,e];case 2:return(i=a.sent())&&(this.lastSuccessfulFetchTimestampMillis=i),[4,n];case 3:return(o=a.sent())&&(this.activeConfig=o),[2]}}))}))},LO.prototype.setLastFetchStatus=function(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)},LO.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)},LO.prototype.setActiveConfig=function(t){return this.activeConfig=t,this.storage.setActiveConfig(t)},LO);function LO(t){this.storage=t}var MO=(FO.prototype.fetch=function(t){return pa(this,void 0,void 0,(function(){var e;return fa(this,(function(n){switch(n.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return e=n.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(t,e)]}}))}))},FO.prototype.attemptFetch=function(t,e){var n=e.throttleEndTimeMillis,r=e.backoffCount;return pa(this,void 0,void 0,(function(){var e,i,o;return fa(this,(function(a){switch(a.label){case 0:return[4,function(t,e){return new Promise((function(n,r){var i=Math.max(e-Date.now(),0),o=setTimeout(n,i);t.addEventListener((function(){clearTimeout(o),r(mO.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(t.signal,n)];case 1:a.sent(),a.label=2;case 2:return a.trys.push([2,5,,7]),[4,this.client.fetch(t)];case 3:return e=a.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return a.sent(),[2,e];case 5:if(!function(t){if(!(t instanceof Oa))return!1;var e=Number(t.httpStatus);return 429===e||500===e||503===e||504===e}(i=a.sent()))throw i;return o={throttleEndTimeMillis:Date.now()+function(t){var e=1e3*Math.pow(2,t),n=Math.round(.5*e*(Math.random()-.5)*2);return Math.min(144e5,e+n)}(r),backoffCount:r+1},[4,this.storage.setThrottleMetadata(o)];case 6:return a.sent(),[2,this.attemptFetch(t,o)];case 7:return[2]}}))}))},FO);function FO(t,e){this.client=t,this.storage=e}var UO,qO="@firebase/remote-config";return(UO=Ps).INTERNAL.registerComponent(new ns("remoteConfig",(function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("installations").getImmediate();if("undefined"==typeof window)throw mO.create("registration-window");var i=n.options,o=i.projectId,a=i.apiKey,s=i.appId;if(!o)throw mO.create("registration-project-id");if(!a)throw mO.create("registration-api-key");if(!s)throw mO.create("registration-app-id");var u=new PO(s,n.name,e=e||"firebase"),c=new xO(u),h=new ys(qO);h.logLevel=ss.ERROR;var l=new _O(r,UO.SDK_VERSION,e,o,a,s),p=new MO(l,u),f=new yO(p,u,c,h),d=new IO(n,f,c,u,h);return d.ensureInitialized(),d}),"PUBLIC").setMultipleInstances(!0)),UO.registerVersion(qO,"0.1.11"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Ps.registerVersion("firebase","7.7.0","cdn"),Ps}));